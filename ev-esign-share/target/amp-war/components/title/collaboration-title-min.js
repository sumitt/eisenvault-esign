(function(){var d=YAHOO.util.Dom,i=YAHOO.util.Event,a=YAHOO.util.Selector;Alfresco.CollaborationTitle=function(l){Alfresco.CollaborationTitle.superclass.constructor.call(this,"Alfresco.CollaborationTitle",l);return this};YAHOO.extend(Alfresco.CollaborationTitle,Alfresco.component.Base,{options:{user:null,site:null,siteTitle:null,userIsMember:null,currentSiteVisibility:null,siteExists:false},onReady:function e(){if(!this.options.siteExists){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.site-does-not-exist-title",this.options.site),text:this.msg("message.site-does-not-exist"),buttons:[{text:this.msg("button.ok"),handler:function(){this.destroy()},isDefault:true}]})}else{if(this.options.userIsMember=="false"&&this.options.currentSiteVisibility!=="PUBLIC"){var l;switch(this.options.currentSiteVisibility){case"MODERATED":l=this.msg("message.moderated-site");break;default:l=this.msg("message.private-site");break}Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.title-site-permission",this.options.site),text:this.msg(l),buttons:[{text:this.msg("button.ok"),handler:function(){this.destroy()},isDefault:true}]})}}i.on(d.get(this.id+"-join-link"),"click",function(m){this.joinSite();i.stopEvent(m)},this,true);i.on(d.get(this.id+"-requestJoin-link"),"click",function(m){this.requestJoinSite();i.stopEvent(m)},this,true);i.on(d.get(this.id+"-become-manager-link"),"click",function(m){this.becomeSiteManager();i.stopEvent(m)},this,true);this.widgets.more=new YAHOO.widget.Button(this.id+"-more",{type:"menu",menu:this.id+"-more-menu"});if(this.widgets.more.getMenu()){this.widgets.more.getMenu().subscribe("click",function(o,n){var p=n[1];if(p){switch(p.value){case"editSite":Alfresco.module.getEditSiteInstance().show({shortName:this.options.site});break;case"customiseSite":window.location=Alfresco.constants.URL_PAGECONTEXT+"site/"+this.options.site+"/customise-site";break;case"leaveSite":var q=this;Alfresco.util.PopupManager.displayPrompt({title:q.msg("message.leave",q.options.siteTitle),text:q.msg("message.leave-site-prompt",q.options.siteTitle),buttons:[{text:q.msg("button.ok"),handler:function r(){q.leaveSite();this.destroy()}},{text:q.msg("button.cancel"),handler:function m(){this.destroy()},isDefault:true}]});break}}},this,true)}d.removeClass(a.query(".links",this.id,true),"hidden")},joinSite:function f(){Alfresco.util.Ajax.jsonPut({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/memberships",dataObj:{role:"SiteConsumer",person:{userName:this.options.user}},successCallback:{fn:function l(){window.location.reload()},scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.join-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.joining",this.options.user,this.options.siteTitle),spanClass:"wait",displayTime:0})},requestJoinSite:function b(){Alfresco.util.Ajax.jsonPost({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/invitations",dataObj:{invitationType:"MODERATED",inviteeUserName:this.options.user,inviteeComments:"",inviteeRoleName:"SiteConsumer"},successCallback:{fn:this._requestJoinSuccess,scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.request-join-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.request-joining",this.options.user,this.options.siteTitle),spanClass:"wait",displayTime:0})},becomeSiteManager:function g(){Alfresco.util.Ajax.jsonPut({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/memberships",method:"POST",dataObj:{role:"SiteManager",person:{userName:this.options.user}},successCallback:{fn:this._becomeSiteManagerSuccess,scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.become-manager-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.become-manager",this.options.siteTitle),spanClass:"wait",displayTime:0})},_becomeSiteManagerSuccess:function k(l){if(this.widgets.feedbackMessage){this.widgets.feedbackMessage.destroy();this.widgets.feedbackMessage=null}Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.success"),text:this.msg("message.become-manager-success"),buttons:[{text:this.msg("button.ok"),handler:function m(){this.destroy();window.location.reload(true)},isDefault:true}]})},_requestJoinSuccess:function j(l){if(this.widgets.feedbackMessage){this.widgets.feedbackMessage.destroy();this.widgets.feedbackMessage=null}Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.success"),text:this.msg("message.request-join-success",this.options.user,this.options.siteTitle),buttons:[{text:this.msg("button.ok"),handler:function m(){this.destroy();window.location=Alfresco.constants.URL_CONTEXT},isDefault:true}]})},leaveSite:function c(){Alfresco.util.Ajax.request({url:Alfresco.constants.PROXY_URI+"api/sites/"+encodeURIComponent(this.options.site)+"/memberships/"+encodeURIComponent(this.options.user),method:"DELETE",successCallback:{fn:function l(){window.location.href=Alfresco.constants.URL_CONTEXT},scope:this},failureCallback:{fn:this._failureCallback,obj:this.msg("message.leave-failure",this.options.user,this.options.siteTitle),scope:this}});this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:this.msg("message.leaving",this.options.user,this.options.siteTitle),spanClass:"wait",displayTime:0})},_failureCallback:function h(m,l){if(this.widgets.feedbackMessage){this.widgets.feedbackMessage.destroy();this.widgets.feedbackMessage=null}if(l){Alfresco.util.PopupManager.displayPrompt({title:this.msg("message.failure"),text:l})}}})})();