Alfresco.Share=Alfresco.Share||{};Alfresco.Share.postActivity=function(g,a,h,d,c,i){if(!YAHOO.lang.isString(g)||g.length===0||!YAHOO.lang.isString(a)||a.length===0||!YAHOO.lang.isString(h)||h.length===0||!YAHOO.lang.isObject(c)===null||!(YAHOO.lang.isString(c.nodeRef)||YAHOO.lang.isString(c.parentNodeRef))){if(i){i()}return}var b={method:"POST",url:Alfresco.constants.PROXY_URI+"slingshot/activity/create",dataObj:YAHOO.lang.merge({site:g,type:a,title:h,page:d},c),successCallback:{fn:function(){if(i){i()}},scope:this},failureCallback:{fn:function(){if(i){i()}},scope:this}};Alfresco.logger.debug("Alfresco.Share.postActivity: ",b.dataObj);try{Alfresco.util.Ajax.jsonRequest(b)}catch(f){}};(function(){var e=YAHOO.util.Dom;var a=Alfresco.util.encodeHTML,f=Alfresco.util.combinePaths;Alfresco.Location=function h(i){if(YAHOO.lang.isString(i)){i=e.get(i)}else{if(!i.getAttribute("id")){Alfresco.util.generateDomId(i)}}Alfresco.Location.superclass.constructor.call(this,"Alfresco.Location",i.getAttribute("id"),["json"]);this.widgets.spanEl=i;return this};YAHOO.extend(Alfresco.Location,Alfresco.component.Base,{options:{rootNode:null,siteId:""},_locations:null,onReady:function g(){},displayByNodeRef:function d(j){if(YAHOO.lang.isString(j)){j=Alfresco.util.NodeRef(j)}if(j){var i=Alfresco.constants.PROXY_URI+"slingshot/doclib/node/"+j.uri+"/location";if(this.options.siteId===""&&this.options.rootNode){i+="?libraryRoot="+encodeURIComponent(this.options.rootNode.toString())}Alfresco.util.Ajax.jsonGet({url:i,successCallback:{fn:function(l){if(l.json!==undefined){var k=l.json;this._locations=k;if(k.site){this.displayByPath(f(k.site.path,k.site.file),k.site.site,k.site.siteTitle)}else{this.displayByPath(f(k.repo.path,k.repo.file))}YAHOO.Bubbling.fire("itemLocationLoaded",{eventGroup:this,locations:k})}},scope:this},failureCallback:{fn:function(k){if(this.widgets.spanEl){this.widgets.spanEl.innerHTML='<span class="location error">'+this.msg("message.failure")+"</span>"}},scope:this}})}else{this.widgets.spanEl.innerHTML='<span class="location-none">'+this.msg("location.label.none")+"</span>"}},displayByPath:function c(i,k,j){this._locations=null;if(this.widgets.spanEl){this.widgets.spanEl.innerHTML=this.generateHTML(i,k,j)}},generateHTML:function b(k,p,m){var l=k.lastIndexOf("/"),o=l>=0?k.substring(0,l+1):"",j=l>=0?k.substring(l+1):k;if(p){if(Alfresco.util.arrayContains(["/",""],j+o)){k=this.msg("location.path.documents");j=this.msg("location.path.documents")}else{k=this.msg("location.path.documents")+k;j=".../"+j}}else{if(Alfresco.util.arrayContains(["/",""],j+o)){k=this.msg("location.path.repository");j=this.msg("location.path.repository")}else{k=this.msg("location.path.repository")+k;j=".../"+j}}var n='<span class="location-path" title="'+this.msg("location.tooltip.path",k)+'">'+a(j)+"</span>";if(p){if(p&&p!=this.options.siteId){var q='<span class="location-site" title="'+this.msg("location.tooltip.site",m?m:p)+'">'+a(m?m:p)+"</span>";return this.msg("location.label.site",n,q)}else{return this.msg("location.label.local",n)}}else{return this.msg("location.label.repository",n)}}})})();(function(){var e=YAHOO.util.Dom,b=YAHOO.util.Selector;var a=Alfresco.util.encodeHTML,g=Alfresco.util.combinePaths;Alfresco.Like=function h(i){if(YAHOO.lang.isString(i)){i=e.get(i)}else{if(!i.getAttribute("id")){Alfresco.util.generateDomId(i)}}YAHOO.util.Dom.addClass(i,"item-social");Alfresco.Like.superclass.constructor.call(this,"Alfresco.Like",i.getAttribute("id"),["json"]);this.widgets.spanEl=i;this.services.likes=new Alfresco.service.Ratings(Alfresco.service.Ratings.LIKES);return this};YAHOO.extend(Alfresco.Like,Alfresco.component.Base,{options:{nodeRef:null,siteId:null,displayName:null,type:"document",activity:{folder:{type:"org.alfresco.documentlibrary.folder-liked",page:"folder-details?nodeRef={nodeRef}"},document:{type:"org.alfresco.documentlibrary.file-liked",page:"document-details?nodeRef={nodeRef}"}}},isLiked:false,totalLikes:0,loadAndDisplay:function c(){throw new Error("Not implemented yet, load data manually and use display(isLiked, totalLikes) instead.")},display:function d(j,i){this.isLiked=j||false;this.totalLikes=i||0;this.render()},render:function f(){var i="";if(this.isLiked){i='<a href="#" class="like-action theme-color-1 enabled '+(this.isLiked?"like-action-liked":"")+'" title="'+this.msg("like."+this.options.type+".remove.tip")+'"></a>'}else{i='<a href="#" class="like-action theme-color-1" title="'+this.msg("like."+this.options.type+".add.tip")+'">'+this.msg("like."+this.options.type+".add.label")+"</a>"}i+='<span class="likes-count">'+a(this.totalLikes)+"</span>";this.widgets.spanEl.innerHTML=i;Alfresco.util.useAsButton(b.query("a",this.widgets.spanEl,true),function(k){var j=e.hasClass(b.query("a",this.widgets.spanEl,true),"like-action-liked");this.like(!j);YAHOO.util.Event.preventDefault(k)},null,this)},like:function(m){var l={isLiked:this.isLiked,totalLikes:this.totalLikes};this.isLiked=m=="true"||(YAHOO.lang.isBoolean(m)&&m);this.totalLikes=this.totalLikes+(this.isLiked?1:-1);var j={successCallback:{fn:function i(n){var p=n.json.data;if(p){this.totalLikes=p.ratingsCount;if(this.isLiked){var q=this.options.activity[this.options.type];if(q){var o=YAHOO.lang.substitute(q.page,{nodeRef:this.options.nodeRef});Alfresco.Share.postActivity(this.options.siteId,q.type,this.options.displayName,o,{nodeRef:this.options.nodeRef,fileName:this.options.displayName})}}}},scope:this},failureCallback:{fn:function k(n){this.isLiked=l.isLiked;this.totalLikes=l.totalLikes;this.render();Alfresco.util.PopupManager.displayPrompt({text:this.msg("like.message.failure")})},scope:this}};if(this.isLiked){this.services.likes.set(new Alfresco.util.NodeRef(this.options.nodeRef),1,j)}else{this.services.likes.remove(new Alfresco.util.NodeRef(this.options.nodeRef),j)}this.render()}})})();(function(){var e=YAHOO.util.Dom,c=YAHOO.util.Selector;var b=Alfresco.util.encodeHTML,g=Alfresco.util.combinePaths;Alfresco.Favourite=function h(i){if(YAHOO.lang.isString(i)){i=e.get(i)}else{if(!i.getAttribute("id")){Alfresco.util.generateDomId(i)}}YAHOO.util.Dom.addClass(i,"item-social");Alfresco.Favourite.superclass.constructor.call(this,"Alfresco.Favourite",i.getAttribute("id"),["json"]);this.widgets.spanEl=i;this.services.preferences=new Alfresco.service.Preferences();return this};YAHOO.extend(Alfresco.Favourite,Alfresco.component.Base,{options:{nodeRef:null,type:"document",preference:{folder:{key:Alfresco.service.Preferences.FAVOURITE_FOLDERS},document:{key:Alfresco.service.Preferences.FAVOURITE_DOCUMENTS}}},isFavourite:false,loadAndDisplay:function d(){throw new Error("Not implemented yet, load data manually and use display(isFavourite) instead.")},display:function f(i){this.isFavourite=i||false;this.render()},render:function a(){var i="";if(this.isFavourite){i='<a href="#" class="favourite-action theme-color-1 favourite-'+this.options.type+' enabled favourite-action-favourite" title="'+this.msg("favourite."+this.options.type+".remove.tip")+'"></a>'}else{i='<a href="#" class="favourite-action theme-color-1 favourite-'+this.options.type+'" title="'+this.msg("favourite."+this.options.type+".add.tip")+'">'+this.msg("favourite."+this.options.type+".add.label")+"</a>"}this.widgets.spanEl.innerHTML=i;Alfresco.util.useAsButton(c.query("a",this.widgets.spanEl,true),function(k){var j=e.hasClass(c.query("a",this.widgets.spanEl,true),"favourite-action-favourite");this.favourite(!j);YAHOO.util.Event.preventDefault(k)},null,this)},favourite:function(k){var m={isFavourite:this.isFavourite};this.isFavourite=k=="true"||(YAHOO.lang.isBoolean(k)&&k);var i={failureCallback:{fn:function n(o){this.isFavourite=m.isFavourite;this.render();Alfresco.util.PopupManager.displayPrompt({text:this.msg("favourite.message.failure")})},scope:this}};var j=this.options.preference[this.options.type];if(j){var l=this.isFavourite?"add":"remove";this.services.preferences[l].call(this.services.preferences,j.key,this.options.nodeRef,i)}else{throw new Error("No prefence has been given for type '"+this-options.type+"'.")}this.render()}})})();(function(){var e=YAHOO.util.Dom,c=YAHOO.util.Selector;var a=Alfresco.util.encodeHTML,f=Alfresco.util.combinePaths;Alfresco.QuickShare=function b(g){var h;if(g){if(YAHOO.lang.isString(g)){h=g;g=e.get(g)}else{if(!g.getAttribute("id")){h=Alfresco.util.generateDomId(g)}}YAHOO.util.Dom.addClass(g,"item-social")}else{h=Alfresco.util.generateDomId()}Alfresco.QuickShare.superclass.constructor.call(this,"Alfresco.QuickShare",h,["json"]);if(g){this.widgets.spanEl=g}this._sharedId=null;this._sharedBy=null;this._menuWasAlreadyOpened=false;this._initialDisplay=true;return this};YAHOO.extend(Alfresco.QuickShare,Alfresco.component.Base,{options:{nodeRef:null,displayName:null},_sharedId:null,_sharedBy:null,_menuWasAlreadyOpened:false,_initialDisplay:true,display:function(i,g){this._sharedId=i;this._sharedBy=g;var k=this._render(),h='<span id="'+this.id+'" class="item-social">'+k+"</span>";if(this.widgets.spanEl&&this._initialDisplay){this.widgets.spanEl.innerHTML=k}else{if(this.widgets.spanEl){var j="quickshare.document.";if(this._sharedId){this.widgets.action.setAttribute("title",this.msg(j+"shared.tip",this._sharedBy.displayName));this.widgets.action.innerHTML=this.msg(j+"shared.label");e.addClass(this.widgets.action,"enabled");e.addClass(this.widgets.indicator,"enabled")}else{this.widgets.action.setAttribute("title",this.msg(j+"share.tip"));this.widgets.action.innerHTML=this.msg(j+"share.label");e.removeClass(this.widgets.action,"enabled");e.removeClass(this.widgets.indicator,"enabled")}}}this._initialDisplay=false;return h},_render:function d(){var l="quickshare.document.",k=this.msg(l+"share.tip"),i=this.msg(l+"share.label"),h="quickshare-action",g="quickshare-indicator";if(this._sharedId){k=this.msg(l+"shared.tip",this._sharedBy.displayName);i=this.msg(l+"shared.label");h+=" enabled";g+=" enabled"}var j='<a href="#" class="'+h+'" title="'+k+'">'+i+"</a>";j+='<span class="'+g+'">&nbsp;</span>';return j},onReady:function(){this.widgets.spanEl=e.get(this.id);this.services.quickshare=new Alfresco.service.QuickShare();this.widgets.action=c.query("a.quickshare-action",this.widgets.spanEl,true);Alfresco.util.useAsButton(this.widgets.action,function(g){if(!this._sharedId){this.services.quickshare.share(this.options.nodeRef,{successCallback:{fn:function(h){var i=h.json;this.display(i.sharedId,Alfresco.constants.USERNAME);this.showMenu()},scope:this},failureMessage:this.msg("quickshare.document.share.failure")})}else{if(this._menuWasAlreadyOpened){this._menuWasAlreadyOpened=false}else{this.showMenu()}}YAHOO.util.Event.preventDefault(g)},null,this);YAHOO.util.Event.addListener(this.widgets.action,"mousedown",function(){this._menuWasAlreadyOpened=this.widgets.overlay&&this.widgets.overlay.cfg.getProperty("visible")},null,this);this.widgets.indicator=c.query("span.quickshare-indicator",this.widgets.spanEl,true)},showMenu:function(){if(!this.widgets.overlay){var i=document.createElement("div");e.addClass(i,"yuimenu");e.addClass(i,"quickshare-action-menu");var h='<div class="bd">  <span class="section">     <label for="'+this.id+'-input">'+this.msg("quickshare.link.label")+':</label> <input id="'+this.id+'-input" type="text" tabindex="0"/>     <a href="#" class="quickshare-action-view">'+this.msg("quickshare.view.label")+'</a>     <a href="#" class="quickshare-action-unshare">'+this.msg("quickshare.unshare.label")+"</a>  </span>";if(Alfresco.constants.LINKSHARE_ACTIONS){h+='  <span class="section">     <label>'+this.msg("quickshare.linkshare.label")+':</label> <span class="quickshare-linkshare"></span>  </span>'}h+="</div>";i.innerHTML=h;this.widgets.overlay=Alfresco.util.createYUIOverlay(i,{context:[this.widgets.action,"tl","bl",["beforeShow","windowResize"]],effect:{effect:YAHOO.widget.ContainerEffect.FADE,duration:0.1},visible:false},{type:YAHOO.widget.Menu});this.widgets.overlay.render(e.get("doc3"));this.widgets.unshare=c.query("a.quickshare-action-unshare",i,true);Alfresco.util.useAsButton(this.widgets.unshare,function(j){YAHOO.util.Event.stopEvent(j);this.services.quickshare.unshare(this._sharedId,{successCallback:{fn:function(k){this.display();this.widgets.overlay.hide()},scope:this},failureCallback:{fn:function(k){if(k.json.status.code==403){Alfresco.util.PopupManager.displayPrompt({text:this.msg("quickshare.document.unshare.user.failure")})}else{Alfresco.util.PopupManager.displayPrompt({text:this.msg("quickshare.document.unshare.failure")})}},scope:this}})},null,this);this.widgets.link=c.query("input",i,true);this.widgets.view=c.query("a.quickshare-action-view",i,true);this.widgets.linkshare=c.query(".quickshare-linkshare",i,true);YAHOO.util.Event.addListener(this.widgets.link,"focus",this.widgets.link.select,null,this.widgets.link);YAHOO.util.Event.addListener(this.widgets.link,"mouseover",this.widgets.link.select,null,this.widgets.link);YAHOO.util.Event.addListener(this.widgets.link,"click",this.widgets.link.select,null,this.widgets.link);YAHOO.util.Event.addListener(this.widgets.link,"keydown",this.widgets.link.select,null,this.widgets.link);YAHOO.util.Event.addListener(this.widgets.link,"keyup",this.widgets.link.select,null,this.widgets.link);Alfresco.util.createBalloon(this.widgets.link,{text:this.msg("quickshare.link.tooltip"+(YAHOO.env.ua.os=="macintosh"?".mac":""))},"mouseover","mouseout");this.widgets.overlay.showEvent.subscribe(function(k,j){this.widgets.link.focus()},this,true)}var g=YAHOO.lang.substitute(Alfresco.constants.QUICKSHARE_URL,{sharedId:this._sharedId});if(g.indexOf("/")==0){g=window.location.protocol+"//"+window.location.host+g}this.widgets.link.value=g;this.widgets.view.setAttribute("href",g);if(this.widgets.linkshare){this.widgets.linkshare.innerHTML=new Alfresco.LinkShare().setOptions({shareUrl:g,displayName:this.options.displayName}).display()}this.widgets.overlay.show()}})})();(function(){var d=YAHOO.util.Dom,b=YAHOO.util.Selector;var a=Alfresco.util.encodeHTML,f=Alfresco.util.combinePaths;Alfresco.LinkShare=function e(g){var h;if(g){if(YAHOO.lang.isString(g)){h=g;g=d.get(g)}else{if(!g.getAttribute("id")){h=Alfresco.util.generateDomId(g)}}YAHOO.util.Dom.addClass(g,"item-social")}else{h=Alfresco.util.generateDomId()}Alfresco.LinkShare.superclass.constructor.call(this,"Alfresco.LinkShare",h);if(g){this.widgets.spanEl=g}return this};YAHOO.extend(Alfresco.LinkShare,Alfresco.component.Base,{options:{actions:null,shareUrl:null,displayName:null},display:function(){var h=this._render(),g='<span id="'+this.id+'" class="linkshare item-social">'+h+"</span>";if(this.widgets.spanEl){this.widgets.spanEl.innerHTML=h}return g},_render:function c(){var k=this.options.actions||Alfresco.constants.LINKSHARE_ACTIONS||[],h="",j;k.sort(this.sortActions);for(var g=0;g<k.length;g++){j=k[g];j.type=j.type||"link";if(YAHOO.lang.isObject(!this.actionTypes[j.type])){throw new Error("action with id '"+j.id+"' is using an unknown action type: '"+j.type+"'")}if(YAHOO.lang.isFunction(this.actionTypes[j.type].render)){h+='<span class="linkshare-action">';h+=this.actionTypes[j.type].render.call(this,j);h+="</span>"}}return h},sortActions:function(h,g){return(h.index>g.index)?1:(h.index<g.index)?-1:0},actionTypes:{link:{render:function(l){var k="linkshare.action."+l.id+".",i=document.createElement("span"),j=document.createElement("a");var h=this._getLabel(l),g=this._resolveParamValue(l,"href",encodeURIComponent),m=this._resolveParamValue(l,"target");d.addClass(j,"linkshare-action-"+l.id);j.setAttribute("title",h);j.setAttribute("href",g);if(m){j.setAttribute("target",m)}j.innerHTML="&nbsp;";i.appendChild(j);return i.innerHTML}}},_getLabel:function(g){return this.msg(g.label||("linkshare.action."+g.id+".label"),this.options.shareUrl,this.options.displayName)},_resolveParamValue:function(k,j,h){var i=k.params[j];if(i){var g=k;return YAHOO.lang.substitute(i,{},this.bind(function(l){var m="";if(this.options[l]){m=this.options[l]}else{m=this.msg("linkshare.action."+g.id+"."+l,this.options.shareUrl,this.options.displayName)}return h(m)}))}return i}})})();(function(){var c=YAHOO.util.Dom;Alfresco.widget.Resizer=function f(h){Alfresco.util.YUILoaderHelper.require(["resize"],this.onComponentsLoaded,this);this.name=h;this.widgets={};return this};Alfresco.widget.Resizer.prototype={MIN_FILTER_PANEL_HEIGHT:200,MIN_FILTER_PANEL_WIDTH:140,DEFAULT_FILTER_PANEL_WIDTH:160,MAX_FILTER_PANEL_WIDTH:500,widgets:null,options:{divLeft:"alf-filters",divRight:"alf-content",documentHeight:-1,initialWidth:null},onComponentsLoaded:function e(){YAHOO.util.Event.onDOMReady(this.onReady,this,true)},onReady:function a(){this.widgets.horizResize=new YAHOO.util.Resize(this.options.divLeft,{handles:["r"],minWidth:this.MIN_FILTER_PANEL_WIDTH,maxWidth:this.MAX_FILTER_PANEL_WIDTH});this.widgets.horizResize.on("beforeResize",function(i){this.onResize(i.width)},this,true);this.widgets.horizResize.on("endResize",function(i){this.onResize(i.width)},this,true);YAHOO.util.Event.on(window,"resize",function(i){this.onResize()},this,true);this.options.documentHeight=c.getXY("alf-ft")[1];YAHOO.lang.later(1000,this,function(){var i=c.getXY("alf-ft")[1];if(Math.abs(this.options.documentHeight-i)>4){this.options.documentHeight=i;this.onResize()}},null,true);var h=(this.options.initialWidth?this.options.initialWidth:this.DEFAULT_FILTER_PANEL_WIDTH);if(YAHOO.env.ua.ie>0){this.widgets.horizResize.resize(null,this.widgets.horizResize.get("element").offsetHeight,h,0,0,true)}else{this.widgets.horizResize.resize(null,this.widgets.horizResize.get("height"),h,0,0,true)}this.onResize(h)},onResize:function g(m){var q=c.get(this.options.divLeft).childNodes,n=q[q.length-1];c.setStyle(this.options.divLeft,"height","auto");c.setStyle(n,"height","");var l=c.getXY("alf-ft")[1]-c.getXY("alf-hd")[1]-c.get("alf-hd").offsetHeight;if(YAHOO.env.ua.ie===6){var p=c.get("alf-hd"),o=0;for(var k=0,j=p.childNodes.length;k<j;k++){o+=p.childNodes[k].offsetHeight}l=c.get("alf-ft").parentNode.offsetTop-o}if(l<this.MIN_FILTER_PANEL_HEIGHT){l=this.MIN_FILTER_PANEL_HEIGHT}c.setStyle(n,"height",l+"px");if(m!==undefined){c.setStyle(this.options.divRight,"margin-left",8+m+"px")}YAHOO.Bubbling.fire("resizerChanged",{width:m});this.onResizeNotification()},onResizeNotification:function b(){},setOptions:function d(h){this.options=YAHOO.lang.merge(this.options,h);return this}}})();var DASHLET_TITLE_BAR_ACTIONS_OPACITY=0,OPACITY_FADE_SPEED=0.2;(function(){var d=YAHOO.util.Dom,b=YAHOO.util.Event,a=YAHOO.util.Selector;Alfresco.widget.DashletTitleBarActions=function g(h){return Alfresco.widget.DashletTitleBarActions.superclass.constructor.call(this,"Alfresco.widget.DashletTitleBarActions",h,["selector"])};YAHOO.extend(Alfresco.widget.DashletTitleBarActions,Alfresco.component.Base,{dashlet:null,dashletTitle:null,dashletBody:null,actionsNode:null,onReady:function f(){this.dashlet=a.query("div.dashlet",d.get(this.id),true);this.dashletTitle=a.query("div.title",this.dashlet,true);this.dashletBody=a.query("div.body",this.dashlet,true);if(this.dashlet&&this.dashletTitle&&this.dashletBody){this.actionsNode=document.createElement("div");d.addClass(this.actionsNode,"titleBarActions");if(YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<9){d.setStyle(this.actionsNode,"display","none")}else{d.setStyle(this.actionsNode,"opacity",DASHLET_TITLE_BAR_ACTIONS_OPACITY)}this.dashlet.insertBefore(this.actionsNode,this.dashletBody);this.options.actions.reverse();for(var k=0;k<this.options.actions.length;k++){var h=this.options.actions[k];if(h.cssClass&&(h.eventOnClick||h.linkOnClick||h.targetOnClick||h.bubbleOnClick)){var l=document.createElement("div");if(h.tooltip){d.setAttribute(l,"title",h.tooltip)}d.addClass(l,"titleBarActionIcon");d.addClass(l,h.cssClass);this.actionsNode.appendChild(l);if(h.id){l.id=this.id+h.id}var o=this;if(h.eventOnClick){var m=(function(p){var i=h.eventOnClick;return function(q){if(q.type=="click"||(q.type=="keydown"&&q.keyCode==13)){o._fadeOut(q,o);i.fire({event:q,scope:o})}}});b.addListener(l,"click",m());b.addListener(l,"keydown",m())}else{if(h.linkOnClick){b.addListener(l,"click",(function(){var i=h.linkOnClick;return function(){window.location=i}})())}else{if(h.targetOnClick){b.addListener(l,"click",(function(){var i=h.targetOnClick;return function(){window.open(i)}})())}else{if(h.bubbleOnClick){var n=Alfresco.util.createBalloon(this.id,{html:h.bubbleOnClick.message,width:"30em"});d.setAttribute(n.content,"role","alert");var j=(function(i){return function(p){if(p.type=="click"||(p.type=="keydown"&&p.keyCode==13)){n.show()}}});b.addListener(l,"click",j(),n,true);b.addListener(l,"keydown",j(),n,true)}}}}}else{Alfresco.logger.warn("DashletTitleBarActions_onReady: Action is not valid.")}d.setAttribute(l,"tabindex",0);b.addListener(l,"focus",this._fadeIn,this);b.addListener(l,"blur",this._fadeOut,this)}b.addListener(this.dashlet,"mouseover",this._fadeIn,this);b.addListener(this.dashlet,"mouseout",this._fadeOut,this)}else{}},_fadeOut:function c(i,h){if(YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<9){h.actionsNode.style.display="none"}else{if(!d.isAncestor(h.dashlet,b.getRelatedTarget(i))||i.type=="blur"){var j=new YAHOO.util.Anim(h.actionsNode,{opacity:{to:DASHLET_TITLE_BAR_ACTIONS_OPACITY}},OPACITY_FADE_SPEED);j.animate()}}},_fadeIn:function e(i,h){if(YAHOO.env.ua.ie>0&&YAHOO.env.ua.ie<9){h.actionsNode.style.display="block"}else{var j=new YAHOO.util.Anim(h.actionsNode,{opacity:{to:1}},OPACITY_FADE_SPEED);j.animate()}}})})();(function(){var c=YAHOO.util.Dom,h=YAHOO.util.Event,a=YAHOO.util.Selector;Alfresco.widget.DashletResizer=function i(k,j){this.name="Alfresco.widget.DashletResizer";this.id=k;this.dashletId=j;Alfresco.util.YUILoaderHelper.require(["resize","selector"],this.onComponentsLoaded,this);this.widgets={};return this};Alfresco.widget.DashletResizer.prototype={options:{dashletHeight:-1,minDashletHeight:120,maxDashletHeight:1200},dashletId:"",widgets:null,dashlet:null,dashletBody:null,heightDelta:0,setOptions:function f(j){this.options=YAHOO.lang.merge(this.options,j);return this},onComponentsLoaded:function b(){h.onDOMReady(this.onReady,this,true)},onReady:function d(){if(!Alfresco.constants.DASHLET_RESIZE){return}this.dashlet=a.query("div.dashlet",c.get(this.id),true);if(!this.dashlet){return}c.addClass(this.dashlet,"resizable");this.dashletBody=a.query("div.body",this.dashlet,true);if(!this.dashletBody){return}var j=c.getStyle(this.dashlet,"height");if(j=="auto"){j=this.dashlet.offsetHeight-parseInt(c.getStyle(this.dashlet,"padding-bottom"),10)}else{j=parseInt(j,10)}this.heightDelta=j-parseInt(c.getStyle(this.dashletBody,"height"),10);this.widgets.resizer=new YAHOO.util.Resize(this.dashlet,{handles:["b"],minHeight:this.options.minDashletHeight,maxHeight:this.options.maxDashletHeight});this.widgets.resizer.on("resize",function(){this.onResize()},this,true);this.widgets.resizer.on("endResize",function(k){this.onEndResize(k.height)},this,true);c.setStyle(this.dashlet,"width","")},_hiddenOnResize:null,onResize:function e(){this.dashletTitle=a.query("div.title",this.dashlet,true);var l=parseInt(c.getStyle(this.dashletTitle,"padding-bottom"),10)+parseInt(c.getStyle(this.dashletTitle,"padding-bottom"),10);var m=parseInt(this.dashletTitle.offsetHeight,10)-parseInt(this.dashletTitle.clientHeight,10);var p=YUISelector.query("div.toolbar",this.dashlet);var q=0;for(n=0;n<p.length;n++){q+=parseInt(p[n].clientHeight,10);m+=parseInt(p[n].offsetHeight,10)-parseInt(p[n].clientHeight,10)}this.heightDelta=q+m+parseInt(this.dashletTitle.clientHeight,10)+l;var k=parseInt(c.getStyle(this.dashlet,"height"),10)-this.heightDelta;this._hiddenOnResize=[];var o=this.dashletBody.getElementsByTagName("iframe");for(var n=0;n<o.length;n++){var j=c.getStyle(o[n],"visibility");if(j="visible"){this._hiddenOnResize.push(o[n]);c.setStyle(o[n],"visibility","hidden")}}c.setStyle(this.dashletBody,"height",k+"px");c.setStyle(this.dashletBody.getElementsByTagName("iframe"),"height",k+"px")},onEndResize:function g(l){c.setStyle(this.dashlet,"width","");for(var k=0;k<this._hiddenOnResize.length;k++){c.setStyle(this._hiddenOnResize[k],"visibility","visible")}this._hiddenOnResize={};var j=parseInt(c.getStyle(this.dashlet,"height"),10)-this.heightDelta;Alfresco.util.Ajax.jsonRequest({method:"POST",url:Alfresco.constants.URL_SERVICECONTEXT+"modules/dashlet/config/"+this.dashletId,dataObj:{height:j},successCallback:function(){},successMessage:null,failureCallback:function(){},failureMessage:null});YAHOO.Bubbling.fire("dashletResizeEnd",{eventGroup:this.dashletId,dashletId:this.dashletId,htmlId:this.id,height:j,heightDelta:this.heightDelta})}}})();(function(){Alfresco.component.ShareFormManager=function d(e){Alfresco.component.ShareFormManager.superclass.constructor.call(this,e);this.name="Alfresco.component.ShareFormManager";Alfresco.util.ComponentManager.reregister(this);this.options=YAHOO.lang.merge(this.options,Alfresco.component.ShareFormManager.superclass.options);return this};YAHOO.extend(Alfresco.component.ShareFormManager,Alfresco.component.FormManager,{pageUsesAjaxState:function a(e){return(e.match(/documentlibrary([?]|$)/)||e.match(/repository([?]|$)/))},isCromeRedirectToTheSamePage:function b(e){var g=window.chrome,f=window.navigator.vendor;if(g!==null&&f==="Google Inc."){return e==document.location.href}else{return false}},getSiteDefaultUrl:function c(){return Alfresco.util.uriTemplate("userdashboardpage",{userid:encodeURIComponent(Alfresco.constants.USERNAME)})}})})();Alfresco.Share.userAvatar=function(b,a){var c=Alfresco.constants.URL_CONTEXT+"res/components/images/no-user-photo-64.png";if(b){c=Alfresco.constants.PROXY_URI+"slingshot/profile/avatar/"+encodeURIComponent(b);if(a===32){c+="/thumbnail/avatar32"}}return'<img src="'+c+'" alt="'+Alfresco.util.message("label.avatar")+'"/>'};(function(){var b=YAHOO.util.Dom,s=YAHOO.util.Event;var n=Alfresco.util.encodeHTML,o=Alfresco.util.activateLinks,e=Alfresco.util.userProfileLink,h=Alfresco.util.siteDashboardLink,d=Alfresco.util.relativeTime;Alfresco.component.SimpleDocList=function c(t){Alfresco.component.SimpleDocList.superclass.constructor.call(this,"Alfresco.component.SimpleDocList",t,["button","container","datasource","datatable","animation"]);this.FAVOURITE_EVENTCLASS=Alfresco.util.generateDomId(null,"favourite");this.LIKE_EVENTCLASS=Alfresco.util.generateDomId(null,"like");this.previewTooltips=[];this.metadataTooltips=[];this.services.preferences=new Alfresco.service.Preferences();this.services.likes=new Alfresco.service.Ratings(Alfresco.service.Ratings.LIKES);return this};Alfresco.component.SimpleDocList.generateFavourite=function m(v,t){var w="favourite."+(t.getData("isFolder")?"folder.":"document."),u="";if(t.getData("isFavourite")){u='<a class="favourite-action '+v.FAVOURITE_EVENTCLASS+' enabled" title="'+v.msg(w+"remove.tip")+'" tabindex="0"></a>'}else{u='<a class="favourite-action '+v.FAVOURITE_EVENTCLASS+'" title="'+v.msg(w+"add.tip")+'" tabindex="0">'+v.msg(w+"add.label")+"</a>"}return u};Alfresco.component.SimpleDocList.generateLikes=function p(w,t){var u=t.getData("likes"),x="like."+(t.getData("isFolder")?"folder.":"document."),v="";if(!u){u={isLiked:false,totalLikes:0}}if(u.isLiked){v='<a class="like-action '+w.LIKE_EVENTCLASS+' enabled" title="'+w.msg(x+"remove.tip")+'" tabindex="0"></a>'}else{v='<a class="like-action '+w.LIKE_EVENTCLASS+'" title="'+w.msg(x+"add.tip")+'" tabindex="0">'+w.msg(x+"add.label")+"</a>"}v+='<span class="likes-count">'+n(u.totalLikes)+"</span>";return v};Alfresco.component.SimpleDocList.generateComments=function g(w,t){var v=t.getData(),u=Alfresco.constants.URL_PAGECONTEXT+"site/"+v.location.site+"/"+(v.isFolder?"folder":"document")+"-details?nodeRef="+v.nodeRef+"#comment",x="comment."+(v.isFolder?"folder.":"document.");return'<a href="'+u+'" class="comment" title="'+w.msg(x+"tip")+'" tabindex="0">'+w.msg(x+"label")+"</a>"};YAHOO.extend(Alfresco.component.SimpleDocList,Alfresco.component.Base,{options:{showFileSize:true},previewTooltips:null,metadataTooltips:null,onReady:function k(){var y=this;this.widgets.previewTooltip=new YAHOO.widget.Tooltip(this.id+"-previewTooltip",{width:"108px"});this.widgets.previewTooltip.contextTriggerEvent.subscribe(function(E,C){var D=C[0],B=y.widgets.alfrescoDataTable.getData(D.id),F=Alfresco.constants.PROXY_URI+"api/node/"+B.nodeRef.replace(":/","")+"/content/thumbnails/doclib?c=queue&ph=true";this.cfg.setProperty("text",'<img src="'+F+'" />')});this.widgets.metadataTooltip=new YAHOO.widget.Tooltip(this.id+"-metadataTooltip");this.widgets.metadataTooltip.contextTriggerEvent.subscribe(function(F,D){var E=D[0],C=y.widgets.alfrescoDataTable.getData(E.id),B=C.location;var G="<em>"+y.msg("label.site")+":</em> "+n(B.siteTitle)+"<br />";G+="<em>"+y.msg("label.path")+":</em> "+n(B.path);this.cfg.setProperty("text",G)});this.widgets.alfrescoDataTable=new Alfresco.util.DataTable({dataSource:{url:this.getWebscriptUrl(),initialParameters:this.getParameters(),config:{responseSchema:{resultsList:"items"}}},dataTable:{container:this.id+"-documents",columnDefinitions:[{key:"thumbnail",sortable:false,formatter:this.bind(this.renderCellThumbnail),width:16},{key:"detail",sortable:false,formatter:this.bind(this.renderCellDetail)}],config:{className:"alfresco-datatable simple-doclist",renderLoopSize:4}}});var y=this,z=this.widgets.alfrescoDataTable.getDataTable(),x=z.doBeforeLoadData;z.doBeforeLoadData=function v(B,C,D){if(C.results&&C.results.length===0){C.results.unshift({isInfo:true,title:y.msg("empty.title"),description:y.msg("empty.description")})}return x.apply(this,arguments)};z.subscribe("renderEvent",function(){this.widgets.previewTooltip.cfg.setProperty("context",this.previewTooltips);this.widgets.metadataTooltip.cfg.setProperty("context",this.metadataTooltips)},this,true);var A=function u(D,C){var B=YAHOO.Bubbling.getOwnerByTagName(C[1].anchor,"div");if(B!==null){y.onFavourite.call(y,C[1].target.offsetParent,B)}return true};YAHOO.Bubbling.addDefaultAction(this.FAVOURITE_EVENTCLASS,A);var t=function w(D,C){var B=YAHOO.Bubbling.getOwnerByTagName(C[1].anchor,"div");if(B!==null){y.onLikes.call(y,C[1].target.offsetParent,B)}return true};YAHOO.Bubbling.addDefaultAction(this.LIKE_EVENTCLASS,t)},getWebscriptUrl:function a(){return Alfresco.constants.PROXY_URI+"slingshot/doclib/doclist/documents/node/alfresco/sites/home?max=50"},getParameters:function l(){return""},reloadDataTable:function q(){this.previewTooltips=[];this.metadataTooltips=[];this.widgets.alfrescoDataTable.loadDataTable(this.getParameters())},renderCellThumbnail:function r(E,G,A,w){var x=40,y=G.getData(),z="";if(y.isInfo){x=52;z='<img src="'+Alfresco.constants.URL_RESCONTEXT+'components/images/help-docs-bw-32.png" />'}else{var u=y.fileName,B=u.substring(u.lastIndexOf(".")),C=y.location,D=new Alfresco.util.NodeRef(y.nodeRef),F=Alfresco.constants.URL_PAGECONTEXT+(C.site?"site/"+C.site+"/":"")+"document-details?nodeRef="+D.toString();if(this.options.simpleView){var v=this.id+"-preview-"+G.getId();z='<span id="'+v+'" class="icon32"><a href="'+F+'"><img src="'+Alfresco.constants.URL_RESCONTEXT+"components/images/filetypes/"+Alfresco.util.getFileIcon(u)+'" alt="'+B+'" title="'+n(u)+'" /></a></span>';this.previewTooltips.push(v)}else{x=100;var t=Alfresco.constants.PROXY_URI+"api/node/"+D.uri+"/content/thumbnails/doclib?c=queue&ph=true";if(y.lastThumbnailModification){t=t+"&lastModified="+y.lastThumbnailModification}z='<span class="thumbnail"><a href="'+F+'"><img src="'+t+'" alt="'+B+'" title="'+n(u)+'" /></a></span>'}}A.width=x;b.setStyle(E,"width",A.width+"px");b.setStyle(E.parentNode,"width",A.width+"px");E.innerHTML=z},renderCellDetail:function j(E,I,z,v){var x=I.getData(),y="";if(x.isInfo){y+='<div class="empty"><h3>'+x.title+"</h3>";y+="<span>"+x.description+"</span></div>"}else{var w=this.id+"-metadata-"+I.getId(),A="",F='<span class="faded">'+this.msg("details.description.none")+"</span>",C="",H=x.permissions.userAccess.create,B=x.location,D=new Alfresco.util.NodeRef(x.nodeRef),G=Alfresco.constants.URL_PAGECONTEXT+(B.site?"site/"+B.site+"/":"")+"document-details?nodeRef="+D.toString();if(x.description&&x.description!==""){F=o(n(x.description))}if(x.version&&x.version!==""){A='<span class="document-version">'+n(x.version)+"</span>"}var u="modified",t=x.modifiedOn;if(x.custom&&x.custom.isWorkingCopy){u="editing-started"}else{if(x.modifiedOn===x.createdOn){u="created";t=x.createdOn}}if(B.site){C=this.msg("details."+u+"-in-site",d(t),h(B.site,B.siteTitle,'class="site-link theme-color-1" id="'+w+'"'))}else{C=this.msg("details."+u+"-by",d(t),e(x.modifiedByUser,x.modifiedBy,'class="theme-color-1"'))}if(this.options.simpleView){y+='<h3 class="filename simple-view"><a class="theme-color-1" href="'+G+'">'+n(x.displayName)+"</a></h3>";y+='<div class="detail"><span class="item-simple">'+C+"</span></div>"}else{y+='<h3 class="filename"><a class="theme-color-1" href="'+G+'">'+n(x.displayName)+"</a>"+A+"</h3>";y+='<div class="detail">';y+='<span class="item">'+C+"</span>";if(this.options.showFileSize){y+='<span class="item">'+Alfresco.util.formatFileSize(x.size)+"</span>"}y+="</div>";y+='<div class="detail"><span class="item">'+F+"</span></div>";y+='<div class="detail detail-social">';y+='<span class="item item-social">'+Alfresco.component.SimpleDocList.generateFavourite(this,I)+"</span>";y+='<span class="item item-social item-separator">'+Alfresco.component.SimpleDocList.generateLikes(this,I)+"</span>";if(H){y+='<span class="item item-social item-separator">'+Alfresco.component.SimpleDocList.generateComments(this,I)+"</span>"}y+="</div>"}this.metadataTooltips.push(w)}E.innerHTML=y},onLikes:function i(z){var w=this.widgets.alfrescoDataTable.getData(z),x=new Alfresco.util.NodeRef(w.nodeRef),u=w.likes;u.isLiked=!u.isLiked;u.totalLikes+=(u.isLiked?1:-1);var v={successCallback:{fn:function t(F,D){var G=F.json.data;if(G){var A=this.widgets.alfrescoDataTable.findRecordByParameter("nodeRef",D),E=A.getData(),B=E.likes;B.totalLikes=G.ratingsCount;this.widgets.alfrescoDataTable.getDataTable().updateRow(A,E);if(B.isLiked){var C={nodeRef:E.nodeRef};Alfresco.Share.postActivity(this.options.siteId,"file-liked",E.fileName,"document-details",C)}}},scope:this,obj:x.toString()},failureCallback:{fn:function y(E,C){var A=this.widgets.alfrescoDataTable.findRecordByParameter("nodeRef",C),D=A.getData(),B=D.likes;B.isLiked=!B.isLiked;B.totalLikes+=(B.isLiked?1:-1);this.widgets.alfrescoDataTable.getDataTable().updateRow(A,D);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",D.displayName)})},scope:this,obj:x.toString()}};if(u.isLiked){this.services.likes.set(x,1,v)}else{this.services.likes.remove(x,v)}this.widgets.alfrescoDataTable.getDataTable().updateRow(record,w)},onFavourite:function f(x){var t=this.widgets.alfrescoDataTable.getRecord(x),v=t.getData(),w=v.nodeRef;v.isFavourite=!v.isFavourite;this.widgets.alfrescoDataTable.getDataTable().updateRow(t,v);var u={failureCallback:{fn:function y(C,z){var A=this.widgets.alfrescoDataTable.getRecord(z),B=A.getData();B.isFavourite=!B.isFavourite;this.widgets.alfrescoDataTable.getDataTable().updateRow(A,B);Alfresco.util.PopupManager.displayPrompt({text:this.msg("message.save.failure",B.displayName)})},scope:this,obj:x}};this.services.preferences[v.isFavourite?"add":"remove"].call(this.services.preferences,Alfresco.service.Preferences.FAVOURITE_DOCUMENTS,w,u)}})})();