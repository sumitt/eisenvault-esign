/*!
 * Copyright 2002 - 2013 Webdetails, a Pentaho company.  All rights reserved.
 *
 * This software was developed by Webdetails and is provided under the terms
 * of the Mozilla Public License, Version 2.0, or any later version. You may not use
 * this file except in compliance with the license. If you need a copy of the license,
 * please go to  http://mozilla.org/MPL/2.0/. The Initial Developer is Webdetails.
 *
 * Software distributed under the Mozilla Public License is distributed on an "AS IS"
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or  implied. Please refer to
 * the license for the specific language governing your rights and limitations.
 */
;
/*!
 * Copyright 2002 - 2013 Webdetails, a Pentaho company.  All rights reserved.
 * 
 * This software was developed by Webdetails and is provided under the terms
 * of the Mozilla Public License, Version 2.0, or any later version. You may not use
 * this file except in compliance with the license. If you need a copy of the license,
 * please go to  http://mozilla.org/MPL/2.0/. The Initial Developer is Webdetails.
 *
 * Software distributed under the Mozilla Public License is distributed on an "AS IS"
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or  implied. Please refer to
 * the license for the specific language governing your rights and limitations.
 */
;
/*! Copyright 2010 Stanford Visualization Group, Mike Bostock, BSD license. */
;
/*! 539b7b4908c29303d90a687962d250d90abf0def */
;Array.prototype.map||(Array.prototype.map=function(c,d){for(var e=this.length,a=new Array(e),b=0;e>b;b++){b in this&&(a[b]=c.call(d,this[b],b,this))}return a});Array.prototype.filter||(Array.prototype.filter=function(d,e){for(var g=this.length,a=new Array(),c=0;g>c;c++){if(c in this){var b=this[c];d.call(e,b,c,this)&&a.push(b)}}return a});Array.prototype.forEach||(Array.prototype.forEach=function(b,c){for(var d=this.length>>>0,a=0;d>a;a++){a in this&&b.call(c,this[a],a,this)}});Array.prototype.reduce||(Array.prototype.reduce=function(d,b){var a=this.length;if(!a&&1==arguments.length){throw new Error("reduce: empty array, no initial value")}var c=0;if(arguments.length<2){for(;;){if(c in this){b=this[c++];break}if(++c>=a){throw new Error("reduce: no values, no initial value")}}}for(;a>c;c++){c in this&&(b=d(b,this[c],c,this))}return b});Array.prototype.indexOf||(Array.prototype.indexOf=function(b,d){for(var c=this.length>>>0,a=!isFinite(d)||0>d?0:d>this.length?this.length:d;c>a;a++){if(this[a]===b){return a}}return -1});Date.now||(Date.now=function(){return +new Date()});Object.create||(Object.create=function(b){function a(){}a.prototype=b;return new a()});var pv={};pv.version={major:3,minor:3};pv.identity=function(a){return a};pv.index=function(){return this.index};pv.child=function(){return this.childIndex};pv.parent=function(){return this.parent.index};!function(){pv.extend=function(e){return Object.create(e.prototype||e)};pv.extendType=function(h,i){var e=h.prototype=pv.extend(i);e.constructor=h;return h};pv.parse=function(e){for(var g,l,o=new RegExp("function\\s*(\\b\\w+)?\\s*\\([^)]*\\)\\s*","mg"),k=0,q="";g=o.exec(e);){var h=g.index+g[0].length;if("{"!=e.charAt(h)){q+=e.substring(k,h)+"{return ";k=h;for(var f=0;f>=0&&h<e.length;h++){var n=e.charAt(h);switch(n){case'"':case"'":for(;++h<e.length&&(l=e.charAt(h))!=n;){"\\"==l&&h++}break;case"[":case"(":f++;break;case"]":case")":f--;break;case";":case",":0==f&&f--}}q+=pv.parse(e.substring(k,--h))+";}";k=h}o.lastIndex=h}q+=e.substring(k);return q};pv.error=function(f){"undefined"!=typeof console&&console.error?console.error(f):alert(f)};pv.listen=function(g,e,f){f=pv.listener(f);if("load"===e||"onload"===e){return pv.listenForPageLoad(f)}if(g.addEventListener){g.addEventListener(e,f,!1)}else{g===window&&(g=document.documentElement);g.attachEvent("on"+e,f)}return f};pv.unlisten=function(g,e,f){f.$listener&&(f=f.$listener);g.removeEventListener?g.removeEventListener(e,f,!1):g.detachEvent("on"+e,f)};pv.listenForPageLoad=function(e){"complete"!==document.readyState?document.addEventListener?window.addEventListener("load",e,!1):document.attachEvent&&window.attachEvent("onload",e):e(null)};pv.listener=function(e){return e.$listener||(e.$listener=function(g){try{pv.event=g=g&&pv.fixEvent(g);return e.call(this,g)}catch(f){pv.error(f)}finally{delete pv.event}})};pv.fixEvent=function(f){if(null==f.pageX&&null!=f.clientX){var g=f.target&&f.target.ownerDocument||document,h=g.documentElement,e=g.body;f.pageX=1*f.clientX+(h&&h.scrollLeft||e&&e.scrollLeft||0)-(h&&h.clientLeft||e&&e.clientLeft||0);f.pageY=1*f.clientY+(h&&h.scrollTop||e&&e.scrollTop||0)-(h&&h.clientTop||e&&e.clientTop||0)}return f};pv.ancestor=function(f,g){for(;g;){if(g===f){return !0}g=g.parentNode}return !1};pv.removeChildren=function(e){for(;e.lastChild;){e.removeChild(e.lastChild)}};pv.getWindow=function(e){return null!=e&&e==e.window?e:9===e.nodeType?e.defaultView||e.parentWindow:!1};var a=/\-([a-z])/g;pv.hiphen2camel=function(e){return a.test(e)?e.replace(a,function(g,f){return f.toUpperCase()}):e};var d=window.getComputedStyle;pv.css=function(g,f){return d?d.call(window,g,null).getPropertyValue(f):g.currentStyle["float"===f?"styleFloat":pv.hiphen2camel(f)]};pv.cssStyle=function(g){var f;if(d){f=d.call(window,g,null);return function(e){return f.getPropertyValue(e)}}f=g.currentStyle;return function(e){return f["float"===e?"styleFloat":pv.hiphen2camel(e)]}};pv._getElementsByClass=function(n,l){null==l&&(l=document);for(var k=[],h=l.getElementsByTagName("*"),e=h.length,m=new RegExp("(^|\\s)"+n+"(\\s|$)"),g=0,f=0;e>g;g++){if(m.test(h[g].className)){k[f]=h[g];f++}}return k};pv.getElementsByClassName=function(e,f){return e.getElementsByClassName?e.getElementsByClassName(f):pv._getElementsByClass(f,e)};pv.elementOffset=function(g){var n=g&&g.ownerDocument;if(n){var k=n.body;if(k!==g){var j;j="undefined"!=typeof g.getBoundingClientRect?g.getBoundingClientRect():{top:0,left:0};var l=pv.getWindow(n),f=n.documentElement,i=f.clientTop||k.clientTop||0,m=f.clientLeft||k.clientLeft||0,e=l.pageYOffset||f.scrollTop,h=l.pageXOffset||f.scrollLeft;return{top:j.top+e-i,left:j.left+h-m}}}};pv.renderer=function(){var e=document.svgImplementation||"nativesvg";pv.renderer=function(){return e};return e};var c=1;pv.id=function(){return c++};pv.functor=function(e){return"function"==typeof e?e:function(){return e}};pv.get=function(h,g,f){var e;return h&&null!=(e=h[g])?e:f};var b=Object.prototype.hasOwnProperty;pv.lazyArrayOwn=function(g,f){var e;return g&&b.call(g,f)&&(e=g[f])?e:g[f]=[]}}();pv.listen(window,"load",function(){pv.$={i:0,x:document.getElementsByTagName("script")};pv.$.xlen=pv.$.x.length;for(;pv.$.i<pv.$.xlen;pv.$.i++){pv.$.s=pv.$.x[pv.$.i];if("text/javascript+protovis"==pv.$.s.type){try{window.eval(pv.parse(pv.$.s.text))}catch(e){pv.error(e)}}}delete pv.$});pv.Format={};pv.Format.re=function(a){return a.replace(/[\\\^\$\*\+\?\[\]\(\)\.\{\}]/g,"\\$&")};pv.Format.pad=function(e,d,b){var a=d-String(b).length;return 1>a?b:new Array(a+1).join(e)+b};pv.Format.date=function(a){function c(e){return a.replace(/%[a-zA-Z0-9]/g,function(g){switch(g){case"%a":return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][e.getDay()];case"%A":return["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()];case"%h":case"%b":return["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()];case"%B":return["January","February","March","April","May","June","July","August","September","October","November","December"][e.getMonth()];case"%c":return e.toLocaleString();case"%C":return b("0",2,Math.floor(e.getFullYear()/100)%100);case"%d":return b("0",2,e.getDate());case"%x":case"%D":return b("0",2,e.getMonth()+1)+"/"+b("0",2,e.getDate())+"/"+b("0",2,e.getFullYear()%100);case"%e":return b(" ",2,e.getDate());case"%H":return b("0",2,e.getHours());case"%I":var f=e.getHours()%12;return f?b("0",2,f):12;case"%m":return b("0",2,e.getMonth()+1);case"%M":return b("0",2,e.getMinutes());case"%n":return"\n";case"%p":return e.getHours()<12?"AM":"PM";case"%T":case"%X":case"%r":var f=e.getHours()%12;return(f?b("0",2,f):12)+":"+b("0",2,e.getMinutes())+":"+b("0",2,e.getSeconds())+" "+(e.getHours()<12?"AM":"PM");case"%R":return b("0",2,e.getHours())+":"+b("0",2,e.getMinutes());case"%S":return b("0",2,e.getSeconds());case"%Q":return b("0",3,e.getMilliseconds());case"%t":return"	";case"%u":var d=e.getDay();return d?d:1;case"%w":return e.getDay();case"%y":return b("0",2,e.getFullYear()%100);case"%Y":return e.getFullYear();case"%%":return"%"}return g})}var b=pv.Format.pad;c.format=c;c.parse=function(m){var k=1970,j=0,e=1,g=0,f=0,d=0,i=[function(){}],l=pv.Format.re(a).replace(/%[a-zA-Z0-9]/g,function(n){switch(n){case"%b":i.push(function(o){j={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[o]});return"([A-Za-z]+)";case"%h":case"%B":i.push(function(o){j={January:0,February:1,March:2,April:3,May:4,June:5,July:6,August:7,September:8,October:9,November:10,December:11}[o]});return"([A-Za-z]+)";case"%e":case"%d":i.push(function(o){e=o});return"([0-9]+)";case"%I":case"%H":i.push(function(o){g=o});return"([0-9]+)";case"%m":i.push(function(o){j=o-1});return"([0-9]+)";case"%M":i.push(function(o){f=o});return"([0-9]+)";case"%p":i.push(function(o){12==g?"am"==o&&(g=0):"pm"==o&&(g=Number(g)+12)});return"(am|pm)";case"%S":i.push(function(o){d=o});return"([0-9]+)";case"%y":i.push(function(o){o=Number(o);k=o+(o>=0&&69>o?2000:o>=69&&100>o?1900:0)});return"([0-9]+)";case"%Y":i.push(function(o){k=o});return"([0-9]+)";case"%%":i.push(function(){});return"%"}return n}),h=m.match(l);h&&h.forEach(function(n,o){i[o](n)});return new Date(k,j,e,g,f,d)};return c};pv.Format.time=function(a){function c(f){f=Number(f);switch(a){case"short":return f>=31536000000?(f/31536000000).toFixed(1)+" years":f>=604800000?(f/604800000).toFixed(1)+" weeks":f>=86400000?(f/86400000).toFixed(1)+" days":f>=3600000?(f/3600000).toFixed(1)+" hours":f>=60000?(f/60000).toFixed(1)+" minutes":(f/1000).toFixed(1)+" seconds";case"long":var e=[],i=f%60000/1000>>0,d=f%3600000/60000>>0;e.push(b("0",2,i));if(f>=3600000){var g=f%86400000/3600000>>0;e.push(b("0",2,d));if(f>=86400000){e.push(b("0",2,g));e.push(Math.floor(f/86400000).toFixed())}else{e.push(g.toFixed())}}else{e.push(d.toFixed())}return e.reverse().join(":")}}var b=pv.Format.pad;c.format=c;c.parse=function(i){switch(a){case"short":for(var d,h=/([0-9,.]+)\s*([a-z]+)/g,g=0;d=h.exec(i);){var j=parseFloat(d[0].replace(",","")),e=0;switch(d[2].toLowerCase()){case"year":case"years":e=31536000000;break;case"week":case"weeks":e=604800000;break;case"day":case"days":e=86400000;break;case"hour":case"hours":e=3600000;break;case"minute":case"minutes":e=60000;break;case"second":case"seconds":e=1000}g+=j*e}return g;case"long":var d=i.replace(",","").split(":").reverse(),g=0;d.length&&(g+=1000*parseFloat(d[0]));d.length>1&&(g+=60000*parseFloat(d[1]));d.length>2&&(g+=3600000*parseFloat(d[2]));d.length>3&&(g+=86400000*parseFloat(d[3]));return g}};return c};pv.Format.number=function(){function l(o){1/0>e&&(o=Math.round(o*b)/b);var q=String(Math.abs(o)).split("."),p=q[0];p.length>c&&(p=p.substring(p.length-c));h&&p.length<g&&(p=new Array(g-p.length+1).join(f)+p);p.length>3&&(p=p.replace(/\B(?=(?:\d{3})+(?!\d))/g,n));!h&&p.length<a&&(p=new Array(a-p.length+1).join(f)+p);q[0]=0>o?m+p+k:p;var r=q[1]||"";r.length>e&&(r=q[1]=r.substr(0,e));r.length<j&&(q[1]=r+new Array(j-r.length+1).join(i));return q.join(d)}var g=0,c=1/0,a=0,j=0,e=0,b=1,f="0",i="0",h=!0,d=".",n=",",m="âˆ’",k="";l.format=l;l.parse=function(o){var r=pv.Format.re,q=String(o).split(d);1==q.length&&(q[1]="");q[0].replace(new RegExp("^("+r(f)+")*"),"");q[1].replace(new RegExp("("+r(i)+")*$"),"");var p=q[0].replace(new RegExp(r(n),"g"),"");p.length>c&&(p=p.substring(p.length-c));var t=q[1]?Number("0."+q[1]):0;1/0>e&&(t=Math.round(t*b)/b);return Math.round(p)+t};l.integerDigits=function(p,o){if(arguments.length){g=Number(p);c=arguments.length>1?Number(o):g;a=g+Math.floor(g/3)*n.length;return this}return[g,c]};l.fractionDigits=function(p,o){if(arguments.length){j=Number(p);e=arguments.length>1?Number(o):j;b=Math.pow(10,e);return this}return[j,e]};l.integerPad=function(o){if(arguments.length){f=String(o);h=/\d/.test(f);return this}return f};l.fractionPad=function(o){if(arguments.length){i=String(o);return this}return i};l.decimal=function(o){if(arguments.length){d=String(o);return this}return d};l.group=function(o){if(arguments.length){n=o?String(o):"";a=g+Math.floor(g/3)*n.length;return this}return n};l.negativeAffix=function(o,p){if(arguments.length){m=String(o||"");k=String(p||"");return this}return[m,k]};return l};!function(){var c;pv.Text={};pv.Text.createCache=function(){return new b()};pv.Text.usingCache=function(f,e,d){if(!(f instanceof b)){throw new Error("Not a valid cache.")}var g=c;c=f;try{return e.call(d)}finally{c=g}};pv.Text.measure=function(f,d){f=null==f?"":String(f);var e=c&&c.get(d,f);if(!e){e=f?this.measureCore(f,d):{width:0,height:0};c&&c.put(d,f,e)}return e};pv.Text.measureWidth=function(e,d){return pv.Text.measure(e,d).width};pv.Text.fontHeight=function(d){return pv.Text.measure("M",d).height};pv.Text.measureCore=function(){function f(){return e||(e=g())}function g(){var k=document.createElement("div");k.id="pvSVGText_"+new Date().getTime();var h=k.style;h.position="absolute";h.visibility="hidden";h.width=0;h.height=0;h.left=0;h.top=0;h.lineHeight=1;h.textTransform="none";h.letterSpacing="normal";h.whiteSpace="nowrap";var i=pv.SvgScene.create("svg");i.setAttribute("font-size","10px");i.setAttribute("font-family","sans-serif");k.appendChild(i);var j=pv.SvgScene.create("text");i.appendChild(j);j.appendChild(document.createTextNode(""));document.body.appendChild(k);return j}var e,d="10px sans-serif";return function(l,h){h||(h=null);var k=f();if(d!==h){d=h;pv.SvgScene.setStyle(k,{font:h})}k.firstChild.nodeValue=String(l);var j;try{j=k.getBBox()}catch(i){"function"==typeof console.error&&console.error("GetBBox failed: ",i);throw i}return{width:j.width,height:j.height}}}();var b=function(){this._fontsCache={}},a=Object.prototype.hasOwnProperty;b.prototype._getFont=function(d){d=d||"";return a.call(this._fontsCache,d)?this._fontsCache[d]:this._fontsCache[d]={}};b.prototype.get=function(d,f){f=f||"";var e=this._getFont(d);return a.call(e,f)?e[f]:null};b.prototype.put=function(d,f,e){return this._getFont(d)[f||""]=e}}();pv.map=function(c,a){var b={};return a?c.map(function(f,e){b.index=e;return a.call(b,f)}):c.slice()};pv.repeat=function(b,a){1==arguments.length&&(a=2);return pv.blend(pv.range(a).map(function(){return b}))};pv.array=function(b,e){var c=b>=0?new Array(b):[];if(void 0!==e){for(var d=0;b>d;d++){c[d]=e}}return c};pv.cross=function(f,e){for(var l=[],h=0,k=f.length,d=e.length;k>h;h++){for(var g=0,c=f[h];d>g;g++){l.push([c,e[g]])}}return l};pv.blend=function(a){return Array.prototype.concat.apply([],a)};pv.transpose=function(e){var f=e.length,a=pv.max(e,function(g){return g.length});if(a>f){e.length=a;for(var d=f;a>d;d++){e[d]=new Array(f)}for(var d=0;f>d;d++){for(var b=d+1;a>b;b++){var c=e[d][b];e[d][b]=e[b][d];e[b][d]=c}}}else{for(var d=0;a>d;d++){e[d].length=f}for(var d=0;f>d;d++){for(var b=0;d>b;b++){var c=e[d][b];e[d][b]=e[b][d];e[b][d]=c}}}e.length=a;for(var d=0;a>d;d++){e[d].length=f}return e};pv.normalize=function(e,d){for(var b=pv.map(e,d),c=pv.sum(b),a=0;a<b.length;a++){b[a]/=c}return b};pv.permute=function(e,a,b){b||(b=pv.identity);var c=new Array(a.length),d={};a.forEach(function(f,g){d.index=f;c[g]=b.call(d,e[f])});return c};pv.numerate=function(a,b){b||(b=pv.identity);var c={},d={};a.forEach(function(e,f){d.index=f;c[b.call(d,e)]=f});return c};pv.uniq=function(g,b){b||(b=pv.identity);var e,c={},a=[],d={};g.forEach(function(f,h){d.index=h;e=b.call(d,f);e in c||(c[e]=a.push(e))});return a};pv.naturalOrder=function(d,c){return c>d?-1:d>c?1:0};pv.reverseOrder=function(c,d){return c>d?-1:d>c?1:0};pv.search=function(h,g,e){e||(e=pv.identity);for(var a=0,d=h.length-1;d>=a;){var b=a+d>>1,c=e(h[b]);if(g>c){a=b+1}else{if(!(c>g)){return b}d=b-1}}return -a-1};pv.search.index=function(d,c,b){var a=pv.search(d,c,b);return 0>a?-a-1:a};pv.range=function(f,c,d){if(1==arguments.length){c=f;f=0}void 0==d&&(d=1);if((c-f)/d==1/0){throw new Error("range must be finite")}var a,e=[],b=0;c-=1e-10*(c-f);if(0>d){for(;(a=f+d*b++)>c;){e.push(a)}}else{for(;(a=f+d*b++)<c;){e.push(a)}}return e};pv.random=function(c,a,b){if(1==arguments.length){a=c;c=0}void 0==b&&(b=1);return b?Math.floor(Math.random()*(a-c)/b)*b+c:Math.random()*(a-c)+c};pv.sum=function(c,a){var b={};return c.reduce(a?function(f,g,e){b.index=e;return f+a.call(b,g)}:function(e,f){return e+f},0)};pv.max=function(b,a){return a==pv.index?b.length-1:Math.max.apply(null,a?pv.map(b,a):b)};pv.max.index=function(h,d){if(!h.length){return -1}if(d==pv.index){return h.length-1}d||(d=pv.identity);for(var b=0,g=-1/0,e={},c=0;c<h.length;c++){e.index=c;var a=d.call(e,h[c]);if(a>g){g=a;b=c}}return b};pv.min=function(b,a){return a==pv.index?0:Math.min.apply(null,a?pv.map(b,a):b)};pv.min.index=function(h,e){if(!h.length){return -1}if(e==pv.index){return 0}e||(e=pv.identity);for(var d=0,b=1/0,g={},c=0;c<h.length;c++){g.index=c;var a=e.call(g,h[c]);if(b>a){b=a;d=c}}return d};pv.mean=function(b,a){return pv.sum(b,a)/b.length};pv.median=function(c,b){if(b==pv.index){return(c.length-1)/2}c=pv.map(c,b).sort(pv.naturalOrder);if(c.length%2){return c[Math.floor(c.length/2)]}var a=c.length/2;return(c[a-1]+c[a])/2};pv.variance=function(j,e){if(j.length<1){return 0/0}if(1==j.length){return 0}var a=pv.mean(j,e),c=0,h={};e||(e=pv.identity);for(var b=0;b<j.length;b++){h.index=b;var g=e.call(h,j[b])-a;c+=g*g}return c};pv.deviation=function(b,a){return Math.sqrt(pv.variance(b,a)/(b.length-1))};pv.log=function(c,a){return Math.log(c)/Math.log(a)};pv.logSymmetric=function(c,a){return 0==c?0:0>c?-pv.log(-c,a):pv.log(c,a)};pv.logAdjusted=function(c,a){if(!isFinite(c)){return c}var d=0>c;a>c&&(c+=(a-c)/a);return d?-pv.log(c,a):pv.log(c,a)};pv.logFloor=function(c,a){return c>0?Math.pow(a,Math.floor(pv.log(c,a))):-Math.pow(a,-Math.floor(-pv.log(-c,a)))};pv.logCeil=function(c,a){return c>0?Math.pow(a,Math.ceil(pv.log(c,a))):-Math.pow(a,-Math.ceil(-pv.log(-c,a)))};!function(){var a=Math.PI/180,b=180/Math.PI;pv.radians=function(c){return a*c};pv.degrees=function(c){return b*c}}();pv.keys=function(b){var c=[];for(var a in b){c.push(a)}return c};pv.entries=function(b){var c=[];for(var a in b){c.push({key:a,value:b[a]})}return c};pv.values=function(b){var c=[];for(var a in b){c.push(b[a])}return c};pv.dict=function(d,e){for(var a={},g={},c=0;c<d.length;c++){if(c in d){var b=d[c];g.index=c;a[b]=e.call(g,b)}}return a};pv.hasOwnProp=Object.prototype.hasOwnProperty;pv.copyOwn=function(e,c){if(c){var d=pv.hasOwnProp;for(var f in c){d.call(c,f)&&(e[f]=c[f])}}return e};pv.dom=function(a){return new pv.Dom(a)};pv.Dom=function(a){this.$map=a};pv.Dom.prototype.$leaf=function(a){return"object"!=typeof a};pv.Dom.prototype.leaf=function(a){if(arguments.length){this.$leaf=a;return this}return this.$leaf};pv.Dom.prototype.root=function(d){function c(g){var h=new pv.Dom.Node();for(var f in g){var e=g[f];h.appendChild(b(e)?new pv.Dom.Node(e):c(e)).nodeName=f}return h}var b=this.$leaf,a=c(this.$map);a.nodeName=d;return a};pv.Dom.prototype.nodes=function(){return this.root().nodes()};pv.Dom.Node=function(a){void 0!==a&&(this.nodeValue=a)};pv.Dom.Node.prototype.nodeValue=void 0;pv.Dom.Node.prototype.childNodes=[];pv.Dom.Node.prototype.parentNode=null;pv.Dom.Node.prototype.firstChild=null;pv.Dom.Node.prototype.lastChild=null;pv.Dom.Node.prototype.previousSibling=null;pv.Dom.Node.prototype.nextSibling=null;pv.Dom.Node.prototype._firstDirtyChildIndex=1/0;pv.Dom.Node.prototype._childIndex=-1;pv.Dom.Node.prototype.findChildIndex=function(b){if(!b){throw new Error("Argument 'n' required")}if(b.parentNode===this){var a=b.childIndex(!0);if(a>-1){return a}}throw new Error("child not found")};pv.Dom.Node.prototype._childRemoved=function(){};pv.Dom.Node.prototype._childAdded=function(){};pv.Dom.Node.prototype.removeChild=function(b){var a=this.findChildIndex(b);return this.removeAt(a)};pv.Dom.Node.prototype.appendChild=function(d){var b=d.parentNode;b&&b.removeChild(d);var c=this.lastChild;d.parentNode=this;d.previousSibling=c;if(c){c.nextSibling=d;d._childIndex=c._childIndex+1}else{this.firstChild=d;d._childIndex=0}this.lastChild=d;var a=pv.lazyArrayOwn(this,"childNodes").push(d);this._childAdded(d,a-1);return d};pv.Dom.Node.prototype.insertBefore=function(c,b){if(!b){return this.appendChild(c)}var a=this.findChildIndex(b);return this.insertAt(c,a)};pv.Dom.Node.prototype.insertAt=function(h,d){if(null==d){return this.appendChild(h)}var e=this.childNodes,a=e.length;if(d===a){return this.appendChild(h)}if(0>d||d>a){throw new Error("Index out of range.")}var b=h.parentNode;b&&b.removeChild(h);var c=d+1;c<this._firstDirtyChildIndex&&(this._firstDirtyChildIndex=c);var f=e[d];h.parentNode=this;h.nextSibling=f;h._childIndex=d;var g=h.previousSibling=f.previousSibling;f.previousSibling=h;if(g){g.nextSibling=h}else{f===this.lastChild&&(this.lastChild=h);this.firstChild=h}e.splice(d,0,h);this._childAdded(h,d);return h};pv.Dom.Node.prototype.removeAt=function(c){var d=this.childNodes,a=d.length;if(!(0>c||c>=a)){var f=d[c];d.splice(c,1);a-1>c&&c<this._firstDirtyChildIndex&&(this._firstDirtyChildIndex=c);var e=f.previousSibling,b=f.nextSibling;e?e.nextSibling=b:this.firstChild=b;b?b.previousSibling=e:this.lastChild=e;f.nextSibling=f.previousSibling=f.parentNode=null;this._childRemoved(f,c);return f}};pv.Dom.Node.prototype.replaceChild=function(f,d){var c=this.findChildIndex(d),b=f.parentNode;b&&b.removeChild(f);f.parentNode=this;f.nextSibling=d.nextSibling;f._childIndex=d._childIndex;var e=f.previousSibling=d.previousSibling;e?e.nextSibling=f:this.firstChild=f;var a=d.nextSibling;a?a.previousSibling=f:this.lastChild=f;this.childNodes[c]=f;this._childRemoved(d,c);this._childAdded(f,c);return d};pv.Dom.Node.prototype.childIndex=function(b){var e=this.parentNode;if(e){var d=e._firstDirtyChildIndex;if(1/0>d){var c=e.childNodes;if(!b){return c.indexOf(this)}for(var a=c.length;a>d;){c[d]._childIndex=d;d++}e._firstDirtyChildIndex=1/0}return this._childIndex}return -1};pv.Dom.Node.prototype.visitBefore=function(b){function a(g,e){b(g,e);for(var f=g.firstChild;f;f=f.nextSibling){a(f,e+1)}}a(this,0)};pv.Dom.Node.prototype.visitAfter=function(b){function a(g,e){for(var f=g.firstChild;f;f=f.nextSibling){a(f,e+1)}b(g,e)}a(this,0)};pv.Dom.Node.prototype.sort=function(e){if(this.firstChild){this._firstDirtyChildIndex=1/0;var d=this.childNodes;d.sort(e);var h,g=this.firstChild=d[0];delete g.previousSibling;g._childIndex=0;for(var b=1,a=d.length;a>b;b++){g.sort(e);h=d[b];h._childIndex=b;h.previousSibling=g;g=g.nextSibling=h}this.lastChild=g;delete g.nextSibling;g.sort(e)}return this};pv.Dom.Node.prototype.reverse=function(){var a=[];this.visitAfter(function(d){this._firstDirtyChildIndex=1/0;for(var b;b=d.lastChild;){a.push(d.removeChild(b))}if(a.length){for(;b=a.pop();){d.insertBefore(b,d.firstChild)}}});return this};pv.Dom.Node.prototype.nodes=function(){var a=[];this.visitBefore(function(b){a.push(b)});return a};pv.Dom.Node.prototype.toggle=function(a){if(a){return this.toggled?this.visitBefore(function(c){c.toggled&&c.toggle()}):this.visitAfter(function(c){c.toggled||c.toggle()})}var d,b=this;if(b.toggled){for(;d=b.toggled.pop();){b.appendChild(d)}delete b.toggled}else{if(d=b.lastChild){b.toggled=[];do{b.toggled.push(b.removeChild(d))}while(d=b.lastChild)}}};pv.nodes=function(c){for(var b=new pv.Dom.Node(),d=0,a=c.length;a>d;d++){b.appendChild(new pv.Dom.Node(c[d]))}return b.nodes()};pv.tree=function(a){return new pv.Tree(a)};pv.Tree=function(a){this.array=a};pv.Tree.prototype.keys=function(a){this.k=a;return this};pv.Tree.prototype.value=function(a){this.v=a;return this};pv.Tree.prototype.map=function(){for(var f={},g={},b=0;b<this.array.length;b++){g.index=b;for(var e=this.array[b],d=this.k.call(g,e),c=f,a=0;a<d.length-1;a++){c=c[d[a]]||(c[d[a]]={})}c[d[a]]=this.v?this.v.call(g,e):e}return f};pv.nest=function(a){return new pv.Nest(a)};pv.Nest=function(a){this.array=a;this.keys=[]};pv.Nest.prototype.key=function(a){this.keys.push(a);return this};pv.Nest.prototype.sortKeys=function(a){this.keys[this.keys.length-1].order=a||pv.naturalOrder;return this};pv.Nest.prototype.sortValues=function(a){this.order=a||pv.naturalOrder;return this};pv.Nest.prototype.map=function(){for(var h,l={},f=[],g=0;g<this.array.length;g++){var c=this.array[g],b=l;for(h=0;h<this.keys.length-1;h++){var e=this.keys[h](c);b[e]||(b[e]={});b=b[e]}e=this.keys[h](c);if(!b[e]){var d=[];f.push(d);b[e]=d}b[e].push(c)}if(this.order){for(var h=0;h<f.length;h++){f[h].sort(this.order)}}return l};pv.Nest.prototype.entries=function(){function a(e){var f=[];for(var d in e){var c=e[d];f.push({key:d,values:c instanceof Array?c:a(c)})}return f}function b(f,d){var e=this.keys[d].order;e&&f.sort(function(h,g){return e(h.key,g.key)});if(++d<this.keys.length){for(var c=0;c<f.length;c++){b.call(this,f[c].values,d)}}return f}return b.call(this,a(this.map()),0)};pv.Nest.prototype.rollup=function(b){function a(e){for(var c in e){var d=e[c];d instanceof Array?e[c]=b(d):a(d)}return e}return a(this.map())};pv.flatten=function(a){return new pv.Flatten(a)};pv.Flatten=function(a){this.map=a;this.keys=[]};pv.Flatten.prototype.key=function(a,b){this.keys.push({name:a,value:b});delete this.$leaf;return this};pv.Flatten.prototype.leaf=function(a){this.keys.length=0;this.$leaf=a;return this};pv.Flatten.prototype.array=function(){function f(j,h){if(c(j)){b.push({keys:a.slice(),value:j})}else{for(var g in j){a.push(g);f(j[g],h+1);a.pop()}}}function d(j,h){if(h<e.length-1){for(var g in j){a.push(g);d(j[g],h+1);a.pop()}}else{b.push(a.concat(j))}}var b=[],a=[],e=this.keys,c=this.$leaf;if(c){f(this.map,0);return b}d(this.map,0);return b.map(function(h){for(var g={},n=0;n<e.length;n++){var l=e[n],j=h[n];g[l.name]=l.value?l.value.call(null,j):j}return g})};pv.Transform=function(){};pv.Transform.prototype={k:1,x:0,y:0};pv.Transform.identity=new pv.Transform();pv.Transform.prototype.translate=function(a,c){var b=new pv.Transform();b.k=this.k;b.x=this.k*a+this.x;b.y=this.k*c+this.y;return b};pv.Transform.prototype.scale=function(b){var a=new pv.Transform();a.k=this.k*b;a.x=this.x;a.y=this.y;return a};pv.Transform.prototype.invert=function(){var b=new pv.Transform(),a=1/this.k;b.k=a;b.x=-this.x*a;b.y=-this.y*a;return b};pv.Transform.prototype.times=function(a){var b=new pv.Transform();b.k=this.k*a.k;b.x=this.k*a.x+this.x;b.y=this.k*a.y+this.y;return b};pv.Scale=function(){};pv.Scale.interpolator=function(d,a){if("number"==typeof d){return function(e){return e*(a-d)+d}}var b=d.type&&"solid"!==d.type,c=a.type&&"solid"!==a.type;if(b||c){d=b?d:pv.color(d).rgb();a=c?a:pv.color(a).rgb();return function(e){return 0.5>e?d:a}}d=pv.color(d).rgb();a=pv.color(a).rgb();return function(f){var e=d.a*(1-f)+a.a*f;0.00001>e&&(e=0);return 0==d.a?pv.rgb(a.r,a.g,a.b,e):0==a.a?pv.rgb(d.r,d.g,d.b,e):pv.rgb(Math.round(d.r*(1-f)+a.r*f),Math.round(d.g*(1-f)+a.g*f),Math.round(d.b*(1-f)+a.b*f),e)}};pv.Scale.common={by:function(a){function b(){return c(a.apply(this,arguments))}var c=this;for(var d in c){b[d]=c[d]}return b},by1:function(a){function c(e){return b(a.call(this,e))}var b=this;for(var d in b){c[d]=b[d]}return c},transform:function(a){function b(){return a.call(this,c.apply(c,arguments))}var c=this;for(var d in c){b[d]=c[d]}return b}};pv.Scale.quantitative=function(){function v(d){return new Date(d)}function j(d){var f=pv.search(t,d);0>f&&(f=-f-2);f=Math.max(0,Math.min(o.length-1,f));return o[f]((q(d)-k[f])/(k[f+1]-k[f]))}var s,w,c,b,t=[0,1],k=[0,1],a=[0,1],o=[pv.identity],u=Number,e=!1,q=pv.identity,p=pv.identity,h=String,m=null;j.transform=function(f,d){q=function(g){return e?-f(-g):f(g)};p=function(g){return e?-d(-g):d(g)};k=t.map(q);return this};j.domain=function(i,f,d){if(arguments.length){var g;if(i instanceof Array){arguments.length<2&&(f=pv.identity);arguments.length<3&&(d=f);g=i.length&&f(i[0]);t=i.length?[pv.min(i,f),pv.max(i,d)]:[]}else{g=i;t=Array.prototype.slice.call(arguments).map(Number)}t.length?1==t.length&&(t=[t[0],t[0]]):t=[-1/0,1/0];e=(t[0]||t[t.length-1])<0;k=t.map(q);u=g instanceof Date?v:Number;return this}return t.map(u)};j.range=function(){if(arguments.length){a=Array.prototype.slice.call(arguments);a.length?1==a.length&&(a=[a[0],a[0]]):a=[-1/0,1/0];o=[];for(var d=0;d<a.length-1;d++){o.push(pv.Scale.interpolator(a[d],a[d+1]))}return this}return a};j.invert=function(f){var d=pv.search(a,f);0>d&&(d=-d-2);d=Math.max(0,Math.min(o.length-1,d));return u(p(k[d]+(f-a[d])/(a[d+1]-a[d])*(k[d+1]-k[d])))};j.ticks=function(F,f){function K(Q,n){switch(n){case 31536000000:Q.setMonth(0);case 2592000000:Q.setDate(1);case 604800000:604800000==n&&Q.setDate(Q.getDate()-Q.getDay());case 86400000:Q.setHours(0);case 3600000:Q.setMinutes(0);case 60000:Q.setSeconds(0);case 1000:Q.setMilliseconds(0)}}var l=t[0],g=t[t.length-1],B=l>g,G=B?g:l,I=B?l:g,H=I-G;if(!H||!isFinite(H)){u==v&&(h=pv.Format.date("%x"));return[u(G)]}var y=pv.get(f,"roundInside",!0);if(u==v){var L,J,O,d=null==F?5:F,A=1;if(H>=31536000000*d){L=31536000000;J="%Y";O=function(n){n.setFullYear(n.getFullYear()+A)}}else{if(H>=2592000000*d){L=2592000000;J="%m/%Y";O=function(n){n.setMonth(n.getMonth()+A)}}else{if(H>=604800000*d){L=604800000;J="%m/%d";O=function(n){n.setDate(n.getDate()+7*A)}}else{if(H>=86400000*d){L=86400000;J="%m/%d";O=function(n){n.setDate(n.getDate()+A)}}else{if(H>=3600000*d){L=3600000;J="%I:%M %p";O=function(n){n.setHours(n.getHours()+A)}}else{if(H>=60000*d){L=60000;J="%I:%M %p";O=function(n){n.setMinutes(n.getMinutes()+A)}}else{if(H>=1000*d){L=1000;J="%I:%M:%S";O=function(n){n.setSeconds(n.getSeconds()+A)}}else{L=1;J="%S.%Qs";O=function(n){n.setTime(n.getTime()+A)}}}}}}}}L=w?w:L;J=s?s:J;c=L;h=pv.Format.date(J);var N=new Date(G),x=[];K(N,L);var D=H/L;if(D>10){switch(L){case 3600000:A=D>20?6:3;N.setHours(Math.floor(N.getHours()/A)*A);break;case 2592000000:A=D>24?3:D>12?2:1;N.setMonth(Math.floor(N.getMonth()/A)*A);break;case 604800000:A=D>15?3:D>10?2:1;N.setDate(1+7*Math.floor(N.getDate()/(7*A))*A);break;case 86400000:A=D>=30?5:D>=15?3:2;N.setDate(1+Math.floor(N.getDate()/A)*A);break;case 60000:A=D>30?15:D>15?10:5;N.setMinutes(Math.floor(N.getMinutes()/A)*A);break;case 1000:A=D>90?15:D>60?10:5;N.setSeconds(Math.floor(N.getSeconds()/A)*A);break;case 1:A=D>1000?250:D>200?100:D>100?50:D>50?25:5;N.setMilliseconds(Math.floor(N.getMilliseconds()/A)*A);break;default:A=pv.logCeil(D/15,10);2>D/A?A/=5:5>D/A&&(A/=2);N.setFullYear(Math.floor(N.getFullYear()/A)*A)}}if(w){A=1;O=function(n){n.setSeconds(n.getSeconds()+A*w/1000)}}if(y){for(;;){O(N);if(N>I){break}x.push(new Date(N))}}else{I=new Date(I);O(I);do{x.push(new Date(N));O(N)}while(I>=N)}return B?x.reverse():x}null==F&&(F=10);var i=pv.get(f,"numberExponentMin",-1/0),z=pv.get(f,"numberExponentMax",+1/0),C=Math.floor(pv.log(H/F,10)),E=!1;if(C>z){C=z;E=!0}else{if(i>C){C=i;E=!0}}A=Math.pow(10,C);var M=H/A,r=F/M;if(0.15>=r&&z-1>C){A*=10;M/=10}else{if(0.35>=r){A*=5;M/=5}else{if(0.75>=r){A*=2;M/=2}}}C=Math.floor(pv.log(A,10)+1e-10);l=A*Math[y?"ceil":"floor"](G/A);g=A*Math[y?"floor":"ceil"](I/A);b=Math.max(0,-C);h=pv.Format.number().fractionDigits(b);2===F&&M>=2&&(A=g-l);var P=pv.range(l,g+A,A);B&&P.reverse();P.roundInside=y;P.step=A;P.exponent=C;P.exponentOverflow=E;P.exponentMin=i;P.exponentMax=z;return P};j.dateTickFormat=function(){if(arguments.length){s=arguments[0];return this}return s};j.dateTickPrecision=function(){if(arguments.length){w=arguments[0];return this}return w};j.tickFormatter=function(d){if(arguments.length){m=d;return this}return m};j.tickFormat=function(d){var f;f=m?m(d,u!==Number?c:b):h(d);return null==f?"":""+f};j.nice=function(){if(2!=t.length){return this}var r=t[0],f=t[t.length-1],g=r>f,i=g?f:r,d=g?r:f,l=d-i;if(!l||!isFinite(l)){return this}var n=Math.pow(10,Math.round(Math.log(l)/Math.log(10))-1);t=[Math.floor(i/n)*n,Math.ceil(d/n)*n];g&&t.reverse();k=t.map(q);return this};pv.copyOwn(j,pv.Scale.common);j.domain.apply(j,arguments);return j};pv.Scale.linear=function(){var a=pv.Scale.quantitative();a.domain.apply(a,arguments);return a};pv.Scale.log=function(){var a,e,f=pv.Scale.quantitative(1,10),c=function(b){return Math.log(b)/e},d=function(b){return Math.pow(a,b)};f.ticks=function(){var m=f.domain(),o=m[0]<0,h=Math.floor(o?-c(-m[0]):c(m[0])),g=Math.ceil(o?-c(-m[1]):c(m[1])),l=[];if(o){l.push(-d(-h));for(;h++<g;){for(var b=a-1;b>0;b--){l.push(-d(-h)*b)}}}else{for(;g>h;h++){for(var b=1;a>b;b++){l.push(d(h)*b)}}l.push(d(h))}for(h=0;l[h]<m[0];h++){}for(g=l.length;l[g-1]>m[1];g--){}return l.slice(h,g)};f.tickFormat=function(b){return b.toPrecision(1)};f.nice=function(){var b=f.domain();return f.domain(pv.logFloor(b[0],a),pv.logCeil(b[1],a))};f.base=function(b){if(arguments.length){a=Number(b);e=Math.log(a);f.transform(c,d);return this}return a};f.domain.apply(f,arguments);return f.base(10)};pv.Scale.root=function(){var a=pv.Scale.quantitative();a.power=function(d){if(arguments.length){var c=Number(d),e=1/c;a.transform(function(b){return Math.pow(b,e)},function(b){return Math.pow(b,c)});return this}return c};a.domain.apply(a,arguments);return a.power(2)};pv.Scale.ordinal=function(){function e(d){d in a||(a[d]=c.push(d)-1);return b[a[d]%b.length]}var c=[],a={},b=[];e.domain=function(k,h){if(arguments.length){k=k instanceof Array?arguments.length>1?pv.map(k,h):k:Array.prototype.slice.call(arguments);c=[];for(var d={},g=0;g<k.length;g++){var i=k[g];if(!(i in d)){d[i]=!0;c.push(i)}}a=pv.numerate(c);return this}return c};e.range=function(g,d){if(arguments.length){b=g instanceof Array?arguments.length>1?pv.map(g,d):g:Array.prototype.slice.call(arguments);"string"==typeof b[0]&&(b=b.map(pv.fillStyle));b.min=b[0];b.max=b[b.length-1];return this}return b};e.split=function(f,d){var g=d-f,i=this.domain().length,h=0;if(0===g){b=pv.array(i,f)}else{if(i){h=(d-f)/i;b=pv.range(f+h/2,d,h)}}b.min=f;b.max=d;b.step=h;return this};e.splitBandedCenter=function(f,d,g){e.split(f,d);null==g&&(g=1);b.band=b.step*g;b.margin=b.step-b.band;b.min=f;b.max=d;return this};e.splitBandedFlushCenter=function(g,d,j){null==j&&(j=1);var h=d-g,i=this.domain().length,f=0,l=0,k=0;if(0===h){b=pv.array(i,g)}else{if(i){l=h*j/i;k=i>1?(h-i*l)/(i-1):0;f=k+l;b=pv.range(g+l/2,d,f)}}b.step=f;b.band=l;b.margin=k;b.min=g;b.max=d;return this};e.splitFlush=function(f,d){var h=this.domain().length,g=(d-f)/(h-1);b=1==h?[(f+d)/2]:pv.range(f,d+g/2,g);b.min=f;b.max=d;return this};e.splitBanded=function(f,d,k){arguments.length<3&&(k=1);if(0>k){var l=this.domain().length,i=-k*l,g=d-f-i,j=g/(l+1);b=pv.range(f+j,d,j-k);b.band=-k}else{var h=(d-f)/(this.domain().length+(1-k));b=pv.range(f+h*(1-k),d,h);b.band=h*k;b.step=h;b.margin=h-b.band}b.min=f;b.max=d;return this};e.invertIndex=function(l,d){var k=this.domain().length;if(0===k){return -1}var j=this.range(),h=j.max-j.min;if(0===h){return 0}var g=h/k;if(l>=j.max){return k}if(l<j.min){return 0}var f=(l-j.min)/g;return d?f:Math.round(f)};pv.copyOwn(e,pv.Scale.common);e.domain.apply(e,arguments);return e};pv.Scale.quantile=function(){function e(d){return f(Math.max(0,Math.min(a,pv.search.index(b,d)-1))/a)}var g=-1,a=-1,b=[],c=[],f=pv.Scale.linear();e.quantiles=function(d){if(arguments.length){g=Number(d);if(0>g){b=[c[0]].concat(c);a=c.length-1}else{b=[];b[0]=c[0];for(var h=1;g>=h;h++){b[h]=c[~~(h*(c.length-1)/g)]}a=g-1}return this}return b};e.domain=function(h,d){if(arguments.length){c=h instanceof Array?pv.map(h,d):Array.prototype.slice.call(arguments);c.sort(pv.naturalOrder);e.quantiles(g);return this}return c};e.range=function(){if(arguments.length){f.range.apply(f,arguments);return this}return f.range()};pv.copyOwn(e,pv.Scale.common);e.domain.apply(e,arguments);return e};pv.histogram=function(b,a){var c=!0;return{bins:function(k){var d=pv.map(b,a),h=[];arguments.length||(k=pv.Scale.linear(d).ticks());for(var g=0;g<k.length-1;g++){var f=h[g]=[];f.x=k[g];f.dx=k[g+1]-k[g];f.y=0}for(var g=0;g<d.length;g++){var e=pv.search.index(k,d[g])-1,f=h[Math.max(0,Math.min(h.length-1,e))];f.y++;f.push(b[g])}if(!c){for(var g=0;g<h.length;g++){h[g].y/=d.length}}return h},frequency:function(d){if(arguments.length){c=Boolean(d);return this}return c}}};!function(){pv.Shape=function(){};var b={x:1,y:1};pv.Shape.dist2=function(j,g,i){i=i||b;var h=j.x-g.x,f=j.y-g.y,l=h*h,e=f*f;return{cost:l+e,dist2:i.x*l+i.y*e}};var d=Math.PI,c=2*d,a=Math.atan2;pv.Shape.normalizeAngle=function(e){e%=c;0>e&&(e+=c);return e};pv.Shape.atan2Norm=function(f,g){var e=a(f,g);0>e&&(e+=c);return e};pv.Shape.prototype.hasArea=function(){return !0}}();!function(){var c=pv.Shape.dist2,e=Math.cos,a=Math.sin,d=Math.sqrt;pv.vector=function(f,g){return new b(f,g)};pv.Vector=function(f,g){this.x=f;this.y=g};var b=pv.Shape.Point=pv.Vector;pv.Vector.prototype=pv.extend(pv.Shape);pv.Vector.prototype.perp=function(){return new b(-this.y,this.x)};pv.Vector.prototype.rotate=function(g){var h=e(g),f=a(g);return new b(h*this.x-f*this.y,f*this.x+h*this.y)};pv.Vector.prototype.norm=function(){var f=this.length();return this.times(f?1/f:1)};pv.Vector.prototype.length=function(){return d(this.x*this.x+this.y*this.y)};pv.Vector.prototype.times=function(f){return new b(this.x*f,this.y*f)};pv.Vector.prototype.plus=function(f,g){return 1==arguments.length?new b(this.x+f.x,this.y+f.y):new b(this.x+f,this.y+g)};pv.Vector.prototype.minus=function(f,g){return 1==arguments.length?new b(this.x-f.x,this.y-f.y):new b(this.x-f,this.y-g)};pv.Vector.prototype.dot=function(f,g){return 1==arguments.length?this.x*f.x+this.y*f.y:this.x*f+this.y*g};pv.Vector.prototype.hasArea=function(){return !1};pv.Vector.prototype.clone=function(){return new b(this.x,this.y)};pv.Vector.prototype.apply=function(f){return new b(f.x+f.k*this.x,f.y+f.k*this.y)};pv.Vector.prototype.intersectsRect=function(f){return this.x>=f.x&&this.x<=f.x2&&this.y>=f.y&&this.y<=f.y2};pv.Vector.prototype.containsPoint=function(f){return this.x===f.x&&this.y===f.y};pv.Vector.prototype.points=function(){return[this]};pv.Vector.prototype.edges=function(){return[]};pv.Vector.prototype.center=function(){return this};pv.Vector.prototype.distance2=function(g,f){return c(this,g,f)}}();!function(){var b=pv.Shape.Point,a=pv.Shape.dist2;pv.Shape.Line=function(d,g,e,f){this.x=d||0;this.y=g||0;this.x2=e||0;this.y2=f||0};var c=pv.Shape.Line;c.prototype=pv.extend(pv.Shape);c.prototype.hasArea=function(){return !1};c.prototype.clone=function(){return new c(this.x,this.y,this.x2,this.x2)};c.prototype.apply=function(g){var d=g.x+g.k*this.x,h=g.y+g.k*this.y,e=g.x+g.k*this.x2,f=g.y+g.k*this.y2;return new c(d,h,e,f)};c.prototype.points=function(){return[new b(this.x,this.y),new b(this.x2,this.y2)]};c.prototype.edges=function(){return[this]};c.prototype.center=function(){return new b((this.x+this.x2)/2,(this.y+this.y2)/2)};c.prototype.normal=function(d,g){var f=this.points(),e=f[1].minus(f[0]).perp().norm();if(g){var h=f[0].minus(g);h.dot(e)<0&&(e=e.times(-1))}return e};c.prototype.intersectsRect=function(h){var f,d,g=this.points();d=g.length;for(f=0;d>f;f++){if(g[f].intersectsRect(h)){return !0}}var e=h.edges();d=e.length;for(f=0;d>f;f++){if(this.intersectsLine(e[f])){return !0}}return !1};c.prototype.containsPoint=function(g){var d=this.x,e=this.x2,h=this.y,f=this.y2;return d<=g.x&&g.x<=e&&(d===e?Math.min(h,f)<=g.y&&g.y<=Math.max(h,f):Math.abs((f-h)/(e-d)*(g.x-d)+h-g.y)<=1e-10)};c.prototype.intersectsLine=function(k){var m=this,i=m.x2-m.x,l=m.y2-m.y,n=k.x2-k.x,p=k.y2-k.y,g=p*i-n*l;if(0===g){return !1}var e=m.y-k.y,o=m.x-k.x,j=n*e-p*o,h=i*e-l*o;if(0===g){return 0===j&&0===h}var f=j/g;if(0>f||f>1){return !1}var d=h/g;return 0>d||d>1?!1:!0};c.prototype.distance2=function(d,g){var l=this,j={x:this.x2,y:this.y2},e=a(l,j).dist2;if(1e-10>=e){return a(d,l,g)}var i=j.x-l.x,h=j.y-l.y,m=((d.x-l.x)*i+(d.y-l.y)*h)/e;if(0>m){return a(d,l,g)}if(m>1){return a(d,j,g)}var f={x:l.x+m*i,y:l.y+m*h};return a(d,f,g)}}();!function(){var b=pv.Shape.Point,c=pv.Shape.Line;pv.Shape.Polygon=function(d){this._points=d||[]};var a=pv.Shape.Polygon;a.prototype=pv.extend(pv.Shape);a.prototype.points=function(){return this._points};a.prototype.clone=function(){return new a(this.points().slice())};a.prototype.apply=function(g){for(var h=this.points(),d=h.length,e=new Array(d),f=0;d>f;f++){e[f]=h[f].apply(g)}return new a(e)};a.prototype.intersectsRect=function(h){var f,d,g=this.points();d=g.length;for(f=0;d>f;f++){if(g[f].intersectsRect(h)){return !0}}var e=this.edges();d=e.length;for(f=0;d>f;f++){if(e[f].intersectsRect(h)){return !0}}return !1};a.prototype.edges=function(){var g=this._edges;if(!g){g=this._edges=[];var j=this.points(),e=j.length;if(e){for(var d,f=j[0],k=f,h=1;e>h;h++){d=j[h];g.push(new c(f.x,f.y,d.x,d.y));f=d}e>2&&g.push(new c(d.x,d.y,k.x,k.y))}}return g};a.prototype.distance2=function(f,d){var e={cost:1/0,dist2:1/0};this.edges().forEach(function(g){var h=g.distance2(f,d);h.cost<e.cost&&(e=h)},this);return e};a.prototype.center=function(){for(var g=this.points(),e=0,j=0,f=0,d=g.length;d>f;f++){var h=g[f];e+=h.x;j+=h.y}return new b(e/d,j/d)};a.prototype.containsPoint=function(i){var j=this.bbox();if(!j.containsPoint(i)){return !1}var h=0.01*j.dx,d=new c(j.x-h,i.y,i.x,i.y),g=0,f=this.edges();f.forEach(function(e){e.intersectsLine(d)&&g++});return 1===(1&g)};a.prototype.bbox=function(){var f=this._bbox;if(!f){var e,d;this.points().forEach(function(g){if(null==e){e={x:g.x,y:g.y}}else{g.x<e.x&&(e.x=g.x);g.y<e.y&&(e.y=g.y)}if(null==d){d={x:g.x,y:g.y}}else{g.x>d.x&&(d.x=g.x);g.y>d.y&&(d.y=g.y)}});e&&(f=this._bbox=new pv.Shape.Rect(e.x,e.y,d.x-e.x,d.y-e.y))}return f}}();!function(){var b=pv.Shape.Point,c=pv.Shape.Line;pv.Shape.Rect=function(d,g,f,e){this.x=d||0;this.y=g||0;this.dx=f||0;this.dy=e||0;if(this.dx<0){this.dx=-this.dx;this.x=this.x-this.dx}if(this.dy<0){this.dy=-this.dy;this.y=this.y-this.dy}this.x2=this.x+this.dx;this.y2=this.y+this.dy};var a=pv.Shape.Rect;a.prototype=pv.extend(pv.Shape.Polygon);a.prototype.clone=function(){var d=Object.create(a.prototype);d.x=this.x;d.y=this.y;d.dx=this.dx;d.dy=this.dy;d.x2=this.x2;d.y2=this.y2;return d};a.prototype.apply=function(g){var d=g.x+g.k*this.x,h=g.y+g.k*this.y,f=g.k*this.dx,e=g.k*this.dy;return new a(d,h,f,e)};a.prototype.containsPoint=function(d){return this.x<=d.x&&d.x<=this.x2&&this.y<=d.y&&d.y<=this.y2};a.prototype.intersectsRect=function(d){return this.x2>d.x&&this.x<d.x2&&this.y2>d.y&&this.y<d.y2};a.prototype.edges=function(){if(!this._edges){var d=this.x,g=this.y,e=this.x2,f=this.y2;this._edges=[new c(d,g,e,g),new c(e,g,e,f),new c(e,f,d,f),new c(d,f,d,g)]}return this._edges};a.prototype.center=function(){return new b(this.x+this.dx/2,this.y+this.dy/2)};a.prototype.points=function(){var g=this._points;if(!g){var d=this.x,h=this.y,e=this.x2,f=this.y2;g=this._points=[new b(d,h),new b(e,h),new b(e,f),new b(d,f)]}return g};a.prototype.bbox=function(){return this.clone()}}();!function(){var e=pv.Shape.Point,d=pv.Shape.dist2,f=Math.sqrt,a=Math.abs,c=Math.pow;pv.Shape.Circle=function(h,i,g){this.x=h||0;this.y=i||0;this.radius=g||0};var b=pv.Shape.Circle;b.prototype=pv.extend(pv.Shape);b.prototype.clone=function(){return new b(this.x,this.y,this.radius)};b.prototype.apply=function(h){var g=h.x+h.k*this.x,j=h.y+h.k*this.y,i=h.k*this.radius;return new b(g,j,i)};b.prototype.intersectsRect=function(k){var l=k.dx/2,g=k.dy/2,j=this.radius,i=a(this.x-k.x-l),h=a(this.y-k.y-g);if(i>l+j||h>g+j){return !1}if(l>=i||g>=h){return !0}var m=c(i-l,2)+c(h-g,2);return j*j>=m};b.prototype.intersectLine=function(w,i){var q=w.x2-w.x,p=w.y2-w.y,u=this.x-w.x,t=this.y-w.y,j=q*q+p*p,n=q*u+p*t,h=this.radius,o=u*u+t*t-h*h,s=n/j,k=s*s-o/j;if(!(0>k)){var v=f(k),m=s-v,l=s+v,g=[];(i||m>=0&&1>=m)&&g.push(new e(w.x+q*m,w.y+p*m));0!==k&&(i||l>=0&&1>=l)&&g.push(new e(w.x+q*l,w.y+p*l));return g}};b.prototype.points=function(){return[this.center()]};b.prototype.center=function(){return new e(this.x,this.y)};b.prototype.normal=function(g){return g.minus(this.x,this.y).norm()};b.prototype.containsPoint=function(j){var h=j.x-this.x,g=j.y-this.y,i=this.radius;return i*i>=h*h+g*g};b.prototype.distance2=function(j,h){var i=(j.x-this.x,j.y-this.y,this.radius),g=j.minus(this).norm().times(i).plus(this),l=d(j,g,h);return l}}();!function(){var d=pv.Shape.Point,b=pv.Shape.dist2,g=pv.Shape.normalizeAngle,e=pv.Shape.atan2Norm,i=Math.cos,f=Math.sin,h=Math.sqrt;pv.Shape.Arc=function(k,n,j,m,l){this.x=k;this.y=n;this.radius=j;this.startAngle=g(m);this.angleSpan=g(l);this.endAngle=this.startAngle+this.angleSpan};var a=pv.Shape.Arc;a.prototype=pv.extend(pv.Shape);a.prototype.hasArea=function(){return !1};a.prototype.clone=function(){var j=Object.create(a.prototype),k=this;j.x=k.x;j.y=k.y;j.radius=k.radius;j.startAngle=k.startAngle;j.angleSpan=k.angleSpan;j.endAngle=k.endAngle;return j};a.prototype.apply=function(k){var j=k.x+k.k*this.x,m=k.y+k.k*this.y,l=k.k*this.radius;return new a(j,m,l,this.startAngle,this.angleSpan)};a.prototype.containsPoint=function(n){var l=n.x-this.x,k=n.y-this.y,m=h(l*l+k*k);if(Math.abs(m-this.radius)<=1e-10){var j=e(k,l);return this.startAngle<=j&&j<=this.endAngle}return !1};a.prototype.intersectsRect=function(n){var l,j,m=this.points(),j=m.length;for(l=0;j>l;l++){if(m[l].intersectsRect(n)){return !0}}var k=n.edges();j=k.length;for(l=0;j>l;l++){if(this.intersectLine(k[l])){return !0}}return !1};var c=pv.Shape.Circle.prototype.intersectLine;a.prototype.intersectLine=function(j,k){var l=c.call(this,j,k);if(l){l=l.filter(function(m){return this.containsPoint(m)},this);if(l.length){return l}}};a.prototype.points=function(){var k=this.x,n=this.y,m=this.radius,j=this.startAngle,l=this.endAngle;return[new d(k+m*i(j),n+m*f(j)),new d(k+m*i(l),n+m*f(l))]};a.prototype.center=function(){var j=this.x,m=this.y,k=this.radius,l=(this.startAngle+this.endAngle)/2;return new d(j+k*i(l),m+k*f(l))};a.prototype.normal=function(j,l){var k=j.minus(this.x,this.y).norm();if(l){var m=this.center().minus(l);m.dot(k)<0&&(k=k.times(-1))}return k};a.prototype.distance2=function(m,n){var t=m.x-this.x,s=m.y-this.y,q=e(s,t);if(this.startAngle<=q&&q<=this.endAngle){var o=new d(this.x+this.radius*i(q),this.y+this.radius*f(q));return b(m,o,n)}var r=this.points(),l=b(m,r[0],n),j=b(m,r[1],n);return l.cost<j.cost?l:j}}();!function(){var a=pv.Shape.Arc,b=pv.Shape.Line,d=pv.Shape.Point,i=Math.cos,f=Math.sin,h=Math.sqrt,e=pv.Shape.atan2Norm,g=pv.Shape.normalizeAngle;pv.Shape.Wedge=function(j,o,n,m,l,k){this.x=j;this.y=o;this.innerRadius=n;this.outerRadius=m;this.startAngle=g(l);this.angleSpan=g(k);this.endAngle=this.startAngle+this.angleSpan};var c=pv.Shape.Wedge;c.prototype=pv.extend(pv.Shape);c.prototype.clone=function(){return new c(this.x,this.y,this.innerRadius,this.outerRadius,this.startAngle,this.angleSpan)};c.prototype.apply=function(k){var j=k.x+k.k*this.x,n=k.y+k.k*this.y,l=k.k*this.innerRadius,m=k.k*this.outerRadius;return new c(j,n,l,m,this.startAngle,this.angleSpan)};c.prototype.containsPoint=function(n){var l=n.x-this.x,k=n.y-this.y,m=h(l*l+k*k);if(m>=this.innerRadius&&m<=this.outerRadius){var j=e(k,l);return this.startAngle<=j&&j<=this.endAngle}return !1};c.prototype.intersectsRect=function(n){var l,j,m=this.points();j=m.length;for(l=0;j>l;l++){if(m[l].intersectsRect(n)){return !0}}m=n.points();j=m.length;for(l=0;j>l;l++){if(this.containsPoint(m[l])){return !0}}var k=this.edges();j=k.length;for(l=0;j>l;l++){if(k[l].intersectsRect(n)){return !0}}return !1};c.prototype.points=function(){this._points||this.edges();return this._points};c.prototype.edges=function(){var p=this._edges;if(!p){var m,n,v=this.x,u=this.y,r=this.innerRadius,q=this.outerRadius,t=this.startAngle,z=this.endAngle,k=this.angleSpan,l=i(t),s=f(t),o=i(z),w=f(z);if(r>0){m=new d(v+r*l,u+r*s);n=new d(v+r*o,u+r*w)}else{m=n=new d(v,u)}var B=new d(v+q*l,u+q*s),j=new d(v+q*o,u+q*w);p=this._edges=[];r>0&&p.push(new a(v,u,r,t,k));p.push(new b(m.x,m.y,B.x,B.y),new a(v,u,q,t,k),new b(n.x,n.y,j.x,j.y));var A=this._points=[m,B,j];r>0&&A.push(n)}return p};c.prototype.distance2=function(m,j){var l={cost:1/0,dist2:1/0};this.edges().forEach(function(k){var n=k.distance2(m,j);n.cost<l.cost&&(l=n)});return l};c.prototype.center=function(){var k=(this.startAngle+this.endAngle)/2,j=(this.innerRadius+this.outerRadius)/2;return new d(this.x+j*i(k),this.y+j*f(k))}}();!function(){var b=Math.round,a=function(h){var g=parseFloat(h);return"%"==h[h.length-1]?b(2.55*g):g},e=/([a-z]+)\((.*)\)/i,c=function(o){if("#"===o.charAt(0)){var f,k,m;if(4===o.length){f=o.charAt(1);f+=f;k=o.charAt(2);k+=k;m=o.charAt(3);m+=m}else{if(7===o.length){f=o.substring(1,3);k=o.substring(3,5);m=o.substring(5,7)}}return pv.rgb(parseInt(f,16),parseInt(k,16),parseInt(m,16),1)}var q=e.exec(o);if(q){var p=q[2].split(","),n=1;switch(q[1]){case"hsla":case"rgba":n=parseFloat(p[3]);if(!n){return pv.Color.transparent}}switch(q[1]){case"hsla":case"hsl":var j=parseFloat(p[0]),t=parseFloat(p[1])/100,i=parseFloat(p[2])/100;return new pv.Color.Hsl(j,t,i,n).rgb();case"rgba":case"rgb":var f=a(p[0]),k=a(p[1]),m=a(p[2]);return pv.rgb(f,k,m,n)}}return new pv.Color(o,1)},d={};pv.color=function(g){if(g.rgb){return g.rgb()}var f=pv.Color.names[g];f||(f=d[g]||(d[g]=c(g)));return f}}();pv.Color=function(a,b){this.color=a;this.opacity=b;this.key="solid "+a+" alpha("+b+")"};pv.Color.prototype.hsl=function(){return this.rgb().hsl()};pv.Color.prototype.brighter=function(a){return this.rgb().brighter(a)};pv.Color.prototype.darker=function(a){return this.rgb().darker(a)};pv.Color.prototype.alphaBlend=function(e){var c=this.rgb(),b=c.a;if(1===b){return this}e=e?pv.color(e):pv.Color.names.white;e=e.rgb();var d=1-b;return pv.rgb(d*c.r+b*e.r,d*c.g+b*e.g,d*c.b+b*e.b,1)};pv.Color.prototype.rgbDecimal=function(b){var a=this.alphaBlend(b);return a.r<<16|a.g<<8|a.b};pv.Color.prototype.isDark=function(){return this.rgbDecimal()<8388607.5};pv.rgb=function(f,e,c,d){return new pv.Color.Rgb(f,e,c,4==arguments.length?d:1)};pv.Color.Rgb=function(f,e,c,d){pv.Color.call(this,d?"rgb("+f+","+e+","+c+")":"none",d);this.r=f;this.g=e;this.b=c;this.a=d};pv.Color.Rgb.prototype=pv.extend(pv.Color);pv.Color.Rgb.prototype.red=function(a){return pv.rgb(a,this.g,this.b,this.a)};pv.Color.Rgb.prototype.green=function(a){return pv.rgb(this.r,a,this.b,this.a)};pv.Color.Rgb.prototype.blue=function(a){return pv.rgb(this.r,this.g,a,this.a)};pv.Color.Rgb.prototype.alpha=function(b){return pv.rgb(this.r,this.g,this.b,b)};pv.Color.Rgb.prototype.rgb=function(){return this};pv.Color.Rgb.prototype.brighter=function(c){c=Math.pow(0.7,null!=c?c:1);var f=this.r,e=this.g,a=this.b,d=30;if(!f&&!e&&!a){return pv.rgb(d,d,d,this.a)}f&&d>f&&(f=d);e&&d>e&&(e=d);a&&d>a&&(a=d);return pv.rgb(Math.min(255,Math.floor(f/c)),Math.min(255,Math.floor(e/c)),Math.min(255,Math.floor(a/c)),this.a)};pv.Color.Rgb.prototype.darker=function(a){a=Math.pow(0.7,null!=a?a:1);return pv.rgb(Math.max(0,Math.floor(a*this.r)),Math.max(0,Math.floor(a*this.g)),Math.max(0,Math.floor(a*this.b)),this.a)};pv.Color.Rgb.prototype.hsl=function(){var f,n,a=this.r/255,i=this.g/255,k=this.b/255,m=Math.max(a,i,k),e=Math.min(a,i,k),c=(m+e)/2;if(m===e){f=n=0}else{var j=m-e;n=c>0.5?j/(2-m-e):j/(m+e);switch(m){case a:f=(i-k)/j+(k>i?6:0);break;case i:f=(k-a)/j+2;break;case k:f=(a-i)/j+4}f/=6}return pv.hsl(360*f,n,c,this.a)};pv.Color.Rgb.prototype.complementary=function(){return this.hsl().complementary().rgb()};pv.hsl=function(e,d,c,b){return new pv.Color.Hsl(e,d,c,4==arguments.length?b:1)};pv.Color.Hsl=function(e,d,c,b){pv.Color.call(this,"hsl("+e+","+100*d+"%,"+100*c+"%)",b);this.h=e;this.s=d;this.l=c;this.a=b};pv.Color.Hsl.prototype=pv.extend(pv.Color);pv.Color.Hsl.prototype.hsl=function(){return this};pv.Color.Hsl.prototype.hue=function(a){return pv.hsl(a,this.s,this.l,this.a)};pv.Color.Hsl.prototype.saturation=function(a){return pv.hsl(this.h,a,this.l,this.a)};pv.Color.Hsl.prototype.lightness=function(a){return pv.hsl(this.h,this.s,a,this.a)};pv.Color.Hsl.prototype.alpha=function(b){return pv.hsl(this.h,this.s,this.l,b)};pv.Color.Hsl.prototype.complementary=function(){return pv.hsl((this.h+180)%360,1-this.s,1-this.l,this.a)};pv.Color.Hsl.prototype.rgb=function(){function c(i){i>360?i-=360:0>i&&(i+=360);return 60>i?d+(b-d)*i/60:180>i?b:240>i?d+(b-d)*(240-i)/60:d}function g(i){return Math.round(255*c(i))}var f=this.h,e=this.s,a=this.l;f%=360;0>f&&(f+=360);e=Math.max(0,Math.min(e,1));a=Math.max(0,Math.min(a,1));var b=0.5>=a?a*(1+e):a+e-a*e,d=2*a-b;return pv.rgb(g(f+120),g(f),g(f-120),this.a)};pv.Color.names={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32",transparent:pv.Color.transparent=pv.rgb(0,0,0,0)};!function(){var b=pv.Color.names;b.none=b.transparent;for(var a in b){b[a]=pv.color(b[a])}}();pv.colors=function(){var a=pv.Scale.ordinal();a.range.apply(a,arguments);return a};pv.Colors={};pv.Colors.category10=function(){var a=pv.colors("#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf");a.domain.apply(a,arguments);return a};pv.Colors.category20=function(){var a=pv.colors("#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5");a.domain.apply(a,arguments);return a};pv.Colors.category19=function(){var a=pv.colors("#9c9ede","#7375b5","#4a5584","#cedb9c","#b5cf6b","#8ca252","#637939","#e7cb94","#e7ba52","#bd9e39","#8c6d31","#e7969c","#d6616b","#ad494a","#843c39","#de9ed6","#ce6dbd","#a55194","#7b4173");a.domain.apply(a,arguments);return a};!function(){function i(t){var q=j(t);if(!q.length){return null}var u,n,r,s=Math.PI,o=q[0];if(0===o.indexOf("to ")){n=/^to\s+(?:((top|bottom)(?:\s+(left|right))?)|((left|right)(?:\\s+(top|bottom))?))$/.exec(o);if(n){if(n[1]){u=n[2];n[3]&&(u+=" "+n[3])}else{u=n[5];n[6]&&(u=n[6]+" "+u)}s=pv.radians(k[u]);q.shift()}}else{r=parseFloat(o);if(!isNaN(r)){s=r;/^.*?deg$/.test(o)&&(s=pv.radians(s));q.shift()}}var p=g(q);switch(p.length){case 0:return null;case 1:return new pv.FillStyle.Solid(p[0].color,1)}return new pv.FillStyle.LinearGradient(s,p,t)}function c(p){var o=j(p);if(!o.length){return null}var n=g(o);switch(n.length){case 0:return null;case 1:return new pv.FillStyle.Solid(n[0].color,1)}return new pv.FillStyle.RadialGradient(50,50,n,p)}function j(q){var p={},n=0;q=q.replace(/\b\w+?\(.*?\)/g,function(r){var s="__color"+n++;p[s]=r;return s});var o=q.split(/\s*,\s*/);if(!o.length){return null}n&&o.forEach(function(s,r){p.hasOwnProperty(s)&&(o[r]=p[s])});return o}function g(s){function A(E){var G=w.length;if(G){for(var C=u,F=(E-C)/(G+1),D=0;G>D;D++){C+=F;w[D].offset=C}w.length=0}}for(var B=[],o=+1/0,u=-1/0,w=[],t=0,r=s.length;r>t;){var q=s[t++],p=/^(.+?)\s*([+\-]?[e\.\d]+%)?$/i.exec(q);if(p){var y={color:pv.color(p[1])},n=parseFloat(p[2]);isNaN(n)&&(B.length?t===r&&(n=Math.max(u,100)):n=0);B.push(y);if(isNaN(n)){w.push(y)}else{y.offset=n;A(n);n>u?u=n:u>n&&(n=u);o>n&&(o=n)}}}if(B.length>=2&&(0>o||u>100)){var z=[],x=[];B.forEach(function(C){z.push(C.offset);x.push(C.color)});var v=pv.scale.linear().domain(z).range(x);if(0>o){for(;B.length&&B[0].offset<=0;){B.shift()}B.unshift({offset:0,color:v(0)})}if(u>100){for(;B.length&&B[B.length-1].offset>=100;){B.pop()}B.push({offset:100,color:v(100)})}}return B}pv.fillStyle=function(p){if(p.type){return p}var o=p.key||p,n=b[o];n=n?n.clone():b[o]=d(p);return n};var b={},d=function(o){if(o.rgb){return new pv.FillStyle.Solid(o.color,o.opacity)}var n=/^\s*([a-z\-]+)\(\s*(.*?)\s*\)\s*$/.exec(o);if(n){switch(n[1]){case"linear-gradient":return i(n[2]);case"radial-gradient":return c(n[2])}}return new pv.FillStyle.Solid(pv.color(o))},k={top:0,"top right":45,right:90,"bottom right":135,bottom:180,"bottom left":225,left:270,"top left":315},a=pv.FillStyle=function(n){this.type=n;this.key=n};pv.extendType(a,new pv.Color("none",1));a.prototype.rgb=function(){var n=pv.color(this.color);this.opacity!==n.opacity&&(n=n.alpha(this.opacity));return n};a.prototype.alphaBlend=function(n){return this.rgb().alphaBlend(n)};a.prototype.rgbDecimal=function(n){return this.rgb().rgbDecimal(n)};a.prototype.isDark=function(){return this.rgb().isDark()};var e=pv.FillStyle.Solid=function(n,o){a.call(this,"solid");if(n.rgb){this.color=n.color;this.opacity=n.opacity}else{this.color=n;this.opacity=o}this.key+=" "+this.color+" alpha("+this.opacity+")"};pv.extendType(e,a);e.prototype.alpha=function(n){return new e(this.color,n)};e.prototype.brighter=function(n){return new e(this.rgb().brighter(n))};e.prototype.darker=function(n){return new e(this.rgb().darker(n))};e.prototype.complementary=function(){return new e(this.rgb().complementary())};e.prototype.clone=function(){var n=pv.extend(e);n.type=this.type;n.key=this.key;n.color=this.color;n.opacity=this.opacity;return n};pv.FillStyle.transparent=new e(pv.Color.transparent);var h=0,f=pv.FillStyle.Gradient=function(n,o){a.call(this,n);this.id=++h;this.stops=o;o.length&&(this.color=o[0].color.color);this.key+=" stops("+o.map(function(q){var p=q.color;return p.color+" alpha("+p.opacity+") at("+q.offset+")"}).join(", ")+")"};pv.extendType(f,a);f.prototype.rgb=function(){return this.stops.length?this.stops[0].color:void 0};f.prototype.alpha=function(n){return this._cloneWithStops(this.stops.map(function(o){return{offset:o.offset,color:o.color.alpha(n)}}))};f.prototype.darker=function(n){return this._cloneWithStops(this.stops.map(function(o){return{offset:o.offset,color:o.color.darker(n)}}))};f.prototype.brighter=function(n){return this._cloneWithStops(this.stops.map(function(o){return{offset:o.offset,color:o.color.brighter(n)}}))};f.prototype.complementary=function(){return this._cloneWithStops(this.stops.map(function(n){return{offset:n.offset,color:n.color.complementary()}}))};f.prototype.alphaBlend=function(n){return this._cloneWithStops(this.stops.map(function(o){return{offset:o.offset,color:o.color.alphaBlend(n)}}))};f.prototype.clone=function(){var n=this.constructor,q=pv.extend(n);q.constructor=n;q.id=++h;q.type=this.type;q.key=this.key;var p=this.stops;q.stops=p;p.length&&(q.color=p[0].color.color);this._initClone(q);return q};var l=pv.FillStyle.LinearGradient=function(o,n){f.call(this,"lineargradient",n);this.angle=o;this.key+=" angle("+o+")"};pv.extendType(l,f);l.prototype._cloneWithStops=function(n){return new l(this.angle,n)};l.prototype._initClone=function(n){n.angle=this.angle};var m=pv.FillStyle.RadialGradient=function(n,p,o){f.call(this,"radialgradient",o);this.cx=n;this.cy=p;this.key+=" center("+n+","+p+")"};pv.extendType(m,f);m.prototype._cloneWithStops=function(n){return new m(this.cx,this.cy,n)};m.prototype._initClone=function(n){n.cx=this.cx;n.cy=this.cy}}();pv.ramp=function(){var a=pv.Scale.linear();a.range.apply(a,arguments);return a};pv.Scene=pv.SvgScene={svg:"http://www.w3.org/2000/svg",xmlns:"http://www.w3.org/2000/xmlns",xlink:"http://www.w3.org/1999/xlink",xhtml:"http://www.w3.org/1999/xhtml",scale:1,events:["DOMMouseScroll","mousewheel","mousedown","mouseup","mouseover","mouseout","mousemove","click","dblclick","contextmenu"],mousePositionEventSet:{mousedown:1,mouseup:1,mouseover:1,mouseout:1,mousemove:1,click:1,dblclick:1,contextmenu:1},implicit:{svg:{"shape-rendering":"auto","pointer-events":"painted",x:0,y:0,dy:0,"text-anchor":"start",transform:"translate(0,0)",fill:"none","fill-opacity":1,stroke:"none","stroke-opacity":1,"stroke-width":1.5,"stroke-linejoin":"miter","stroke-linecap":"butt","stroke-miterlimit":8,"stroke-dasharray":"none"},css:{font:"10px sans-serif"}}};pv.SvgScene.updateAll=function(a){if(a.length&&a[0].reverse&&"line"!==a.type&&"area"!==a.type){for(var d=Object.create(a),c=0,b=a.length-1;b>=0;c++,b--){d[c]=a[b]}a=d}this.removeSiblings(this[a.type](a))};pv.SvgScene.create=function(a){return document.createElementNS(this.svg,a)};pv.SvgScene.expect=function(h,g,a,d,b,f){var c;if(h){c=h.tagName;if("defs"===c){h=h.nextSibling;h&&(c=h.tagName)}else{"a"===c&&(h=h.firstChild)}}if(h){if(c!==g){var j=this.create(g);h.parentNode.replaceChild(j,h);h=j}}else{h=this.create(g)}b&&this.setAttributes(h,b);f&&this.setStyle(h,f);return h};pv.SvgScene.setAttributes=function(f,a){var g=this.implicit.svg,c=f.__attributes__;c===a&&(c=null);for(var b in a){var d=a[b];c&&d===c[b]||(null==d||d==g[b]?f.removeAttribute(b):f.setAttribute(b,d))}f.__attributes__=a};pv.SvgScene.setStyle=function(g,c){var a=this.implicit.css,d=g.__style__;d===c&&(d=null);for(var b in c){var f=c[b];d&&f===d[b]||(null==f||f==a[b]?g.style.removeProperty(b):g.style[b]=f)}g.__style__=c};pv.SvgScene.append=function(c,a,b){c.$scene={scenes:a,index:b};c=this.title(c,a[b]);c.parentNode||a.$g.appendChild(c);return c.nextSibling};pv.SvgScene.title=function(g,f){var b=g.parentNode;b&&"a"!=b.tagName&&(b=null);if(f.title){if(!b){b=this.create("a");b.setAttributeNS(this.xlink,"xlink:href","");g.parentNode&&g.parentNode.replaceChild(b,g);b.appendChild(g)}b.setAttributeNS(this.xlink,"xlink:title",f.title);for(var d=null,h=g.firstChild;null!=h;h=h.nextSibling){if("title"==h.nodeName){d=h;break}}if(d){d.removeChild(d.firstChild)}else{d=this.create("title");g.appendChild(d)}d.appendChild(document.createTextNode(f.title));return b}b&&b.parentNode.replaceChild(g,b);return g};pv.SvgScene.dispatch=pv.listener(function(c){var a=c.target.$scene;if(a){var b=c.type;switch(b){case"DOMMouseScroll":b="mousewheel";c.wheel=-480*c.detail;break;case"mousewheel":c.wheel=(window.opera?12:1)*c.wheelDelta}if(pv.Mark.dispatch(b,a.scenes,a.index,c)){c.preventDefault();c.stopPropagation()}}});pv.SvgScene.removeSiblings=function(a){for(;a;){var b=a.nextSibling;"defs"!==a.nodeName&&a.parentNode.removeChild(a);a=b}};pv.SvgScene.undefined=function(){};!function(){var b={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"},a={shortdash:[3,1],shortdot:[1,1],shortdashdot:[3,1,1,1],shortdashdotdot:[3,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]};pv.SvgScene.isStandardDashStyle=function(c){return a.hasOwnProperty(c)};pv.SvgScene.translateDashStyleAlias=function(c){return b.hasOwnProperty(c)?b[c]:c};pv.SvgScene.parseDasharray=function(f){var d=f.strokeDasharray;if(d&&"none"!==d){d=this.translateDashStyleAlias(d);var e=a[d];d=e?e:d.split(/[\s,]+/);var c=f.lineWidth,h=f.lineCap||"butt",g="butt"===h;d=d.map(function(j,i){j=+j;g||(i%2?j++:j-=1);0>=j&&(j=0.001);return j*c/this.scale},this).join(" ")}else{d=null}return d}}();!function(){var a=/^url\(#/,d=1,g=Math.PI/2,e=g/2,c=Math.SQRT2/2,j=Math.abs,h=Math.sin,i=Math.cos,f=function(k){return j(k)<=1e-12?0:k};pv.SvgScene.addFillStyleDefinition=function(l,r){if(r.type&&"solid"!==r.type&&!a.test(r.color)){var q=l.mark.root,o=q.__fillStyleMap__||(q.__fillStyleMap__={}),n=r.key,m=o[n];if(!m){m=o[n]="__pvGradient"+d++;var p=b.call(this,l,r,m);q.scene.$defs.appendChild(p)}r.color="url(#"+m+")"}};var b=function(m,A,o){var p="lineargradient"===A.type,q=this.create(p?"linearGradient":"radialGradient");q.setAttribute("id",o);if(p){var k=A.angle-g,v=j(k%g)-e,l=j(c*i(v)),y=l*i(k),x=l*h(k);q.setAttribute("x1",f(0.5-y));q.setAttribute("y1",f(0.5-x));q.setAttribute("x2",f(0.5+y));q.setAttribute("y2",f(0.5+x))}for(var z=A.stops,t=z.length,u=0;t>u;u++){var w=z[u],n=q.appendChild(this.create("stop")),s=w.color;n.setAttribute("offset",w.offset+"%");n.setAttribute("stop-color",s.color);n.setAttribute("stop-opacity",s.opacity+"")}return q}}();pv.SvgScene.pathBasis=function(){function a(d,h,g,f,e){return{x:d[0]*h.left+d[1]*g.left+d[2]*f.left+d[3]*e.left,y:d[0]*h.top+d[1]*g.top+d[2]*f.top+d[3]*e.top}}var c=[[1/6,2/3,1/6,0],[0,2/3,1/3,0],[0,1/3,2/3,0],[0,1/6,2/3,1/6]],b=function(j,i,h,g){var f=a(c[1],j,i,h,g),e=a(c[2],j,i,h,g),d=a(c[3],j,i,h,g);return"C"+f.x+","+f.y+","+e.x+","+e.y+","+d.x+","+d.y};b.segment=function(k,j,i,h){var g=a(c[0],k,j,i,h),f=a(c[1],k,j,i,h),e=a(c[2],k,j,i,h),d=a(c[3],k,j,i,h);return["M"+g.x+","+g.y,"C"+f.x+","+f.y+","+e.x+","+e.y+","+d.x+","+d.y]};return b}();pv.SvgScene.curveBasis=function(g,d,e){var b;if(null==d){b=g.length;d=0;e=b-1}else{b=e-d+1}if(2>=b){return""}var k="",j=g[d],h=j,f=j,c=g[d+1];k+=this.pathBasis(j,h,f,c);for(var a=d+2;e>=a;a++){j=h;h=f;f=c;c=g[a];k+=this.pathBasis(j,h,f,c)}k+=this.pathBasis(h,f,c,c);k+=this.pathBasis(f,c,c,c);return k};pv.SvgScene.curveBasisSegments=function(j,f,g){var b;if(null==f){b=j.length;f=0;g=b-1}else{b=g-f+1}if(2>=b){return""}var m=[],l=j[f],k=l,h=l,e=j[f+1],c=this.pathBasis.segment(l,k,h,e);l=k;k=h;h=e;e=j[f+2];c[1]+=this.pathBasis(l,k,h,e);m.push(c);for(var a=f+3;g>=a;a++){l=k;k=h;h=e;e=j[a];m.push(this.pathBasis.segment(l,k,h,e))}var d=this.pathBasis.segment(k,h,e,e);d[1]+=this.pathBasis(h,e,e,e);m.push(d);return m};pv.SvgScene.curveHermite=function(l,h,j,k){var g;if(null==j){g=l.length;j=0;k=g-1}else{g=k-j+1}var b=h.length;if(1>b||g!==b&&g!==b+2){return""}var m=g!==b,q="",o=l[j],a=l[j+1],f=h[0],n=f,d=j+1;if(m){q+="Q"+(a.left-2*f.x/3)+","+(a.top-2*f.y/3)+","+a.left+","+a.top;o=l[j+1];d=j+2}if(b>1){n=h[1];a=l[d];d++;q+="C"+(o.left+f.x)+","+(o.top+f.y)+","+(a.left-n.x)+","+(a.top-n.y)+","+a.left+","+a.top;for(var c=2;b>c;c++,d++){a=l[d];n=h[c];q+="S"+(a.left-n.x)+","+(a.top-n.y)+","+a.left+","+a.top}}if(m){var e=l[d];q+="Q"+(a.left+2*n.x/3)+","+(a.top+2*n.y/3)+","+e.left+","+e.top}return q};pv.SvgScene.curveHermiteSegments=function(l,h,j,k){var g;if(null==j){g=l.length;j=0;k=g-1}else{g=k-j+1}var b=h.length;if(1>b||g!==b&&g!==b+2){return[]}var m=g!==b,q=[],o=l[j],a=o,f=h[0],n=f,d=j+1;if(m){a=l[j+1];q.push(["M"+o.left+","+o.top,"Q"+(a.left-2*n.x/3)+","+(a.top-2*n.y/3)+","+a.left+","+a.top]);d=j+2}for(var c=1;b>c;c++,d++){o=a;f=n;a=l[d];n=h[c];q.push(["M"+o.left+","+o.top,"C"+(o.left+f.x)+","+(o.top+f.y)+","+(a.left-n.x)+","+(a.top-n.y)+","+a.left+","+a.top])}if(m){var e=l[d];q.push(["M"+a.left+","+a.top,"Q"+(a.left+2*n.x/3)+","+(a.top+2*n.y/3)+","+e.left+","+e.top])}return q};pv.SvgScene.cardinalTangents=function(k,h,f,g){var c;if(null==f){c=k.length;f=0;g=c-1}else{c=g-f+1}for(var d=[],e=(1-h)/2,m=k[f],l=k[f+1],j=k[f+2],b=f+3;g>=b;b++){d.push({x:e*(j.left-m.left),y:e*(j.top-m.top)});m=l;l=j;j=k[b]}d.push({x:e*(j.left-m.left),y:e*(j.top-m.top)});return d};pv.SvgScene.curveCardinal=function(c,b,e,d){var a;if(null==e){a=c.length;e=0;d=a-1}else{a=d-e+1}return 2>=a?"":this.curveHermite(c,this.cardinalTangents(c,b,e,d),e,d)};pv.SvgScene.curveCardinalSegments=function(c,b,e,d){var a;if(null==e){a=c.length;e=0;d=a-1}else{a=d-e+1}return 2>=a?"":this.curveHermiteSegments(c,this.cardinalTangents(c,b,e,d),e,d)};pv.SvgScene.monotoneTangents=function(t,q,r){var n;if(null==q){n=t.length;q=0;r=n-1}else{n=r-q+1}var e,o=[],l=[],b=[],w=[],c=0;for(c=0;n-1>c;c++){e=q+c;var p=t[e+1].left-t[e].left;l[c]=Math.abs(p)<=1e-12?0:(t[e+1].top-t[e].top)/p}b[0]=l[0];w[0]=t[q+1].left-t[q].left;for(c=1,e=q+c;n-1>c;c++,e++){b[c]=(l[c-1]+l[c])/2;w[c]=(t[e+1].left-t[e-1].left)/2}b[c]=l[c-1];w[c]=t[e].left-t[e-1].left;for(c=0;n-1>c;c++){if(0==l[c]){b[c]=0;b[c+1]=0}}for(c=0;n-1>c;c++){if(!(Math.abs(b[c])<0.00001||Math.abs(b[c+1])<0.00001)){var h=b[c]/l[c],a=b[c+1]/l[c],v=h*h+a*a;if(v>9){var u=3/Math.sqrt(v);b[c]=u*h*l[c];b[c+1]=u*a*l[c]}}}for(var g,f=0;n>f;f++){g=1+b[f]*b[f];o.push({x:w[f]/3/g,y:b[f]*w[f]/3/g})}return o};pv.SvgScene.curveMonotone=function(b,d,c){var a;if(null==d){a=b.length;d=0;c=a-1}else{a=c-d+1}return 2>=a?"":this.curveHermite(b,this.monotoneTangents(b,d,c),d,c)};pv.SvgScene.curveMonotoneSegments=function(b,d,c){var a;if(null==d){a=b.length;d=0;c=a-1}else{a=c-d+1}return 2>=a?"":this.curveHermiteSegments(b,this.monotoneTangents(b,d,c),d,c)};pv.SvgScene.area=function(a){var d=a.$g.firstChild,c=a.length;if(!c){return d}var b=a[0];return"smart"===b.segmented?this.areaSegmentedSmart(d,a):b.segmented?this.areaSegmentedFull(d,a):this.areaFixed(d,a,0,c-1,!0)};pv.SvgScene.areaFixed=function(f,c,r,e,q){var g=e-r+1;if(1===g){return this.lineAreaDotAlone(f,c,r)}var n=c[r];if(!n.visible){return f}var u=n.fillStyle,h=n.strokeStyle;if(!u.opacity&&!h.opacity){return f}this.addFillStyleDefinition(c,u);this.addFillStyleDefinition(c,h);var k=!1,l=!1,o=!1,b=!1,m=!1;switch(n.interpolate){case"basis":k=!0;break;case"cardinal":l=!0;break;case"monotone":o=!0;break;case"step-after":b=!0;break;case"step-before":m=!0}for(var z,x,p=k||l||o,w=[],v=r;e>=v;v++){z=c[v];if(z.width||z.height){for(var t=v+1;e>=t;t++){x=c[t];if(!x.width&&!x.height){break}}v>r&&!b&&v--;e>=t&&!m&&t++;var y=p&&t-v>2?this.areaPathCurve:this.areaPathStraight;w.push(y.call(this,c,v,t-1,n));v=t-1}}if(!w.length){return f}var a=h.opacity;f=this.expect(f,"path",c,r,{"shape-rendering":n.antialias?null:"crispEdges","pointer-events":q?n.events:"none",cursor:n.cursor,d:"M"+w.join("ZM")+"Z",fill:u.color,"fill-opacity":u.opacity||null,stroke:h.color,"stroke-opacity":a||null,"stroke-width":a?n.lineWidth/this.scale:null,"stroke-linecap":n.lineCap,"stroke-linejoin":n.lineJoin,"stroke-miterlimit":n.strokeMiterLimit,"stroke-dasharray":a?this.parseDasharray(n):null});n.svg&&this.setAttributes(f,n.svg);n.css&&this.setStyle(f,n.css);return this.append(f,c,r)};pv.SvgScene.areaSegmentedSmart=function(b,a){return this.eachLineAreaSegment(b,a,function(g,c,i,j){var e=this.areaSegmentPaths(c,i,j),f=e.top,d=e.bottom,h=i,k={breakOnKeyChange:!0,from:i,to:j};return this.eachLineAreaSegment(g,c,k,function(p,l,q,r,n,t){var u=l[q],w=u.fillStyle,v=u.strokeStyle;this.addFillStyleDefinition(l,w);this.addFillStyleDefinition(l,v);if(q===r){return this.lineAreaDotAlone(p,l,q)}var o=this.areaJoinPaths(f,d,q-h,r-h-1),m=v.opacity,s={"shape-rendering":u.antialias?null:"crispEdges","pointer-events":t,cursor:u.cursor,d:o,fill:w.color,"fill-opacity":w.opacity||null,stroke:v.color,"stroke-opacity":m||null,"stroke-width":m?u.lineWidth/this.scale:null,"stroke-linecap":u.lineCap,"stroke-linejoin":u.lineJoin,"stroke-miterlimit":u.strokeMiterLimit,"stroke-dasharray":m?this.parseDasharray(u):null};p=this.expect(p,"path",l,q,s,u.css);return this.append(p,l,q)})})};pv.SvgScene.areaSegmentPaths=function(a,c,b){return this.areaSegmentCurvePaths(a,c,b)||this.areaSegmentStraightPaths(a,c,b)};pv.SvgScene.areaSegmentCurvePaths=function(a,l,m){var j=m-l+1,o=a[l],h="basis"===o.interpolate,n=!h&&"cardinal"===o.interpolate;if(h||n||"monotone"==o.interpolate){for(var g=[],b=[],f=0;j>f;f++){var e=a[l+f],d=a[m-f];g.push(e);b.push({left:d.left+d.width,top:d.top+d.height})}var k,c;if(h){k=this.curveBasisSegments(g);c=this.curveBasisSegments(b)}else{if(n){k=this.curveCardinalSegments(g,o.tension);c=this.curveCardinalSegments(b,o.tension)}else{k=this.curveMonotoneSegments(g);c=this.curveMonotoneSegments(b)}}if(k||k.length){return{from:l,top:k,bottom:c}}}};pv.SvgScene.areaSegmentStraightPaths=function(a,n,g){for(var q=[],h=[],e=g,b=n;e>n;n++,g--){var o=a[n],f=a[g],p=["M"+o.left+","+o.top],l=["M"+(f.left+f.width)+","+(f.top+f.height)],d=a[n+1],c=a[g-1];switch(o.interpolate){case"step-before":p.push("V"+d.top+"H"+d.left);break;case"step-after":p.push("H"+d.left+"V"+d.top);break;default:p.push("L"+d.left+","+d.top)}l.push("L"+(c.left+c.width)+","+(c.top+c.height));q.push(p);h.push(l)}return{from:b,top:q,bottom:h}};pv.SvgScene.areaJoinPaths=function(p,g,m,h){for(var a="",q="",o=p.length,f=m,c=o-1-h;h>=f;f++,c++){var n,e,d=p[f],b=g[c];if(f===m){n=d.join("");e="L"+b[0].substr(1)+b[1]}else{n=d[1];e=b[1]}a+=n;q+=e}return a+q+"Z"};pv.SvgScene.areaSegmentedFull=function(l,a){var m,g,k=a.length,t=this.areaSegmentCurvePaths(a,0,k-1);if(t){m=t.top;g=t.bottom}for(var j=(a[0],0);k-1>j;j++){var q=a[j],o=a[j+1];if(q.visible&&o.visible){var s=q.fillStyle,r=q.strokeStyle;if(s.opacity||r.opacity){var n;if(m){var c=m[j].join(""),b="L"+g[k-j-2].join("").substr(1);n=c+b+"Z"}else{var h=q,f=o;switch(q.interpolate){case"step-before":h=o;break;case"step-after":f=q}n="M"+q.left+","+h.top+"L"+o.left+","+f.top+"L"+(o.left+o.width)+","+(f.top+f.height)+"L"+(q.left+q.width)+","+(h.top+h.height)+"Z"}var p={"shape-rendering":q.antialias?null:"crispEdges","pointer-events":q.events,cursor:q.cursor,d:n,fill:s.color,"fill-opacity":s.opacity||null,stroke:r.color,"stroke-opacity":r.opacity||null,"stroke-width":r.opacity?q.lineWidth/this.scale:null};l=this.expect(l,"path",a,j,p);q.svg&&this.setAttributes(l,q.svg);q.css&&this.setStyle(l,q.css);l=this.append(l,a,j)}}}return l};pv.SvgScene.areaPathStraight=function(a,l,g,p){for(var o=[],b=[],e=g;e>=l;l++,g--){var m=a[l],f=a[g],n=m.left+","+m.top,h=f.left+f.width+","+(f.top+f.height);if(e>l){var d=a[l+1],c=a[g-1];switch(p.interpolate){case"step-before":n+="V"+d.top;h+="H"+(c.left+c.width);break;case"step-after":n+="H"+d.left;h+="V"+(c.top+c.height)}}o.push(n);b.push(h)}return o.concat(b).join("L")};pv.SvgScene.areaPathCurve=function(a,h,g,m){for(var e,b,l=[],c=[],d=g;d>=h;h++,g--){var f=a[g];l.push(a[h]);c.push({left:f.left+f.width,top:f.top+f.height})}switch(m.interpolate){case"basis":e=this.curveBasis(l);b=this.curveBasis(c);break;case"cardinal":e=this.curveCardinal(l,m.tension);b=this.curveCardinal(c,m.tension);break;default:e=this.curveMonotone(l);b=this.curveMonotone(c)}return l[0].left+","+l[0].top+e+"L"+c[0].left+","+c[0].top+b};pv.SvgScene.minBarWidth=1;pv.SvgScene.minBarHeight=1;pv.SvgScene.minBarLineWidth=0.2;pv.SvgScene.bar=function(b){for(var h=b.$g.firstChild,c=0;c<b.length;c++){var d=b[c];if(!(!d.visible||Math.abs(d.width)<=1e-10||Math.abs(d.height)<=1e-10)){d.width<this.minBarWidth&&(d.width=this.minBarWidth);d.height<this.minBarHeight&&(d.height=this.minBarHeight);var g=d.fillStyle,f=d.strokeStyle;if(g.opacity||f.opacity){this.addFillStyleDefinition(b,g);this.addFillStyleDefinition(b,f);var a;if(f.opacity){a=d.lineWidth;a=1e-10>a?0:Math.max(this.minBarLineWidth,a/this.scale)}else{a=null}h=this.expect(h,"rect",b,c,{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,x:d.left,y:d.top,width:Math.max(1e-10,d.width),height:Math.max(1e-10,d.height),fill:g.color,"fill-opacity":g.opacity||null,stroke:f.color,"stroke-opacity":f.opacity||null,"stroke-width":a,"stroke-linecap":d.lineCap,"stroke-dasharray":f.opacity?this.parseDasharray(d):null});d.svg&&this.setAttributes(h,d.svg);d.css&&this.setStyle(h,d.css);h=this.append(h,b,c)}}}return h};pv.SvgScene.dot=function(a){for(var x=a.$g.firstChild,v=0,h=a.length;h>v;v++){var k=a[v];if(k.visible){var u=k.fillStyle,q=u.opacity,g=k.strokeStyle,w=g.opacity;if(q||w){this.addFillStyleDefinition(a,u);this.addFillStyleDefinition(a,g);var o={"shape-rendering":k.antialias?null:"crispEdges","pointer-events":k.events,cursor:k.cursor,fill:u.color,"fill-opacity":q||null,stroke:g.color,"stroke-opacity":w||null,"stroke-width":w?k.lineWidth/this.scale:null,"stroke-linecap":k.lineCap,"stroke-dasharray":w?this.parseDasharray(k):null},c=k.shape||"circle",p=k.aspectRatio,b=k.shapeAngle,j=null;if("circle"===c){if(1===p){o.cx=k.left;o.cy=k.top;o.r=k.shapeRadius}else{c="ellipse";o.cx=o.cy=0;j="translate("+k.left+","+k.top+") ";b&&(j+="rotate("+pv.degrees(b)+") ");o.rx=k._width/2;o.ry=k._height/2}}else{var m=k.shapeRadius,f=m,d=m;if(p>0&&1!==p){var l=1/Math.sqrt(p),n=p*l;f*=n;d*=l}o.d=this.renderSymbol(c,k,f,d);c="path";j="translate("+k.left+","+k.top+") ";b&&(j+="rotate("+pv.degrees(b)+") ")}j&&(o.transform=j);x=this.expect(x,c,a,v,o);k.svg&&this.setAttributes(x,k.svg);k.css&&this.setStyle(x,k.css);x=this.append(x,a,v)}}}return x};!function(a){var b={};a.registerSymbol=function(d,e){b[d]=e;return a};a.renderSymbol=function(e,d,g,f){return b[e].call(a,d,e,g,f)};a.hasSymbol=function(d){return b.hasOwnProperty(d)};a.symbols=function(){return pv.keys(b)};var c=2/Math.sqrt(3);a.registerSymbol("circle",function(){throw new Error("Not implemented as a symbol")}).registerSymbol("cross",function(g,e,i,h){var d=(g.shapeRadius,-i),f=-h;return"M"+d+","+f+"L"+i+","+h+"M"+i+","+f+"L"+d+","+h}).registerSymbol("triangle",function(f,d,j,i){var h=i,e=j*c,k=-i,g=-e;return"M0,"+h+"L"+e+","+k+" "+g+","+k+"Z"}).registerSymbol("diamond",function(i,g,k,j){var d=k*Math.SQRT2,f=j*Math.SQRT2,e=-d,h=-f;return"M0,"+h+"L"+d+",0 0,"+f+" "+e+",0Z"}).registerSymbol("square",function(g,e,i,h){var d=-i,f=-h;return"M"+d+","+f+"L"+i+","+f+" "+i+","+h+" "+d+","+h+"Z"}).registerSymbol("tick",function(e,d,g,f){var h=-f*f;return"M0,0L0,"+h}).registerSymbol("bar",function(e,d,h,g){var f=g*g/2;return"M0,"+f+"L0,"+-f})}(pv.SvgScene);pv.SvgScene.image=function(a){for(var f=a.$g.firstChild,b=0;b<a.length;b++){var d=a[b];if(d.visible){f=this.fill(f,a,b);if(d.image){f=this.expect(f,"foreignObject",a,b,{cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height});d.svg&&this.setAttributes(f,d.svg);d.css&&this.setStyle(f,d.css);var g=f.firstChild||f.appendChild(document.createElementNS(this.xhtml,"canvas"));g.$scene={scenes:a,index:b};g.style.width=d.width;g.style.height=d.height;g.width=d.imageWidth;g.height=d.imageHeight;g.getContext("2d").putImageData(d.image,0,0)}else{f=this.expect(f,"image",a,b,{preserveAspectRatio:"none",cursor:d.cursor,x:d.left,y:d.top,width:d.width,height:d.height});d.svg&&this.setAttributes(f,d.svg);d.css&&this.setStyle(f,d.css);f.setAttributeNS(this.xlink,"xlink:href",d.url)}f=this.append(f,a,b);f=this.stroke(f,a,b)}}return f};pv.SvgScene.label=function(a){for(var d=a.$g.firstChild,c=0;c<a.length;c++){var k=a[c];if(k.visible){var h=k.textStyle;if(h.opacity&&k.text){var g=0,f=0,j=0,b="start";switch(k.textBaseline){case"middle":j=".35em";break;case"top":j=".71em";f=k.textMargin;break;case"bottom":f="-"+k.textMargin}switch(k.textAlign){case"right":b="end";g="-"+k.textMargin;break;case"center":b="middle";break;case"left":g=k.textMargin}d=this.expect(d,"text",a,c,{"pointer-events":k.events,cursor:k.cursor,x:g,y:f,dy:j,transform:"translate("+k.left+","+k.top+")"+(k.textAngle?" rotate("+180*k.textAngle/Math.PI+")":"")+(1!=this.scale?" scale("+1/this.scale+")":""),fill:h.color,"fill-opacity":h.opacity||null,"text-anchor":b},{font:k.font,"text-shadow":k.textShadow,"text-decoration":k.textDecoration});k.svg&&this.setAttributes(d,k.svg);k.css&&this.setStyle(d,k.css);d.firstChild?d.firstChild.nodeValue=k.text:d.appendChild(document.createTextNode(k.text));d=this.append(d,a,c)}}}return d};pv.SvgScene.line=function(a){var d=a.$g.firstChild,c=a.length;if(!c){return d}var b=a[0];return"smart"===b.segmented?this.lineSegmentedSmart(d,a):2>c?d:b.segmented?this.lineSegmentedFull(d,a):this.lineFixed(d,a)};pv.SvgScene.lineFixed=function(g,a){var f=a.length;if(1===f){return this.lineAreaDotAlone(g,a,0)}var m=a[0];if(!m.visible){return g}var k=m.fillStyle,l=m.strokeStyle;if(!k.opacity&&!l.opacity){return g}this.addFillStyleDefinition(a,k);this.addFillStyleDefinition(a,l);var h="M"+m.left+","+m.top,b=f>2;if(b){switch(m.interpolate){case"basis":h+=this.curveBasis(a);break;case"cardinal":h+=this.curveCardinal(a,m.tension);break;case"monotone":h+=this.curveMonotone(a);break;default:b=!1}}if(!b){for(var c=1;f>c;c++){h+=this.lineSegmentPath(a[c-1],a[c])}}var e=l.opacity,j={"shape-rendering":m.antialias?null:"crispEdges","pointer-events":m.events,cursor:m.cursor,d:h,fill:k.color,"fill-opacity":k.opacity||null,stroke:l.color,"stroke-opacity":e||null,"stroke-width":e?m.lineWidth/this.scale:null,"stroke-linecap":m.lineCap,"stroke-linejoin":m.lineJoin,"stroke-miterlimit":m.strokeMiterLimit,"stroke-dasharray":e?this.parseDasharray(m):null};g=this.expect(g,"path",a,0,j,m.css);m.svg&&this.setAttributes(g,m.svg);return this.append(g,a,0)};pv.SvgScene.lineSegmentedSmart=function(b,a){return this.eachLineAreaSegment(b,a,function(i,c,h,g){var f=this.lineSegmentPaths(c,h,g),e=h,d={breakOnKeyChange:!0,from:h,to:g};return this.eachLineAreaSegment(i,c,d,function(n,j,o,p,l,r){var s=j[o],u=s.fillStyle;this.addFillStyleDefinition(j,u);var t=s.strokeStyle;this.addFillStyleDefinition(j,t);if(o===p){return this.lineAreaDotAlone(n,j,o)}var m=this.lineJoinPaths(f,o-e,p-e-1),k=t.opacity,q={"shape-rendering":s.antialias?null:"crispEdges","pointer-events":r,cursor:s.cursor,d:m,fill:u.color,"fill-opacity":u.opacity||null,stroke:t.color,"stroke-opacity":k||null,"stroke-width":k?s.lineWidth/this.scale:null,"stroke-linecap":s.lineCap,"stroke-linejoin":s.lineJoin,"stroke-miterlimit":s.strokeMiterLimit,"stroke-dasharray":k?this.parseDasharray(s):null};n=this.expect(n,"path",j,o,q,s.css);return this.append(n,j,o)})})};pv.SvgScene.lineSegmentedFull=function(f,a){var m,o=a[0];switch(o.interpolate){case"basis":m=this.curveBasisSegments(a);break;case"cardinal":m=this.curveCardinalSegments(a,o.tension);break;case"monotone":m=this.curveMonotoneSegments(a)}for(var c=0,b=a.length-1;b>c;c++){var j=a[c],h=a[c+1];if(j.visible&&h.visible){var l=j.strokeStyle,k=pv.FillStyle.transparent;if(l.opacity){var g;if("linear"==j.interpolate&&"miter"==j.lineJoin){k=l;l=pv.FillStyle.transparent;g=this.pathJoin(a[c-1],j,h,a[c+2])}else{g=m?m[c].join(""):"M"+j.left+","+j.top+this.lineSegmentPath(j,h)}f=this.expect(f,"path",a,c,{"shape-rendering":j.antialias?null:"crispEdges","pointer-events":j.events,cursor:j.cursor,d:g,fill:k.color,"fill-opacity":k.opacity||null,stroke:l.color,"stroke-opacity":l.opacity||null,"stroke-width":l.opacity?j.lineWidth/this.scale:null,"stroke-linejoin":j.lineJoin});j.svg&&this.setAttributes(f,j.svg);j.css&&this.setStyle(f,j.css);f=this.append(f,a,c)}}}return f};pv.SvgScene.lineSegmentPath=function(f,d){var b=1;switch(f.interpolate){case"polar-reverse":b=0;case"polar":var c=d.left-f.left,a=d.top-f.top,h=1-f.eccentricity,g=Math.sqrt(c*c+a*a)/(2*h);if(0>=h||h>1){break}return"A"+g+","+g+" 0 0,"+b+" "+d.left+","+d.top;case"step-before":return"V"+d.top+"H"+d.left;case"step-after":return"H"+d.left+"V"+d.top}return"L"+d.left+","+d.top};pv.SvgScene.lineSegmentPaths=function(a,h,g){var f,e=a[h];switch(e.interpolate){case"basis":f=this.curveBasisSegments(a,h,g);break;case"cardinal":f=this.curveCardinalSegments(a,e.tension,h,g);break;case"monotone":f=this.curveMonotoneSegments(a,h,g)}if(!f||!f.length){f=[];for(var d=h+1;g>=d;d++){var c=a[d-1],b=a[d];f.push(["M"+c.left+","+c.top,this.lineSegmentPath(c,b)])}}return f};pv.strokeMiterLimit=4;pv.SvgScene.pathJoin=function(P,M,K,H){var w,e,A,N=[],t=M.lineWidth/this.scale,G=pv.vector(M.left,M.top),F=pv.vector(K.left,K.top),h=F.minus(G),n=h.perp().norm(),l=n.times(t/2),R=G.plus(l),I=G.minus(l),O=F.plus(l),L=F.minus(l);if(P&&P.visible){var J=pv.vector(P.left,P.top),q=G.minus(J),x=q.perp().norm(),S=x.plus(n).norm(),i=this.lineIntersect(G,S,R,h),j=this.lineIntersect(G,S,I,h);A=i.minus(j).length();var u=P.lineWidth/this.scale,C=(t+u)/2;e=A/C;w=M.strokeMiterLimit||pv.strokeMiterLimit;if(w>=e){N.push(j,i)}else{var o=h.times(-1),m=q.norm().plus(o.norm()).norm(),p=G.plus(m.times(C/2));m.dot(n)>=0?N.push(j,p,R):N.push(I,p,i)}}else{N.push(I,R)}if(H&&H.visible){var E=pv.vector(H.left,H.top),z=E.minus(F),f=z.perp().norm(),Q=f.plus(n).norm(),B=this.lineIntersect(F,Q,O,h),r=this.lineIntersect(F,Q,L,h);A=B.minus(r).length();var s=H.lineWidth/this.scale,v=(s+t)/2;e=A/v;w=K.strokeMiterLimit||pv.strokeMiterLimit;if(w>=e){N.push(B,r)}else{var g=z.times(-1),D=h.norm().plus(g.norm()).norm(),y=F.plus(D.times(v/2));D.dot(n)>=0?N.push(O,y,r):N.push(B,y,L)}}else{N.push(O,L)}var k=N.shift();return"M"+k.x+","+k.y+"L"+N.map(function(a){return a.x+","+a.y}).join(" ")};pv.SvgScene.lineIntersect=function(d,c,b,a){return d.plus(c.times(b.minus(d).dot(a.perp())/c.dot(a.perp())))};pv.SvgScene.lineJoinPaths=function(c,f,e){for(var b=c[f].join(""),a=f+1;e>=a;a++){b+=c[a][1]}return b};pv.SvgScene.lineAreaDotAlone=function(a){return a};pv.Scene.eventsToNumber={"":0,none:0,painted:1,all:2};pv.Scene.numberToEvents=["none","painted","all"];pv.SvgScene.eachLineAreaSegment=function(n,a,k,o){if("function"==typeof k){o=k;k=null}var p,c,g,b=pv.get(k,"breakOnKeyChange",!1),r=pv.get(k,"from")||0,q=pv.get(k,"to",a.length-1);if(b){c=[];g=[]}for(var j=r;q>=j;){var h=a[j];if(this.isSceneVisible(h)){p=this.eventsToNumber[h.events]||0;b&&this.lineAreaSceneKey(h,c);for(var d,m=j;;){var e=m+1;if(e>q){d=e;break}var l=a[e];if(!this.isSceneVisible(l)){d=e+1;break}p=Math.max(p,this.eventsToNumber[l.events]||0);m=e;if(b){this.lineAreaSceneKey(l,g);if(!this.equalSceneKeys(c,g)){d=m;break}}}n=o.call(this,n,a,j,m,k,this.numberToEvents[p]);j=d}else{j++}}return n};pv.SvgScene.lineAreaSceneKey=function(b,a){a[0]=b.fillStyle.key;a[1]=b.strokeStyle.key;a[2]=b.lineWidth;a[3]=b.strokeDasharray||"none";a[4]=b.interpolate;return a};pv.SvgScene.isSceneVisible=function(a){return a.visible&&(a.fillStyle.opacity>0||a.strokeStyle.opacity>0)};pv.SvgScene.equalSceneKeys=function(d,c){for(var b=0,a=d.length;a>b;b++){if(d[b]!==c[b]){return !1}}return !0};pv.SvgScene.panel=function(A){for(var w=A.$g,z=w&&w.firstChild,v=0,d=A.length;d>v;v++){var n=A[v];if(n.visible){if(!A.parent){var b=n.canvas;this.applyCanvasStyle(b);if(w&&w.parentNode!==b){w=b.firstChild;z=w&&w.firstChild}if(w){z&&"defs"===z.tagName&&(z=z.nextSibling)}else{w=this.createRootPanelElement();z=null;this.initRootPanelElement(w,A.mark);b.appendChild(w);A.$defs=w.appendChild(this.create("defs"));A.$g=w}w.setAttribute("width",n.width+n.left+n.right);w.setAttribute("height",n.height+n.top+n.bottom)}var l=null;if("hidden"===n.overflow){var a=this.addPanelClipPath(w,z,A,v,n);l=a.g;A.$g=w=l;z=a.next}z=this.fill(z,A,v);var r=this.scale,m=n.transform,h=n.left+m.x,f=n.top+m.y;this.scale*=m.k;if(n.children.length){for(var q={transform:"translate("+h+","+f+")"+(1!=m.k?" scale("+m.k+")":"")},p=this.getSortedChildScenes(A,v),u=0,o=p.length;o>u;u++){var c=p[u];c.$g=z=this.expect(z,"g",A,v,q);this.updateAll(c);z.parentNode||w.appendChild(z);z=z.nextSibling}}this.scale=r;z=this.stroke(z,A,v);if(l){A.$g=w=l.parentNode;z=l.nextSibling}}}return z};pv.SvgScene.applyCanvasStyle=function(a){a.style.display="inline-block"};pv.SvgScene.createRootPanelElement=function(){return this.create("svg")};pv.SvgScene.initRootPanelElement=function(b,a){b.setAttribute("font-size","10px");b.setAttribute("font-family","sans-serif");b.setAttribute("fill","none");b.setAttribute("stroke","none");b.setAttribute("stroke-width",1.5);this.disableElementSelection(b);this.listenRootPanelElement(b,a)};pv.SvgScene.listenRootPanelElement=function(e,a){for(var d=0,c=this.events,b=c.length;b>d;d++){e.addEventListener(c[d],this.dispatch,!1);a._registerBoundEvent(e,c[d],this.dispatch,!1)}};pv.SvgScene.disableElementSelection=function(a){a.setAttribute("style","-webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none;");if("undefined"!=typeof a.onselectstart){a.setAttribute("unselectable","on");a.onselectstart=function(){return !1}}};pv.SvgScene.addPanelClipPath=function(j,k,h,f,l){var c=pv.id().toString(36),d=this.expect(k,"g",h,f,{"clip-path":"url(#"+c+")"}),b=this.expect(d.firstChild,"clipPath",h,f,{id:c}),a=b.firstChild||b.appendChild(this.create("rect"));a.setAttribute("x",l.left);a.setAttribute("y",l.top);a.setAttribute("width",l.width);a.setAttribute("height",l.height);b.parentNode||d.appendChild(b);d.parentNode||j.appendChild(d);return{g:d,next:b.nextSibling}};pv.SvgScene.getSortedChildScenes=function(c,b){var a=c[b].children;if(c.mark._zOrderChildCount){a=a.slice(0);a.sort(function(e,d){var f=e.mark._zOrder-d.mark._zOrder;0===f&&(f=e.childIndex-d.childIndex);return f})}return a};pv.SvgScene.fill=function(f,d,a){var b=d[a],c=b.fillStyle;if(c.opacity||"all"==b.events){this.addFillStyleDefinition(d,c);f=this.expect(f,"rect",d,a,{"shape-rendering":b.antialias?null:"crispEdges","pointer-events":b.events,cursor:b.cursor,x:b.left,y:b.top,width:b.width,height:b.height,fill:c.color,"fill-opacity":c.opacity,stroke:null});f=this.append(f,d,a)}return f};pv.SvgScene.stroke=function(f,d,a){var b=d[a],c=b.strokeStyle;if(c.opacity||"all"==b.events){f=this.expect(f,"rect",d,a,{"shape-rendering":b.antialias?null:"crispEdges","pointer-events":"all"==b.events?"stroke":b.events,cursor:b.cursor,x:b.left,y:b.top,width:Math.max(1e-10,b.width),height:Math.max(1e-10,b.height),fill:null,stroke:c.color,"stroke-opacity":c.opacity,"stroke-width":b.lineWidth/this.scale,"stroke-linecap":b.lineCap,"stroke-dasharray":c.opacity?this.parseDasharray(b):null});f=this.append(f,d,a)}return f};pv.SvgScene.minRuleLineWidth=1;pv.SvgScene.rule=function(b){for(var g=b.$g.firstChild,c=0;c<b.length;c++){var d=b[c];if(d.visible){var f=d.strokeStyle;if(f.opacity){var a=d.lineWidth;a=1e-10>a?0:Math.max(this.minRuleLineWidth,a/this.scale);g=this.expect(g,"line",b,c,{"shape-rendering":d.antialias?null:"crispEdges","pointer-events":d.events,cursor:d.cursor,x1:d.left,y1:d.top,x2:d.left+d.width,y2:d.top+d.height,stroke:f.color,"stroke-opacity":f.opacity,"stroke-width":a,"stroke-linecap":d.lineCap,"stroke-dasharray":f.opacity?this.parseDasharray(d):null});d.svg&&this.setAttributes(g,d.svg);d.css&&this.setStyle(g,d.css);g=this.append(g,b,c)}}}return g};pv.SvgScene.wedge=function(b){for(var k=b.$g.firstChild,j=0;j<b.length;j++){var u=b[j];if(u.visible){var r=u.fillStyle,t=u.strokeStyle;if(r.opacity||t.opacity){var c,f=u.innerRadius,d=u.outerRadius,n=Math.abs(u.angle);if(n>=2*Math.PI){c=f?"M0,"+d+"A"+d+","+d+" 0 1,1 0,"+-d+"A"+d+","+d+" 0 1,1 0,"+d+"M0,"+f+"A"+f+","+f+" 0 1,1 0,"+-f+"A"+f+","+f+" 0 1,1 0,"+f+"Z":"M0,"+d+"A"+d+","+d+" 0 1,1 0,"+-d+"A"+d+","+d+" 0 1,1 0,"+d+"Z"}else{var m=Math.min(u.startAngle,u.endAngle),l=Math.max(u.startAngle,u.endAngle),h=Math.cos(m),g=Math.cos(l),q=Math.sin(m),o=Math.sin(l);c=f?"M"+d*h+","+d*q+"A"+d+","+d+" 0 "+(n<Math.PI?"0":"1")+",1 "+d*g+","+d*o+"L"+f*g+","+f*o+"A"+f+","+f+" 0 "+(n<Math.PI?"0":"1")+",0 "+f*h+","+f*q+"Z":"M"+d*h+","+d*q+"A"+d+","+d+" 0 "+(n<Math.PI?"0":"1")+",1 "+d*g+","+d*o+"L0,0Z"}this.addFillStyleDefinition(b,r);this.addFillStyleDefinition(b,t);k=this.expect(k,"path",b,j,{"shape-rendering":u.antialias?null:"crispEdges","pointer-events":u.events,cursor:u.cursor,transform:"translate("+u.left+","+u.top+")",d:c,fill:r.color,"fill-rule":"evenodd","fill-opacity":r.opacity||null,stroke:t.color,"stroke-opacity":t.opacity||null,"stroke-width":t.opacity?u.lineWidth/this.scale:null,"stroke-linejoin":u.lineJoin,"stroke-miterlimit":u.strokeMiterLimit,"stroke-linecap":u.lineCap,"stroke-dasharray":t.opacity?this.parseDasharray(u):null});u.svg&&this.setAttributes(k,u.svg);u.css&&this.setStyle(k,u.css);k=this.append(k,b,j)}}}return k};pv.Mark=function(){this.$properties=[];this.$propertiesMap={};this.$handlers={}};pv.Mark.prototype.properties={};pv.Mark.cast={};pv.Mark.prototype.property=function(b,a){this.hasOwnProperty("properties")||(this.properties=pv.extend(this.properties));this.properties[b]=!0;pv.Mark.prototype.propertyMethod(b,!1,pv.Mark.cast[b]=a);return this};pv.Mark.prototype.localProperty=function(b,a){this.hasOwnProperty("properties")||(this.properties=pv.extend(this.properties));this.properties[b]=!0;var c=pv.Mark.cast[b];a&&(pv.Mark.cast[b]=c=a);this.propertyMethod(b,!1,c);return this};pv.Mark.prototype.def=function(b,a){this.propertyMethod(b,!0);return this[b](arguments.length>1?a:null)};pv.Mark.prototype.propertyMethod=function(c,b,a){a||(a=pv.Mark.cast[c]);this[c]=function(f,e){if(b&&this.scene){var d=this.scene.defs;if(arguments.length){d[c]={id:null==f?0:pv.id(),value:null!=f&&a?a(f):f};return this}var h=d[c];return h?h.value:null}if(arguments.length){this.setPropertyValue(c,f,b,a,!1,e);return this}var g=this.instance();if(pv.propBuildMark===this&&1!==pv.propBuilt[c]){pv.propBuilt[c]=1;return g[c]=this.evalProperty(this.binds.properties[c])}return g[c]}};pv.Mark.funPropertyCaller=function(c,b){function d(){var e=c.apply(this,a);return null!=e?b(e):e}var a=pv.Mark.stack;return d};pv.Mark.prototype.setPropertyValue=function(b,m,c,f,a,n){var l=!c<<1|"function"==typeof m;1&l&&f?m=pv.Mark.funPropertyCaller(m,f):null!=m&&f&&(m=f(m));var e=this.$propertiesMap,k=this.$properties,d={name:b,id:pv.id(),value:m,type:l,tag:n},h=e[b];e[b]=d;if(h){for(var g=0,j=k.length;j>g;g++){if(k[g]===h){k.splice(g,1);break}}}k.push(d);if(a&&h&&3===l){d.proto=h;d.root=h.root||h}return d};pv.Mark.prototype.intercept=function(b,a,c){this.setPropertyValue(b,a,!1,pv.get(c,"noCast")?null:pv.Mark.cast[b],!0,pv.get(c,"tag"));return this};pv.Mark.prototype.propertyValue=function(b,a){var d=this.$propertiesMap[b];if(d){return d.value}if(a){if(this.proto){var c=this.proto._propertyValueRecursive(b);if(void 0!==c){return c}}return this.defaults._propertyValueRecursive(b)}};pv.Mark.prototype._propertyValueRecursive=function(a){var b=this.$propertiesMap[a];return b?b.value:this.proto?this.proto._propertyValueRecursive(a):void 0};pv.Mark.stack=[];pv.Mark.prototype.property("data").property("visible",Boolean).property("css",Object).property("svg",Object).property("left",Number).property("right",Number).property("top",Number).property("bottom",Number).property("cursor",String).property("title",String).property("reverse",Boolean).property("antialias",Boolean).property("events",String).property("id",String);pv.Mark.prototype.childIndex=-1;pv.Mark.prototype.index=-1;pv.Mark.prototype.scale=1;pv.Mark.prototype._zOrder=0;pv.Mark.prototype.defaults=new pv.Mark().data(function(a){return[a]}).visible(!0).antialias(!0).events("painted");pv.Mark.prototype.extend=function(a){this.proto=a;this.target=a.target;return this};pv.Mark.prototype.add=function(a){return this.parent.add(a).extend(this)};pv.Mark.prototype.zOrder=function(a){if(!arguments.length){return this._zOrder}a=+a||0;if(this._zOrder!==a){var b=this.parent;b&&0!==this._zOrder&&b._zOrderChildCount--;this._zOrder=a;b&&0!==this._zOrder&&b._zOrderChildCount++}return this};pv.Mark.prototype.anchor=function(a){return new pv.Anchor(this).name(a||"center").data(function(){return this.scene.target.map(function(b){return b.data})}).visible(function(){return this.scene.target[this.index].visible}).id(function(){return this.scene.target[this.index].id}).left(function(){var c=this.scene.target[this.index],b=c.width||0;switch(this.name()){case"bottom":case"top":case"center":return c.left+b/2;case"left":return null}return c.left+b}).top(function(){var c=this.scene.target[this.index],b=c.height||0;switch(this.name()){case"left":case"right":case"center":return c.top+b/2;case"top":return null}return c.top+b}).right(function(){var b=this.scene.target[this.index];return"left"==this.name()?b.right+(b.width||0):null}).bottom(function(){var b=this.scene.target[this.index];return"top"==this.name()?b.bottom+(b.height||0):null}).textAlign(function(){switch(this.name()){case"bottom":case"top":case"center":return"center";case"right":return"right"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"top"}return"bottom"})};pv.Mark.prototype.anchorTarget=function(){return this.target};pv.Mark.prototype.margin=function(a){return this.left(a).right(a).top(a).bottom(a)};pv.Mark.prototype.instance=function(c){var b=this.scene||this.parent.instance(-1).children[this.childIndex],a=null==c||this.hasOwnProperty("index")?this.index:c;return b[0>a?b.length-1:a]};pv.Mark.prototype.instances=function(d){for(var f,g=this,b=[];!(f=g.scene);){b.push({index:d.parentIndex,childIndex:g.childIndex});d=d.parent;g=g.parent}for(var a=b.length;a--;){var e=b[a];f=f[e.index].children[e.childIndex]}if(this.hasOwnProperty("index")){var c=pv.extend(f[this.index]);c.right=c.top=c.left=c.bottom=0;return[c]}return f};pv.Mark.prototype.first=function(){return this.scene[0]};pv.Mark.prototype.last=function(){return this.scene[this.scene.length-1]};pv.Mark.prototype.sibling=function(){return 0==this.index?null:this.scene[this.index-1]};pv.Mark.prototype.cousin=function(){var b=this.parent,a=b&&b.sibling();return a&&a.children?a.children[this.childIndex][this.index]:null};pv.Mark.prototype._renderId=0;pv.Mark.prototype.renderId=function(){return this.root._renderId};pv.Mark.prototype.render=function(){var a=this.root;if(!this.parent||a.scene){a._renderId++;this.renderCore()}else{a.render()}};pv.Mark.prototype.renderCore=function(){function a(p,m,l){p.scale=l;if(g>m){var e=m>=h.length;e&&h.unshift(null);if(p.hasOwnProperty("index")){j(p,m,l,e)}else{for(var k=0,o=p.scene.length;o>k;k++){p.index=k;j(p,m,l,e)}delete p.index}e&&h.shift()}else{p.build();pv.Scene.scale=l;pv.Scene.updateAll(p.scene)}delete p.scale}function j(m,o,l,q){var p,t=m.scene[m.index];if(t.visible){var r=m.children,e=t.children,n=d[o],k=r[n];k.scene||n++;for(p=0;n>p;p++){r[p].scene=e[p]}q&&(h[0]=t.data);a(k,o+1,l*t.transform.k);for(p=0;n>p;p++){r[p].scene=void 0}}}for(var i=this.parent,h=pv.Mark.stack,c=h.length,d=[],b=this;b.parent;b=b.parent){d.unshift(b.childIndex)}var g=d.length;this.bind();for(;i&&!i.hasOwnProperty("index");){i=i.parent}try{this.context(i?i.scene:void 0,i?i.index:-1,function(){a(this.root,0,1)})}catch(f){h.length>c&&(h.length=c);throw f}};pv.Mark.prototype.bind=function(){function k(v){do{for(var r=v.$properties,q=r.length;q--;){var s=r[q],o=s.name,u=b[o];if(u){if(3===u.type){var t=u.root;u.root=s;t?t.proto||(t.proto=s):u.proto=s}}else{b[o]=s;switch(o){case"data":g=s;break;case"visible":case"id":l.push(s);break;default:h[s.type].push(s)}}}}while(v=v.proto)}var g,b={},l=[],h=[[],[],[],[]];k(this);k(this.defaults);var n=h[0],m=h[1].reverse(),j=h[2];h[3].reverse();var d=this;do{for(var c in d.properties){c in b||j.push(b[c]={name:c,type:2,value:null})}}while(d=d.proto);var e;if(n.length||m.length){e=n.concat(m);for(var f=0,a=e.length;a>f;f++){this.propertyMethod(e[f].name,!0)}}else{e=[]}this.binds={properties:b,data:g,defs:e,required:l,optional:pv.blend(h)}};pv.Mark.prototype.build=function(){var m=pv.Mark.stack,h=this.scene;if(!h){h=this.scene=[];h.mark=this;h.type=this.type;h.childIndex=this.childIndex;var n=this.parent;if(n){h.parent=n.scene;h.parentIndex=n.index}}this.target&&(h.target=this.target.instances(h));var q=this.binds.defs;if(q.length){for(var e=h.defs||(h.defs={}),f=0,b=q.length;b>f;f++){var c=q[f],k=e[c.name];(!k||c.id>k.id)&&(e[c.name]={id:0,value:1&c.type?c.value.apply(this,m):c.value})}}var g=this.evalProperty(this.binds.data),l=g.length;h.length=l;if(l){var j=pv.Mark.prototype;m.unshift(null);var r=pv.propBuildMark,a=pv.propBuilt;pv.propBuildMark=this;try{for(var f=0;l>f;f++){j.index=this.index=f;pv.propBuilt={};var o=h[f];o?o._state&&delete o._state:o=h[f]={};o.data=m[0]=g[f];this.preBuildInstance(o);this.buildInstance(o)}}finally{j.index=-1;delete this.index;m.shift();pv.propBuildMark=r;pv.propBuilt=a}}return this};pv.Mark.prototype.instanceState=function(a){a||(a=this.instance());return a?a._state||(a._state={}):null};pv.Mark.prototype.preBuildInstance=function(){};pv.Mark.prototype.buildInstance=function(a){this.buildProperties(a,this.binds.required);if(a.visible){this.buildProperties(a,this.binds.optional);this.buildImplied(a)}};!function(){var b,a=pv.Mark.stack,c=[function(d){return this.scene.defs[d.name].value},null,function(d){return d.value},function(d){b=d.proto;return d.value.apply(this,a)}];c[1]=c[0];pv.Mark.prototype.buildProperties=function(m,k){var e=pv.propBuilt,f=!e;if(f){pv.propBuildMark=this;pv.propBuilt=e={}}for(var l=b,h=0,j=k.length;j>h;h++){var d=k[h],g=d.name;if(!(g in e)){e[g]=1;m[g]=c[d.type].call(this,d)}}b=l;f&&(pv.propBuildMark=pv.propBuilt=null)};pv.Mark.prototype.evalProperty=function(f){var e=b,d=c[f.type].call(this,f);b=e;return d};pv.Mark.prototype.evalInPropertyContext=function(h,e){var g=b;b=e;var d=h.apply(this,a);b=g;return d};pv.Mark.prototype.delegate=function(e,d){if(b&&(!d||b.tag===d)){var f=this.evalProperty(b);if(void 0!==f){return f}}return e};pv.Mark.prototype.delegateExcept=function(d,f){if(b&&(!f||b.tag!==f)){var e=this.evalProperty(b);if(void 0!==e){return e}}return d};pv.Mark.prototype.hasDelegate=function(d){return !(!b||d&&b.tag!==d)}}();pv.Mark.prototype.buildImplied=function(o){var e,k,f=o.left,a=o.right,n=o.top,i=o.bottom,d=this.properties,j=d.width?o.width:0,g=d.height?o.height:0;if(null==j||null==a||null==f){e=this.parent&&this.parent.instance();k=!0;var c=e?e.width:j+f+a;null==j?j=c-(a=a||0)-(f=f||0):null==a?null==f?f=a=(c-j)/2:a=c-j-f:f=c-j-a}if(null==g||null==i||null==n){k||(e=this.parent&&this.parent.instance());var m=e?e.height:g+n+i;null==g?g=m-(n=n||0)-(i=i||0):null==i?i=null==n?n=(m-g)/2:m-g-n:n=m-g-i}o.left=f;o.right=a;o.top=n;o.bottom=i;d.width&&(o.width=j);d.height&&(o.height=g);d.textStyle&&!o.textStyle&&(o.textStyle=pv.FillStyle.transparent);d.fillStyle&&!o.fillStyle&&(o.fillStyle=pv.FillStyle.transparent);d.strokeStyle&&!o.strokeStyle&&(o.strokeStyle=pv.FillStyle.transparent)};pv.Mark.prototype.mouse=function(){var b=this.root.canvas(),h=pv.event,i=h&&h.pageX||0,g=h&&h.pageY||0,c=pv.elementOffset(b);if(c){var d=pv.cssStyle(b);i-=c.left+parseFloat(d("paddingLeft")||0);g-=c.top+parseFloat(d("paddingTop")||0)}var j=pv.Transform.identity,a=this.properties.transform?this:this.parent,f=[];do{f.push(a)}while(a=a.parent);for(;a=f.pop();){var e=a.instance();j=j.translate(e.left,e.top).times(e.transform)}j=j.invert();return pv.vector(i*j.k+j.x,g*j.k+j.y)};pv.Mark.prototype.event=function(c,b){b=pv.functor(b);var a=this.$handlers[c];a?a instanceof Array?a.push(b):a=[a,b]:a=b;this.$hasHandlers=!0;this.$handlers[c]=a;return this};pv.Mark.prototype.context=function(a,g,e){function k(s,u){pv.Mark.scene=s;b.index=u;if(s){var r,t=s.mark,o=t,v=[];do{v.push(o);j.push(s[u].data);o.index=u;o.scene=s;if(o=o.parent){u=s.parentIndex;s=s.parent}}while(o);var p=1;r=v.length-1;if(r>0){do{o=v[r--];o.scale=p;p*=o.scene[o.index].transform.k}while(r)}t.scale=p;var m,l=t.children;if(l&&(m=l.length)>0){var f=t.scene[t.index];p*=f.transform.k;var q=f.children;r=m;for(;r--;){o=l[r];o.scene=q[r];o.scale=p}}}}function c(p){if(p){var q,o=p.mark,l=o.children;if(l){for(var f=l.length;f--;){q=l[f];q.scene=void 0;q.scale=1}}q=o;var m,n=0;do{n++;delete q.index;if(m=q.parent){q.scene=void 0;q.scale=1}}while(q=m);n&&(j.length-=n)}}var b=pv.Mark.prototype,j=pv.Mark.stack,d=pv.Mark.scene,h=b.index;if(a&&a===d&&g===h){try{e.apply(this,j)}catch(i){pv.error(i);throw i}finally{pv.Mark.scene=d;b.index=h}}else{c(d,h);k(a,g);try{e.apply(this,j)}catch(i){pv.error(i);throw i}finally{c(a,g);k(d,h)}}};pv.Mark.prototype.getEventHandler=function(d,a,b,e){var c=this.$handlers[d];return c?[c,a,b,e]:this.getParentEventHandler(d,a,b,e)};pv.Mark.prototype.getParentEventHandler=function(d,a,b,e){var c=a.parent;return c?c.mark.getEventHandler(d,c,a.parentIndex,e):void 0};pv.Mark.dispatch=function(h,b,f,a){var j=b.mark.root;if(j.$transition){return !0}var d,c=j.$interceptors&&j.$interceptors[h];if(c){for(var e=0,g=c.length;g>e;e++){d=c[e](h,a);if(d){break}if(d===!1){return !0}}}if(!d){d=b.mark.getEventHandler(h,b,f,a);if(!d){return !1}}return this.handle.apply(this,d)};pv.Mark.handle=function(d,b,c,e){var a=b.mark;a.context(b,c,function(){var k,g,h,f=pv.Mark.stack.concat(e);if(d instanceof Array){var j;for(k=0,g=d.length;g>k;k++){h=d[k].apply(a,f);h&&h.render&&(j||(j=[])).push(h)}if(j){for(k=0,g=j.length;g>k;k++){j[k].render()}}}else{h=d.apply(a,f);h&&h.render&&h.render()}});return !0};pv.Mark.prototype.addEventInterceptor=function(c,b,e){var a=this.root;if(a){var f=a.$interceptors||(a.$interceptors={}),d=f[c]||(f[c]=[]);e?d.unshift(b):d.push(b)}};pv.Mark.prototype.eachInstance=function(c,b){function f(n,i,p){var h=n.length;if(h>0){var l,j=i===a;j||(l=d[i]);for(var o=0;h>o;o++){var q=n[o];if(q.visible){if(i===a){c.call(b,n,o,p)}else{var k=q.children[l];if(k){var m=p.times(q.transform).translate(q.left,q.top);f(k,i+1,m)}}}}}}for(var g=this,d=[];g.parent;){d.unshift(g.childIndex);g=g.parent}var e=g.scene;if(e){var a=d.length;f(e,0,pv.Transform.identity)}};pv.Mark.prototype.toScreenTransform=function(){var a=pv.Transform.identity;this instanceof pv.Panel&&(a=a.translate(this.left(),this.top()).times(this.transform()));var b=this.parent;if(b){do{a=a.translate(b.left(),b.top()).times(b.transform())}while(b=b.parent)}return a};pv.Mark.prototype.transition=function(){return new pv.Transition(this)};pv.Mark.prototype.on=function(a){return this["$"+a]=new pv.Transient(this)};pv.Mark.prototype.getShape=function(a,c,b){var e=a[c];if(!e.visible){return null}null==b&&(b=0);var d="_shape_inset_"+b;return e[d]||(e[d]=this.getShapeCore(a,c,b))};pv.Mark.prototype.getShapeCore=function(b,e,k){var j=b[e],c=j.left,i=j.top,g=j.width,d=j.height;if(k>0&&1>=k){var a=k*g,f=k*d;c+=a;i+=f;g-=2*a;d-=2*f}return new pv.Shape.Rect(c,i,g,d)};pv.Anchor=function(a){pv.Mark.call(this);this.target=a;this.parent=a.parent};pv.Anchor.prototype=pv.extend(pv.Mark).property("name",String);pv.Anchor.prototype.extend=function(a){this.proto=a;return this};pv.Area=function(){pv.Mark.call(this)};pv.Area.castSegmented=function(a){if(!a){return""}switch(a){case"smart":case"full":break;default:a="full"}return a};pv.Area.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("lineJoin",String).property("strokeMiterLimit",Number).property("lineCap",String).property("strokeDasharray",String).property("strokeStyle",pv.fillStyle).property("fillStyle",pv.fillStyle).property("segmented",pv.Area.castSegmented).property("interpolate",String).property("tension",Number);pv.Area.prototype.type="area";pv.Area.prototype.defaults=new pv.Area().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).interpolate("linear").tension(0.7).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none");pv.Area.prototype.buildImplied=function(a){null==a.height&&(a.height=0);null==a.width&&(a.width=0);pv.Mark.prototype.buildImplied.call(this,a)};pv.Area.fixed={lineWidth:1,lineJoin:1,strokeMiterLimit:1,lineCap:1,strokeStyle:1,strokeDasharray:1,fillStyle:1,segmented:1,interpolate:1,tension:1};pv.Area.prototype.bind=function(){pv.Mark.prototype.bind.call(this);for(var c=this.binds,e=c.required,a=c.optional,b=0,f=a.length;f>b;b++){var d=a[b];d.fixed=d.name in pv.Area.fixed;if("segmented"==d.name){e.push(d);a.splice(b,1);b--;f--}}this.binds.$required=e;this.binds.$optional=a};pv.Area.prototype.buildInstance=function(c){function g(f){return !f.fixed||(e.push(f),!1)}var b=this.binds;if(this.index){var e=b.fixed;if(!e){e=b.fixed=[];b.required=b.required.filter(g);this.scene[0].segmented||(b.optional=b.optional.filter(g))}var j=e.length;if(j){for(var d=this.scene[0],a=0;j>a;a++){var h=e[a].name;c[h]=d[h]}}}else{b.required=b.$required;b.optional=b.$optional;b.fixed=null}pv.Mark.prototype.buildInstance.call(this,c)};pv.Area.prototype.anchor=function(a){return pv.Mark.prototype.anchor.call(this,a).interpolate(function(){return this.scene.target[this.index].interpolate}).eccentricity(function(){return this.scene.target[this.index].eccentricity}).tension(function(){return this.scene.target[this.index].tension})};pv.Area.prototype.getEventHandler=function(h,b,d,i){var k=b[d],e=1===pv.Scene.mousePositionEventSet[h]&&!k.segmented||"smart"===k.segmented;if(!e){return pv.Mark.prototype.getEventHandler.call(this,h,b,d,i)}var j=this.$handlers[h],g="mousemove"===h,f=g?this.$handlers.mouseover:null;if(!j&&!f){return this.getParentEventHandler(h,b,d,i)}var c=this.getNearestInstanceToMouse(b,d);if(j){if(f){var a=this._mouseOverScene;if(!a||a!==b||this._mouseOverIndex!==c){this._mouseOverScene=b;this._mouseOverIndex=c;return[[j,f],b,c,i]}}return[j,b,c,i]}return[f,b,c,i]};pv.Area.prototype.getNearestInstanceToMouse=function(e,a){for(var b=this.mouse(),c=1/0,f=null,g=a,i=e.length;i>g;g++){var h=this.getShape(e,g);if(h){if(h.containsPoint(b)){return g}var d=h.distance2(b).dist2;if(c>d){c=d;f=g}}}return null!=f?f:a};pv.Area.prototype.getShapeCore=function(b,e){var m=b[e],l=m.width||0,d=m.height||0,j=m.left,i=m.top,k=e+1<b.length?b[e+1]:null;if(!k||!k.visible){return new pv.Shape.Line(j,i,j+l,i+d)}var a=k.left,g=k.top,f=k.height||0,c=k.width||0;return new pv.Shape.Polygon([new pv.Vector(j,i),new pv.Vector(a,g),new pv.Vector(a+c,g+f),new pv.Vector(j+l,i+d)])};pv.Bar=function(){pv.Mark.call(this)};pv.Bar.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("fillStyle",pv.fillStyle).property("lineCap",String).property("strokeDasharray",String);pv.Bar.prototype.type="bar";pv.Bar.prototype.defaults=new pv.Bar().extend(pv.Mark.prototype.defaults).lineWidth(1.5).fillStyle(pv.Colors.category20().by(pv.parent)).lineCap("butt").strokeDasharray("none");pv.Dot=function(){pv.Mark.call(this)};pv.Dot.prototype=pv.extend(pv.Mark).property("shape",String).property("shapeAngle",Number).property("shapeRadius",Number).property("shapeSize",Number).property("aspectRatio",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineCap",String).property("strokeDasharray",String).property("fillStyle",pv.fillStyle);pv.Dot.prototype.type="dot";pv.Dot.prototype.defaults=new pv.Dot().extend(pv.Mark.prototype.defaults).shape("circle").aspectRatio(1).lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).lineCap("butt").strokeDasharray("none");pv.Dot.prototype.anchor=function(a){return pv.Mark.prototype.anchor.call(this,a).left(function(){var b=this.scene.target[this.index];switch(this.name()){case"bottom":case"top":case"center":return b.left;case"left":return null}return b.left+b._width/2}).right(function(){var b=this.scene.target[this.index];return"left"==this.name()?b.right+b._width/2:null}).top(function(){var b=this.scene.target[this.index];switch(this.name()){case"left":case"right":case"center":return b.top;case"top":return null}return b.top+b._height/2}).bottom(function(){var b=this.scene.target[this.index];return"top"==this.name()?b.bottom+b._height/2:null}).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center"}return"left"}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"bottom":return"top"}return"bottom"})};pv.Dot.prototype.buildImplied=function(e){var f=e.shapeRadius,g=e.shapeSize,c=e.aspectRatio||1;if(null==f){if(null==g){g=e.shapeSize=20.25;f=e.shapeRadius=4.5}else{f=e.shapeRadius=Math.sqrt(g)}}else{null==g&&(g=e.shapeSize=f*f)}var d,b;if(1===c||0>c){d=b=2*f}else{d=2*f/Math.sqrt(c);b=c*d}e._height=d;e._width=b;pv.Mark.prototype.buildImplied.call(this,e)};pv.Dot.prototype.width=function(){return this.instance()._width};pv.Dot.prototype.height=function(){return this.instance()._height};pv.Dot.prototype.getShapeCore=function(b,d){var f=b[d],e=f._width,c=f._height,a=f.left,g=f.top;switch(f.shape){case"diamond":e*=Math.SQRT2;c*=Math.SQRT2;case"square":case"cross":return new pv.Shape.Rect(a-c/2,g-e/2,c,e)}return new pv.Shape.Circle(a,g,f.shapeRadius)};pv.Label=function(){pv.Mark.call(this)};pv.Label.prototype=pv.extend(pv.Mark).property("text",String).property("font",String).property("textAngle",Number).property("textStyle",pv.color).property("textAlign",String).property("textBaseline",String).property("textMargin",Number).property("textDecoration",String).property("textShadow",String);pv.Label.prototype.type="label";pv.Label.prototype.defaults=new pv.Label().extend(pv.Mark.prototype.defaults).events("none").text(pv.identity).font("10px sans-serif").textAngle(0).textStyle("black").textAlign("left").textBaseline("bottom").textMargin(3);pv.Label.prototype.getShapeCore=function(b,e,m){var j=b[e],k=pv.Text.measure(j.text,j.font),c=j.left,i=j.top,g=k.width,d=k.height;if(m>0&&1>=m){var a=m*g,f=m*d;c+=a;i+=f;g-=2*a;d-=2*f}return pv.Label.getPolygon(g,d,j.textAlign,j.textBaseline,j.textAngle,j.textMargin).apply(pv.Transform.identity.translate(c,i))};pv.Label.getPolygon=function(f,i,d,e,b,c){var j,h;switch(e){case"middle":h=i/2;break;case"top":h=c+i;break;case"bottom":h=-c}switch(d){case"right":j=-c-f;break;case"center":j=-f/2;break;case"left":j=c}var a=new pv.Vector(j,h),l=a.plus(f,0),g=l.plus(0,-i),k=a.plus(0,-i);if(0!==b){a=a.rotate(b);l=l.rotate(b);k=k.rotate(b);g=g.rotate(b)}return new pv.Shape.Polygon([a,l,g,k])};pv.Line=function(){pv.Mark.call(this)};pv.Line.prototype=pv.extend(pv.Mark).property("lineWidth",Number).property("lineJoin",String).property("strokeMiterLimit",Number).property("lineCap",String).property("strokeStyle",pv.fillStyle).property("strokeDasharray",String).property("fillStyle",pv.fillStyle).property("segmented",pv.Area.castSegmented).property("interpolate",String).property("eccentricity",Number).property("tension",Number);pv.Line.prototype.type="line";pv.Line.prototype.defaults=new pv.Line().extend(pv.Mark.prototype.defaults).lineWidth(1.5).strokeStyle(pv.Colors.category10().by(pv.parent)).interpolate("linear").eccentricity(0).tension(0.7).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none");pv.Line.prototype.bind=pv.Area.prototype.bind;pv.Line.prototype.buildInstance=pv.Area.prototype.buildInstance;pv.Line.prototype.getEventHandler=pv.Area.prototype.getEventHandler;pv.Line.prototype.getNearestInstanceToMouse=pv.Area.prototype.getNearestInstanceToMouse;pv.Line.prototype.anchor=function(a){return pv.Area.prototype.anchor.call(this,a).textAlign(function(){switch(this.name()){case"left":return"right";case"bottom":case"top":case"center":return"center";case"right":return"left"}}).textBaseline(function(){switch(this.name()){case"right":case"left":case"center":return"middle";case"top":return"bottom";case"bottom":return"top"}})};pv.Line.prototype.getShapeCore=function(a,c){var d=a[c],b=c+1<a.length?a[c+1]:null;return null!=b&&b.visible?new pv.Shape.Line(d.left,d.top,b.left,b.top):new pv.Shape.Point(d.left,d.top)};pv.Rule=function(){pv.Mark.call(this)};pv.Rule.prototype=pv.extend(pv.Mark).property("width",Number).property("height",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineCap",String).property("strokeDasharray",String);pv.Rule.prototype.type="rule";pv.Rule.prototype.defaults=new pv.Rule().extend(pv.Mark.prototype.defaults).lineWidth(1).strokeStyle("black").antialias(!1).lineCap("butt").strokeDasharray("none");pv.Rule.prototype.anchor=pv.Line.prototype.anchor;pv.Rule.prototype.buildImplied=function(b){var a=b.left,c=b.right;b.top,b.bottom;null!=b.width||null==a&&null==c||null!=c&&null!=a?b.height=0:b.width=0;pv.Mark.prototype.buildImplied.call(this,b)};pv.Rule.prototype.getShapeCore=function(a,b){var c=a[b];return new pv.Shape.Line(c.left,c.top,c.left+c.width,c.top+c.height)};pv.Panel=function(){pv.Bar.call(this);this.children=[];this.root=this;this.$dom=pv.$&&pv.$.s};pv.Panel.prototype=pv.extend(pv.Bar).property("transform").property("overflow",String).property("canvas",function(a){return"string"==typeof a?document.getElementById(a):a});pv.Panel.prototype.type="panel";pv.Panel.prototype._zOrderChildCount=0;pv.Panel.prototype.defaults=new pv.Panel().extend(pv.Bar.prototype.defaults).fillStyle(null).overflow("visible");pv.Panel.prototype.anchor=function(b){var a=pv.Bar.prototype.anchor.call(this,b);a.parent=this;return a};pv.Panel.prototype.add=function(a){var c=new a();c.parent=this;c.root=this.root;c.childIndex=this.children.length;this.children.push(c);var b=+c._zOrder||0;0!==b&&this._zOrderChildCount++;return c};pv.Panel.prototype.bind=function(){pv.Mark.prototype.bind.call(this);for(var b=this.children,a=0,c=b.length;c>a;a++){b[a].bind()}};pv.Panel.prototype.buildInstance=function(d){pv.Bar.prototype.buildInstance.call(this,d);if(d.visible){var e=this.scale*d.transform.k;pv.Mark.prototype.index=-1;for(var g,c=this.children,a=d.children||(d.children=[]),b=0,f=c.length;f>b;b++){g=c[b];g.scene=a[b];g.scale=e;g.build()}b=f;for(;b--;){g=c[b];a[b]=g.scene;delete g.scene;delete g.scale}a.length=f}};pv.Panel.prototype.buildImplied=function(a){if(this.parent||this._buildRootInstanceImplied(a)){a.transform||(a.transform=pv.Transform.identity);pv.Mark.prototype.buildImplied.call(this,a)}else{a.visible=!1}};pv.Panel.prototype._buildRootInstanceImplied=function(a){var b=a.canvas;if(b){if(!this._rootInstanceStealCanvas(a,b)){return !1}this._rootInstanceInitCanvas(a,b)}else{a.canvas=this._rootInstanceGetInlineCanvas(a)}return !0};pv.Panel.prototype._rootInstanceStealCanvas=function(a,d){var b=d.$panel;if(b!==this){if(b){if(this.$lastCreateId){return !1}b._disposeRootPanel();this._updateCreateId(d)}d.$panel=this;pv.removeChildren(d)}else{this._updateCreateId(d)}return !0};pv.Panel.prototype._registerBoundEvent=function(e,a,d,b){if(e.removeEventListener){var c=this._boundEvents||(this._boundEvents=[]);c.push([e,a,d,b])}};pv.Panel.prototype._disposeRootPanel=function(){var c=this.$transition;c&&c.stop();var e=this._boundEvents;if(e){this._boundEvents=null;for(var b=0,a=e.length;a>b;b++){var d=e[b];d[0].removeEventListener(d[1],d[2],d[3])}}};pv.Panel.prototype._rootInstanceInitCanvas=function(d,f){var a,b,e;if(null==d.width){e=pv.cssStyle(f);a=parseFloat(e("width")||0);d.width=a-d.left-d.right}if(null==d.height){e||(e=pv.cssStyle(f));b=parseFloat(e("height")||0);d.height=b-d.top-d.bottom}e=null};pv.Panel.prototype._rootInstanceGetInlineCanvas=function(){var d,a=this.$canvas||(this.$canvas=[]);if(!(d=a[this.index])){d=a[this.index]=document.createElement("span");if(this.$dom){this.$dom.parentNode.insertBefore(d,this.$dom)}else{for(var b=document.body;b.lastChild&&b.lastChild.tagName;){b=b.lastChild}b!=document.body&&(b=b.parentNode);b.appendChild(d)}}return d};pv.Panel.prototype._updateCreateId=function(a){this.$lastCreateId=a.$pvCreateId=(a.$pvCreateId||0)+1};pv.Image=function(){pv.Bar.call(this)};pv.Image.prototype=pv.extend(pv.Bar).property("url",String).property("imageWidth",Number).property("imageHeight",Number);pv.Image.prototype.type="image";pv.Image.prototype.defaults=new pv.Image().extend(pv.Bar.prototype.defaults).fillStyle(null);pv.Image.prototype.image=function(a){this.$image=function(){var b=a.apply(this,arguments);return null==b?pv.Color.transparent:"string"==typeof b?pv.color(b):b};return this};pv.Image.prototype.bind=function(){pv.Bar.prototype.bind.call(this);var a=this.binds,b=this;do{a.image=b.$image}while(!a.image&&(b=b.proto))};pv.Image.prototype.buildImplied=function(l){pv.Bar.prototype.buildImplied.call(this,l);if(l.visible){null==l.imageWidth&&(l.imageWidth=l.width);null==l.imageHeight&&(l.imageHeight=l.height);if(null==l.url&&this.binds.image){var e,c=this.$canvas||(this.$canvas=document.createElement("canvas")),b=c.getContext("2d"),k=l.imageWidth,f=l.imageHeight,i=pv.Mark.stack;c.width=k;c.height=f;e=(l.image=b.createImageData(k,f)).data;i.unshift(null,null);for(var g=0,a=0;f>g;g++){i[1]=g;for(var j=0;k>j;j++){i[0]=j;var d=this.binds.image.apply(this,i);e[a++]=d.r;e[a++]=d.g;e[a++]=d.b;e[a++]=255*d.a}}i.splice(0,2)}}};pv.Wedge=function(){pv.Mark.call(this)};pv.Wedge.prototype=pv.extend(pv.Mark).property("startAngle",Number).property("endAngle",Number).property("angle",Number).property("innerRadius",Number).property("outerRadius",Number).property("lineWidth",Number).property("strokeStyle",pv.fillStyle).property("lineJoin",String).property("strokeMiterLimit",Number).property("lineCap",String).property("strokeDasharray",String).property("fillStyle",pv.fillStyle);pv.Wedge.prototype.type="wedge";pv.Wedge.prototype.defaults=new pv.Wedge().extend(pv.Mark.prototype.defaults).startAngle(function(){var a=this.sibling();return a?a.endAngle:-Math.PI/2}).innerRadius(0).lineWidth(1.5).strokeStyle(null).fillStyle(pv.Colors.category20().by(pv.index)).lineJoin("miter").strokeMiterLimit(8).lineCap("butt").strokeDasharray("none");pv.Wedge.prototype.midRadius=function(){return(this.innerRadius()+this.outerRadius())/2};pv.Wedge.prototype.midAngle=function(){return(this.startAngle()+this.endAngle())/2};pv.Wedge.prototype.anchor=function(c){function b(e){return e.innerRadius||e.angle<2*Math.PI}function a(e){return(e.innerRadius+e.outerRadius)/2}function d(e){return(e.startAngle+e.endAngle)/2}return pv.Mark.prototype.anchor.call(this,c).left(function(){var e=this.scene.target[this.index];if(b(e)){switch(this.name()){case"outer":return e.left+e.outerRadius*Math.cos(d(e));case"inner":return e.left+e.innerRadius*Math.cos(d(e));case"start":return e.left+a(e)*Math.cos(e.startAngle);case"center":return e.left+a(e)*Math.cos(d(e));case"end":return e.left+a(e)*Math.cos(e.endAngle)}}return e.left}).top(function(){var e=this.scene.target[this.index];if(b(e)){switch(this.name()){case"outer":return e.top+e.outerRadius*Math.sin(d(e));case"inner":return e.top+e.innerRadius*Math.sin(d(e));case"start":return e.top+a(e)*Math.sin(e.startAngle);case"center":return e.top+a(e)*Math.sin(d(e));case"end":return e.top+a(e)*Math.sin(e.endAngle)}}return e.top}).textAlign(function(){var e=this.scene.target[this.index];if(b(e)){switch(this.name()){case"outer":return pv.Wedge.upright(d(e))?"right":"left";case"inner":return pv.Wedge.upright(d(e))?"left":"right"}}return"center"}).textBaseline(function(){var e=this.scene.target[this.index];if(b(e)){switch(this.name()){case"start":return pv.Wedge.upright(e.startAngle)?"top":"bottom";case"end":return pv.Wedge.upright(e.endAngle)?"bottom":"top"}}return"middle"}).textAngle(function(){var f=this.scene.target[this.index],e=0;if(b(f)){switch(this.name()){case"center":case"inner":case"outer":e=d(f);break;case"start":e=f.startAngle;break;case"end":e=f.endAngle}}return pv.Wedge.upright(e)?e:e+Math.PI})};pv.Wedge.upright=function(a){a%=2*Math.PI;a=0>a?2*Math.PI+a:a;return a<Math.PI/2||a>=3*Math.PI/2};pv.Wedge.prototype.buildImplied=function(a){null==a.angle?a.angle=a.endAngle-a.startAngle:null==a.endAngle&&(a.endAngle=a.startAngle+a.angle);pv.Mark.prototype.buildImplied.call(this,a)};pv.Wedge.prototype.getShapeCore=function(a,b){var c=a[b];return new pv.Shape.Wedge(c.left,c.top,c.innerRadius,c.outerRadius,c.startAngle,c.angle)};pv.Ease=function(){function i(o){return function(p){return 1-o(1-p)}}function d(o){return function(p){return 0.5*(0.5>p?o(2*p):2-o(2-2*p))}}function b(o){return function(p){return 0>p?0:p>1?1:Math.pow(p,o)}}function j(o){return 1-Math.cos(o*Math.PI/2)}function f(o){return o?Math.pow(2,10*(o-1))-0.001:0}function a(o){return -(Math.sqrt(1-o*o)-1)}function m(o,r){var q;r||(r=0.45);if(!o||1>o){o=1;q=r/4}else{q=r/(2*Math.PI)*Math.asin(1/o)}return function(p){return 0>=p||p>=1?p:-(o*Math.pow(2,10*--p)*Math.sin(2*(p-q)*Math.PI/r))}}function h(o){o||(o=1.70158);return function(p){return p*p*((o+1)*p-o)}}function n(o){return 1/2.75>o?7.5625*o*o:2/2.75>o?7.5625*(o-=1.5/2.75)*o+0.75:2.5/2.75>o?7.5625*(o-=2.25/2.75)*o+0.9375:7.5625*(o-=2.625/2.75)*o+0.984375}var l=b(2),e=b(3),c=m(),g=h(),k={linear:pv.identity,"quad-in":l,"quad-out":i(l),"quad-in-out":d(l),"quad-out-in":d(i(l)),"cubic-in":e,"cubic-out":i(e),"cubic-in-out":d(e),"cubic-out-in":d(i(e)),"sin-in":j,"sin-out":i(j),"sin-in-out":d(j),"sin-out-in":d(i(j)),"exp-in":f,"exp-out":i(f),"exp-in-out":d(f),"exp-out-in":d(i(f)),"circle-in":a,"circle-out":i(a),"circle-in-out":d(a),"circle-out-in":d(i(a)),"elastic-in":c,"elastic-out":i(c),"elastic-in-out":d(c),"elastic-out-in":d(i(c)),"back-in":g,"back-out":i(g),"back-in-out":d(g),"back-out-in":d(i(g)),"bounce-in":n,"bounce-out":i(n),"bounce-in-out":d(n),"bounce-out-in":d(i(n))};pv.ease=function(o){return k[o]};return{reverse:i,reflect:d,linear:function(){return pv.identity},sin:function(){return j},exp:function(){return f},circle:function(){return a},elastic:m,back:h,bounce:n,poly:b}}();pv.Transient=function(a){pv.Mark.call(this);this.fillStyle(null).strokeStyle(null).textStyle(null);this.on=function(b){return a.on(b)}};pv.Transient.prototype=pv.extend(pv.Mark);!function(){function d(m){for(var l={},j=m.length;j--;){var k=m[j],n=k.id;n&&(l[n]=k)}return l}function e(l,i,k,n){var j;if(i in b){var m=pv.Scale.interpolator(k[i],n[i]);j=function(o){k[i]=m(o)}}else{j=function(o){o>0.5&&(k[i]=n[i])}}j.next=l.head;l.head=j}function h(p,m,q){for(var l in m){"children"!==l&&m[l]!=q[l]&&e(p,l,m,q)}var o=m.children;if(o){for(var n=q.children,k=0,i=o.length;i>k;k++){a(p,o[k],n[k])}}}function f(n,p,o,r){var s,q=Object.create(n[p]),k=n.mark,l=k.root.scene;if(r.target&&(s=r.target[r.length])){n=Object.create(n);n.target=Object.create(r.target);n.target[p]=s}o||(o=g);var i=o.$properties,j=o.$propertiesMap;i=k.binds.optional.filter(function(m){return !(m.name in j)}).concat(i);k.context(n,p,function(){this.buildProperties(q,i);this.buildImplied(q)});k.root.scene=l;return q}function a(p,s,j){for(var t,m,k=s.mark,n=d(s),u=d(j),l=0,r=s.length;r>l;l++){t=s[l];m=t.id?u[t.id]:j[l];t.index=l;if(t.visible){if(!m||!m.visible){var o=f(s,l,k.$exit,j);t.transition=m?2:(j.push(o),1);m=o}h(p,t,m)}}l=0;r=j.length;for(;r>l;l++){m=j[l];t=m.id?n[m.id]:s[l];if((!t||!t.visible)&&m.visible){var q=f(j,l,k.$enter,s);t?s[t.index]=q:s.push(q);h(p,q,m)}}}function c(n){for(var l=0,k=0;l<n.length;l++){var m=n[l];if(1!=m.transition){n[k++]=m;2==m.transition&&(m.visible=!1);m.children&&m.children.forEach(c)}}n.length=k}var b={top:1,left:1,right:1,bottom:1,width:1,height:1,innerRadius:1,outerRadius:1,radius:1,shapeRadius:1,shapeSize:1,startAngle:1,endAngle:1,angle:1,fillStyle:1,strokeStyle:1,lineWidth:1,eccentricity:1,tension:1,textAngle:1,textStyle:1,textMargin:1},g=new pv.Transient();pv.Transition=function(l){function q(t){var s=l.root.$transition===o;s&&(l.root.$transition=null);if(null!=i){clearInterval(i);i=null}s&&j(l.scene);if(p){var r=p;p=null;r(t)}return t}var i,p,k,o=this,m=pv.ease("cubic-in-out"),n=250,j=function(r){if(!k){k=!0;c(r)}};o.ease=function(r){return arguments.length?(m="function"==typeof r?r:pv.ease(r),o):m};o.duration=function(r){return arguments.length?(n=Number(r),o):n};o.start=function(r){if(l.parent){throw new Error("Animated partial rendering is not supported.")}p=r;var x=l.root;if(x.$transition){try{x.$transition.stop()}catch(w){return q(!1)}}var v,t;x.$transition=o;var y=l.scene;l.scene=null;var u=pv.Mark.prototype.index;try{l.bind();l.build();var s=l.scene;l.scene=y;pv.Mark.prototype.index=u;t=Date.now();v={};a(v,y,s)}catch(w){pv.Mark.prototype.index=u;return q(!1)}if(!v.head){return q(!0)}var z=function(){var A=Math.max(0,Math.min(1,(Date.now()-t)/n)),C=m(A),B=v.head;do{B(C)}while(B=B.next);if(1===A){j(l.scene);pv.Scene.updateAll(y);q(!0)}else{pv.Scene.updateAll(y)}};i=setInterval(function(){try{z()}catch(A){q(!1)}},24)};o.stop=function(){q(!0)}}}();pv.simulation=function(a){return new pv.Simulation(a)};pv.Simulation=function(b){for(var a=0;a<b.length;a++){this.particle(b[a])}};pv.Simulation.prototype.particle=function(a){a.next=this.particles;isNaN(a.px)&&(a.px=a.x);isNaN(a.py)&&(a.py=a.y);isNaN(a.fx)&&(a.fx=0);isNaN(a.fy)&&(a.fy=0);this.particles=a;return this};pv.Simulation.prototype.force=function(a){a.next=this.forces;this.forces=a;return this};pv.Simulation.prototype.constraint=function(a){a.next=this.constraints;this.constraints=a;return this};pv.Simulation.prototype.stabilize=function(f){var e;arguments.length||(f=3);for(var a=0;f>a;a++){var b=new pv.Quadtree(this.particles);for(e=this.constraints;e;e=e.next){e.apply(this.particles,b)}}for(var d=this.particles;d;d=d.next){d.px=d.x;d.py=d.y}return this};pv.Simulation.prototype.step=function(){var g,e,h;for(g=this.particles;g;g=g.next){var b=g.px,a=g.py;g.px=g.x;g.py=g.y;g.x+=g.vx=g.x-b+g.fx;g.y+=g.vy=g.y-a+g.fy}var d=new pv.Quadtree(this.particles);for(h=this.constraints;h;h=h.next){h.apply(this.particles,d)}for(g=this.particles;g;g=g.next){g.fx=g.fy=0}for(e=this.forces;e;e=e.next){e.apply(this.particles,d)}};pv.Quadtree=function(i){function g(s,r,m,q,l,o){if(!isNaN(r.x)&&!isNaN(r.y)){if(s.leaf){if(s.p){if(Math.abs(s.p.x-r.x)+Math.abs(s.p.y-r.y)<0.01){d(s,r,m,q,l,o)}else{var k=s.p;s.p=null;d(s,k,m,q,l,o);d(s,r,m,q,l,o)}}else{s.p=r}}else{d(s,r,m,q,l,o)}}}function d(q,m,o,u,l,s){var t=0.5*(o+l),r=0.5*(u+s),v=m.x>=t,k=m.y>=r;q.leaf=!1;switch((k<<1)+v){case 0:q=q.c1||(q.c1=new pv.Quadtree.Node());break;case 1:q=q.c2||(q.c2=new pv.Quadtree.Node());break;case 2:q=q.c3||(q.c3=new pv.Quadtree.Node());break;case 3:q=q.c4||(q.c4=new pv.Quadtree.Node())}v?o=t:l=t;k?u=r:s=r;g(q,m,o,u,l,s)}var b,c=Number.POSITIVE_INFINITY,f=c,a=Number.NEGATIVE_INFINITY,e=a;for(b=i;b;b=b.next){b.x<c&&(c=b.x);b.y<f&&(f=b.y);b.x>a&&(a=b.x);b.y>e&&(e=b.y)}var j=a-c,h=e-f;j>h?e=f+j:a=c+h;this.xMin=c;this.yMin=f;this.xMax=a;this.yMax=e;this.root=new pv.Quadtree.Node();for(b=i;b;b=b.next){g(this.root,b,c,f,a,e)}};pv.Quadtree.Node=function(){this.leaf=!0;this.c1=null;this.c2=null;this.c3=null;this.c4=null;this.p=null};pv.Force={};pv.Force.charge=function(d){function h(m){function k(n){h(n);m.cn+=n.cn;j+=n.cn*n.cx;l+=n.cn*n.cy}var j=0,l=0;m.cn=0;if(!m.leaf){m.c1&&k(m.c1);m.c2&&k(m.c2);m.c3&&k(m.c3);m.c4&&k(m.c4)}if(m.p){m.cn+=d;j+=d*m.p.x;l+=d*m.p.y}m.cx=j/m.cn;m.cy=l/m.cn}function c(m,k,l,w,j,u){var y=m.cx-k.x,x=m.cy-k.y,r=1/Math.sqrt(y*y+x*x);if(m.leaf&&m.p!=k||b>(j-l)*r){if(g>r){return}r>i&&(r=i);var s=m.cn*r*r*r,q=y*s,o=x*s;k.fx+=q;k.fy+=o}else{if(!m.leaf){var v=0.5*(l+j),t=0.5*(w+u);m.c1&&c(m.c1,k,l,w,v,t);m.c2&&c(m.c2,k,v,w,j,t);m.c3&&c(m.c3,k,l,t,v,u);m.c4&&c(m.c4,k,v,t,j,u);if(g>r){return}r>i&&(r=i);if(m.p&&m.p!=k){var s=d*r*r*r,q=y*s,o=x*s;k.fx+=q;k.fy+=o}}}}var e=2,i=1/e,f=500,g=1/f,b=0.9,a={};arguments.length||(d=-40);a.constant=function(j){if(arguments.length){d=Number(j);return a}return d};a.domain=function(k,j){if(arguments.length){e=Number(k);i=1/e;f=Number(j);g=1/f;return a}return[e,f]};a.theta=function(j){if(arguments.length){b=Number(j);return a}return b};a.apply=function(j,k){h(k.root);for(var l=j;l;l=l.next){c(k.root,l,k.xMin,k.yMin,k.xMax,k.yMax)}};return a};pv.Force.drag=function(a){var b={};arguments.length||(a=0.1);b.constant=function(c){if(arguments.length){a=c;return b}return a};b.apply=function(c){if(a){for(var d=c;d;d=d.next){d.fx-=a*d.vx;d.fy-=a*d.vy}}};return b};pv.Force.spring=function(c){var b,e,g=0.1,a=20,f={};arguments.length||(c=0.1);f.links=function(d){if(arguments.length){b=d;e=d.map(function(h){return 1/Math.sqrt(Math.max(h.sourceNode.linkDegree,h.targetNode.linkDegree))});return f}return b};f.constant=function(d){if(arguments.length){c=Number(d);return f}return c};f.damping=function(d){if(arguments.length){g=Number(d);return f}return g};f.length=function(d){if(arguments.length){a=Number(d);return f}return a};f.apply=function(){for(var l=0;l<b.length;l++){var p=b[l].sourceNode,n=b[l].targetNode,s=p.x-n.x,r=p.y-n.y,m=Math.sqrt(s*s+r*r),q=m?1/m:1,o=c*e[l],k=g*e[l],d=(o*(m-a)+k*(s*(p.vx-n.vx)+r*(p.vy-n.vy))*q)*q,j=-d*(m?s:0.01*(0.5-Math.random())),h=-d*(m?r:0.01*(0.5-Math.random()));p.fx+=j;p.fy+=h;n.fx-=j;n.fy-=h}};return f};pv.Constraint={};pv.Constraint.collision=function(h){function i(r,o,q,A,m,y){if(!r.leaf){var z=0.5*(q+m),x=0.5*(A+y),w=x>c,j=a>x,s=z>g,B=f>z;if(w){r.c1&&s&&i(r.c1,o,q,A,z,x);r.c2&&B&&i(r.c2,o,z,A,m,x)}if(j){r.c3&&s&&i(r.c3,o,q,x,z,y);r.c4&&B&&i(r.c4,o,z,x,m,y)}}if(r.p&&r.p!=o){var D=o.x-r.p.x,C=o.y-r.p.y,t=Math.sqrt(D*D+C*C),v=e+h(r.p);if(v>t){var u=(t-v)/t*0.5;D*=u;C*=u;o.x-=D;o.y-=C;r.p.x+=D;r.p.y+=C}}}var e,g,c,f,a,d=1,b={};arguments.length||(e=10);b.repeat=function(j){if(arguments.length){d=Number(j);return b}return d};b.apply=function(m,n){var o,l,j=-1/0;for(o=m;o;o=o.next){l=h(o);l>j&&(j=l)}for(var k=0;d>k;k++){for(o=m;o;o=o.next){l=(e=h(o))+j;g=o.x-l;f=o.x+l;c=o.y-l;a=o.y+l;i(n.root,o,n.xMin,n.yMin,n.xMax,n.yMax)}}};return b};pv.Constraint.position=function(c){var b=1,d={};arguments.length||(c=function(a){return a.fix});d.alpha=function(a){if(arguments.length){b=Number(a);return d}return b};d.apply=function(e){for(var f=e;f;f=f.next){var a=c(f);if(a){f.x+=(a.x-f.x)*b;f.y+=(a.y-f.y)*b;f.fx=f.fy=f.vx=f.vy=0}}};return d};pv.Constraint.bound=function(){var a,c,b={};b.x=function(e,d){if(arguments.length){a={min:Math.min(e,d),max:Math.max(e,d)};return this}return a};b.y=function(e,d){if(arguments.length){c={min:Math.min(e,d),max:Math.max(e,d)};return this}return c};b.apply=function(d){if(a){for(var e=d;e;e=e.next){e.x=e.x<a.min?a.min:e.x>a.max?a.max:e.x}}if(c){for(var e=d;e;e=e.next){e.y=e.y<c.min?c.min:e.y>c.max?c.max:e.y}}};return b};pv.Layout=function(){pv.Panel.call(this)};pv.Layout.prototype=pv.extend(pv.Panel);pv.Layout.prototype.property=pv.Mark.prototype.localProperty;pv.Layout.Network=function(){pv.Layout.call(this);var a=this;this.$id=pv.id();(this.node=new pv.Mark().data(function(){return a.nodes()}).strokeStyle("#1f77b4").fillStyle("#fff").left(function(b){return b.x}).top(function(b){return b.y})).parent=this;this.link=new pv.Mark().extend(this.node).data(function(b){return[b.sourceNode,b.targetNode]}).fillStyle(null).lineWidth(function(c,b){return 1.5*b.linkValue}).strokeStyle("rgba(0,0,0,.2)");this.link.add=function(b){return a.add(pv.Panel).data(function(){return a.links()}).add(b).extend(this)};(this.label=new pv.Mark().extend(this.node).textMargin(7).textBaseline("middle").text(function(b){return b.nodeName||b.nodeValue}).textAngle(function(c){var b=c.midAngle;return pv.Wedge.upright(b)?b:b+Math.PI}).textAlign(function(b){return pv.Wedge.upright(b.midAngle)?"left":"right"})).parent=this};pv.Layout.Network.prototype=pv.extend(pv.Layout).property("nodes",function(a){return a.map(function(c,b){"object"!=typeof c&&(c={nodeValue:c});c.index=b;return c})}).property("links",function(a){return a.map(function(b){isNaN(b.linkValue)&&(b.linkValue=isNaN(b.value)?1:b.value);return b})});pv.Layout.Network.prototype.reset=function(){this.$id=pv.id();return this};pv.Layout.Network.prototype.buildProperties=function(b,a){(b.$id||0)<this.$id&&pv.Layout.prototype.buildProperties.call(this,b,a)};pv.Layout.Network.prototype.buildImplied=function(a){pv.Layout.prototype.buildImplied.call(this,a);if(a.$id>=this.$id){return !0}a.$id=this.$id;a.nodes.forEach(function(b){b.linkDegree=0});a.links.forEach(function(c){var b=c.linkValue;(c.sourceNode||(c.sourceNode=a.nodes[c.source])).linkDegree+=b;(c.targetNode||(c.targetNode=a.nodes[c.target])).linkDegree+=b})};pv.Layout.Hierarchy=function(){pv.Layout.Network.call(this);this.link.strokeStyle("#ccc")};pv.Layout.Hierarchy.prototype=pv.extend(pv.Layout.Network);pv.Layout.Hierarchy.prototype.buildImplied=function(a){a.links||(a.links=pv.Layout.Hierarchy.links.call(this));pv.Layout.Network.prototype.buildImplied.call(this,a)};pv.Layout.Hierarchy.links=function(){return this.nodes().filter(function(a){return a.parentNode}).map(function(a){return{sourceNode:a,targetNode:a.parentNode,linkValue:1}})};pv.Layout.Hierarchy.NodeLink={buildImplied:function(q){function l(h){return h.parentNode?h.depth*(g-k)+k:0}function d(h){return h.parentNode?2*(h.breadth-0.25)*Math.PI:0}function o(h){switch(e){case"left":return h.depth*p;case"right":return p-h.depth*p;case"top":return h.breadth*p;case"bottom":return p-h.breadth*p;case"radial":return p/2+l(h)*Math.cos(h.midAngle)}}function m(h){switch(e){case"left":return h.breadth*j;case"right":return j-h.breadth*j;case"top":return h.depth*j;case"bottom":return j-h.depth*j;case"radial":return j/2+l(h)*Math.sin(h.midAngle)}}var a=q.nodes,e=q.orient,b=/^(top|bottom)$/.test(e),p=q.width,j=q.height;if("radial"==e){var k=q.innerRadius,g=q.outerRadius;null==k&&(k=0);null==g&&(g=Math.min(p,j)/2)}for(var f=0;f<a.length;f++){var c=a[f];c.midAngle="radial"==e?d(c):b?Math.PI/2:0;c.x=o(c);c.y=m(c);c.firstChild&&(c.midAngle+=Math.PI)}}};pv.Layout.Hierarchy.Fill={constructor:function(){this.node.strokeStyle("#fff").fillStyle("#ccc").width(function(a){return a.dx}).height(function(a){return a.dy}).innerRadius(function(a){return a.innerRadius}).outerRadius(function(a){return a.outerRadius}).startAngle(function(a){return a.startAngle}).angle(function(a){return a.angle});this.label.textAlign("center").left(function(a){return a.x+a.dx/2}).top(function(a){return a.y+a.dy/2});delete this.link},buildImplied:function(l){function A(i,h){return(i+h)/(1+h)}function e(h){switch(f){case"left":return A(h.minDepth,z)*j;case"right":return(1-A(h.maxDepth,z))*j;case"top":return h.minBreadth*j;case"bottom":return(1-h.maxBreadth)*j;case"radial":return j/2}}function d(h){switch(f){case"left":return h.minBreadth*t;case"right":return(1-h.maxBreadth)*t;case"top":return A(h.minDepth,z)*t;case"bottom":return(1-A(h.maxDepth,z))*t;case"radial":return t/2}}function k(h){switch(f){case"left":case"right":return(h.maxDepth-h.minDepth)/(1+z)*j;case"top":case"bottom":return(h.maxBreadth-h.minBreadth)*j;case"radial":return h.parentNode?(h.innerRadius+h.outerRadius)*Math.cos(h.midAngle):0}}function g(h){switch(f){case"left":case"right":return(h.maxBreadth-h.minBreadth)*t;case"top":case"bottom":return(h.maxDepth-h.minDepth)/(1+z)*t;case"radial":return h.parentNode?(h.innerRadius+h.outerRadius)*Math.sin(h.midAngle):0}}function b(h){return Math.max(0,A(h.minDepth,z/2))*(c-a)+a}function p(h){return A(h.maxDepth,z/2)*(c-a)+a}function q(h){return 2*(h.parentNode?h.minBreadth-0.25:0)*Math.PI}function u(h){return 2*(h.parentNode?h.maxBreadth-h.minBreadth:1)*Math.PI}var o=l.nodes,f=l.orient,v=/^(top|bottom)$/.test(f),j=l.width,t=l.height,z=-o[0].minDepth;if("radial"==f){var a=l.innerRadius,c=l.outerRadius;null==a&&(a=0);a&&(z*=2);null==c&&(c=Math.min(j,t)/2)}for(var r=0;r<o.length;r++){var m=o[r];m.x=e(m);m.y=d(m);if("radial"==f){m.innerRadius=b(m);m.outerRadius=p(m);m.startAngle=q(m);m.angle=u(m);m.midAngle=m.startAngle+m.angle/2}else{m.midAngle=v?-Math.PI/2:0}m.dx=k(m);m.dy=g(m)}}};pv.Layout.Grid=function(){pv.Layout.call(this);var a=this;(this.cell=new pv.Mark().data(function(){return a.scene[a.index].$grid}).width(function(){return a.width()/a.cols()}).height(function(){return a.height()/a.rows()}).left(function(){return this.width()*(this.index%a.cols())}).top(function(){return this.height()*Math.floor(this.index/a.cols())})).parent=this};pv.Layout.Grid.prototype=pv.extend(pv.Layout).property("rows").property("cols");pv.Layout.Grid.prototype.defaults=new pv.Layout.Grid().extend(pv.Layout.prototype.defaults).rows(1).cols(1);pv.Layout.Grid.prototype.buildImplied=function(a){pv.Layout.prototype.buildImplied.call(this,a);var b=a.rows,d=a.cols;"object"==typeof d&&(b=pv.transpose(d));if("object"==typeof b){a.$grid=pv.blend(b);a.rows=b.length;a.cols=b[0]?b[0].length:0}else{a.$grid=pv.repeat([a.data],b*d)}};pv.Layout.Stack=function(){function c(g){return function(){return f[g](this.parent.index,this.index)}}pv.Layout.call(this);var a,e=this,b=function(){return null},f={t:b,l:b,r:b,b:b,w:b,h:b},d=e.buildImplied;this.buildImplied=function(G){d.call(this,G);var N,V=G.layers,L=V.length,B=G.orient,T=/^(top|bottom)\b/.test(B),S=this.parent[T?"height":"width"](),A=[],z=[],C=[],r=pv.Mark.stack,K={parent:{parent:this}};r.unshift(null);a=[];for(var R=0;L>R;R++){C[R]=[];z[R]=[];K.parent.index=R;r[0]=V[R];a[R]=this.$values.apply(K.parent,r);R||(N=a[R].length);r.unshift(null);for(var P=0;N>P;P++){r[0]=a[R][P];K.index=P;R||(A[P]=this.$x.apply(K,r));C[R][P]=this.$y.apply(K,r)}r.shift()}r.shift();var t;switch(G.order){case"inside-out":for(var Q=C.map(function(h){return pv.max.index(h)}),U=pv.range(L).sort(function(i,h){return Q[i]-Q[h]}),E=C.map(function(h){return pv.sum(h)}),I=0,v=0,u=[],M=[],R=0;L>R;R++){var P=U[R];if(v>I){I+=E[P];u.push(P)}else{v+=E[P];M.push(P)}}t=M.reverse().concat(u);break;case"reverse":t=pv.range(L-1,-1,-1);break;default:t=pv.range(L)}switch(G.offset){case"silohouette":for(var P=0;N>P;P++){for(var K=0,R=0;L>R;R++){K+=C[R][P]}z[t[0]][P]=(S-K)/2}break;case"wiggle":for(var K=0,R=0;L>R;R++){K+=C[R][0]}z[t[0]][0]=K=(S-K)/2;for(var P=1;N>P;P++){for(var q=0,l=0,D=A[P]-A[P-1],R=0;L>R;R++){q+=C[R][P]}for(var R=0;L>R;R++){for(var g=(C[t[R]][P]-C[t[R]][P-1])/(2*D),O=0;R>O;O++){g+=(C[t[O]][P]-C[t[O]][P-1])/D}l+=g*C[t[R]][P]}z[t[0]][P]=K-=q?l/q*D:0}break;case"expand":for(var P=0;N>P;P++){z[t[0]][P]=0;for(var O=0,R=0;L>R;R++){O+=C[R][P]}if(O){O=S/O;for(var R=0;L>R;R++){C[R][P]*=O}}else{O=S/L;for(var R=0;L>R;R++){C[R][P]=O}}}break;default:for(var P=0;N>P;P++){z[t[0]][P]=0}}for(var P=0;N>P;P++){for(var K=z[t[0]][P],R=1;L>R;R++){K+=C[t[R-1]][P];z[t[R]][P]=K}}var R=B.indexOf("-"),w=T?"h":"w",H=0>R?T?"l":"b":B.charAt(R+1),F=B.charAt(0);for(var J in f){f[J]=b}f[H]=function(k,h){return A[h]};f[F]=function(k,h){return z[k][h]};f[w]=function(k,h){return C[k][h]}};this.layer=new pv.Mark().data(function(){return a[this.parent.index]}).top(c("t")).left(c("l")).right(c("r")).bottom(c("b")).width(c("w")).height(c("h"));this.layer.add=function(g){return e.add(pv.Panel).data(function(){return e.layers()}).add(g).extend(this)}};pv.Layout.Stack.prototype=pv.extend(pv.Layout).property("orient",String).property("offset",String).property("order",String).property("layers");pv.Layout.Stack.prototype.defaults=new pv.Layout.Stack().extend(pv.Layout.prototype.defaults).orient("bottom-left").offset("zero").layers([[]]);pv.Layout.Stack.prototype.$x=pv.Layout.Stack.prototype.$y=function(){return 0};pv.Layout.Stack.prototype.x=function(a){this.$x=pv.functor(a);return this};pv.Layout.Stack.prototype.y=function(a){this.$y=pv.functor(a);return this};pv.Layout.Stack.prototype.$values=pv.identity;pv.Layout.Stack.prototype.values=function(a){this.$values=pv.functor(a);return this};pv.Layout.Band=function(){function d(i){return function(){return g[i](this.index,this.parent.index)}}pv.Layout.call(this);var g,c,f=this,e=f.buildImplied,h=new pv.Mark().data(function(){return c[this.parent.index]}).top(d("t")).left(d("l")).right(d("r")).bottom(d("b")).width(d("w")).height(d("h")).antialias(d("antialias"));this.buildImplied=function(A){e.call(this,A);g=Object.create(pv.Layout.Band.$baseItemProps);c=[];var t=A.layers,u=t.length;if(u>0){var o=A.orient,k=/^(top|bottom)\b/.test(o),p=this.parent[k?"height":"width"](),m=this._readData(t,c,A),l=m.length;"reverse"===A.bandOrder&&m.reverse();if("reverse"===A.order){c.reverse();for(var v=0;l>v;v++){m[v].items.reverse()}}switch(A.layout){case"grouped":this._calcGrouped(m,u,A);break;case"stacked":this._calcStacked(m,u,p,A)}for(var z=A.hZero||0,w="stacked"===A.layout,r=0;l>r;r++){for(var x=m[r],q=w?Math.max(0,x.vertiMargin)/2:0,n=0;u>n;n++){var y=x.items[n];if(y.zero){y.h=z;y.y-=q+z/2}}}this._bindItemProps(m,g,o,k)}};var b=this.item={end:this,add:function(i){return f.add(pv.Panel).data(function(){return f.layers()}).add(i).extend(h)},order:function(i){f.order(i);return this},w:function(i){f.$iw=pv.functor(i);return this},h:function(i){f.$ih=pv.functor(i);return this},horizontalRatio:function(i){f.$ihorizRatio=pv.functor(i);return this},verticalMargin:function(i){f.$ivertiMargin=pv.functor(i);return this}},a=this.band={end:this,w:function(i){f.$bw=pv.functor(i);return this},x:function(i){f.$bx=pv.functor(i);return this},order:function(i){f.bandOrder(i);return this},differentialControl:function(i){f.$bDiffControl=pv.functor(i);return this}};this.band.item=b;this.item.band=a};pv.Layout.Band.$baseItemProps=function(){var a=function(){return null};return{t:a,l:a,r:a,b:a,w:a,h:a}}();pv.Layout.Band.prototype=pv.extend(pv.Layout).property("orient",String).property("layout",String).property("layers").property("yZero",Number).property("hZero",Number).property("verticalMode",String).property("horizontalMode",String).property("order",String).property("bandOrder",String);pv.Layout.Band.prototype.defaults=new pv.Layout.Band().extend(pv.Layout.prototype.defaults).orient("bottom-left").layout("grouped").yZero(0).hZero(1.5).layers([[]]);pv.Layout.Band.prototype.$bx=pv.Layout.Band.prototype.$bw=pv.Layout.Band.prototype.$bDiffControl=pv.Layout.Band.prototype.$iw=pv.Layout.Band.prototype.$ih=pv.Layout.Band.prototype.$ivertiMargin=pv.functor(0);pv.Layout.Band.prototype.$ihorizRatio=pv.functor(0.9);pv.Layout.Band.prototype.$values=pv.identity;pv.Layout.Band.prototype.values=function(a){this.$values=pv.functor(a);return this};pv.Layout.prototype._readData=function(f,j,i){var a,k=f.length,e=[],n=pv.Mark.stack,s=i.hZero,c={parent:{parent:this}};n.unshift(null);for(var d=0;k>d;d++){c.parent.index=d;n[0]=f[d];var p=j[d]=this.$values.apply(c.parent,n);d||(a=p.length);n.unshift(null);for(var m=0;a>m;m++){n[0]=p[m];c.index=m;var q=e[m];q||(q=e[m]={horizRatio:this.$ihorizRatio.apply(c,n),vertiMargin:this.$ivertiMargin.apply(c,n),w:this.$bw.apply(c,n),x:this.$bx.apply(c,n),diffControl:this.$bDiffControl?this.$bDiffControl.apply(c,n):0,items:[]});var r=this.$ih.apply(c,n),g=null!=r?Math.abs(r):r;q.items[d]={y:i.yZero||0,x:0,w:this.$iw.apply(c,n),h:g,zero:null!=g&&s>=g,dir:0>r?-1:1}}n.shift()}n.shift();return e};pv.Layout.Band.prototype._calcGrouped=function(c,d,s){for(var t=0,k=c.length;k>t;t++){for(var h=c[t],j=h.items,f=h.w,p=h.horizRatio,g=0,o=0;d>o;o++){g+=j[o].w}1===d?p=1:p>0&&1>=p||(p=1);if(null==f){f=h.w=g/p}else{if("expand"===s.horizontalMode){var m=p*f;if(g){for(var r=m/g,o=0;d>o;o++){j[o].w*=r}}else{for(var n=m/d,o=0;d>o;o++){j[o].w=n}}g=m}}for(var e=g/p,a=h.x-e/2,i=d>1?(e-g)/(d-1):0,o=0;d>o;o++){var q=j[o];q.x=a;a+=q.w+i;q.dir<0&&(q.y-=q.h)}}};pv.Layout.Band.prototype._calcStacked=function(e,f,a,v){var n,o=e.length;if("expand"===v.verticalMode){for(var x=0;o>x;x++){n=e[x].items;for(var y=null,k=0,p=0;f>p;p++){var u=n[p];u.dir=1;var r=u.h;if(null!=r){k++;y+=r}}if(k){if(y){for(var A=a/y,p=0;f>p;p++){var r=n[p].h;null!=r&&(n[p].h=r*A)}}else{if(0==y){for(var p=0;f>p;p++){n[p].h=0}}else{for(var j=a/k,p=0;f>p;p++){var r=n[p].h;null!=r&&(n[p].h=j)}}}}}}for(var g=v.yZero,i=g,x=0;o>x;x++){var m=e[x],t=m.x,q=m.diffControl,s=0>q,w=Math.max(0,m.vertiMargin);n=m.items;var d=this._layoutItemsOfDir(1,s,n,w,t,i),z=null;d.existsOtherDir&&(z=this._layoutItemsOfDir(-1,s,n,w,t,i));if(q){if(1===Math.abs(q)){var c=i;i=d.yOffset;z&&(i-=c-z.yOffset)}}else{i=g}}};pv.Layout.Band.prototype._layoutItemsOfDir=function(n,o,j,f,m,c){for(var g=!1,a=f/2,p=o?-n:n,e=o,b=0,k=j.length;k>b;b+=1){var q=j[e?k-b-1:b];if(q.dir===n){var d=q.h||0;if(p>0){q.y=c+a;c+=d}else{q.y=c-(d-a);c-=d}var i=d-f;q.h=i>0?i:0;q.x=m-q.w/2}else{g=!0}}return{existsOtherDir:g,yOffset:c}};pv.Layout.Band.prototype._bindItemProps=function(c,b,d,a){var f=d.indexOf("-"),e=a?"h":"w",i=a?"w":"h",h=0>f?a?"l":"b":d.charAt(f+1),g=d.charAt(0);b[h]=function(j,k){return c[j].items[k].x};b[g]=function(j,k){return c[j].items[k].y};b[i]=function(j,k){return c[j].items[k].w};b[e]=function(j,k){return c[j].items[k].h||0};b.antialias=function(j,k){return c[j].items[k].zero}};pv.Layout.Treemap=function(){pv.Layout.Hierarchy.call(this);this.node.strokeStyle("#fff").fillStyle("rgba(31, 119, 180, .25)").width(function(a){return a.dx}).height(function(a){return a.dy});this.label.visible(function(a){return !a.firstChild}).left(function(a){return a.x+a.dx/2}).top(function(a){return a.y+a.dy/2}).textAlign("center").textAngle(function(a){return a.dx>a.dy?0:-Math.PI/2});(this.leaf=new pv.Mark().extend(this.node).fillStyle(null).strokeStyle(null).visible(function(a){return !a.firstChild})).parent=this;delete this.link};pv.Layout.Treemap.prototype=pv.extend(pv.Layout.Hierarchy).property("round",Boolean).property("mode",String).property("order",String);pv.Layout.Treemap.prototype.defaults=new pv.Layout.Treemap().extend(pv.Layout.Hierarchy.prototype.defaults).mode("squarify").order("ascending");pv.Layout.Treemap.prototype.$size=function(a){return Number(a.nodeValue)};pv.Layout.Treemap.prototype.$padLeft=pv.Layout.Treemap.prototype.$padRight=pv.Layout.Treemap.prototype.$padBottom=pv.Layout.Treemap.prototype.$padTop=function(){return 0};pv.Layout.Treemap.prototype.size=function(a){this.$size=pv.functor(a);return this};pv.Layout.Treemap.prototype.padding=function(a){a=pv.functor(a);return this.paddingLeft(a).paddingRight(a).paddingTop(a).paddingBottom(a)};pv.Layout.Treemap.prototype.paddingLeft=function(a){if(arguments.length){this.$padLeft=pv.functor(a);return this}return this.$padLeft};pv.Layout.Treemap.prototype.paddingRight=function(a){if(arguments.length){this.$padRight=pv.functor(a);return this}return this.$padRight};pv.Layout.Treemap.prototype.paddingBottom=function(a){if(arguments.length){this.$padBottom=pv.functor(a);return this}return this.$padBottom};pv.Layout.Treemap.prototype.paddingTop=function(a){if(arguments.length){this.$padTop=pv.functor(a);return this}return this.$padTop};pv.Layout.Treemap.prototype.buildImplied=function(k){function h(v,q,l,t,s,u,p){for(var o=0,r=0;o<v.length;o++){var m=v[o];if(l){m.x=t+r;m.y=s;r+=m.dx=i(u*m.size/q);m.dy=p}else{m.x=t;m.y=s+r;m.dx=u;r+=m.dy=i(p*m.size/q)}}m&&(l?m.dx+=u-r:m.dy+=p-r)}function e(t,m){for(var u=-1/0,n=1/0,p=0,o=0;o<t.length;o++){var q=t[o].size;n>q&&(n=q);q>u&&(u=q);p+=q}p*=p;m*=m;return Math.max(m*u/p,p/(m*n))}function c(r,u){function A(w){var l=D==s,n=pv.sum(w,j),p=s?i(n/s):0;h(w,n,l,C,B,l?D:p,l?p:z);if(l){B+=p;z-=p}else{C+=p;D-=p}s=Math.min(D,z);return l}var m=r.parentNode,C=r.x,B=r.y,D=r.dx,z=r.dy;if(m){C+=m.paddingLeft;B+=m.paddingTop;D+=-m.paddingLeft-m.paddingRight,z+=-m.paddingTop-m.paddingBottom}if("squarify"==b){var E=[],v=1/0,s=Math.min(D,z),t=D*z/r.size;if(!(r.size<=0)){r.visitBefore(function(l){l.size*=t});for(var q=r.childNodes.slice();q.length;){var o=q[q.length-1];if(o.size){E.push(o);var t=e(E,s);if(v>=t){q.pop();v=t}else{E.pop();A(E);E.length=0;v=1/0}}else{q.pop()}}if(A(E)){for(var u=0;u<E.length;u++){E[u].dy+=z}}else{for(var u=0;u<E.length;u++){E[u].dx+=D}}}}else{h(r.childNodes,r.size,"slice"==b?!0:"dice"==b?!1:1&u,C,B,D,z)}}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,k)){var d=this,a=k.nodes,f=a[0],g=pv.Mark.stack,j=function(l){return l.size},i=k.round?Math.round:Number,b=k.mode;g.unshift(null);try{f.visitAfter(function(m,l){m.depth=l;m.x=m.y=m.dx=m.dy=0;g[0]=m;if(m.firstChild){m.size=pv.sum(m.childNodes,j);m.paddingRight=+d.$padRight.apply(d,g)||0;m.paddingLeft=+d.$padLeft.apply(d,g)||0;m.paddingBottom=+d.$padBottom.apply(d,g)||0;m.paddingTop=+d.$padTop.apply(d,g)||0}else{m.size=d.$size.apply(d,g)}})}finally{g.shift()}switch(k.order){case"ascending":f.sort(function(m,l){return m.size-l.size});break;case"descending":f.sort(function(m,l){return l.size-m.size});break;case"reverse":f.reverse()}f.x=0;f.y=0;f.dx=k.width;f.dy=k.height;f.visitBefore(c)}};pv.Layout.Tree=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Tree.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("breadth",Number).property("depth",Number).property("orient",String);pv.Layout.Tree.prototype.defaults=new pv.Layout.Tree().extend(pv.Layout.Hierarchy.prototype.defaults).group(1).breadth(15).depth(60).orient("top");pv.Layout.Tree.prototype.buildImplied=function(k){function t(w){var s,y,h;if(w.firstChild){s=w.firstChild;y=w.lastChild;h=s;for(var A=s;A;A=A.nextSibling){t(A);h=m(A,h)}e(w);var x=0.5*(s.prelim+y.prelim);if(s=w.previousSibling){w.prelim=s.prelim+a(w.depth,!0);w.mod=w.prelim-x}else{w.prelim=x}}else{(s=w.previousSibling)&&(w.prelim=s.prelim+a(w.depth,!0))}}function o(s,h,w){s.breadth=s.prelim+h;h+=s.mod;for(var x=s.firstChild;x;x=x.nextSibling){o(x,h,w)}}function m(J,H){var I=J.previousSibling;if(I){for(var y=J,x=J,B=I,A=J.parentNode.firstChild,D=y.mod,C=x.mod,F=B.mod,E=A.mod,G=z(B),h=q(y);G&&h;){B=G;y=h;A=q(A);x=z(x);x.ancestor=J;var s=B.prelim+F-(y.prelim+D)+a(B.depth,!1);if(s>0){l(u(B,J,H),J,s);D+=s;C+=s}F+=B.mod;D+=y.mod;E+=A.mod;C+=x.mod;G=z(B);h=q(y)}if(G&&!z(x)){x.thread=G;x.mod+=F-C}if(h&&!q(A)){A.thread=h;A.mod+=D-E;H=J}}return H}function q(h){return h.firstChild||h.thread}function z(h){return h.lastChild||h.thread}function l(w,s,h){var x=s.number-w.number;s.change-=h/x;s.shift+=h;w.change+=h/x;s.prelim+=h;s.mod+=h}function e(s){for(var h=0,x=0,w=s.lastChild;w;w=w.previousSibling){w.prelim+=h;w.mod+=h;x+=w.change;h+=w.shift+x}}function u(w,s,h){return w.ancestor.parentNode==s.parentNode?w.ancestor:h}function a(s,h){return(h?1:b+1)/("radial"==f?s:1)}function g(h){return"radial"==f?h.breadth/v:0}function d(h){switch(f){case"left":return h.depth;case"right":return i-h.depth;case"top":case"bottom":return h.breadth+i/2;case"radial":return i/2+h.depth*Math.cos(g(h))}}function c(h){switch(f){case"left":case"right":return h.breadth+r/2;case"top":return h.depth;case"bottom":return r-h.depth;case"radial":return r/2+h.depth*Math.sin(g(h))}}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,k)){var n=k.nodes,f=k.orient,v=k.depth,j=k.breadth,b=k.group,i=k.width,r=k.height,p=n[0];p.visitAfter(function(h,s){h.ancestor=h;h.prelim=0;h.mod=0;h.change=0;h.shift=0;h.number=h.previousSibling?h.previousSibling.number+1:0;h.depth=s});t(p);o(p,-p.prelim,0);p.visitAfter(function(h){h.breadth*=j;h.depth*=v;h.midAngle=g(h);h.x=d(h);h.y=c(h);h.firstChild&&(h.midAngle+=Math.PI);delete h.breadth;delete h.depth;delete h.ancestor;delete h.prelim;delete h.mod;delete h.change;delete h.shift;delete h.number;delete h.thread})}};pv.Layout.Indent=function(){pv.Layout.Hierarchy.call(this);this.link.interpolate("step-after")};pv.Layout.Indent.prototype=pv.extend(pv.Layout.Hierarchy).property("depth",Number).property("breadth",Number);pv.Layout.Indent.prototype.defaults=new pv.Layout.Indent().extend(pv.Layout.Hierarchy.prototype.defaults).depth(15).breadth(15);pv.Layout.Indent.prototype.buildImplied=function(c){function a(k,j,h){k.x=e+h++*f;k.y=d+j++*g;k.midAngle=0;for(var i=k.firstChild;i;i=i.nextSibling){j=a(i,j,h)}return j}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,c)){var b=c.nodes,g=c.breadth,f=c.depth,e=0,d=0;a(b[0],1,1)}};pv.Layout.Pack=function(){pv.Layout.Hierarchy.call(this);this.node.shapeRadius(function(a){return a.radius}).strokeStyle("rgb(31, 119, 180)").fillStyle("rgba(31, 119, 180, .25)");this.label.textAlign("center");delete this.link};pv.Layout.Pack.prototype=pv.extend(pv.Layout.Hierarchy).property("spacing",Number).property("order",String);pv.Layout.Pack.prototype.defaults=new pv.Layout.Pack().extend(pv.Layout.Hierarchy.prototype.defaults).spacing(1).order("ascending");pv.Layout.Pack.prototype.$radius=function(){return 1};pv.Layout.Pack.prototype.size=function(a){this.$radius="function"==typeof a?function(){return Math.sqrt(a.apply(this,arguments))}:(a=Math.sqrt(a),function(){return a});return this};pv.Layout.Pack.prototype.buildImplied=function(n){function f(k){var h=pv.Mark.stack;h.unshift(null);for(var o=0,q=k.length;q>o;o++){var p=k[o];p.firstChild||(p.radius=i.$radius.apply(i,(h[0]=p,h)))}h.shift()}function m(o){for(var h=[],k=o.firstChild;k;k=k.nextSibling){k.firstChild&&(k.radius=m(k));k.n=k.p=k;h.push(k)}switch(n.order){case"ascending":h.sort(function(q,p){return q.radius-p.radius});break;case"descending":h.sort(function(q,p){return p.radius-q.radius});break;case"reverse":h.reverse()}return e(h)}function e(z){function p(k){D=Math.min(k.x-k.radius,D);H=Math.max(k.x+k.radius,H);h=Math.min(k.y-k.radius,h);t=Math.max(k.y+k.radius,t)}function q(J,k){var K=J.n;J.n=k;k.p=J;k.n=K;K.p=k}function I(J,k){J.n=k;k.p=J}function r(K,k){var L=k.x-K.x,J=k.y-K.y,M=K.radius+k.radius;return M*M-L*L-J*J>0.001}var G,F,E,B,A,D=1/0,H=-1/0,h=1/0,t=-1/0;G=z[0];G.x=-G.radius;G.y=0;p(G);if(z.length>1){F=z[1];F.x=F.radius;F.y=0;p(F);if(z.length>2){E=z[2];d(G,F,E);p(E);q(G,E);G.p=E;q(E,F);F=G.n;for(var C=3;C<z.length;C++){d(G,F,E=z[C]);var o=0,u=1,s=1;for(B=F.n;B!=F;B=B.n,u++){if(r(B,E)){o=1;break}}if(1==o){for(A=G.p;A!=B.p;A=A.p,s++){if(r(A,E)){if(u>s){o=-1;B=A}break}}}if(0==o){q(G,E);F=E;p(E)}else{if(o>0){I(G,B);F=B;C--}else{if(0>o){I(B,F);G=B;C--}}}}}}for(var w=(D+H)/2,v=(h+t)/2,x=0,C=0;C<z.length;C++){var y=z[C];y.x-=w;y.y-=v;x=Math.max(x,y.radius+Math.sqrt(y.x*y.x+y.y*y.y))}return x+n.spacing}function d(s,q,p){var y=q.radius+p.radius,v=s.radius+p.radius,z=q.x-s.x,w=q.y-s.y,u=Math.sqrt(z*z+w*w),t=(v*v+u*u-y*y)/(2*v*u),k=Math.acos(t),r=t*v,o=Math.sin(k)*v;z/=u;w/=u;p.x=s.x+r*z+o*w;p.y=s.y+r*w-o*z}function b(r,h,q,o){for(var p=r.firstChild;p;p=p.nextSibling){p.x+=r.x;p.y+=r.y;b(p,h,q,o)}r.x=h+o*r.x;r.y=q+o*r.y;r.radius*=o}if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,n)){var i=this,a=n.nodes,j=a[0];f(a);j.x=0;j.y=0;j.radius=m(j);var l=this.width(),g=this.height(),c=1/Math.max(2*j.radius/l,2*j.radius/g);b(j,l/2,g/2,c)}};pv.Layout.Force=function(){pv.Layout.Network.call(this);this.link.lineWidth(function(b,a){return 1.5*Math.sqrt(a.linkValue)});this.label.textAlign("center")};pv.Layout.Force.prototype=pv.extend(pv.Layout.Network).property("bound",Boolean).property("iterations",Number).property("dragConstant",Number).property("chargeConstant",Number).property("chargeMinDistance",Number).property("chargeMaxDistance",Number).property("chargeTheta",Number).property("springConstant",Number).property("springDamping",Number).property("springLength",Number);pv.Layout.Force.prototype.defaults=new pv.Layout.Force().extend(pv.Layout.Network.prototype.defaults).dragConstant(0.1).chargeConstant(-40).chargeMinDistance(2).chargeMaxDistance(500).chargeTheta(0.9).springConstant(0.1).springDamping(0.3).springLength(20);pv.Layout.Force.prototype.buildImplied=function(q){function c(f){return f.fix?1:f.vx*f.vx+f.vy*f.vy}if(pv.Layout.Network.prototype.buildImplied.call(this,q)){var j=q.$force;if(j){j.next=this.binds.$force;this.binds.$force=j}}else{for(var b,l=this,a=q.nodes,p=q.links,d=q.iterations,o=q.width,g=q.height,e=0;e<a.length;e++){b=a[e];isNaN(b.x)&&(b.x=o/2+40*Math.random()-20);isNaN(b.y)&&(b.y=g/2+40*Math.random()-20)}var m=pv.simulation(a);m.force(pv.Force.drag(q.dragConstant));m.force(pv.Force.charge(q.chargeConstant).domain(q.chargeMinDistance,q.chargeMaxDistance).theta(q.chargeTheta));m.force(pv.Force.spring(q.springConstant).damping(q.springDamping).length(q.springLength).links(p));m.constraint(pv.Constraint.position());q.bound&&m.constraint(pv.Constraint.bound().x(6,o-6).y(6,g-6));if(null==d){m.step();m.step();q.$force=this.binds.$force={next:this.binds.$force,nodes:a,min:0.0001*(p.length+1),sim:m};this.$timer||(this.$timer=setInterval(function(){for(var h=!1,i=l.binds.$force;i;i=i.next){if(pv.max(i.nodes,c)>i.min){i.sim.step();h=!0}}h&&l.render()},42))}else{for(var e=0;d>e;e++){m.step()}}}};pv.Layout.Cluster=function(){pv.Layout.Hierarchy.call(this);var a,b=this.buildImplied;this.buildImplied=function(c){b.call(this,c);a=/^(top|bottom)$/.test(c.orient)?"step-before":/^(left|right)$/.test(c.orient)?"step-after":"linear"};this.link.interpolate(function(){return a})};pv.Layout.Cluster.prototype=pv.extend(pv.Layout.Hierarchy).property("group",Number).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Cluster.prototype.defaults=new pv.Layout.Cluster().extend(pv.Layout.Hierarchy.prototype.defaults).group(0).orient("top");pv.Layout.Cluster.prototype.buildImplied=function(c){if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,c)){var h,g,a=c.nodes[0],f=c.group,e=0,b=0.5-f/2,d=void 0;a.visitAfter(function(i){if(i.firstChild){i.depth=1+pv.max(i.childNodes,function(j){return j.depth})}else{if(f&&d!=i.parentNode){d=i.parentNode;e+=f}e++;i.depth=0}});h=1/e;g=1/a.depth;var d=void 0;a.visitAfter(function(i){if(i.firstChild){i.breadth=pv.mean(i.childNodes,function(j){return j.breadth})}else{if(f&&d!=i.parentNode){d=i.parentNode;b+=f}i.breadth=h*b++}i.depth=1-i.depth*g});a.visitAfter(function(i){i.minBreadth=i.firstChild?i.firstChild.minBreadth:i.breadth-h/2;i.maxBreadth=i.firstChild?i.lastChild.maxBreadth:i.breadth+h/2});a.visitBefore(function(i){i.minDepth=i.parentNode?i.parentNode.maxDepth:0;i.maxDepth=i.parentNode?i.depth+a.depth:i.minDepth+2*a.depth});a.minDepth=-g;pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,c)}};pv.Layout.Cluster.Fill=function(){pv.Layout.Cluster.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Cluster.Fill.prototype=pv.extend(pv.Layout.Cluster);pv.Layout.Cluster.Fill.prototype.buildImplied=function(a){pv.Layout.Cluster.prototype.buildImplied.call(this,a)||pv.Layout.Hierarchy.Fill.buildImplied.call(this,a)};pv.Layout.Partition=function(){pv.Layout.Hierarchy.call(this)};pv.Layout.Partition.prototype=pv.extend(pv.Layout.Hierarchy).property("order",String).property("orient",String).property("innerRadius",Number).property("outerRadius",Number);pv.Layout.Partition.prototype.defaults=new pv.Layout.Partition().extend(pv.Layout.Hierarchy.prototype.defaults).orient("top");pv.Layout.Partition.prototype.$size=function(){return 1};pv.Layout.Partition.prototype.size=function(a){this.$size=a;return this};pv.Layout.Partition.prototype.buildImplied=function(c){if(!pv.Layout.Hierarchy.prototype.buildImplied.call(this,c)){var d=this,b=c.nodes[0],a=pv.Mark.stack,e=0;a.unshift(null);b.visitAfter(function(g,f){f>e&&(e=f);g.size=g.firstChild?pv.sum(g.childNodes,function(h){return h.size}):d.$size.apply(d,(a[0]=g,a))});a.shift();switch(c.order){case"ascending":b.sort(function(g,f){return g.size-f.size});break;case"descending":b.sort(function(f,g){return g.size-f.size})}b.minBreadth=0;b.breadth=0.5;b.maxBreadth=1;b.visitBefore(function(i){for(var f=i.minBreadth,g=i.maxBreadth-f,h=i.firstChild;h;h=h.nextSibling){h.minBreadth=f;f+=h.size/i.size*g;h.maxBreadth=f;h.breadth=(f+h.minBreadth)/2}});b.visitAfter(function(g,f){g.minDepth=(f-1)/e;g.maxDepth=g.depth=f/e});pv.Layout.Hierarchy.NodeLink.buildImplied.call(this,c)}};pv.Layout.Partition.Fill=function(){pv.Layout.Partition.call(this);pv.Layout.Hierarchy.Fill.constructor.call(this)};pv.Layout.Partition.Fill.prototype=pv.extend(pv.Layout.Partition);pv.Layout.Partition.Fill.prototype.buildImplied=function(a){pv.Layout.Partition.prototype.buildImplied.call(this,a)||pv.Layout.Hierarchy.Fill.buildImplied.call(this,a)};pv.Layout.Arc=function(){pv.Layout.Network.call(this);var b,d,a,c=this.buildImplied;this.buildImplied=function(e){c.call(this,e);d=e.directed;b="radial"==e.orient?"linear":"polar";a="right"==e.orient||"top"==e.orient};this.link.data(function(g){var f=g.sourceNode,e=g.targetNode;return a!=(d||f.breadth<e.breadth)?[f,e]:[e,f]}).interpolate(function(){return b})};pv.Layout.Arc.prototype=pv.extend(pv.Layout.Network).property("orient",String).property("directed",Boolean);pv.Layout.Arc.prototype.defaults=new pv.Layout.Arc().extend(pv.Layout.Network.prototype.defaults).orient("bottom");pv.Layout.Arc.prototype.sort=function(a){this.$sort=a;return this};pv.Layout.Arc.prototype.buildImplied=function(t){function e(h){switch(f){case"top":return -Math.PI/2;case"bottom":return Math.PI/2;case"left":return Math.PI;case"right":return 0;case"radial":return 2*(h-0.25)*Math.PI}}function p(h){switch(f){case"top":case"bottom":return h*q;case"left":return 0;case"right":return q;case"radial":return q/2+a*Math.cos(e(h))}}function o(h){switch(f){case"top":return 0;case"bottom":return k;case"left":case"right":return h*k;case"radial":return k/2+a*Math.sin(e(h))}}if(!pv.Layout.Network.prototype.buildImplied.call(this,t)){var c=t.nodes,f=t.orient,j=this.$sort,l=pv.range(c.length),q=t.width,k=t.height,a=Math.min(q,k)/2;j&&l.sort(function(i,h){return j(c[i],c[h])});for(var g=0;g<c.length;g++){var d=c[l[g]],m=d.breadth=(g+0.5)/c.length;d.x=p(m);d.y=o(m);d.midAngle=e(m)}}};pv.Layout.Horizon=function(){pv.Layout.call(this);var e,h,b,g,f,a,d=this,c=this.buildImplied;this.buildImplied=function(i){c.call(this,i);e=i.bands;h=i.mode;b=Math.round(("color"==h?0.5:1)*i.height);g=i.backgroundStyle;f=pv.ramp(g,i.negativeStyle).domain(0,e);a=pv.ramp(g,i.positiveStyle).domain(0,e)};var e=new pv.Panel().data(function(){return pv.range(2*e)}).overflow("hidden").height(function(){return b}).top(function(j){return"color"==h?(1&j)*b:0}).fillStyle(function(j){return j?null:g});this.band=new pv.Mark().top(function(k,j){return"mirror"==h&&1&j?(j+1>>1)*b:null}).bottom(function(k,j){return"mirror"==h?1&j?null:(j+1>>1)*-b:(1&j||-1)*(j+1>>1)*b}).fillStyle(function(k,j){return(1&j?f:a)((j>>1)+1)});this.band.add=function(i){return d.add(pv.Panel).extend(e).add(i).extend(this)}};pv.Layout.Horizon.prototype=pv.extend(pv.Layout).property("bands",Number).property("mode",String).property("backgroundStyle",pv.fillStyle).property("positiveStyle",pv.fillStyle).property("negativeStyle",pv.fillStyle);pv.Layout.Horizon.prototype.defaults=new pv.Layout.Horizon().extend(pv.Layout.prototype.defaults).bands(2).mode("offset").backgroundStyle("white").positiveStyle("#1f77b4").negativeStyle("#d62728");pv.Layout.Rollup=function(){pv.Layout.Network.call(this);var b,a,d=this,c=d.buildImplied;this.buildImplied=function(e){c.call(this,e);b=e.$rollup.nodes;a=e.$rollup.links};this.node.data(function(){return b}).shapeSize(function(e){return 20*e.nodes.length});this.link.interpolate("polar").eccentricity(0.8);this.link.add=function(e){return d.add(pv.Panel).data(function(){return a}).add(e).extend(this)}};pv.Layout.Rollup.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Rollup.prototype.x=function(a){this.$x=pv.functor(a);return this};pv.Layout.Rollup.prototype.y=function(a){this.$y=pv.functor(a);return this};pv.Layout.Rollup.prototype.buildImplied=function(p){function q(n){return j[n]+","+h[n]}if(!pv.Layout.Network.prototype.buildImplied.call(this,p)){var u=p.nodes,a=p.links,d=p.directed,t=u.length,j=[],h=[],B=0,v={},b={},f=pv.Mark.stack,r={parent:this};f.unshift(null);for(var z=0;t>z;z++){r.index=z;f[0]=u[z];j[z]=this.$x.apply(r,f);h[z]=this.$y.apply(r,f)}f.shift();for(var z=0;z<u.length;z++){var l=q(z),k=v[l];if(!k){k=v[l]=Object.create(u[z]);k.index=B++;k.x=j[z];k.y=h[z];k.nodes=[]}k.nodes.push(u[z])}for(var z=0;z<a.length;z++){var w=a[z].sourceNode,C=a[z].targetNode,A=v[q(w.index)],c=v[q(C.index)],g=!d&&A.index>c.index,e=g?c.index+","+A.index:A.index+","+c.index,m=b[e];m||(m=b[e]={sourceNode:A,targetNode:c,linkValue:0,links:[]});m.links.push(a[z]);m.linkValue+=a[z].linkValue}p.$rollup={nodes:pv.values(v),links:pv.values(b)}}};pv.Layout.Matrix=function(){pv.Layout.Network.call(this);var g,b,a,f,e,d=this,c=d.buildImplied;this.buildImplied=function(h){c.call(this,h);g=h.nodes.length;b=h.width/g;a=h.height/g;f=h.$matrix.labels;e=h.$matrix.pairs};this.link.data(function(){return e}).left(function(){return b*(this.index%g)}).top(function(){return a*Math.floor(this.index/g)}).width(function(){return b}).height(function(){return a}).lineWidth(1.5).strokeStyle("#fff").fillStyle(function(h){return h.linkValue?"#555":"#eee"}).parent=this;delete this.link.add;this.label.data(function(){return f}).left(function(){return 1&this.index?b*((this.index>>1)+0.5):0}).top(function(){return 1&this.index?0:a*((this.index>>1)+0.5)}).textMargin(4).textAlign(function(){return 1&this.index?"left":"right"}).textAngle(function(){return 1&this.index?-Math.PI/2:0});delete this.node};pv.Layout.Matrix.prototype=pv.extend(pv.Layout.Network).property("directed",Boolean);pv.Layout.Matrix.prototype.sort=function(a){this.$sort=a;return this};pv.Layout.Matrix.prototype.buildImplied=function(e){if(!pv.Layout.Network.prototype.buildImplied.call(this,e)){var h=e.nodes,c=e.links,u=this.$sort,g=h.length,d=pv.range(g),t=[],z=[],x={};e.$matrix={labels:t,pairs:z};u&&d.sort(function(j,i){return u(h[j],h[i])});for(var r=0;g>r;r++){for(var q=0;g>q;q++){var w=d[r],v=d[q],f={row:r,col:q,sourceNode:h[w],targetNode:h[v],linkValue:0};z.push(x[w+"."+v]=f)}}for(var r=0;g>r;r++){var w=d[r];t.push(h[w],h[w])}for(var r=0;r<c.length;r++){var o=c[r],k=o.sourceNode.index,y=o.targetNode.index,m=o.linkValue;x[k+"."+y].linkValue+=m;e.directed||(x[y+"."+k].linkValue+=m)}}};pv.Layout.Bullet=function(){pv.Layout.call(this);var c,b,h,d,a,f=this,e=f.buildImplied,g=f.x=pv.Scale.linear();this.buildImplied=function(i){e.call(this,a=i);c=i.orient;b=/^left|right$/.test(c);h=pv.ramp("#bbb","#eee").domain(0,Math.max(1,a.ranges.length-1));d=pv.ramp("steelblue","lightsteelblue").domain(0,Math.max(1,a.measures.length-1))};(this.range=new pv.Mark()).data(function(){return a.ranges}).reverse(!0).left(function(){return"left"==c?0:null}).top(function(){return"top"==c?0:null}).right(function(){return"right"==c?0:null}).bottom(function(){return"bottom"==c?0:null}).width(function(i){return b?g(i):null}).height(function(i){return b?null:g(i)}).fillStyle(function(){return h(this.index)}).antialias(!1).parent=f;(this.measure=new pv.Mark()).extend(this.range).data(function(){return a.measures}).left(function(){return"left"==c?0:b?null:this.parent.width()/3.25}).top(function(){return"top"==c?0:b?this.parent.height()/3.25:null}).right(function(){return"right"==c?0:b?null:this.parent.width()/3.25}).bottom(function(){return"bottom"==c?0:b?this.parent.height()/3.25:null}).fillStyle(function(){return d(this.index)}).parent=f;(this.marker=new pv.Mark()).data(function(){return a.markers}).left(function(i){return"left"==c?g(i):b?null:this.parent.width()/2}).top(function(i){return"top"==c?g(i):b?this.parent.height()/2:null}).right(function(i){return"right"==c?g(i):null}).bottom(function(i){return"bottom"==c?g(i):null}).strokeStyle("black").shape("bar").shapeAngle(function(){return b?0:Math.PI/2}).parent=f;(this.tick=new pv.Mark()).data(function(){return g.ticks(7)}).left(function(i){return"left"==c?g(i):null}).top(function(i){return"top"==c?g(i):null}).right(function(i){return"right"==c?g(i):b?null:-6}).bottom(function(i){return"bottom"==c?g(i):b?-8:null}).height(function(){return b?6:null}).width(function(){return b?null:6}).parent=f};pv.Layout.Bullet.prototype=pv.extend(pv.Layout).property("orient",String).property("ranges").property("markers").property("measures").property("minimum").property("maximum");pv.Layout.Bullet.prototype.defaults=new pv.Layout.Bullet().extend(pv.Layout.prototype.defaults).orient("left").ranges([]).markers([]).measures([]);pv.Layout.Bullet.prototype._originIsZero=!0;pv.Layout.Bullet.prototype.originIsZero=function(a){return arguments.length?this._originIsZero=!!a:this._originIsZero};pv.Layout.Bullet.prototype.buildImplied=function(e){pv.Layout.prototype.buildImplied.call(this,e);var b,d=this.parent[/^left|right$/.test(e.orient)?"width":"height"](),a=e.maximum,c=e.minimum,f=1e-10;if(null==a){b=[].concat(e.ranges,e.markers,e.measures);a=pv.max(b)}else{a=+a}if(null==c){b||(b=[].concat(e.ranges,e.markers,e.measures));c=pv.min(b);c=0.95*c}else{c=+c}(c>a||f>a-c)&&(c=Math.abs(a)<f?-0.1:0.99*a);this._originIsZero&&c*a>0&&(c>0?c=0:a=0);e.minimum=c;e.maximum=a;this.x.domain(c,a).range(0,d)};pv.Behavior={};pv.Behavior.dragBase=function(c){function b(t){if(!l){l=!0;this.addEventInterceptor("click",d,!0)}if(!k){var o=this.root.scene.$g;k=[[o,"mousemove",pv.listen(o,"mousemove",h)],[o,"mouseup",pv.listen(o,"mouseup",e)],[document,"mousemove",pv.listen(document,"mousemove",h)],[document,"mouseup",pv.listen(document,"mouseup",e)]]}var r=arguments[arguments.length-1];j=r.target;g=!1;r.stopPropagation();var q=this.mouse(),s=this.scene,p=this.index;f=s[p].drag={phase:"start",m:q,m1:q,m2:null,d:t,scene:s,index:p};r=i(r,f);c.dragstart.call(this,r);var n=f.m;if(n!==q){q.x=n.x;q.y=n.y}}function h(m){if(f){f.phase="move";m.stopPropagation();m=i(m,f);var n=f.scene;n.mark.context(n,f.index,function(){var p=f.m2||f.m1,q=this.mouse();if(!(p&&q.distance2(p).dist2<=2)){f.m=f.m2=q;c.drag.call(this,m);var o=f.m;if(o!==q){q.x=o.x;q.y=o.y}}})}}function e(p){if(f){f.phase="end";var m=f.m2,o=m&&f.m1.distance2(m).dist2>0.1;f.canceled=!o;g=o&&j===p.target;g||(j=null);p.stopPropagation();p=i(p,f);if(k){k.forEach(function(r){pv.unlisten.apply(pv,r)});k=null}var q=f.scene,n=f.index;try{q.mark.context(q,n,function(){c.dragend.call(this,p)})}finally{f=null;delete q[n].drag}}}function i(r,q){try{r.drag=q;return r}catch(o){}var m={};for(var s in r){var n=r[s];m[s]="function"!=typeof n?n:a(n,r)}m._sourceEvent=r;return m}function a(n,m){return function(){return n.apply(m,arguments)}}function d(m,n){if(g&&j===n.target){g=!1;j=null;return !1}}var k,j,g,l,f;c.autoRender=!0;c.positionConstraint=null;c.bound=function(m,n){return Math.max(f.min[n],Math.min(f.max[n],m))};b.autoRender=function(m){if(arguments.length){c.autoRender=!!m;return b}return c.autoRender};b.positionConstraint=function(m){if(arguments.length){c.positionConstraint=m;return b}return c.positionConstraint};return b};pv.Behavior.drag=function(){var f,e=null,c=1,b=1,d={dragstart:function(j){var i=j.drag;i.type="drag";var k=i.d,g=pv.vector(k.x,k.y);k.fix=g;k.drag=i;f=g.minus(i.m1);var h=this.parent;i.max={x:h.width()-(k.dx||0),y:h.height()-(k.dy||0)};i.min={x:0,y:0};d.autoRender&&this.render();pv.Mark.dispatch("dragstart",i.scene,i.index,j)},drag:function(j){var i=j.drag,h=i.m2,l=i.d;i.m=f.plus(h);var k=d.positionConstraint;k&&k(i);var g=i.m;c&&(l.x=l.fix.x=d.bound(g.x,"x"));b&&(l.y=l.fix.y=d.bound(g.y,"y"));d.autoRender&&this.render();pv.Mark.dispatch("drag",i.scene,i.index,j)},dragend:function(h){var g=h.drag,i=g.d;i.fix=null;f=null;d.autoRender&&this.render();try{pv.Mark.dispatch("dragend",g.scene,g.index,h)}finally{delete i.drag}}},a=pv.Behavior.dragBase(d);a.collapse=function(g){if(arguments.length){e=String(g);switch(e){case"y":c=1;b=0;break;case"x":c=0;b=1;break;default:c=1;b=1}return a}return e};return a};pv.Behavior.point=function(a){function j(q,r){for(var A=q[r],u={cost:1/0},o=(A.visible?A.children.length:0)-1;o>=0;o--){var k,l=A.children[o],m=l.mark;if("panel"==m.type){m.scene=l;for(var n=l.length-1;n>=0;n--){m.index=n;k=j(l,n);k.cost<u.cost&&(u=k)}delete m.scene;delete m.index}else{if(m.$handlers.point){for(var x=m.mouse(),n=l.length-1;n>=0;n--){var t=l[n],z=x.x-t.left-(t.width||0)/2,y=x.y-t.top-(t.height||0)/2,w=f*z*z+e*y*y;if(w<u.cost){u.distance=z*z+y*y;u.cost=w;u.scene=l;u.index=n}}}}}return u}function d(l){var k=j(this.scene,this.index);(1/0==k.cost||k.distance>b)&&(k=null);if(i){if(k&&i.scene==k.scene&&i.index==k.index){return}pv.Mark.dispatch("unpoint",i.scene,i.index,l)}if(i=k){pv.Mark.dispatch("point",k.scene,k.index,l);if(h||"panel"!==this.type){pv.listen(this.root.canvas(),"mouseout",c)}else{h=this;h.event("mouseout",function(){var m=arguments[arguments.length-1];c.call(h.scene.$g,m)})}}}function c(k){if(i&&!pv.ancestor(this,k.relatedTarget)){pv.Mark.dispatch("unpoint",i.scene,i.index,k);i=null}}var i,g=null,f=1,e=1,h=null,b=arguments.length?a*a:900;d.collapse=function(k){if(arguments.length){g=String(k);switch(g){case"y":f=1;e=0;break;case"x":f=0;e=1;break;default:f=1;e=1}return d}return g};return d};pv.Behavior.select=function(){var f=null,d=1,c=1,b=!1,e={dragstart:function(j){var h=j.drag;h.type="select";var i=h.d;i.drag=h;h.max={x:this.width(),y:this.height()};h.min={x:0,y:0};var k=e.positionConstraint;if(k){h.m=h.m.clone();k(h)}var g=h.m;if(d){i.x=e.bound(g.x,"x");b||(i.dx=0)}if(c){i.y=e.bound(g.y,"y");b||(i.dy=0)}pv.Mark.dispatch("selectstart",h.scene,h.index,j)},drag:function(p){var j=p.drag,q=j.m1,g=j.d;j.max.x=this.width();j.max.y=this.height();var h=e.positionConstraint;if(h){j.m=j.m.clone();h(j)}var i=j.m;if(d){var o=Math.min(q.x,i.x);o=e.bound(o,"x");g.x=o;if(!b){var n=Math.max(i.x,q.x);n=e.bound(n,"x");g.dx=n-o}}if(c){var l=Math.min(q.y,i.y);l=e.bound(l,"y");g.y=l;if(!b){var k=Math.max(i.y,q.y);k=e.bound(k,"y");g.dy=k-l}}e.autoRender&&this.render();pv.Mark.dispatch("select",j.scene,j.index,p)},dragend:function(i){var g=i.drag;try{pv.Mark.dispatch("selectend",g.scene,g.index,i)}finally{var h=g.d;delete h.drag}}},a=pv.Behavior.dragBase(e);a.collapse=function(g){if(arguments.length){f=String(g);switch(f){case"y":d=1;c=0;break;case"x":d=0;c=1;break;default:d=1;c=1}return a}return f};a.preserveLength=function(g){if(arguments.length){b=!!g;return a}return b};return a};pv.Behavior.resize=function(c){var a=!1,e="left"===c||"right"===c,d={dragstart:function(j){var h=j.drag;h.type="resize";var f=h.m1,i=h.d;i.drag=h;switch(c){case"left":f.x=i.x+i.dx;break;case"right":f.x=i.x;break;case"top":f.y=i.y+i.dy;break;case"bottom":f.y=i.y}var g=this.parent;h.max={x:g.width(),y:g.height()};h.min={x:0,y:0};pv.Mark.dispatch("resizestart",h.scene,h.index,j)},drag:function(o){var i=o.drag,p=i.m1,g=d.positionConstraint;if(g){i.m=i.m.clone();g(i)}var h=i.m,f=i.d;if(!a||e){var n=Math.min(p.x,h.x),l=Math.max(h.x,p.x);n=d.bound(n,"x");l=d.bound(l,"x");f.x=n;f.dx=l-n}if(!a||!e){var k=Math.min(p.y,h.y),j=Math.max(h.y,p.y);n=d.bound(k,"y");l=d.bound(j,"y");f.y=k;f.dy=j-k}d.autoRender&&this.render();pv.Mark.dispatch("resize",i.scene,i.index,o)},dragend:function(h){var f=h.drag;max=null;try{pv.Mark.dispatch("resizeend",f.scene,f.index,h)}finally{var g=f.d;delete g.drag}}},b=pv.Behavior.dragBase(d);b.preserveOrtho=function(f){if(arguments.length){a=!!f;return b}return a};return b};pv.Behavior.pan=function(){function a(){g=this.index;e=this.scene;h=pv.vector(pv.event.pageX,pv.event.pageY);i=this.transform();c=1/(i.k*this.scale);b&&(b={x:(1-i.k)*this.width(),y:(1-i.k)*this.height()})}function f(j){if(e){e.mark.context(e,g,function(){var l=(pv.event.pageX-h.x)*c,n=(pv.event.pageY-h.y)*c,k=i.translate(l,n);if(b){k.x=Math.max(b.x,Math.min(0,k.x));k.y=Math.max(b.y,Math.min(0,k.y))}this.transform(k).render()});pv.Mark.dispatch("pan",e,g,j)}}function d(){e=null}var e,g,i,h,c,b;a.bound=function(j){if(arguments.length){b=Boolean(j);return this}return Boolean(b)};pv.listen(window,"mousemove",f);pv.listen(window,"mouseup",d);return a};pv.Behavior.zoom=function(c){function a(h){var g=this.mouse(),f=pv.event.wheel*c,d=this.transform().translate(g.x,g.y).scale(0>f?1000/(1000-f):(1000+f)/1000).translate(-g.x,-g.y);if(b){d.k=Math.max(1,d.k);d.x=Math.max((1-d.k)*this.width(),Math.min(0,d.x));d.y=Math.max((1-d.k)*this.height(),Math.min(0,d.y))}this.transform(d).render();pv.Mark.dispatch("zoom",this.scene,this.index,h)}var b;arguments.length||(c=1/48);a.bound=function(d){if(arguments.length){b=Boolean(d);return this}return Boolean(b)};return a};pv.Geo=function(){};pv.Geo.projections={mercator:{project:function(a){return{x:a.lng/180,y:a.lat>85?1:a.lat<-85?-1:Math.log(Math.tan(Math.PI/4+pv.radians(a.lat)/2))/Math.PI}},invert:function(a){return{lng:180*a.x,lat:pv.degrees(2*Math.atan(Math.exp(a.y*Math.PI))-Math.PI/2)}}},"gall-peters":{project:function(a){return{x:a.lng/180,y:Math.sin(pv.radians(a.lat))}},invert:function(a){return{lng:180*a.x,lat:pv.degrees(Math.asin(a.y))}}},sinusoidal:{project:function(a){return{x:pv.radians(a.lng)*Math.cos(pv.radians(a.lat))/Math.PI,y:a.lat/90}},invert:function(a){return{lng:pv.degrees(a.x*Math.PI/Math.cos(a.y*Math.PI/2)),lat:90*a.y}}},aitoff:{project:function(e){var c=pv.radians(e.lng),d=pv.radians(e.lat),b=Math.acos(Math.cos(d)*Math.cos(c/2));return{x:2*(b?Math.cos(d)*Math.sin(c/2)*b/Math.sin(b):0)/Math.PI,y:2*(b?Math.sin(d)*b/Math.sin(b):0)/Math.PI}},invert:function(b){var a=b.x*Math.PI/2,c=b.y*Math.PI/2;return{lng:pv.degrees(a/Math.cos(c)),lat:pv.degrees(c)}}},hammer:{project:function(e){var a=pv.radians(e.lng),b=pv.radians(e.lat),d=Math.sqrt(1+Math.cos(b)*Math.cos(a/2));return{x:2*Math.SQRT2*Math.cos(b)*Math.sin(a/2)/d/3,y:Math.SQRT2*Math.sin(b)/d/1.5}},invert:function(b){var a=3*b.x,d=1.5*b.y,c=Math.sqrt(1-a*a/16-d*d/4);return{lng:pv.degrees(2*Math.atan2(c*a,2*(2*c*c-1))),lat:pv.degrees(Math.asin(c*d))}}},identity:{project:function(a){return{x:a.lng/180,y:a.lat/90}},invert:function(a){return{lng:180*a.x,lat:90*a.y}}}};pv.Geo.scale=function(b){function e(d){if(!o||d.lng!=o.lng||d.lat!=o.lat){o=d;var c=n(d);m={x:l(c.x),y:k(c.y)}}return m}function n(d){var c={lng:d.lng-i.lng,lat:d.lat};return f.project(c)}function a(c){var d=f.invert(c);d.lng+=i.lng;return d}var o,m,h={x:0,y:0},q={x:1,y:1},g=[],f=pv.Geo.projections.identity,l=pv.Scale.linear(-1,1).range(0,1),k=pv.Scale.linear(-1,1).range(1,0),i={lng:0,lat:0};e.x=function(c){return e(c).x};e.y=function(c){return e(c).y};e.ticks={lng:function(c){var p,d;if(g.length>1){var j=pv.Scale.linear();void 0==c&&(c=10);p=j.domain(g,function(r){return r.lat}).ticks(c);d=j.domain(g,function(r){return r.lng}).ticks(c)}else{p=pv.range(-80,81,10);d=pv.range(-180,181,10)}return d.map(function(r){return p.map(function(s){return{lat:s,lng:r}})})},lat:function(c){return pv.transpose(e.ticks.lng(c))}};e.invert=function(c){return a({x:l.invert(c.x),y:k.invert(c.y)})};e.domain=function(r,c){if(arguments.length){g=r instanceof Array?arguments.length>1?pv.map(r,c):r:Array.prototype.slice.call(arguments);if(g.length>1){var d=g.map(function(s){return s.lng}),j=g.map(function(s){return s.lat});i={lng:(pv.max(d)+pv.min(d))/2,lat:(pv.max(j)+pv.min(j))/2};var p=g.map(n);l.domain(p,function(s){return s.x});k.domain(p,function(s){return s.y})}else{i={lng:0,lat:0};l.domain(-1,1);k.domain(-1,1)}o=null;return this}return g};e.range=function(d,c){if(arguments.length){if("object"==typeof d){h={x:Number(d.x),y:Number(d.y)};q={x:Number(c.x),y:Number(c.y)}}else{h={x:0,y:0};q={x:Number(d),y:Number(c)}}l.range(h.x,q.x);k.range(q.y,h.y);o=null;return this}return[h,q]};e.projection=function(c){if(arguments.length){f="string"==typeof c?pv.Geo.projections[c]||pv.Geo.projections.identity:c;return this.domain(g)}return c};pv.copyOwn(e,pv.Scale.common);arguments.length&&e.projection(b);return e};