/*!
 * Copyright 2002 - 2013 Webdetails, a Pentaho company.  All rights reserved.
 *
 * This software was developed by Webdetails and is provided under the terms
 * of the Mozilla Public License, Version 2.0, or any later version. You may not use
 * this file except in compliance with the license. If you need a copy of the license,
 * please go to  http://mozilla.org/MPL/2.0/. The Initial Developer is Webdetails.
 *
 * Software distributed under the Mozilla Public License is distributed on an "AS IS"
 * basis, WITHOUT WARRANTY OF ANY KIND, either express or  implied. Please refer to
 * the license for the specific language governing your rights and limitations.
 */
;
/*!!*/
;var pvc=function(a4,p){function ar(){if(aL.debug>0&&"undefined"!=typeof console){["log","info",["trace","debug"],"error","warn",["group","groupCollapsed"],"groupEnd"].forEach(function(bf){bf=bf instanceof Array?bf:[bf,bf];aW(aL,bf[0],bf[1],"[pvChart]")})}else{aL.debug>1&&(aL.debug=1);["log","info","trace","warn","group","groupEnd"].forEach(function(bf){aL[bf]=a4.noop});var be="[pvChart ERROR]: ";aL.error=function(bf){bf&&"object"==typeof bf&&bf.message&&(bf=bf.message);bf=""+a4.nullyTo(bf,"");bf.indexOf(be)<0&&(bf=be+bf);throw new Error(bf)}}aL.logError=aL.error;p.error=aL.error}function aE(){var be=p.Behavior.tipsy;if(be&&be.setDebug){be.setDebug(aL.debug);be.log=aL.log}}function aW(bf,bg,be,bh){be||(be=bg);var bk,bj=console,bi=bj[be]||bj.log;if(bi){var bm=bh+": %s";if(a4.fun.is(bi)){bk=bi.bind(bj,bm)}else{var bl=Function.prototype.apply;bk=function(){bl.call(bi,bj,a4.array.append([bm],arguments))}}}bf[bg]=bk}function a3(bf,be){return bf?a4.object.is(bf)?bf.abs:be?be+a4.firstUpperCase(bf):bf:be}function ab(bg){bg=p.color(bg);var bi=bg.r,bh=bg.g,be=bg.b,bj=(bi+bh+be)/3,bf=2;return Math.abs(bi-bj)<=bf&&Math.abs(bh-bj)<=bf&&Math.abs(be-bj)<=bf}function B(bf){bf||a4.fail.argumentRequired("keyArgs");var be=bf.type||a4.fail.argumentRequired("keyArgs.type");switch(be){case"linear":return new aL.color.LinearScalesBuild(bf).buildMap();case"discrete":return new aL.color.DiscreteScalesBuild(bf).buildMap();case"normal":return new aL.color.NormalScalesBuild(bf).buildMap()}throw a4.error.argumentInvalid("scaleType","Unexistent scale type '{0}'.",[be])}function aK(bf){bf||a4.fail.argumentRequired("keyArgs");var be=bf.type||a4.fail.argumentRequired("keyArgs.type");switch(be){case"linear":return new aL.color.LinearScalesBuild(bf).build();case"discrete":return new aL.color.DiscreteScalesBuild(bf).build();case"normal":return new aL.color.NormalScalesBuild(bf).build()}throw a4.error.argumentInvalid("scaleType","Unexistent scale type '{0}'.",[be])}function bb(bg,be){function bp(bq){return bo[bq].resolve()}function bl(bq,br){var bs=bp(bq);return br&&!bs.isSpecified?void 0:bs.value}function bf(bq){return bp(bq).isSpecified}function bk(bq){return bl(bq,!0)}function bn(bq){return a4.hasOwn(bo,bq)}function bi(bq){return bm(bq,!1)}function bh(bq){return bm(bq,!0)}function bj(bq){return bp(bq)._dv}function bm(br,bt){for(var bq in br){var bu=a4.hasOwnProp.call(bo,bq)&&bo[bq];if(bu){var bs=br[bq];void 0!==bs&&bu.set(bs,bt)}}return bl}bg||a4.fail.argumentRequired("specs");var bo={};a4.each(bg,function(bq,br){var bs=new aH(br,bl,be,bq);bo[bs.name]=bs});bl.option=bl;bl.specified=bk;bl.defaultValue=bj;bl.isSpecified=bf;bl.isDefined=bn;bl.specify=bi;bl.defaults=bh;return bl}function I(be){return function(bi){for(var bh=0,bg=be.length;bg>bh;bh++){var bf=be[bh];"string"==typeof bf&&(bf=this[bf]);if(bf.call(this,bi)===!0){return !0}}}}function aQ(be){return function(bf){bf.specify(be);return !0}}function az(be){return function(bg){var bf=be.call(this,bg);if(void 0!==bf){bg.specify(bf);return !0}}}function M(be){return function(bg){var bf=be.call(this,bg);if(void 0!==bf){bg.defaultValue(bf);return !0}}}function aq(bh,bg){var be=bh&&bh.length;if(be){for(var bf=0;be>bf;bf++){var bi=bh[bf];bg&&(bi[bg]=null);bi.dispose()}bh.length=0}}function G(bi,be,bj,bh,bg){bj[bh]=bi;var bf=bi[be]||(bi[be]=[]);null==bg||bg>=bf.length?bf.push(bj):bf.splice(bg,0,bj)}function ak(bi,be,bj,bh){var bg=bi[be];if(bg){var bf=bg.indexOf(bj);bf>=0&&a4.array.removeAt(bg,bf)}bj[bh]=null}function aR(be){this.playedVisualRoles.set(be.name,be);aU.call(this.complexType,this)}function Q(be){this.playedVisualRoles.rem(be.name);aU.call(this.complexType,this)}function aU(){this._isPctRoleDimTypeMap=null}function A(be,bh){function bf(){var bi={},bj=a4.query(bg.source).select(function(bk){bh(bk,bi);var bl=bi.series;null!=bl&&null!=bl.v&&(bl=bl.v);return bl||null}).distinct().array();return bg._createPlot2SeriesKeySet(be,bj)}var bg=this;return this._dataPartGet(bf,bh)}function q(bf,be){return bf.id-be.id}function v(bf,be){return be.id-bf.id}function h(){delete this.isSelected}function aj(be){return be.isNull||be.isSelected}function aY(be){return be.isSelected===!0}function a7(be){return be.isSelected===!1}function ay(be){return be.isVisible===!0}function aF(be){return be.isVisible===!1}function aX(be){return be.isNull===!0}function a6(be){return be.isNull===!1}function ag(bh,bk,bm,bj,bi,bf){var bg;if(this.owner===this){if(null==bi){var bl=bh._formatter;bi=bl?bl(bj,bk):bj}bi=""+bi;!bi&&aL.debug>=2&&aL.log("Only the null value should have an empty label.");bg=new aL.data.Atom(this,bj,bi,bk,bm);bf&&(bg.isVirtual=!0)}else{var be=this.parent||this.linkParent;bg=be._atomsByKey[bm]||ag.call(be,bh,bk,bm,bj,bi,bf)}a4.array.insert(this._atoms,bg,this._atomComparer);g.call(this);this._atomsByKey[bm]=bg;return bg}function a(bi){var be=bi.key,bh=this;if(bi.dimension===bh){bh.owner===bh||a4.assert("Should be an owner dimension");be||bi!==bh._virtualNullAtom||(bi=bh.intern(null));return bi}var bg=!bh._lazyInit;if(bg){var bf=bh._atomsByKey[be];if(bf){if(bf!==bi){throw a4.error.operationInvalid("Atom is from a different root data.")}return bi}if(bh.owner===bh){throw a4.error.operationInvalid("Atom is from a different root data.")}}a.call(bh.parent||bh.linkParent,bi);if(bg){bh._atomsByKey[be]=bi;if(be){a4.array.insert(bh._atoms,bi,bh._atomComparer)}else{bh._nullAtom=bi;bh._atoms.unshift(bi)}g.call(bh)}return bi}function L(bf){var bg=a4.get(bf,"visible"),be=a4.get(bf,"selected");return(null==bg?null:!!bg)+":"+(null==be?null:!!be)}function ae(bg){var bh=this._nullAtom;if(!bh){if(this.owner===this){var be=this.type._formatter,bf=""+(be?be.call(null,null,bg):"");bh=new aL.data.Atom(this,null,bf,null,"");this.data._atomsBase[this.name]=bh}else{bh=ae.call(this.parent||this.linkParent,bg)}this._atomsByKey[""]=this._nullAtom=bh;this._atoms.unshift(bh)}return bh}function O(){this.owner===this||a4.assert("Can only create atoms on an owner dimension.");if(!this._virtualNullAtom){this._virtualNullAtom=new aL.data.Atom(this,null,"",null,"");this.data._atomsBase[this.name]=this._virtualNullAtom}return this._virtualNullAtom}function N(){this.owner===this||a4.assert("Can only unintern atoms of an owner dimension.");var bg=this._atoms;if(bg){for(var bf=this._atomsByKey,bi=0,be=bg.length;be>bi;){var bj=bg[bi];if(bj.visited){delete bj.visited;bi++}else{if(bj!==this._virtualNullAtom){bg.splice(bi,1);be--;var bh=bj.key;delete bf[bh];if(!bh){delete this._nullAtom;this.data._atomsBase[this.name]=this._virtualNullAtom}}}}g.call(this)}}function x(){var bg=this._atoms;if(bg){for(var bk,bf=this._atomsByKey,bi=0,be=bg.length;be>bi;){var bj=bg[bi];if(bj.isVirtual){bg.splice(bi,1);be--;bk=!0;var bh=bj.key||a4.assert("Cannot be the null or virtual null atom.");delete bf[bh]}else{bi++}}bk&&g.call(this)}}function g(){this._atomVisibleDatumsCount=this._sumCache=this._visibleAtoms=this._visibleIndexes=null}function E(be){G(this,"childNodes",be,"parent");be.owner=this.owner}function bc(be){G(this,"_linkChildren",be,"linkParent");be.owner=this.owner}function d(be,bj){var bi;if(!this._disposed&&(bi=this._atomVisibleDatumsCount)){var bh=be.atoms[this.name],bf=bh.key;a4.hasOwn(this._atomsByKey,bf)||a4.assert("Atom must exist in this dimension.");var bg=bi[bf];bj||bg>0||a4.assert("Must have had accounted for at least one visible datum.");bi[bf]=(bg||0)+(bj?1:-1);this._visibleAtoms=this._sumCache=this._visibleIndexes=null}}function t(){var be=this._atomVisibleDatumsCount;if(!be){be={};this.data.datums(null,{visible:!0}).each(function(bf){var bh=bf.atoms[this.name],bg=bh.key;be[bg]=(be[bg]||0)+1},this);this._atomVisibleDatumsCount=be}return be}function W(bf){var be=[];this._atoms.forEach(function(bh,bg){this.isVisible(bh)===bf&&be.push(bg)},this);return be}function a1(be){return a4.query(this._atoms).where(function(bf){return this.isVisible(bf)===be},this).array()}function a9(bf,be){this.insertAt(bf,be);a4.lazy(this,"_childrenByKey")[bf.key]=bf}function at(bf,be){G(this,"_linkChildren",bf,"linkParent",be)}function o(be){ak(this,"_linkChildren",be,"linkParent")}function w(){aq(this.childNodes,"parent");this._childrenByKey=null;aq(this._linkChildren,"linkParent");this._groupByCache=null;this._sumAbsCache=null}function C(){this.isOwner()||a4.fail("Can only be called on the owner data.")}function aG(be,bf){!be.isNull||a4.assert("Null datums do not notify selected changes");bf?this._selectedNotNullDatums.set(be.id,be):this._selectedNotNullDatums.rem(be.id);this._sumAbsCache=null}function a5(bg,bl){var bj=bg.id,bi=this,bf=a4.hasOwnProp;if(bf.call(bi._datumsById,bj)){!bg.isNull||a4.assert("Null datums do not notify visible changes");bl?bi._visibleNotNullDatums.set(bj,bg):bi._visibleNotNullDatums.rem(bj);bi._sumAbsCache=null;for(var bk=bi._dimensionsList,bh=0,be=bk.length;be>bh;){d.call(bk[bh++],bg,bl)}bk=bi.childNodes;bh=0;be=bk.length;for(;be>bh;){a5.call(bk[bh++],bg,bl)}bk=bi._linkChildren;if(bk&&(be=bk.length)){bh=0;for(;be>bh;){a5.call(bk[bh++],bg,bl)}}}}function ao(be,bf){a4.string.is(be)||a4.fail.argumentInvalid("groupLevelText","Invalid grouping specification.");return a4.query(be.split(/\s*\|\s*/)).where(a4.truthy).select(function(bk){var bj=n.exec(bk)||a4.fail.argumentInvalid("groupLevelText","Invalid grouping level syntax '{0}'.",[bk]),bi=bj[1],bg=(bj[2]||"").toLowerCase(),bh="desc"===bg;return new aL.data.GroupingDimensionSpec(bi,bh,bf)})}function R(bi,bm){function bf(bx){if(bx){var by=bx.key;if(!a4.hasOwnProp.call(bu,by)){!bq&&bn&&a4.hasOwnProp.call(bn,by)&&(bx=bn[by]);var bz=bx.id;br.push(bx);bu[by]=bx;bh[bz]=bx;bv&&bv.push(bx);D.call(this,bx,be,bs);if(!bx.isNull){bw&&bx.isSelected&&bw.set(bz,bx);bx.isVisible&&bl.set(bz,bx)}}}}bi||a4.fail.argumentRequired("addDatums");var bt,bj,bn,bg,bs=a4.get(bm,"doAtomGC",!1),bq=a4.get(bm,"isAdditive",!1),be=!!this._dimensions,bl=this._visibleNotNullDatums,bw=this._selectedNotNullDatums,bo=this._datums;if(bo){bn=this._datumsByKey;bg=this._datumsById;bq&&bs&&bo.forEach(function(bx){D.call(this,bx,!1,!0)},this)}else{bq=!1}var bv,br,bu,bh;if(bq){bv=[];br=bo;bh=bg;bu=bn;this._sumAbsCache=null}else{this._datums=br=[];this._datumsById=bh={};this._datumsByKey=bu={};if(bo){w.call(this);bl.clear();bw&&bw.clear()}}if(a4.array.is(bi)){bt=0;bj=bi.length;for(;bj>bt;){bf.call(this,bi[bt++])}}else{if(!(bi instanceof a4.Query)){throw a4.error.argumentInvalid("addDatums","Argument is of invalid type.")}bi.each(bf,this)}if(bs){var bp=this._dimensionsList;bt=0;bj=bp.length;for(;bj>bt;){N.call(bp[bt++])}}if(bq){var bk=this._linkChildren;if(bk){bt=0;bj=bk.length;for(;bj>bt;){ah.call(bk[bt++],bv)}}}}function D(bl,bn,bj){var bm=this._dimensionsList;bm||(bn=!1);if(bn||bj){var bk,bi,bh,bf=bl.atoms,bg=0;if(bm){bk=bm.length;for(;bk>bg;){bh=bm[bg++];bi=bf[bh.name];if(bi){bn&&a.call(bh,bi);bj&&(bi.visited=!0)}}}else{var be=this.type.dimensionsNames();bk=be.length;for(;bk>bg;){bi=bf[be[bg++]];bi&&(bi.visited=!0)}}}}function ah(bf){bf||a4.fail.argumentRequired("newDatums");var bh=this._groupOper;if(bh){bf=bh.executeAdd(this,bf)}else{var bj=this._wherePred;bj&&(bf=bf.filter(bj));e.call(this,bf)}var bi=this._linkChildren,be=bi&&bi.length;if(be){for(var bg=0;be>bg;bg++){ah.call(bi[bg],bf)}}}function e(bk){var bl=this;bl._sumAbsCache=null;for(var bi=bl._datums,bn=bl._visibleNotNullDatums,bh=bl._selectedNotNullDatums,be=bl._datumsById,bj=0,bm=bk.length;bm>bj;bj++){var bf=bk[bj],bg=bf.id;be[bg]=bf;D.call(bl,bf,!0,!1);if(!bf.isNull){bh&&bf.isSelected&&bh.set(bg,bf);bf.isVisible&&bn.set(bg,bf)}bi.push(bf)}}function aA(bg){function bf(bi){if(null!=bi){"object"==typeof bi||a4.fail.invalidArgument("datumFilter");var bl={},bj=!1;for(var bk in bi){var bh=this.dimensions(bk).getDistinctAtoms(a4.array.as(bi[bk]));if(bh.length){bj=!0;bl[bk]=bh}}bj&&be.push(bl)}}var be=[];bg=a4.array.as(bg);bg&&bg.forEach(bf,this);return be}function aT(bi,bh){var bj=a4.get(bh,"visible"),bf=a4.get(bh,"isNull"),bg=a4.get(bh,"selected"),be=a4.get(bh,"where");null!=bj&&(bi=bi.where(bj?ay:aF));null!=bf&&(bi=bi.where(bf?aX:a6));null!=bg&&(bi=bi.where(bg?aY:a7));be&&(bi=bi.where(be));return bi}function ai(be,bk){var bh=a4.get(bk,"visible"),bg=a4.get(bk,"isNull"),bi=a4.get(bk,"selected"),bj=a4.get(bk,"where"),bf=[];null!=bh&&bf.unshift(bh?ay:aF);null!=bg&&bf.unshift(bg?aX:a6);null!=bi&&bf.unshift(bi?aY:a7);bj&&bf.unshift(bj);be&&bf.unshift(au(be));var bl=bf.length;if(bl){if(1===bl){return bf[0]}var bm=function(bo){for(var bn=bl;bn;){if(!bf[--bn](bo)){return !1}}return !0};return bm}}function au(bh){function bg(bk){for(var bi=bk.atoms,bj=0;be>bj;bj++){if(bf(bi,bh[bj])){return !0}}return !1}function bf(bi,bj){for(var bk in bj){if(bj[bk].indexOf(bi[bk])<0){return !1}}return !0}var be=bh.length;return bg}function m(bi,bf){var be=a4.array.as(a4.get(bf,"orderBy")),bh=a4.create(bf||{},{orderBy:null}),bg=a4.query(bi).selectMany(function(bk,bj){be&&(bh.orderBy=be[bj]);return X.call(this,bk,bh)},this);return bg.distinct(a4.propGet("id"))}function X(bi,bh){var bj=bh.orderBy;if(bj){if(bj.indexOf("|")>=0){throw a4.error.argumentInvalid("keyArgs.orderBy","Multi-dimension order by is not supported.")}}else{bj=Object.keys(bi).sort().join(",")}var bf=this.groupBy(bj,bh),bg=bf.treeHeight,be=[];return a4.query(function(){var bl;if(this._data){if(this._datumsQuery){this._data||a4.assert("Must have a current data");be.length||a4.assert("Must have a parent data");!this._dimAtomsOrQuery||a4.assert();if(this._datumsQuery.next()){this.item=this._datumsQuery.item;return 1}this._datumsQuery=null;bl=be.pop();this._data=bl.data;this._dimAtomsOrQuery=bl.dimAtomsOrQuery}}else{this._data=bf;this._dimAtomsOrQuery=a4.query(bi[bf._groupLevelSpec.dimensions[0].name])}this._dimAtomsOrQuery||a4.assert("Invalid programmer");this._data||a4.assert("Must have a current data");for(var bn=be.length;;){for(;this._dimAtomsOrQuery.next();){var bm=this._dimAtomsOrQuery.item,bk=this._data.child(bm.key);if(bk&&(bg-1>bn||bk._datums.length)){be.push({data:this._data,dimAtomsOrQuery:this._dimAtomsOrQuery});this._data=bk;if(!(bg-1>bn)){this._dimAtomsOrQuery=null;this._datumsQuery=a4.query(bk._datums);this._datumsQuery.next();this.item=this._datumsQuery.item;return 1}this._dimAtomsOrQuery=a4.query(bi[bk._groupLevelSpec.dimensions[0].name]);bn++}}if(!bn){return 0}bl=be.pop();this._data=bl.data;this._dimAtomsOrQuery=bl.dimAtomsOrQuery;bn--}return 0})}function H(be){if(this._renderId!==be){this._renderId=be;this.renderState={}}}function aS(bg){var be;bg&&(be=bg.ownerScene)&&(bg=be);var bf=this._active;if(bf!==bg){bf&&u.call(bf,!1);this._active=bf=bg||null;bf&&u.call(bf,!0);return !0}return !1}function u(be){this.isActive!==be&&(be?this.isActive=!0:delete this.isActive)}function af(be,bf){return function(){var bg=this.vars[be];if(void 0===bg){bg=this[bf]();void 0===bg&&(bg=null);this.vars[be]=bg}return bg}}function U(be,bg){this.event=p.event;this.pvMark=be;if(be){var bf=this.sign=be.sign||null;!bg&&bf&&(bg=bf.scene());if(bg){this.index=bg.childIndex()}else{this.index=null;bg=new aL.visual.Scene(null,{panel:this.panel})}}else{this.sign=null;this.index=null;bg=new aL.visual.Scene(null,{panel:this.panel,source:this.chart.root.data})}this.scene=bg}function ac(be){var bf=an(be)||a4.assert("There must exist an ancestor sign");return new aL.visual.BasicSign(bf.panel,be)}function an(be){var bf;do{be=be.parent}while(!(!be||(bf=be.sign)||be.proto&&(bf=be.proto.sign)));return bf}function aM(be){return be.isDiscrete()?"discrete":be.firstDimensionValueType()===Date?"timeSeries":"numeric"}function av(bf,be){return aL.parseDomainScope(bf,be.orientation)}function ap(be){if(be){if(a4.hasOwn(aD.namesSet,be)){var bf=aL.BasePanel["y"===this.orientation?"horizontalAlign":"verticalAlign2"];return bf[be]}aL.debug>=2&&aL.log(a4.format("Invalid axis position value '{0}'.",[be]))}return"x"===this.orientation?"bottom":"left"}function a0(bf){var be=this.option("Position");return s.toOrtho(bf,be)}function al(bf){var be=this.option("Position");return s.to(bf,{singleProp:aL.BasePanel.orthogonalLength[be]})}function aP(bf){var be;if(bf){var bg;a4.eachOwn(bf,function(bi,bh){bg=!0;bf[bh]=p.color(bi)});bg&&(be=bf)}return be}function y(){var bf,be=this.scaleType;if(be){if("discrete"===be){if(0===this.index){bf=aL.createColorScheme()}else{var bg=this;bf=function(){return bg.chart._getRoleColorScale(bg.role.name)}}}else{aC||(aC=["red","yellow","green"].map(p.color));bf=aC.slice()}}else{bf=aL.createColorScheme()}return bf}function S(bf){if(!a4.object.is(bf)){var be=this.option("Position");bf=new s().setSize(bf,{singleProp:aL.BasePanel.orthogonalLength[be]})}return bf}function ad(bf){var be=this.option("Position");return aL.parseAlign(be,bf)}function ax(be){return new s().setSize(be,{singleProp:"width"})}function j(be){return be.dataPartValue}function aI(bg){if("trend"===this.name){return null}var bh=this.option("TrendType");!bh&&bg&&(bh=bg.type);if(!bh||"none"===bh){return null}bg=bg?Object.create(bg):{};var be=aL.trends.get(bh);bg.info=be;bg.type=bh;var bf=this.option("TrendLabel");bg.label=null!=bf?String(bf):be.dataPartAtom.f;return bg}function aJ(bf,be){return{resolveV1:function(bg){if(0===this.globalIndex){this._specifyChartOption(bg,"show"+bf)||bg.defaultValue(be);return !0}}}}function aa(be){return{resolveV1:function(bf){this._specifyChartOption(bf,"show"+be);return !0}}}Array.prototype.every||(Array.prototype.every=function(bg){if(null==this){throw new TypeError()}var bi=Object(this),be=bi.length>>>0;if("function"!=typeof bg){throw new TypeError()}for(var bf=arguments.length>=2?arguments[1]:void 0,bh=0;be>bh;bh++){if(bh in bi&&!bg.call(bf,bi[bh],bh,bi)){return !1}}return !0});var aL=a4.globalSpace("pvc",{debug:0});!function(){if("undefined"!=typeof window&&window.location){var bf=function(bi){return bi&&/\bdebug=true\b/.test(bi)?bi:null},bg=bf(window.location.href);if(!bg){try{bg=bf(window.top.location.href)}catch(bh){}}if(bg){var be=/\bdebugLevel=(\d+)/.exec(bg);aL.debug=be?+be[1]:3}}}();var Z=p.Mark;aL.invisibleFill="rgba(127,127,127,0.00001)";aL.logSeparator="------------------------------------------";var a2=Array.prototype.slice;aL.setDebug=function(be){be=+be;aL.debug=isNaN(be)?0:be;ar();aE();return aL.debug};aL.setDebug(aL.debug);aL.defaultCompatVersion=function(be){var bf=aL.BaseChart.prototype.defaults;return null!=be?bf.compatVersion=be:bf.compatVersion};aL.cloneMatrix=function(be){return be.map(function(bf){return bf.slice()})};aL.normAngle=p.Shape.normalizeAngle;aL.stringify=function(bg,bh){var be=a4.get(bh,"maxLevel")||5,bf=[];aL.stringifyRecursive(bf,bg,be,bh);return bf.join("")};aL.stringifyRecursive=function(bf,bg,be,bi){if(be>0){be--;switch(typeof bg){case"undefined":return bf.push("undefined");case"object":if(!bg){bf.push("null");return !0}if(a4.fun.is(bg.stringify)){return bg.stringify(bf,be,bi)}if(bg instanceof Array){bf.push("[");bg.forEach(function(bn,bm){bm&&bf.push(", ");aL.stringifyRecursive(bf,bn,be,bi)||bf.pop()});bf.push("]")}else{var bl=a4.get(bi,"ownOnly",!0);if(bg===a4.global){bf.push("<window>");return !0}if(a4.fun.is(bg.cloneNode)){bf.push("<dom #"+(bg.id||bg.name||"?")+">");return !0}if(be>1&&bg.constructor!==Object){be=1;bl=!0}bf.push("{");var bk=!0;for(var bj in bg){if(!bl||a4.hasOwnProp.call(bg,bj)){bk||bf.push(", ");bf.push(bj+": ");if(aL.stringifyRecursive(bf,bg[bj],be,bi)){bk&&(bk=!1)}else{bf.pop();bk||bf.pop()}}}if(bk){var bh=""+bg;"[object Object]"!==bh&&bf.push("{"+bh+"}")}bf.push("}")}return !0;case"number":bf.push(""+Math.round(100000*bg)/100000);return !0;case"boolean":bf.push(""+bg);return !0;case"string":bf.push(JSON.stringify(bg));return !0;case"function":if(a4.get(bi,"funs",!1)){bf.push(JSON.stringify(bg.toString().substr(0,13)+"..."));return !0}return !1}bf.push("'new ???'");return !0}};aL.orientation={vertical:"vertical",horizontal:"horizontal"};aL.extensionTag="extension";aL.extendType=function(bh,bf,bi){if(bf){var bg,be=bh.prototype._vars,bj=function(bk,bl){if(void 0!==bk){bg||(bg={});be&&be[bl]&&(bl="_"+bl+"EvalCore");bg[bl]=a4.fun.to(bk)}};bi?bi.forEach(function(bk){bj(bf[bk],bk)}):a4.each(bj);bg&&bh.add(bg)}};p.Color.prototype.stringify=function(bf,be,bg){return aL.stringifyRecursive(bf,this.key,be,bg)};Z.prototype.hasDelegateValue=function(bf,be){var bg=this.$propertiesMap[bf];return bg?!be||bg.tag===be:this.proto?this.proto.hasDelegateValue(bf,be):!1};aL.defaultColorScheme=null;aL.brighterColorTransform=function(be){return(be.rgb?be:p.color(be)).brighter(0.6)};aL.setDefaultColorScheme=function(be){return aL.defaultColorScheme=aL.colorScheme(be)};aL.defaultColor=p.Colors.category10()("?");aL.colorScheme=function(be){if(null==be){return null}if("function"==typeof be){if(!be.hasOwnProperty("range")){return be}be=be.range()}else{be=a4.array.as(be)}return be.length?function(){var bf=p.colors(be);bf.domain.apply(bf,arguments);return bf}:null},aL.createColorScheme=function(be){return aL.colorScheme(be)||aL.defaultColorScheme||p.Colors.category10};aL.toGrayScale=function(bf,bi,bg,be){bf=p.color(bf);var bh=0.299*bf.r+0.587*bf.g+0.114*bf.b;void 0===bg?bg=200:null==bg&&(bg=255);void 0===be?be=30:null==be&&(be=0);var bj=bg-be;bh=0>=bj?bg:be+bh/255*bj;null==bi?bi=bf.opacity:0>bi&&(bi=-bi*bf.opacity);bh=Math.round(bh);return p.rgb(bh,bh,bh,bi)};aL.removeTipsyLegends=function(){try{$(".tipsy").remove()}catch(be){}};aL.createDateComparer=function(bf,be){be||(be=p.identity);return function(bh,bg){return bf.parse(be(bh))-bf.parse(be(bg))}};aL.time={intervals:{y:31536000000,m:2592000000,d30:2592000000,w:604800000,d7:604800000,d:86400000,h:3600000,M:60000,s:1000,ms:1},withoutTime:function(be){return new Date(be.getFullYear(),be.getMonth(),be.getDate())},weekday:{previousOrSelf:function(be,bi){var bg=be.getDay(),bh=bg-bi;if(bh){var bf=0>bh?7+bh:bh;be=new Date(be-bf*aL.time.intervals.d)}return be},nextOrSelf:function(bf,bi){var bg=bf.getDay(),bh=bg-bi;if(bh){var be=bh>0?7-bh:-bh;bf=new Date(bf+be*aL.time.intervals.d)}return bf},closestOrSelf:function(bf,bi){var bg=bf.getDay(),bh=bg-bi;if(bh){var bj=aL.time.intervals.d,be=bh>0?1:-1;bh=Math.abs(bh);bf=new Date(bh>=4?bf.getTime()+be*(7-bh)*bj:bf.getTime()-be*bh*bj)}return bf}}};p.Format.createParser=function(be){function bf(bg){return bg instanceof Date?bg:a4.number.is(bg)?new Date(bg):be.parse(bg)}return bf};p.Format.createFormatter=function(be){function bf(bg){return null!=bg?be.format(bg):""}return bf};aL.buildTitleFromName=function(be){return a4.firstUpperCase(be).replace(/([a-z\d])([A-Z])/,"$1 $2")};aL.buildIndexedId=function(bf,be){return be>0?bf+""+(be+1):bf};aL.splitIndexedId=function(be){var bg=/^(.*?)(\d*)$/.exec(be),bf=null;if(bg[2]){bf=Number(bg[2]);1>=bf?bf=1:bf--}return[bg[1],bf]};var F=[null];aL.makeExtensionAbsId=function(bl,bk){if(!bl){return bk}var be=[];bk=a4.array.to(bk)||F;bl=a4.array.to(bl);for(var bi=0,bh=bk.length;bh>bi;bi++){for(var bg=0,bf=bl.length;bf>bg;bg++){var bj=a3(bl[bg],bk[bi]);bj&&be.push(bj)}}return be};aL.makeEnumParser=function(bh,bf,bg){if(a4.array.is(bf)){var be={};bf.forEach(function(bi){bi&&(be[bi.toLowerCase()]=bi)});bf=function(bi){return a4.hasOwn(be,bi)}}bg&&(bg=bg.toLowerCase());return function(bi){bi&&(bi=(""+bi).toLowerCase());if(!bf(bi)){bi&&aL.debug>=2&&aL.warn("Invalid '"+bh+"' value: '"+bi+"'. Assuming '"+bg+"'.");bi=bg}return bi}};aL.parseDistinctIndexArray=function(bh,bg,be){bh=a4.array.as(bh);if(null==bh){return null}null==bg&&(bg=0);null==be&&(be=1/0);var bf=a4.query(bh).select(function(bi){return +bi}).where(function(bi){return !isNaN(bi)&&bi>=bg&&be>=bi}).distinct().array();return bf.length?bf:null};aL.parseValuesOverflow=aL.makeEnumParser("valuesOverflow",["show","trim","hide"],"hide");aL.parseMultiChartOverflow=aL.makeEnumParser("multiChartOverflow",["grow","fit","clip"],"grow");aL.parseLegendClickMode=aL.makeEnumParser("legendClickMode",["toggleSelected","toggleVisible","none"],"toggleVisible");aL.parseTooltipAutoContent=aL.makeEnumParser("tooltipAutoContent",["summary","value"],"value");aL.parseSelectionMode=aL.makeEnumParser("selectionMode",["rubberBand","focusWindow"],"rubberBand");aL.parseClearSelectionMode=aL.makeEnumParser("clearSelectionMode",["emptySpaceClick","manual"],"emptySpaceClick");aL.parseSunburstSliceOrder=aL.makeEnumParser("sliceOrder",["bySizeAscending","bySizeDescending","none"],"bySizeDescending");aL.parseShape=aL.makeEnumParser("shape",p.Scene.hasSymbol,null);aL.parseTreemapColorMode=aL.makeEnumParser("colorMode",["byParent","bySelf"],"byParent");aL.parseTreemapLayoutMode=aL.makeEnumParser("layoutMode",["squarify","slice-and-dice","slice","dice"],"squarify");aL.parseContinuousColorScaleType=function(be){if(be){be=(""+be).toLowerCase();switch(be){case"linear":case"normal":case"discrete":break;default:aL.debug>=2&&aL.log("[Warning] Invalid 'ScaleType' option value: '"+be+"'.");be=null}}return be};aL.parseDomainScope=function(bf,be){if(bf){bf=(""+bf).toLowerCase();switch(bf){case"cell":case"global":break;case"section":if(!be){throw a4.error.argumentRequired("orientation")}bf="y"===be?"row":"column";break;case"column":case"row":if(be&&be!==("row"===bf?"y":"x")){bf="section";aL.debug>=2&&aL.log("[Warning] Invalid 'DomainScope' option value: '"+bf+"' for the orientation: '"+be+"'.")}break;default:aL.debug>=2&&aL.log("[Warning] Invalid 'DomainScope' option value: '"+bf+"'.");bf=null}}return bf};aL.parseDomainRoundingMode=function(be){if(be){be=(""+be).toLowerCase();switch(be){case"none":case"nice":case"tick":break;default:aL.debug>=2&&aL.log("[Warning] Invalid 'DomainRoundMode' value: '"+be+"'.");be=null}}return be};aL.parseOverlappedLabelsMode=function(be){if(be){be=(""+be).toLowerCase();switch(be){case"leave":case"hide":case"rotatethenhide":break;default:aL.debug>=2&&aL.log("[Warning] Invalid 'OverlappedLabelsMode' option value: '"+be+"'.");be=null}}return be};aL.castNumber=function(be){if(null!=be){be=+be;isNaN(be)&&(be=null)}return be};aL.castPositiveNumber=function(be){be=aL.castNumber(be);null==be||be>0||(be=null);return be};aL.castNonNegativeNumber=function(be){be=aL.castNumber(be);null!=be&&0>be&&(be=null);return be};aL.parseWaterDirection=function(be){if(be){be=(""+be).toLowerCase();switch(be){case"up":case"down":return be}aL.debug>=2&&aL.log("[Warning] Invalid 'WaterDirection' value: '"+be+"'.")}};aL.parseTrendType=function(be){if(be){be=(""+be).toLowerCase();if("none"===be){return be}if(aL.trends.has(be)){return be}aL.debug>=2&&aL.log("[Warning] Invalid 'TrendType' value: '"+be+"'.")}};aL.parseNullInterpolationMode=function(be){if(be){be=(""+be).toLowerCase();switch(be){case"none":case"linear":case"zero":return be}aL.debug>=2&&aL.log("[Warning] Invalid 'NullInterpolationMode' value: '"+be+"'.")}};aL.parseAlign=function(bf,bh){bh&&(bh=(""+bh).toLowerCase());var bg,be;if("left"===bf||"right"===bf){bg=bh&&aL.BasePanel.verticalAlign[bh];if(!bg){bg="middle";be=!!bh}}else{bg=bh&&aL.BasePanel.horizontalAlign[bh];if(!bg){bg="center";be=!!bh}}be&&aL.debug>=2&&aL.log(a4.format("Invalid alignment value '{0}'. Assuming '{1}'.",[bh,bg]));return bg};aL.parseAnchor=function(be){if(be){be=(""+be).toLowerCase();switch(be){case"top":case"left":case"center":case"bottom":case"right":return be}aL.debug>=2&&aL.log(a4.format("Invalid anchor value '{0}'.",[be]))}};aL.parseAnchorWedge=function(be){if(be){be=(""+be).toLowerCase();switch(be){case"outer":case"inner":case"center":case"start":case"end":return be}aL.debug>=2&&aL.log(a4.format("Invalid wedge anchor value '{0}'.",[be]))}};aL.unionExtents=function(be,bf){if(be){if(bf){bf.min<be.min&&(be.min=bf.min);bf.max>be.max&&(be.max=bf.max)}}else{if(!bf){return null}be={min:bf.min,max:bf.max}}return be};var aD=aL.Sides=function(be){null!=be&&this.setSides(be)};aD.hnames="left right".split(" ");aD.vnames="top bottom".split(" ");aD.names="left right top bottom".split(" ");aD.namesSet=p.dict(aD.names,a4.retTrue);aL.parsePosition=function(bf,bg){if(bf){bf=(""+bf).toLowerCase();if(!a4.hasOwn(aD.namesSet,bf)){var be=bg||"left";aL.debug>=2&&aL.log(a4.format("Invalid position value '{0}. Assuming '{1}'.",[bf,be]));bf=be}}return bf||bg||"left"};aD.as=function(be){null==be||be instanceof aD||(be=new aD().setSides(be));return be};aD.to=function(be){null!=be&&be instanceof aD||(be=new aD().setSides(be));return be};aD.prototype.stringify=function(bf,be,bg){return aL.stringifyRecursive(bf,a4.copyOwn(this),be,bg)};aD.prototype.setSides=function(be){if("string"==typeof be){var bg=be.split(/\s+/).map(function(bh){return l.parse(bh)});switch(bg.length){case 1:this.set("all",bg[0]);return this;case 2:this.set("top",bg[0]);this.set("left",bg[1]);this.set("right",bg[1]);this.set("bottom",bg[0]);return this;case 3:this.set("top",bg[0]);this.set("left",bg[1]);this.set("right",bg[1]);this.set("bottom",bg[2]);return this;case 4:this.set("top",bg[0]);this.set("right",bg[1]);this.set("bottom",bg[2]);this.set("left",bg[3]);return this;case 0:return this}}else{if("number"==typeof be){this.set("all",be);return this}if("object"==typeof be){if(be instanceof l){this.set("all",be)}else{this.set("all",be.all);this.set("width",be.width);this.set("height",be.height);for(var bf in be){aD.namesSet.hasOwnProperty(bf)&&this.set(bf,be[bf])}}return this}}aL.debug&&aL.log("Invalid 'sides' value: "+aL.stringify(be));return this};aD.prototype.set=function(bf,be){be=l.parse(be);if(null!=be){switch(bf){case"all":aD.names.forEach(function(bg){this[bg]=be},this);break;case"width":this.left=this.right=l.divide(be,2);break;case"height":this.top=this.bottom=l.divide(be,2);break;default:a4.hasOwn(aD.namesSet,bf)&&(this[bf]=be)}}};aD.prototype.resolve=function(bf,be){if("object"==typeof bf){be=bf.height;bf=bf.width}var bg={};aD.names.forEach(function(bi){var bj=0,bh=this[bi];null!=bh&&(bj="number"==typeof bh?bh:bh.resolve("left"===bi||"right"===bi?bf:be));bg[bi]=bj},this);return aD.updateSize(bg)};aD.updateSize=function(be){be.width=(be.left||0)+(be.right||0);be.height=(be.bottom||0)+(be.top||0);return be};aD.resolvedMax=function(bf,be){var bg={};aD.names.forEach(function(bh){bg[bh]=Math.max(bf[bh]||0,be[bh]||0)});return bg};aD.inflate=function(be,bf){var bg={};aD.names.forEach(function(bh){bg[bh]=(be[bh]||0)+bf});return aD.updateSize(bg)};var l=aL.PercentValue=function(be){this.percent=be};l.prototype.resolve=function(be){return this.percent*be};l.prototype.divide=function(be){return new l(this.percent/be)};l.divide=function(be,bf){return be instanceof l?be.divide(bf):be/bf};l.parse=function(bf){if(null!=bf&&""!==bf){switch(typeof bf){case"number":return bf;case"string":var be=bf.match(/^(.+?)\s*(%)?$/);if(be){var bg=+be[1];if(!isNaN(bg)){if(!be[2]){return bg}if(bg>=0){return new l(bg/100)}}}break;case"object":if(bf instanceof l){return bf}}aL.debug&&aL.log(a4.format("Invalid margins component '{0}'",[""+bf]))}};l.resolve=function(bf,be){return bf instanceof l?bf.resolve(be):bf};var J=Z.prototype.zOrder;Z.prototype.zOrder=function(be){var bf=this.borderPanel;return bf&&bf!==this?J.call(bf,be):J.call(this,be)};Z.prototype.wrapper=function(be){this._wrapper=be;return this};Z.prototype.wrap=function(bf,be){if(bf&&a4.fun.is(bf)&&this._wrapper&&!bf._cccWrapped){bf=this._wrapper(bf,be);bf._cccWrapped=!0}return bf};p.Mark.prototype.call=function(be){be.call(this,this)};Z.prototype.lock=function(bf,be){void 0!==be&&this[bf](be);(this._locked||(this._locked={}))[bf]=!0;return this};Z.prototype.isIntercepted=function(be){return this._intercepted&&this._intercepted[be]};Z.prototype.isLocked=function(be){return this._locked&&this._locked[be]};Z.prototype.ensureEvents=function(be){var bf=this.propertyValue("events",!0);bf&&"none"!==bf||this.events(be||"all");return this};Z.prototype.addMargin=function(be,bg){if(0!==bg){var bh=a4.nullyTo(this.propertyValue(be),0),bf=p.functor(bh);this[be](function(){return bg+bf.apply(this,a2.call(arguments))})}return this};Z.prototype.addMargins=function(bf){var be=a4.get(bf,"all",0);this.addMargin("left",a4.get(bf,"left",be));this.addMargin("right",a4.get(bf,"right",be));this.addMargin("top",a4.get(bf,"top",be));this.addMargin("bottom",a4.get(bf,"bottom",be));return this};Z.prototype.eachInstanceWithData=function(bf,be){this.eachInstance(function(bg,bh,bi){bg.mark.sign&&bg[bh].data&&bf.call(be,bg,bh,bi)})};Z.prototype.eachSceneWithDataOnRect=function(bk,bh,bg,bl){function be(bn,bm){if(bn.intersectsRect(bk)){var bo=bm.data;bo&&bo.datum&&bh.call(bg,bo)}}var bj=this,bf=bj.sign;if(!bf||bf.selectable()){null==bl&&(bl=bj.rubberBandSelectionMode||"partial");var bi="center"===bl;bj.eachInstanceWithData(function(bm,bo,bp){var bn=bj.getShape(bm,bo,0.15);bn=(bi?bn.center():bn).apply(bp);be(bn,bm[bo],bo)})}};Z.prototype.eachDatumOnRect=function(bk,bh,bg,bl){function be(bn,bm){if(bn.intersectsRect(bk)){var bo=bm.data;bo&&bo.datum&&bo.datums().each(function(bp){bp.isNull||bh.call(bg,bp)})}}var bj=this,bf=bj.sign;if(!bf||bf.selectable()){null==bl&&(bl=bj.rubberBandSelectionMode||"partial");var bi="center"===bl;bj.eachInstanceWithData(function(bm,bo,bp){var bn=bj.getShape(bm,bo,0.15);bn=(bi?bn.center():bn).apply(bp);be(bn,bm[bo],bo)})}};p.Transform.prototype.transformHPosition=function(be){return this.x+this.k*be};p.Transform.prototype.transformVPosition=function(be){return this.y+this.k*be};p.Transform.prototype.transformLength=function(be){return this.k*be};var s=a4.type("pvc.Size").init(function(bf,be){if(1===arguments.length){null!=bf&&this.setSize(bf)}else{null!=bf&&(this.width=bf);null!=be&&(this.height=be)}}).add({stringify:function(bf,be,bg){return aL.stringifyRecursive(bf,a4.copyOwn(this),be,bg)},setSize:function(be,bf){if("string"==typeof be){var bh=be.split(/\s+/).map(function(bi){return l.parse(bi)});switch(bh.length){case 1:this.set(a4.get(bf,"singleProp","all"),bh[0]);return this;case 2:this.set("width",bh[0]);this.set("height",bh[1]);return this;case 0:return this}}else{if("number"==typeof be){this.set(a4.get(bf,"singleProp","all"),be);return this}if("object"==typeof be){if(be instanceof l){this.set(a4.get(bf,"singleProp","all"),be)}else{this.set("all",be.all);for(var bg in be){"all"!==bg&&this.set(bg,be[bg])}}return this}}aL.debug&&aL.log("Invalid 'size' value: "+aL.stringify(be));return this},set:function(bf,be){if(null!=be&&("all"===bf||a4.hasOwn(s.namesSet,bf))){be=l.parse(be);null!=be&&("all"===bf?s.names.forEach(function(bg){this[bg]=be},this):this[bf]=be)}return this},clone:function(){return new s(this.width,this.height)},intersect:function(be){return new s(Math.min(this.width,be.width),Math.min(this.height,be.height))},resolve:function(be){var bf={};s.names.forEach(function(bi){var bh=this[bi];if(null!=bh){if("number"==typeof bh){bf[bi]=bh}else{if(be){var bg=be[bi];null!=bg&&(bf[bi]=bh.resolve(bg))}}}},this);return bf}});s.names=["width","height"];s.namesSet=p.dict(s.names,a4.retTrue);s.toOrtho=function(bg,bf){if(null!=bg){var be;bf&&(be=aL.BasePanel.orthogonalLength[bf]);bg=s.to(bg,{singleProp:be});bf&&delete bg[aL.BasePanel.oppositeLength[be]]}return bg};s.to=function(be,bf){null==be||be instanceof s||(be=new s().setSize(be,bf));return be};var aZ=a4.type("pvc.Offset").init(function(be,bf){if(1===arguments.length){null!=be&&this.setOffset(be)}else{null!=be&&(this.x=be);null!=bf&&(this.y=bf)}}).add({stringify:function(bf,be,bg){return aL.stringifyRecursive(bf,a4.copyOwn(this),be,bg)},setOffset:function(bg,be){if("string"==typeof bg){var bh=bg.split(/\s+/).map(function(bi){return l.parse(bi)});switch(bh.length){case 1:this.set(a4.get(be,"singleProp","all"),bh[0]);return this;case 2:this.set("x",bh[0]);this.set("y",bh[1]);return this;case 0:return this}}else{if("number"==typeof bg){this.set(a4.get(be,"singleProp","all"),bg);return this}if("object"==typeof bg){this.set("all",bg.all);for(var bf in bg){"all"!==bf&&this.set(bf,bg[bf])}return this}}aL.debug&&aL.log("Invalid 'offset' value: "+aL.stringify(bg));return this},set:function(bf,be){if(null!=be&&a4.hasOwn(aZ.namesSet,bf)){be=l.parse(be);null!=be&&("all"===bf?aZ.names.forEach(function(bg){this[bg]=be},this):this[bf]=be)}},resolve:function(be){var bf={};s.names.forEach(function(bh){var bj=aZ.namesSizeToOffset[bh],bi=this[bj];if(null!=bi){if("number"==typeof bi){bf[bj]=bi}else{if(be){var bg=be[bh];null!=bg&&(bf[bj]=bi.resolve(bg))}}}},this);return bf}});aZ.addStatic({names:["x","y"]}).addStatic({namesSet:p.dict(aZ.names,a4.retTrue),namesSizeToOffset:{width:"x",height:"y"},namesSidesToOffset:{left:"x",right:"x",top:"y",bottom:"y"},as:function(be){null==be||be instanceof aZ||(be=new aZ().setOffset(be));return be}});null==$.support.svg&&($.support.svg=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1"));aL.text={getFitInfo:function(bf,bi,bj,bg,bh){if(""===bj){return{h:!0,v:!0,d:!0}}var be=p.Text.measureWidth(bj,bg);return{h:bf>=be,v:bi>=be,d:be<=Math.sqrt(bf*bf+bi*bi)-bh}},trimToWidthB:function(be,bk,bg,bj,bh){var bi=p.Text.measureWidth(bj,bg),bf=1.5*bi;return aL.text.trimToWidth(be,bk,bg,bj,bh,bf)},trimToWidth:function(be,bk,bg,bj,bi,bf){if(""===bk){return bk}var bh=p.Text.measureWidth(bk,bg);if(be>=bh){return bk}if(bh>1.5*be){return aL.text.trimToWidthBin(be,bk,bg,bj,bi,bf)}be-=p.Text.measureWidth(bj,bg);for(;bh>be;){bk=bi?bk.slice(1):bk.slice(0,bk.length-1);bh=p.Text.measureWidth(bk,bg)}return bf&&bf>=bh?"":bi?bj+bk:bk+bj},trimToWidthBin:function(bk,bp,bh,bj,bm,bf){bk-=p.Text.measureWidth(bj,bh);for(var bn,bo,bg=bp.length,bi=bg-2,bl=0;bi>=bl&&bi>0;){bn=Math.ceil((bl+bi)/2);var be=bm?bp.slice(bg-bn):bp.slice(0,bn);bo=p.Text.measureWidth(be,bh);if(bo>bk){bi=bn-1}else{if(!(p.Text.measureWidth(bm?bp.slice(bg-bn-1):bp.slice(0,bn+1),bh)<bk)){return bf&&bf>=bo?"":bm?bj+be:be+bj}bl=bn+1}}bp=bm?bp.slice(bg-bi):bp.slice(0,bi);bo=bp.length;return bf&&bf>=bo?"":bm?bj+bp:bp+bj},justify:function(bl,be,bh){var bg=[];if(be<p.Text.measureWidth("a",bh)){return bg}for(var bk=(bl||"").split(/\s+/),bf="";bk.length;){var bj=bk.shift();if(bj){var bi=bf?bf+" "+bj:bj;if(p.Text.measureWidth(bi,bh)>be){bf&&bg.push(bf);bf=bj}else{bf=bi}}}bf&&bg.push(bf);return bg},getLabelBBox:function(bk,bj,bl,bf,bi,bg){var be=p.Label.getPolygon(bk,bj,bl,bf,bi,bg),bh=be.bbox();bh.source=be;bh.sourceAngle=bi;bh.sourceAlign=bl;bh.sourceTextWidth=bk;return bh}};aL.color={scale:aK,scales:B,toGray:aL.toGrayScale,isGray:ab};a4.type("pvc.color.ScalesBuild").init(function(be){this.keyArgs=be;this.data=be.data||a4.fail.argumentRequired("keyArgs.data");this.domainDimName=be.colorDimension||a4.fail.argumentRequired("keyArgs.colorDimension");this.domainDim=this.data.dimensions(this.domainDimName);var bf=this.domainDim.type;if(bf.isComparable){this.domainComparer=function(bh,bg){return bf.compare(bh,bg)}}else{this.domainComparer=null;aL.log("Color value dimension should be comparable. Generated color scale may be invalid.")}this.nullRangeValue=be.colorMissing?p.color(be.colorMissing):p.Color.transparent;this.domainRangeCountDif=0}).add({build:function(){this.range=this._getRange();this.desiredDomainCount=this.range.length+this.domainRangeCountDif;var be=this._getDomain();return this._createScale(be)},buildMap:function(){this.range=this._getRange();this.desiredDomainCount=this.range.length+this.domainRangeCountDif;var be;if(this.keyArgs.normPerBaseCategory){be=function(bh){var bi=this._ensureDomain(null,!1,bh);return this._createScale(bi)}}else{var bf=this._getDomain(),bg=this._createScale(bf);be=a4.fun.constant(bg)}return this._createCategoryScalesMap(be)},_createScale:a4.method({isAbstract:!0}),_createCategoryScalesMap:function(be){return this.data.children().object({name:function(bf){return bf.absKey},value:be,context:this})},_getRange:function(){var bf=this.keyArgs,be=bf.colors||["red","yellow","green"];null!=bf.colorMin&&null!=bf.colorMax?be=[bf.colorMin,bf.colorMax]:null!=bf.colorMin?be.unshift(bf.colorMin):null!=bf.colorMax&&be.push(bf.colorMax);return be.map(function(bg){return p.color(bg)})},_getDataExtent:function(bh){var bg=bh.dimensions(this.domainDimName).extent({visible:!0});if(!bg){return null}var bf=bg.min.value,be=bg.max.value;be==bf&&(be>=1?bf=be-1:be=bf+1);return{min:bf,max:be}},_getDomain:function(){var be=this.keyArgs.colorDomain;if(null!=be){be=be.slice();this.domainComparer&&be.sort(this.domainComparer);be.length>this.desiredDomainCount&&(be=be.slice(0,this.desiredDomainCount))}else{be=[]}return this._ensureDomain(be,!0,this.data)},_ensureDomain:function(bk,bf,bj){var bh;if(bk&&bf){var bl=this.desiredDomainCount-bk.length;if(bl>0){bh=this._getDataExtent(bj);if(bh){switch(bl){case 1:this.domainComparer?a4.array.insert(bk,bh.max,this.domainComparer):bk.push(bh.max);break;case 2:if(this.domainComparer){a4.array.insert(bk,bh.min,this.domainComparer);a4.array.insert(bk,bh.max,this.domainComparer)}else{bk.unshift(bh.min);bk.push(bh.max)}break;default:aL.debug>=2&&aL.log("Ignoring option 'colorDomain' due to unsupported length."+a4.format(" Should have '{0}', but instead has '{1}'.",[this.desiredDomainCount,bk.length]));bk=null}}}}if(!bk){bh||(bh=this._getDataExtent(bj));if(bh){var bg=bh.min,be=bh.max,bi=(be-bg)/(this.desiredDomainCount-1);bk=p.range(bg,be+bi,bi)}}return bk}});a4.type("pvc.color.LinearScalesBuild",aL.color.ScalesBuild).add({_createScale:function(be){var bf=p.Scale.linear();be&&bf.domain.apply(bf,be);bf.range.apply(bf,this.range);return bf}});a4.type("pvc.color.DiscreteScalesBuild",aL.color.ScalesBuild).init(function(be){this.base(be);this.domainRangeCountDif=1}).add({_createScale:function(bh){function bi(bl){if(null==bl){return bj}for(var bk=0;bg>bk;bk++){if(bl<=bh[bk+1]){return bf[bk]}}return bf[be]}var bg=bh.length-1,bf=this.range,bj=this.nullRangeValue,be=bf.length-1;a4.copy(bi,p.Scale.common);bi.domain=function(){return bh};bi.range=function(){return bf};return bi}});a4.space("pvc.trends",function(bf){var be={};a4.set(bf,"define",function(bj,bk){bj||a4.fail.argumentRequired("type");bk||a4.fail.argumentRequired("trendSpec");a4.object.is(bk)||a4.fail.argumentInvalid("trendSpec","Must be a trend specification object.");bj=(""+bj).toLowerCase();aL.debug>=2&&a4.hasOwn(be,bj)&&aL.log(a4.format("[WARNING] A trend type with the name '{0}' is already defined.",[bj]));var bi=bk.label||a4.fail.argumentRequired("trendSpec.label"),bh=bk.model||a4.fail.argumentRequired("trendSpec.model");a4.fun.is(bh)||a4.fail.argumentInvalid("trendSpec.mode","Must be a function.");var bg={dataPartAtom:{v:"trend",f:bi},type:bj,label:bi,model:bh};be[bj]=bg},"get",function(bg){bg||a4.fail.argumentRequired("type");return a4.getOwn(be,bg)||a4.fail.operationInvalid("Undefined trend type '{0}'.",[bg])},"has",function(bg){return a4.hasOwn(be,bg)},"types",function(){return a4.ownKeys(be)});bf.define("linear",{label:"Linear trend",model:function(bi){for(var bo=a4.get(bi,"rows"),bt=a4.get(bi,"x"),br=a4.get(bi,"y"),bw=0,bl=0,bh=0,bg=0,bu=0,bv=0,bx=function(bB){return null!=bB?+bB:0/0};bo.next();){var bk=bo.item,bp=bt?bx(bt(bk)):bw;if(!isNaN(bp)){var bn=bx(br(bk));if(!isNaN(bn)){bl++;bh+=bp;bg+=bn;bu+=bp*bn;bv+=bp*bp}}bw++}var bj,bz;if(bl>=2){var bA=bh/bl,by=bg/bl,bq=bu/bl,bs=bv/bl,bm=bs-bA*bA;bz=0===bm?0:(bq-bA*by)/bm;bj=by-bz*bA;return{alpha:bj,beta:bz,reset:a4.noop,sample:function(bB){return bj+bz*+bB}}}}});bf.define("moving-average",{label:"Moving average",model:function(bh){var bg=Math.max(+(a4.get(bh,"periods")||3),2),bj=0,bi=[];return{reset:function(){bj=0;bi.length=0},sample:function(bl,bm){var bk=bg;if(null!=bm){bi.unshift(bm);bj+=bm;bk=bi.length;if(bk>bg){bj-=bi.pop();bk=bg}}return bj/bk}}}});bf.define("weighted-moving-average",{label:"Weighted Moving average",model:function(bj){var bh=Math.max(+(a4.get(bj,"periods")||3),2),bm=0,bl=0,bk=[],bg=0,bi=0;return{reset:function(){bm=bl=bi=bg=0;bk.length=0},sample:function(bn,bp){if(null!=bp){if(bh>bg){bk.push(bp);bg++;bi+=bg;bl+=bg*bp;bm+=bp}else{bl+=bg*bp-bm;bm+=bp-bk[0];for(var bo=1;bh>bo;bo++){bk[bo-1]=bk[bo]}bk[bh-1]=bp}}return bl/bi}}}})});bb.resolvers=I;bb.constant=aQ;bb.specify=az;bb.defaultValue=M;aL.options=bb;var aH=a4.type().init(function(bg,bi,bh,bf){this.name=bg;this.option=bi;this._dv=this.value=a4.get(bf,"value");this._resolve=a4.get(bf,"resolve");var be=!this._resolve;this.isResolved=be;this.isSpecified=!1;this._setCalled=!1;this._context=bh;this._cast=a4.get(bf,"cast");this._getDefault=be?null:a4.get(bf,"getDefault");this.data=a4.get(bf,"data")}).add({resolve:function(){if(!this.isResolved){this.isResolved=!0;this._setCalled=!1;this._getFunProp("_resolve").call(this._context,this);if(!this._setCalled){this.isSpecified=!1;var be=this._dynDefault();null!=be&&(this.value=this._dv=be)}}return this},specify:function(be){return this.set(be,!1)},defaultValue:function(be){arguments.length&&this.set(be,!0);return this._dv},cast:function(bf){if(null!=bf){var be=this._getFunProp("_cast");be&&(bf=be.call(this._context,bf,this))}return bf},set:function(bf,be){this._setCalled=!0;null!=bf&&(bf=this.cast(bf));if(null==bf){bf=this._dynDefault();if(null==bf){if(!this.isSpecified){return this}bf=this._dv}be=!0}if(be){this._dv=bf;this.isSpecified||(this.value=bf)}else{this.isResolved=this.isSpecified=!0;this.value=bf}return this},_dynDefault:function(){var be=this._getFunProp("_getDefault");return be&&this.cast(be.call(this._context,this))},_getFunProp:function(bf){var be=this[bf];if(be){var bg=this._context;bg&&"string"==typeof be&&(be=bg[be])}return be}});a4.global.NoDataException=function(){};a4.global.InvalidDataException=function(be){this.message=be?be:"Invalid Data."};aL.data={visibleKeyArgs:{visible:!0}};a4.type("pvc.data.DimensionType").init(function(bm,be,bj){this.complexType=bm;this.name=be;this.label=a4.get(bj,"label")||aL.buildTitleFromName(be);var bk=aL.splitIndexedId(be);this.group=bk[0];this.groupLevel=a4.nullyTo(bk[1],0);this.label.indexOf("{")>=0&&(this.label=a4.format(this.label,[this.groupLevel+1]));this.playedVisualRoles=new a4.Map();this.isHidden=!!a4.get(bj,"isHidden");var bi=a4.get(bj,"valueType")||null,bf=aL.data.DimensionType.valueTypeName(bi),bg=a4.getOwn(aL.data.DimensionType.cast,bf,null);this.valueType=bi;this.valueTypeName=bf;this.cast=bg;this.isDiscreteValueType=this.valueType!==Number&&this.valueType!==Date;this.isDiscrete=a4.get(bj,"isDiscrete");if(null==this.isDiscrete){this.isDiscrete=this.isDiscreteValueType}else{this.isDiscrete=!!this.isDiscrete;if(!this.isDiscrete&&this.isDiscreteValueType){throw a4.error.argumentInvalid("isDiscrete","The only supported continuous value types are Number and Date.")}}this._converter=a4.get(bj,"converter")||null;if(!this._converter){var bh=a4.get(bj,"rawFormat");if(bh){switch(this.valueType){case Date:this._converter=p.Format.createParser(p.Format.date(bh))}}}this._key=a4.get(bj,"key")||null;this._comparer=a4.get(bj,"comparer");if(void 0===this._comparer){switch(this.valueType){case Number:case Date:this._comparer=a4.compare;break;default:this._comparer=null}}this.isComparable=null!=this._comparer;this._formatter=a4.get(bj,"formatter")||null;if(!this._formatter){switch(this.valueType){case Number:this._formatter=p.Format.createFormatter(p.Format.number().fractionDigits(0,2));break;case Date:var bl=a4.get(bj,"format");if(!bl){bl=a4.get(bj,"rawFormat");bl&&(bl=bl.replace(/-/g,"/"))}bl||(bl="%Y/%m/%d");this._formatter=p.Format.createFormatter(p.Format.date(bl))}}}).add({isCalculated:!1,compare:function(bf,be){return null==bf?null==be?0:-1:null==be?1:this._comparer.call(null,bf,be)},comparer:function(be){if(!this.isComparable){return null}var bf=this;return be?this._reverseComparer||(this._reverseComparer=function(bh,bg){return bf.compare(bg,bh)}):this._directComparer||(this._directComparer=function(bh,bg){return bf.compare(bh,bg)})},atomComparer:function(be){return be?this._reverseAtomComparer||(this._reverseAtomComparer=this._createReverseAtomComparer()):this._directAtomComparer||(this._directAtomComparer=this._createDirectAtomComparer())},_toDiscrete:function(){this.isDiscrete=!0},_toCalculated:function(){this.isCalculated=!0},_createReverseAtomComparer:function(){function bf(bh,bg){return bh===bg?0:be.compare(bg.value,bh.value)}if(!this.isComparable){return v}var be=this;return bf},_createDirectAtomComparer:function(){function be(bh,bg){return bh===bg?0:bf.compare(bh.value,bg.value)}if(!this.isComparable){return q}var bf=this;return be},formatter:function(){return this._formatter},converter:function(){return this._converter},playingPercentVisualRole:function(){return a4.query(this.playedVisualRoles.values()).any(function(be){return be.isPercent})}});aL.data.DimensionType.cast={Date:function(be){return be instanceof Date?be:new Date(be)},Number:function(be){be=Number(be);return isNaN(be)?null:be},String:String,Boolean:Boolean,Object:Object,Any:null};aL.data.DimensionType.dimensionGroupName=function(be){return be.replace(/^(.*?)(\d*)$/,"$1")};aL.data.DimensionType.valueTypeName=function(be){if(null==be){return"Any"}switch(be){case Boolean:return"Boolean";case Number:return"Number";case String:return"String";case Object:return"Object";case Date:return"Date";default:throw a4.error.argumentInvalid("valueType","Invalid valueType function: '{0}'.",[be])}};aL.data.DimensionType.extendSpec=function(bj,bi,bg){var bf=aL.data.DimensionType.dimensionGroupName(bj),be=a4.get(bg,"dimensionGroups");if(be){var bh=be[bf];bh&&(bi=a4.create(bh,bi))}bi||(bi={});switch(bf){case"category":var bk=a4.get(bg,"isCategoryTimeSeries",!1);bk&&void 0===bi.valueType&&(bi.valueType=Date);break;case"value":void 0===bi.valueType&&(bi.valueType=Number);bi.valueType===Number&&(void 0!==bi.formatter||bi.format||(bi.formatter=a4.get(bg,"valueNumberFormatter")))}void 0!==bi.converter||bi.valueType!==Date||bi.rawFormat||(bi.rawFormat=a4.get(bg,"timeSeriesFormat"));return bi};a4.type("pvc.data.ComplexType").init(function(be){this._dims={};this._dimsList=[];this._dimsNames=[];this._calculations=[];this._calculatedDimNames={};this._dimsIndexByName=null;this._dimsByGroup={};this._dimsNamesByGroup={};if(be){for(var bf in be){this.addDimension(bf,be[bf])}}}).add({describe:function(){var be=["COMPLEX TYPE INFORMATION",aL.logSeparator];this._dimsList.forEach(function(bg){var bf=[];bf.push(bg.valueTypeName);bg.isComparable&&bf.push("comparable");bg.isDiscrete||bf.push("continuous");bg.isHidden&&bf.push("hidden");be.push("  "+bg.name+" ("+bf.join(", ")+")")});return be.join("\n")},dimensions:function(be,bf){if(null==be){return this._dims}var bg=a4.getOwn(this._dims,be,null);if(!bg&&a4.get(bf,"assertExists",!0)){throw a4.error.argumentInvalid("name","Undefined dimension '{0}'",[be])}return bg},dimensionsList:function(){return this._dimsList},calculatedDimensionsList:function(){return this._calcDimsList},dimensionsNames:function(){return this._dimsNames},groupDimensions:function(bf,be){var bg=a4.getOwn(this._dimsByGroup,bf);if(!bg&&a4.get(be,"assertExists",!0)){throw a4.error.operationInvalid("There is no dimension type group with name '{0}'.",[bf])}return bg},groupDimensionsNames:function(bg,bf){var be=a4.getOwn(this._dimsNamesByGroup,bg);if(!be&&a4.get(bf,"assertExists",!0)){throw a4.error.operationInvalid("There is no dimension type group with name '{0}'.",[bg])}return be},addDimension:function(be,bj){be||a4.fail.argumentRequired("name");!a4.hasOwn(this._dims,be)||a4.fail.operationInvalid("A dimension type with name '{0}' is already defined.",[be]);var bf=new aL.data.DimensionType(this,be,bj);this._dims[be]=bf;this._dimsIndexByName=null;var bg,bn=bf.group;if(bn){var bo,bm=a4.getOwn(this._dimsByGroup,bn);if(bm){bo=this._dimsNamesByGroup[bn]}else{bm=this._dimsByGroup[bn]=[];bo=this._dimsNamesByGroup[bn]=[]}bg=a4.array.insert(bo,be,a4.compare);bg=~bg;a4.array.insertAt(bm,bg,bf)}var bk,bl=this._dimsList.length;if(bn){bg=bf.groupLevel;for(var bh=0;bl>bh;bh++){var bi=this._dimsList[bh];if(bi.group===bn){if(bi.groupLevel>bg){bk=bh;break}bk=bh+1}}null==bk&&(bk=bl)}else{bk=bl}a4.array.insertAt(this._dimsList,bk,bf);a4.array.insertAt(this._dimsNames,bk,be);if(bf._calculate){bk=a4.array.binarySearch(this._calcDimsList,bf._calculationOrder,a4.compare,function(bp){return bp._calculationOrder});bk>=0?bk++:bk=~bk;a4.array.insertAt(this._calcDimsList,bk,bf)}this._isPctRoleDimTypeMap=null;return bf},addCalculation:function(bi,bf){bi||a4.fail.argumentRequired("calcSpec");var bh=bi.calculation||a4.fail.argumentRequired("calculations[i].calculation"),be=bi.names;be="string"==typeof be?be.split(/\s*\,\s*/):a4.array.as(be);if(be&&be.length){var bg=this._calculatedDimNames;be.forEach(function(bj){if(bj){bj=bj.replace(/^\s*(.+?)\s*$/,"$1");!a4.hasOwn(bg,bj)||a4.fail.argumentInvalid("calculations[i].names","Dimension name '{0}' is already being calculated.",[bj]);var bl=this._dims[bj];if(!bl){var bk=aL.data.DimensionType.extendSpec(bj,null,bf);this.addDimension(bj,bk)}bg[bj]=!0;bl._toCalculated()}},this)}this._calculations.push(bh)},isCalculated:function(be){return a4.hasOwn(this._calculatedDimNames,be)},_calculate:function(bi){var bj=this._calculations,be=bj.length;if(be){for(var bh={},bg=0;be>bg;bg++){var bf=bj[bg];bf(bi,bh)}return bh}},getPlayingPercentVisualRoleDimensionMap:function(){var be=this._isPctRoleDimTypeMap;be||(be=this._isPctRoleDimTypeMap=new a4.Map(a4.query(a4.own(this._dims)).where(function(bf){return bf.playingPercentVisualRole()}).object({name:function(bf){return bf.name}})));return be},sortDimensionNames:function(bg,bf){var be=this._dimsIndexByName;if(!be){be=a4.query(this._dimsList).object({name:function(bh){return bh.name},value:function(bi,bh){return bh}});this._dimsIndexByName=be}bg.sort(function(bi,bh){return a4.compare(be[bf?bf(bi):bi],be[bf?bf(bh):bh])});return bg}});a4.type("pvc.data.ComplexTypeProject").init(function(be){this._dims={};this._dimList=[];this._dimGroupsDims={};this._dimGroupSpecs=be||{};this._calcList=[]}).add({_ensureDim:function(bf,be){bf||a4.fail.argumentInvalid("name","Invalid dimension name '{0}'.",[bf]);var bg=a4.getOwn(this._dims,bf);if(bg){be&&a4.setUDefaults(bg.spec,be)}else{bg=this._dims[bf]=this._createDim(bf,be);this._dimList.push(bg);var bh=a4.array.lazy(this._dimGroupsDims,bg.groupName);a4.array.insert(bh,bf,a4.compare)}return bg},hasDim:function(be){return a4.hasOwn(this._dims,be)},setDim:function(bg,be){var bf=this._ensureDim(bg).spec;be&&a4.copy(bf,be);return this},setDimDefaults:function(bf,be){a4.setUDefaults(this._ensureDim(bf).spec,be);return this},_createDim:function(bh,bg){var bf=aL.data.DimensionType.dimensionGroupName(bh),be=this._dimGroupSpecs[bf];be&&(bg=a4.create(be,bg));return{name:bh,groupName:bf,spec:bg||{}}},readDim:function(bf,be){var bg=this._ensureDim(bf,be);if(bg.isRead){throw a4.error.operationInvalid("Dimension '{0}' already is the target of a reader.",[bf])}if(bg.isCalc){throw a4.error.operationInvalid("Dimension '{0}' is being calculated, so it cannot be the target of a reader.",[bf])}bg.isRead=!0},calcDim:function(bf,be){var bg=this._ensureDim(bf,be);if(bg.isCalc){throw a4.error.operationInvalid("Dimension '{0}' already is being calculated.",[bf])}if(bg.isRead){throw a4.error.operationInvalid("Dimension '{0}' is the target of a reader, so it cannot be calculated.",[bf])}bg.isCalc=!0},isReadOrCalc:function(be){if(be){var bf=a4.getOwn(this._dims,be);if(bf){return bf.isRead||bf.isCalc}}return !1},groupDimensionsNames:function(be){return this._dimGroupsDims[be]},setCalc:function(bf){bf||a4.fail.argumentRequired("calculations[i]");bf.calculation||a4.fail.argumentRequired("calculations[i].calculation");var be=bf.names;be="string"==typeof be?be.split(/\s*\,\s*/):a4.array.as(be);be&&be.length&&be.forEach(this.calcDim,this);this._calcList.push(bf)},configureComplexType:function(be,bf){this._dimList.forEach(function(bh){var bi=bh.name,bg=bh.spec;bg=aL.data.DimensionType.extendSpec(bi,bg,bf);be.addDimension(bi,bg)});this._calcList.forEach(function(bg){be.addCalculation(bg)})}});a4.type("pvc.data.TranslationOper").init(function(bg,bi,bh,bf,be){this.chart=bg;this.complexTypeProj=bi;this.source=bh||a4.fail.argumentRequired("source");this.metadata=bf||a4.fail.argumentRequired("metadata");this.options=be||{};this._initType();if(aL.debug>=4){this._logItems=!0;this._logItemCount=0}}).add({_logItems:!1,logSource:a4.method({isAbstract:!0}),logVItem:a4.method({isAbstract:!0}),_translType:"Unknown",logTranslatorType:function(){return this._translType+" data source translator"},virtualItemSize:function(){return this.metadata.length},freeVirtualItemSize:function(){return this.virtualItemSize()-this._userUsedIndexesCount},setSource:function(be){if(!be){throw a4.error.argumentRequired("source")}this.source=be},defReader:function(bi){bi||a4.fail.argumentRequired("readerSpec");var bf;bf=a4.string.is(bi)?bi:bi.names;bf=a4.string.is(bf)?bf.split(/\s*\,\s*/):a4.array.as(bf);var bg=a4.array.as(bi.indexes);bg&&bg.forEach(this._userUseIndex,this);var bh=!(!bf||!bf.length),be=bi.reader;if(be){bh||a4.fail.argumentRequired("reader.names","Required argument when a reader function is specified.");this._userRead(be,bf)}else{if(bh){return this._userCreateReaders(bf,bg)}bg&&bg.forEach(function(bj){this._userIndexesToSingleDim[bj]=null},this)}return bg},configureType:function(){this._configureTypeCore()},_configureTypeCore:a4.method({isAbstract:!0}),_initType:function(){this._userDimsReaders=[];this._userDimsReadersByDim={};this._userItem=[];this._userUsedIndexes={};this._userUsedIndexesCount=0;this._userIndexesToSingleDim=[];var be=this.options.readers;be&&be.forEach(this.defReader,this);var bf=aL.parseDistinctIndexArray(this.options.multiChartIndexes);bf&&(this._multiChartIndexes=this.defReader({names:"multiChart",indexes:bf}))},_userUseIndex:function(be){be=+be;if(0>be){throw a4.error.argumentInvalid("index","Invalid reader index: '{0}'.",[be])}if(a4.hasOwn(this._userUsedIndexes,be)){throw a4.error.argumentInvalid("index","Virtual item index '{0}' is already assigned.",[be])}this._userUsedIndexes[be]=!0;this._userUsedIndexesCount++;this._userItem[be]=!0;return be},_userCreateReaders:function(be,bl){bl?bl.forEach(function(bs,br){bl[br]=+bs}):bl=[];var bi,bp=bl.length,bn=be.length;if(bn>bp){var bk=bp>0?bl[bp-1]+1:0;do{bk=this._nextAvailableItemIndex(bk);bl[bp]=bk;this._userUseIndex(bk);bp++}while(bn>bp)}for(var bm,bo=bp===bn?bn:bn-1,bg=0;bo>bg;bg++){bi=be[bg];bm=bl[bg];this._userIndexesToSingleDim[bm]=bi;this._userRead(this._propGet(bi,bm),bi)}if(bn>bo){for(var bh=aL.splitIndexedId(be[bn-1]),bq=bh[0],bf=a4.nullyTo(bh[1],0),bj=bo;bp>bj;bj++,bf++){bi=aL.buildIndexedId(bq,bf);bm=bl[bj];this._userIndexesToSingleDim[bm]=bi;this._userRead(this._propGet(bi,bm),bi)}}return bl},_userRead:function(be,bf){a4.fun.is(be)||a4.fail.argumentInvalid("reader","Reader must be a function.");a4.array.is(bf)?bf.forEach(function(bg){this._readDim(bg,be)},this):this._readDim(bf,be);this._userDimsReaders.push(be)},_readDim:function(bi,be){var bj,bf,bh=this._userIndexesToSingleDim.indexOf(bi);if(bh>=0){bj=this._itemInfos[bh];if(bj&&!this.options.ignoreMetadataLabels){var bg=bj.label||bj.name;bg&&(bf={label:bg})}}this.complexTypeProj.readDim(bi,bf);this._userDimsReadersByDim[bi]=be},execute:function(be){this.data=be;return this._executeCore()},_executeCore:function(){var be=this._getDimensionsReaders();return a4.query(this._getItems()).select(function(bf){return this._readItem(bf,be)},this)},_getItems:function(){return this.source},_getDimensionsReaders:function(){return this._userDimsReaders},_readItem:function(bo,bn){var bf=this._logItems;if(bf){var bh=this._logItemCount;if(10>bh){aL.log("virtual item ["+this._logItemCount+"]: "+aL.stringify(bo));this._logItemCount++}else{aL.log("...");bf=this._logItems=!1}}for(var be=0,bk=bn.length,bj=this.data,bg={};bk>be;){bn[be++].call(bj,bo,bg)}if(bf){var bl={};for(var bi in bg){var bm=bg[bi];a4.object.is(bm)&&(bm="v" in bm?bm.v:"value" in bm?bm.value:"...");bl[bi]=bm}aL.log("-> read: "+aL.stringify(bl))}return bg},_propGet:function(bf,bg){function be(bi,bh){bh[bf]=bi[bg]}return be},_nextAvailableItemIndex:function(bf,be){null==bf&&(bf=0);null==be&&(be=1/0);for(;be>bf&&a4.hasOwn(this._userItem,bf);){bf++}return be>bf?bf:-1},_getUnboundRoleDefaultDimNames:function(be,bg,bi,bk){var bj=this.chart.visualRoles[be];if(bj&&!bj.isPreBound()){var bf=bj.defaultDimensionName;if(bf){bf=bf.match(/^(.*?)(\*)?$/)[1];bi||(bi=[]);null==bk&&(bk=0);null==bg&&(bg=1);for(;bg--;){var bh=aL.buildIndexedId(bf,bk++);this.complexTypeProj.isReadOrCalc(bh)||bi.push(bh)}return bi.length?bi:null}}},collectFreeDiscreteAndConstinuousIndexes:function(bf,be){this._itemInfos.forEach(function(bi,bh){if(!this._userUsedIndexes[bh]){var bg=1===bi.type?be:bf;bg&&bg.push(bh)}},this)}});a4.type("pvc.data.MatrixTranslationOper",aL.data.TranslationOper).add({_initType:function(){this.J=this.metadata.length;this.I=this.source.length;this._processMetadata();this.base()},setSource:function(be){this.base(be);this.I=this.source.length},_knownContinuousColTypes:{numeric:1,number:1,integer:1},_processMetadata:function(){for(var bj=this._knownContinuousColTypes,bg=a4.query(this.metadata).select(function(bq,bp){bq.colIndex=bp;return bq}).where(function(bp){var bq=bp.colType;return !bq||1!==bj[bq.toLowerCase()]}).select(function(bp){return bp.colIndex}).array(),bk=a4.array.create(this.J,1),bn=this.I,be=this.source,bl=bg.length,bi=0;bn>bi&&bl>0;bi++){for(var bo=be[bi],bf=0;bl>bf;){var bh=bg[bf],bm=bo[bh];if(null!=bm){bk[bh]=this._getSourceValueType(bm);bg.splice(bf,1);bl--}else{bf++}}}this._columnTypes=bk},_buildItemInfoFromMetadata:function(be){var bf=this.metadata[be];return{type:this._columnTypes[be],name:bf.colName,label:bf.colLabel}},_getSourceValueType:function(be){switch(typeof be){case"number":return 1;case"object":if(be instanceof Date){return 1}}return 0},logSource:function(){var be=["DATA SOURCE SUMMARY",aL.logSeparator,"ROWS ("+Math.min(10,this.I)+"/"+this.I+")"];a4.query(this.source).take(10).each(function(bh,bg){be.push("  ["+bg+"] "+aL.stringify(bh))});this.I>10&&be.push("  ...");be.push("COLS ("+this.J+")");var bf=this._columnTypes;this.metadata.forEach(function(bh,bg){be.push("  ["+bg+"] '"+bh.colName+"' (type: "+bh.colType+", inspected: "+(bf[bg]?"number":"string")+(bh.colLabel?", label: '"+bh.colLabel+"'":"")+")")});be.push("");return be.join("\n")},_logVItem:function(bi,be){var bg=["VIRTUAL ITEM ARRAY",aL.logSeparator],bk=4,bh=5,bj=9;this._itemInfos.forEach(function(bn,bl){bk=Math.max(bk,(bn.name||"").length);bh=Math.max(bh,(bn.label||"").length);var bm=this._userIndexesToSingleDim[bl];bm&&(bj=Math.max(bj,bm.length))},this);bg.push("Index | Kind | Type   | "+a4.string.padRight("Name",bk)+" | "+a4.string.padRight("Label",bh)+" > Dimension","------+------+--------+-"+a4.string.padRight("",bk,"-")+"-+-"+a4.string.padRight("",bh,"-")+"-+-"+a4.string.padRight("",bj,"-")+"-");var bf=0;bi.forEach(function(bn){for(var bm=0,bl=be[bn];bl>bm;bm++){var bp=this._itemInfos[bf],bo=this._userIndexesToSingleDim[bf];void 0===bo&&(bo="");bg.push(" "+bf+"    | "+bn+"    | "+(bp.type?"number":"string")+" | "+a4.string.padRight(bp.name||"",bk)+" | "+a4.string.padRight(bp.label||"",bh)+" | "+bo);bf++}},this);bg.push("");return bg.join("\n")},_createPlot2SeriesKeySet:function(be,bf){var bh=null,bg=bf.length;a4.query(be).each(function(bj){var bi=+bj;if(isNaN(bi)){throw a4.error.argumentInvalid("plot2DataSeriesIndexes","Element is not a number '{0}'.",[bj])}if(0>bi){if(-bg>=bi){throw a4.error.argumentInvalid("plot2DataSeriesIndexes","Index is out of range '{0}'.",[bi])}bi=bg+bi}else{if(bi>=bg){throw a4.error.argumentInvalid("plot2DataSeriesIndexes","Index is out of range '{0}'.",[bi])}}bh||(bh={});bh[bf[bi]]=!0});return bh},_dataPartGet:function(bn,bk){function bi(bq,br){if(!bl){bg=bn();bl=bm.data.dimensions(bh);aL.debug>=3&&bg&&aL.log("Second axis series values: "+aL.stringify(a4.keys(bg)))}var bp;bk(bq,bj);var bo=bj.series;null!=bo&&null!=bo.v&&(bo=bo.v);bp=a4.hasOwn(bg,bo)?be||(be=bl.intern("1")):bf||(bf=bl.intern("0"));br[bh]=bp}var bl,bg,bf,be,bm=this,bh=this.options.dataPartDimName,bj={};return bi}});a4.type("pvc.data.CrosstabTranslationOper",aL.data.MatrixTranslationOper).add({_translType:"Crosstab",virtualItemSize:function(){return this.R+this.C+this.M},_executeCore:function(){function bj(bp,bo){for(var bn=bl[bp],bm=0,bq=bg[bp];bq-->0;){bh[bn++]=bo[bm++]}}function bf(bm,bq){for(var bp=bl.M,bo=bg._colGroupsIndexes[bq],bs=bg.M,bn=0;bs>bn;bn++){var br=bo[bn];bh[bp++]=null!=br?bm[br]:null}}if(!this.metadata.length){return a4.query()}var be=this._getDimensionsReaders(),bh=new Array(this.virtualItemSize()),bl=this._itemCrossGroupIndex,bg=this,bi=a4.query(this.source);if(this._colGroups&&this._colGroups.length){var bk=function(bm){bj("R",bm);return a4.query(this._colGroups).select(function(bo,bn){bj("C",bo);bf(bm,bn);return this._readItem(bh,be)},this)};return bi.selectMany(bk,this)}return bi.select(function(bm){bj("R",bm);return this._readItem(bh,be)},this)},_processMetadata:function(){this.base();this._separator=this.options.separator||"~";var bg=this.R=1;this.C=1;this.M=1;this.measuresDirection=null;var bo,be=this.options.seriesInRows,bk=this.metadata;bo=bk.map(be?function(bp){return bp.colName}:this.options.compatVersion<=1?function(bp){return{v:bp.colName}}:function(bp){return{v:bp.colName,f:bp.colLabel}});var bh=this._itemCrossGroupInfos={};if(this.options.isMultiValued){var bl=a4.get(this.options,"measuresInColumns",!0);if(bl||null==this.options.measuresIndex){bg=this.R=this._getCategoriesCount();var bm=bo.slice(bg),bj=bm.length;if(bj>0){if(bl){this.measuresDirection="columns";this._processEncodedColGroups(bm)}else{this._colGroups=bm;this._colGroupsIndexes=[];this._colGroups.forEach(function(bq,bp){this._colGroups[bp]=this._splitEncodedColGroupCell(bq);this._colGroupsIndexes[bp]=[this.R+bp]},this);bh.M=[this._buildItemInfoFromMetadata(bg)]}this.C=this._colGroups[0].length;bh.C=a4.range(0,this.C).select(function(){return{type:0}}).array()}else{this.C=this.M=0;bh.M=[];bh.C=[]}}else{this.measuresDirection="rows";this.R=+this.options.measuresIndex;var bn=this.options.measuresCount;null==bn&&(bn=1);this.M=bn;this._colGroups=bo.slice(this.R+1);this._colGroups.forEach(function(bq,bp){this._colGroups[bp]=[bq]},this)}}else{bg=this.R=this._getCategoriesCount();this._colGroups=bo.slice(bg);this._colGroupsIndexes=new Array(this._colGroups.length);this._colGroups.forEach(function(bq,bp){this._colGroups[bp]=[bq];this._colGroupsIndexes[bp]=[bg+bp]},this);bh.C=[{type:0}];bh.M=[{type:this._columnTypes[bg]}]}bh.R=a4.range(0,this.R).select(this._buildItemInfoFromMetadata,this).array();var bi=this._itemCrossGroupIndex={C:be?this.R:0,R:be?0:this.C,M:this.C+this.R},bf=this._itemInfos=new Array(this.virtualItemSize());a4.eachOwn(bi,function(bq,bp){bh[bp].forEach(function(bs,br){bf[bq+br]=bs})});this._itemLogicalGroup={series:be?this.R:this.C,category:be?this.C:this.R,value:this.M};this._itemLogicalGroupIndex={series:0,category:this._itemLogicalGroup.series,value:this.C+this.R}},logVItem:function(){return this._logVItem(["C","R","M"],{C:this.C,R:this.R,M:this.M})},_getCategoriesCount:function(){var be=this.options.categoriesCount;null!=be&&(!isFinite(be)||0>be)&&(be=null);if(null==be){be=a4.query(this._columnTypes).whayl(function(bf){return 0===bf}).count();be||(be=1)}return be},_splitEncodedColGroupCell:function(bf){var bg,be=bf.v;if(null==be){be=[]}else{be=be.split(this._separator);bg=bf.f;bg&&(bg=bg.split(this._separator))}return be.map(function(bi,bh){return{v:bi,f:bg&&bg[bh]}})},_processEncodedColGroups:function(bt){for(var bo,bm=bt.length||a4.assert("Must have columns"),bi=this.R,bl=[],bp={},bh=[],bu=0;bm>bu;bu++){var by,bx,bf,bz,bq=bt[bu],bv=bq.v,bn=bq.f,bg=bv.lastIndexOf(this._separator);if(0>bg){by=bv;bx=bn;bv="";bf=[]}else{by=bv.substring(bg+1);bv=bv.substring(0,bg);bf=bv.split(this._separator);if(null!=bn){bz=bn.split(this._separator);bx=bz.pop()}bf.forEach(function(bC,bB){var bA=bz&&bz[bB];bf[bB]={v:bC,f:bA}})}if(bo&&bo.encValues===bv){bo.measureNames.push(by)}else{bo={startIndex:bu,encValues:bv,values:bf,measureNames:[by]};bl.push(bo)}var br=bu-bo.startIndex,bs=a4.getOwn(bp,by);if(bs){br>bs.groupIndex&&(bs.groupIndex=br)}else{bp[by]=bs={name:by,label:bx,type:this._columnTypes[bi+bu],groupIndex:br,index:bu};bh.push(bs)}}bh.sort(function(bB,bA){return a4.compare(bB.groupIndex,bA.groupIndex)||a4.compare(bB.index,bA.index)});bh.forEach(function(bB,bA){bB.groupIndex=bA});var bj=bl.length,be=new Array(bj),bw=new Array(bj),bk=bh.length;bl.map(function(bD,bB){be[bB]=bD.values;var bA=bD.startIndex,bC=bw[bB]=new Array(bk);bD.measureNames.forEach(function(bG,bF){var bE=bp[bG].groupIndex;bC[bE]=bi+bA+bF})});this._colGroups=be;this._colGroupsIndexes=bw;this._itemCrossGroupInfos.M=bh;this.M=bk},configureType:function(){if("rows"===this.measuresDirection){throw a4.error.notImplemented()}this.base()},_configureTypeCore:function(){function bo(bp,bt,bq){for(var bs=bn[bp]+bq;bq>0;){var br=aL.buildIndexedId(bp,bt);if(!bk.complexTypeProj.isReadOrCalc(br)){bh=bk._nextAvailableItemIndex(bh);if(bh>=bs){return}bl.push({names:br,indexes:bh});bh++;bq--}bt++}}var bk=this,bf=bk._itemLogicalGroup,bn=bk._itemLogicalGroupIndex,bh=0,bl=[],bg=this.options.dataPartDimName;if(bg&&1===this.C&&!this.complexTypeProj.isReadOrCalc(bg)){var be=this.options.plot2DataSeriesIndexes;if(null!=be){var bj=this._colGroups.map(function(bp){return""+bp[0].v});this._plot2SeriesKeySet=this._createPlot2SeriesKeySet(be,bj)}}["series","category","value"].forEach(function(bq){var bp=bf[bq];bp>0&&bo(bq,0,bp)});bl&&bl.forEach(this.defReader,this);if(this._plot2SeriesKeySet){var bi=this._userDimsReadersByDim.series;if(bi){var bm=a4.fun.constant(this._plot2SeriesKeySet);this._userRead(this._dataPartGet(bm,bi),bg)}}}});a4.type("pvc.data.RelationalTranslationOper",aL.data.MatrixTranslationOper).add({M:0,C:0,S:0,_translType:"Relational",_processMetadata:function(){this.base();var bp=this.metadata,bq=this.J,bf=this.options.categoriesCount;null!=bf&&(!isFinite(bf)||0>bf)&&(bf=0);var bm,bh,bn;if(this.options.isMultiValued){bh=aL.parseDistinctIndexArray(this.options.measuresIndexes,0,bq-1);bn=bh?bh.length:0}var be;if(null==bn){if(bq>0&&3>=bq&&(null==bf||1===bf)&&null==bm){bn=1;bh=[bq-1];bf=bq>=2?1:0;bm=bq>=3?1:0;be=bf+bm}else{if(null!=bf&&bf>=bq){be=bq;bf=bq;bm=0;bn=0}else{var bo=null!=bf?bq-bf:1/0;bh=a4.query(bp).where(function(bs,br){return 0!==this._columnTypes[br]},this).select(function(br){return br.colIndex}).take(bo).array();bn=bh.length}}}if(null==be){be=bq-bn;if(0===be){bm=bf=0}else{if(null!=bf){if(bf>be){bf=be;bm=0}else{bm=be-bf}}else{bm=be>1?1:0;bf=be-bm}}}var bg=this.options.seriesInRows,bk=[];if(be){bm&&!bg&&bk.push({name:"S",count:bm});bf&&bk.push({name:"C",count:bf});bm&&bg&&bk.push({name:"S",count:bm})}bn&&bk.push({name:"M",count:bn});var bj=a4.range(0,bq).array();bh&&bh.forEach(function(br){bj.splice(br,1)});var bl={};bk.forEach(function(bt){var bs=bt.count,br=bt.name;bl[br]=bt;bt.indexes=bh&&"M"===br?bh:bj.splice(0,bs)});this.M=bn;this.S=bm;this.C=bf;var bi=[];["S","C","M"].forEach(function(br){var bs=bl[br];bs&&a4.array.append(bi,bs.indexes)});this._itemInfos=bi.map(this._buildItemInfoFromMetadata,this);this._itemCrossGroupIndex={S:0,C:this.S,M:this.S+this.C};this._itemPerm=bi},logVItem:function(){return this._logVItem(["S","C","M"],{S:this.S,C:this.C,M:this.M})},_configureTypeCore:function(){function bk(bl,bn,bq,bm){for(var bp=bj._itemCrossGroupIndex[bn]+bm;bm>0;){var bo=aL.buildIndexedId(bl,bq);if(!bj.complexTypeProj.isReadOrCalc(bo)){bf=bj._nextAvailableItemIndex(bf);if(bf>=bp){return}bh.push({names:bo,indexes:bf});bf++;bm--}bq++}}var bj=this,bf=0,bh=[];this.S>0&&bk("series","S",0,this.S);this.C>0&&bk("category","C",0,this.C);this.M>0&&bk("value","M",0,this.M);bh&&bh.forEach(this.defReader,this);var bg=this.options.dataPartDimName;if(bg&&!this.complexTypeProj.isReadOrCalc(bg)){var be=this.options.plot2DataSeriesIndexes;if(null!=be){var bi=this._userDimsReadersByDim.series;bi&&this._userRead(A.call(this,be,bi),bg)}}},_executeCore:function(){var be=this._getDimensionsReaders(),bf=this._itemPerm;return a4.query(this._getItems()).select(function(bg){bg=p.permute(bg,bf);return this._readItem(bg,be)},this)}});a4.type("pvc.data.Atom").init(function(bi,bh,be,bg,bf){this.dimension=bi;this.id=null==bh?-a4.nextId():a4.nextId();this.value=bh;this.label=be;void 0!==bg&&(this.rawValue=bg);this.key=bf}).add({isVirtual:!1,rawValue:void 0,toString:function(){var be=this.label;if(null!=be){return be}be=this.value;return null!=be?""+be:""}});var T=1;a4.type("pvc.data.Complex").init(function(bq,bv,bu,bs,bo,bn){var bx=this;bx.id=T++;var be;if(bq){be=bq.owner;bs||(bs=bq.atoms)}bx.owner=be=be||bx;var bh=be.type||a4.fail.argumentRequired("owner.type");bx.atoms=bs?Object.create(bs):{};var bm=!!bu;bu||(bu=bh._dimsNames);var bt,bl,bg=bx.atoms,bp=bu.length;if(bv){var br=be._dimensions,by=function(bC){var bA=bv[bC],bB=br[bC].intern(bA);null==bA||bs&&bB===bs[bC]||(bg[bC]=bB)};if(bm){bt=bp;for(;bt--;){by(bu[bt])}}else{for(bl in bv){by(bl)}}if(bn){bv=bh._calculate(bx);for(bl in bv){a4.hasOwnProp.call(bg,bl)||by(bl)}}}var bf;if(bp){if(1===bp){bf=bg[bu[0]];bx.value=bf.value;bx.rawValue=bf.rawValue;bx.key=bf.key;bo&&(bx.label=bf.label)}else{var bz,bk,bi,bj=be.keySep,bw=be.labelSep;for(bt=0;bp>bt;bt++){bf=bg[bu[bt]];bt?bz+=bj+bf.key:bz=bf.key;bo&&(bi=bf.label)&&(bk?bk+=bw+bi:bk=bi)}bx.value=bx.rawValue=bx.key=bz;bo&&(bx.label=bk)}}else{bx.value=null;bx.key="";bo&&(bx.label="")}}).add({labelSep:" ~ ",keySep:"~",value:null,label:null,rawValue:void 0,ensureLabel:function(){var bf=this.label;if(null==bf){bf="";var be=this.owner.labelSep;a4.eachOwn(this.atoms,function(bg){var bh=bg.label;bh&&(bf?bf+=be+bh:bf=bh)});this.label=bf}return bf},view:function(be){return new aL.data.ComplexView(this,be)},toString:function(){var be=[""+this.constructor.typeName];null!=this.index&&be.push("#"+this.index);this.owner.type.dimensionsNames().forEach(function(bf){be.push(bf+": "+aL.stringify(this.atoms[bf].value))},this);return be.join(" ")},rightTrimKeySep:function(be){return be&&aL.data.Complex.rightTrimKeySep(be,this.owner.keySep)},absKeyTrimmed:function(){return this.rightTrimKeySep(this.absKey)},keyTrimmed:function(){return this.rightTrimKeySep(this.key)}});aL.data.Complex.rightTrimKeySep=function(bg,bh){if(bg&&bh){for(var bf,be=bh.length;bg.lastIndexOf(bh)===(bf=bg.length-be)&&bf>=0;){bg=bg.substr(0,bf)}}return bg};aL.data.Complex.values=function(bg,bf){var be=bg.atoms;return bf.map(function(bh){return be[bh].value})};aL.data.Complex.compositeKey=function(bg,bf){var be=bg.atoms;return bf.map(function(bh){return be[bh].key}).join(bg.owner.keySep)};aL.data.Complex.labels=function(bg,bf){var be=bg.atoms;return bf.map(function(bh){return be[bh].label})};var aB=a4.propGet("id");a4.type("pvc.data.ComplexView",aL.data.Complex).init(function(bf,be){this.source=bf;this.viewDimNames=be;this.base(bf,bf.atoms,be,bf.owner.atoms,!0)}).add({values:function(){return aL.data.Complex.values(this,this.viewDimNames)},labels:function(){return aL.data.Complex.labels(this,this.viewDimNames)}});a4.type("pvc.data.Datum",aL.data.Complex).init(function(be,bf){this.base(be,bf,null,null,!1,!0)}).add({isSelected:!1,isVisible:!0,isNull:!1,isVirtual:!1,isTrend:!1,trend:null,isInterpolated:!1,interpolation:null,setSelected:function(be){if(this.isNull){return !1}be=null==be||!!be;var bf=this.isSelected!==be;if(bf){be?this.isSelected=!0:delete this.isSelected;aG.call(this.owner,this,be)}return bf},toggleSelected:function(){return this.setSelected(!this.isSelected)},setVisible:function(bf){if(this.isNull){return !1}bf=null==bf||!!bf;var be=this.isVisible!==bf;if(be){this.isVisible=bf;a5.call(this.owner,this,bf)}return be},toggleVisible:function(){return this.setVisible(!this.isVisible)}});var z=a4.propGet("isSelected");a4.type("pvc.data.TrendDatum",aL.data.Datum).init(function(bf,bg,be){this.base(bf,bg);this.trend=be}).add({isVirtual:!0,isTrend:!0});a4.type("pvc.data.InterpolationDatum",aL.data.Datum).init(function(bf,bg,be){this.base(bf,bg);this.interpolation=be}).add({isVirtual:!0,isInterpolated:!0});a4.type("pvc.data.Dimension").init(function(bi,bg){this.data=bi;this.type=bg;this.root=this;this.owner=this;var bf=bg.name;this.name=bf;this._atomComparer=bg.atomComparer();this._atomsByKey={};if(bi.isOwner()){this._atoms=[];O.call(this)}else{var bh,be=bi.parent;if(be){bh=be._dimensions[bf];E.call(bh,this);this.root=bi.parent.root}else{be=bi.linkParent;be||a4.assert("Data must have a linkParent");bh=be._dimensions[bf];bc.call(bh,this)}this._nullAtom=this.owner._nullAtom;this._lazyInit=function(){this._lazyInit=null;for(var bl=this.data._datums,bk=bl.length,bj=this._atomsByKey,bm=0;bk>bm;bm++){var bn=bl[bm].atoms[bf];bj[bn.key]=bn}this._atoms=bh.atoms().filter(function(bo){return a4.hasOwnProp.call(bj,bo.key)})}}}).add({parent:null,linkParent:null,_linkChildren:null,_atomsByKey:null,_atomVisibleDatumsCount:null,_disposed:!1,_nullAtom:null,_virtualNullAtom:null,_visibleAtoms:null,_visibleIndexes:null,_atomComparer:null,_atoms:null,_sumCache:null,count:function(){this._lazyInit&&this._lazyInit();return this._atoms.length},isVisible:function(be){this._lazyInit&&this._lazyInit();a4.hasOwn(this._atomsByKey,be.key)||a4.assert("Atom must exist in this dimension.");return t.call(this)[be.key]>0},atoms:function(be){this._lazyInit&&this._lazyInit();var bf=a4.get(be,"visible");if(null==bf){return this._atoms}bf=!!bf;this._visibleAtoms||(this._visibleAtoms={});return this._visibleAtoms[bf]||(this._visibleAtoms[bf]=a1.call(this,bf))},indexes:function(be){this._lazyInit&&this._lazyInit();var bf=a4.get(be,"visible");if(null==bf){return p.range(0,this._atoms.length)}bf=!!bf;this._visibleIndexes||(this._visibleIndexes={});return this._visibleIndexes[bf]||(this._visibleIndexes[bf]=W.call(this,bf))},atom:function(bg){if(null==bg||""===bg){return this._nullAtom}if(bg instanceof aL.data.Atom){return bg}this._lazyInit&&this._lazyInit();var bf=this.type._key,be=bf?bf.call(null,bg):bg;return this._atomsByKey[be]||null},getDistinctAtoms:function(bh){var bg=[],bf=bh?bh.length:0;if(bf){for(var be={},bj=0;bf>bj;bj++){var bi,bk=this.atom(bh[bj]);if(bk&&!be[bi="\x00"+bk.key]){be[bi]=bk;bg.push(bk)}}}return bg},extent:function(bj){var bl=this.atoms(bj),bn=bl.length;if(!bn){return void 0}var bg=this._nullAtom&&null==bl[0].value?1:0,bq=bn-bg;if(bq>0){var bi,bh=bl[bg],bo=bl[bn-1];if(bh!==bo&&a4.get(bj,"abs",!1)){var bf=bh.value<0?-1:1,be=bo.value<0?-1:1;if(bf===be){if(0>be){bi=bo;bo=bh;bh=bi}}else{if(bq>2){bo.value<-bh.value&&(bo=bh);var bp=a4.array.binarySearch(bl,0,this.type.comparer(),function(br){return br.value});if(0>bp){bp=~bp;var bk=bl[bp-1],bm=bl[bp];bh=-bk.value<bm.value?bk:bm}else{bh=bl[bp]}}else{if(bo.value<-bh.value){bi=bo;bo=bh;bh=bi}}}}return{min:bh,max:bo}}return void 0},min:function(bg){var bf=this.atoms(bg),be=bf.length;if(!be){return void 0}var bh=this._nullAtom&&null==bf[0].value?1:0;return be>bh?bf[bh]:void 0},max:function(bg){var bf=this.atoms(bg),be=bf.length;return be&&null!=bf[be-1].value?bf[be-1]:void 0},sumAbs:function(be){return this.sum(a4.create(be,{abs:!0}))},value:function(be){return this.sum(be&&be.abs?a4.create(be,{abs:!1}):be)},valueAbs:function(be){var bf=this.value(be);return bf?Math.abs(bf):bf},sum:function(bg){var bh=!!a4.get(bg,"abs",!1),bi=a4.get(bg,"zeroIfNone",!0),be=L(bg)+":"+bh,bf=a4.getOwn(this._sumCache,be);if(void 0===bf){var bj=this.name;bf=this.data.datums(null,bg).reduce(function(bl,bk){var bm=bk.atoms[bj].value;bh&&0>bm&&(bm=-bm);return null!=bl?bl+bm:bm},null);(this._sumCache||(this._sumCache={}))[be]=bf}return bi?bf||0:bf},percent:function(bh,bf){var bg=bh instanceof aL.data.Atom?bh.value:bh;if(!bg){return 0}var be=this.sumAbs(bf);return be?Math.abs(bg)/be:0},valuePercent:function(bg){var bh=this.valueAbs(bg);if(!bh){return 0}var be=this.data.parent;if(!be){return 1}var bf=be.dimensionsSumAbs(this.name,bg);return bh/bf},percentOverParent:function(be){return this.valuePercent(be)},format:function(bf,be){return""+(this.type._formatter?this.type._formatter.call(null,bf,be):"")},intern:function(bm,bh){if(null==bm||""===bm){return this._nullAtom||ae.call(this,bm)}if(bm instanceof aL.data.Atom){if(bm.dimension!==this){throw a4.error.operationInvalid("Atom is of a different dimension.")}return bm}var bl,bk,bj=this.type;if("object"==typeof bm&&"v" in bm){bk=bm.f;bm=bm.v;if(null==bm||""===bm){return this._nullAtom||ae.call(this)}}if(bh){bl=bm}else{var bg=bj._converter;if(bg){bl=bg(bm);if(null==bl||""===bl){return this._nullAtom||ae.call(this,bm)}}else{bl=bm}}var bf=bj.cast;if(bf){bl=bf(bl);if(null==bl||""===bl){return this._nullAtom||ae.call(this)}}var be=bj._key,bn=""+(be?be(bl):bl);bn||a4.fail.operationInvalid("Only a null value can have an empty key.");var bi=this._atomsByKey[bn];if(bi){!bh&&bi.isVirtual&&delete bi.isVirtual;return bi}return ag.call(this,bj,bm,bn,bl,bk,bh)},read:function(bm,bj){if(null==bm||""===bm){return null}var bl,bi=this.type;if("object"==typeof bm&&"v" in bm){bj=bm.f;bm=bm.v;if(null==bm||""===bm){return null}}var bg=bi._converter;bl=bg?bg(bm):bm;if(null==bl||""===bl){return null}var bf=bi.cast;if(bf){bl=bf(bl);if(null==bl||""===bl){return null}}var be=bi._key,bn=""+(be?be(bl):bl),bh=this._atomsByKey[bn];if(bh){return{rawValue:bm,key:bn,value:bh.value,label:""+(null==bj?bh.label:bj)}}if(null==bj){var bk=bi._formatter;bj=bk?bk(bl,bm):bl}bj=""+bj;return{rawValue:bm,key:bn,value:bl,label:bj}},dispose:function(){var bf=this;if(!bf._disposed){aq(bf.childNodes,"parent");aq(bf._linkChildren,"linkParent");var be;(be=bf.parent)&&ak(be,"childNodes",bf,"parent");(be=bf.linkParent)&&ak(be,"_linkChildren",bf,"linkParent");g.call(bf);bf._lazyInit=bf._atoms=bf._nullAtom=bf._virtualNullAtom=null;bf._disposed=!0}}});a4.type("pvc.data.Data",aL.data.Complex).init(function(bh){bh||a4.fail.argumentRequired("keyArgs");this._visibleNotNullDatums=new a4.Map();var bf,bi,bg,bm,bj,bk,bl=this.parent=bh.parent||null;if(bl){this.root=bl.root;this.depth=bl.depth+1;this.type=bl.type;bj=bh.datums||a4.fail.argumentRequired("datums");bf=bl.owner;bi=bh.atoms||a4.fail.argumentRequired("atoms");bm=bh.atomsDimNames||a4.fail.argumentRequired("atomsDimNames");bg=bl.atoms}else{this.root=this;bm=[];var be=bh.linkParent||null;if(be){bf=be.owner;this.type=bf.type;bj=bh.datums||a4.fail.argumentRequired("datums");this._leafs=[];this._wherePred=bh.where||null;bg=be.atoms;bk=a4.get(bh,"index",null);at.call(be,this,bk)}else{bf=this;bg={};bh.labelSep&&(this.labelSep=bh.labelSep);bh.keySep&&(this.keySep=bh.keySep);this.type=bh.type||a4.fail.argumentRequired("type");this._selectedNotNullDatums=new a4.Map()}}bj&&R.call(this,bj);this.owner=bf;this._atomsBase=bg;this._dimensions={};this._dimensionsList=[];this.type.dimensionsList().forEach(this._initDimension,this);this.base(bf,bi,bm,bg,!0);p.Dom.Node.call(this);if(bl){bk=a4.get(bh,"index",null);a9.call(bl,this,bk);this.absLabel=bl.absLabel?a4.string.join(bf.labelSep,bl.absLabel,this.label):this.label;this.absKey=bl.absKey?a4.string.join(bf.keySep,bl.absKey,this.key):this.key}else{this.absLabel=this.label;this.absKey=this.key}}).add(p.Dom.Node).add({parent:null,linkParent:null,_dimensions:null,_dimensionsList:null,_freeDimensionNames:null,_linkChildren:null,_leafs:null,_childrenByKey:null,_visibleNotNullDatums:null,_selectedNotNullDatums:null,_groupByCache:null,_sumAbsCache:null,treeHeight:null,_groupOper:null,_wherePred:null,_groupSpec:null,_groupLevel:null,_datums:null,_datumsById:null,_datumsByKey:null,depth:0,label:"",absLabel:"",_disposed:!1,_isFlattenGroup:!1,_isDegenerateFlattenGroup:!1,_initDimension:function(bf){var be=new aL.data.Dimension(this,bf);this._dimensions[bf.name]=be;this._dimensionsList.push(be)},dimensions:function(be,bf){if(null==be){return this._dimensions}var bg=a4.getOwn(this._dimensions,be);if(!bg&&a4.get(bf,"assertExists",!0)){throw a4.error.argumentInvalid("name","Undefined dimension '{0}'.",[be])}return bg},dimensionsList:function(){return this._dimensionsList},freeDimensionsNames:function(){var be=this._freeDimensionNames;be||(this._freeDimensionNames=be=this.type.dimensionsNames().filter(function(bg){var bf=this.atoms[bg];return !(bf instanceof aL.data.Atom)||null==bf.value},this));return be},isOwner:function(){return this.owner===this},children:function(){var be=this.childNodes;return be.length?a4.query(be):a4.query()},child:function(be){return a4.getOwn(this._childrenByKey,be,null)},childCount:function(){return this.childNodes.length},leafs:function(){return a4.query(this._leafs)},count:function(){return this._datums.length},firstDatum:function(){return this._datums.length?this._datums[0]:null},firstAtoms:function(){return(this.firstDatum()||this).atoms},singleDatum:function(){var be=this._datums;return 1===be.length?be[0]:null},dispose:function(){var bh=this;if(!bh._disposed){w.call(bh);var bf;(bf=bh._selectedNotNullDatums)&&bf.clear();bh._visibleNotNullDatums.clear();bf=bh._dimensionsList;for(var bg=0,be=bf.length;be>bg;bg++){bf[bg].dispose()}bh._dimensions=null;bh._dimensionsLIst=null;if(bf=bh.parent){bf.removeChild(bh);bh.parent=null}(bf=bh.linkParent)&&o.call(bf,bh);bh._disposed=!0}},disposeChildren:function(){w.call(this)}});aL.data.Data.add({selectedCount:function(){return this.isOwner()?this._selectedNotNullDatums.count:this.datums(null,{selected:!0}).count()},selectedDatums:function(){return this.isOwner()?this._selectedNotNullDatums.values():this.datums(null,{selected:!0}).array()},selectedDatumMap:function(){if(!this.isOwner()){var be=this.datums(null,{selected:!0}).object({name:a4.propGet("id")});return new a4.Set(be)}return this._selectedNotNullDatums.clone()},visibleCount:function(){return this._visibleNotNullDatums.count},replaceSelected:function(be){a4.array.is(be)||(be=be.array());var bf=a4.query(be).where(z).object({name:aB}),bg=this.owner.clearSelected(function(bh){return !a4.hasOwn(bf,bh.id)});bg|=aL.data.Data.setSelected(be,!0);return bg},clearSelected:function(be){if(this.owner!==this){return this.owner.clearSelected(be)}if(!this._selectedNotNullDatums.count){return !1}var bf;if(be){bf=!1;this._selectedNotNullDatums.values().filter(be).forEach(function(bg){bf=!0;h.call(bg);this._selectedNotNullDatums.rem(bg.id)},this)}else{bf=!0;this._selectedNotNullDatums.values().forEach(function(bg){h.call(bg)});this._selectedNotNullDatums.clear()}return bf}});aL.data.Data.setSelected=function(be,bf){var bg=0;be&&a4.query(be).each(function(bh){bg|=bh.setSelected(bf)});return !!bg};aL.data.Data.toggleSelected=function(bf,bh){a4.array.isLike(bf)||(bf=a4.query(bf).array());var bg=a4.query(bf),be=bh?bg.any(z):bg.all(aj);return this.setSelected(bf,!be)};aL.data.Data.setVisible=function(be,bg){var bf=0;be&&a4.query(be).each(function(bh){bf|=bh.setVisible(bg)});return !!bf};aL.data.Data.toggleVisible=function(be){a4.array.isLike(be)||(be=a4.query(be).array());var bf=a4.query(be).all(a4.propGet("isVisible"));return aL.data.Data.setVisible(be,!bf)};a4.space("pvc.data").FlatteningMode=a4.set(a4.makeEnum(["DfsPre","DfsPost"]),"None",0);a4.type("pvc.data.GroupingSpec").init(function(bi,bg,bh){this.type=bg||null;var bf=[];this.hasCompositeLevels=!1;var be=[];this.levels=a4.query(bi||void 0).where(function(bj){return bj.dimensions.length>0}).select(function(bj){bf.push(bj.id);a4.array.append(be,bj.dimensionNames());!this.hasCompositeLevels&&bj.dimensions.length>1&&(this.hasCompositeLevels=!0);bj._setAccDimNames(be.slice(0));return bj},this).array();this._dimNames=be;this.depth=this.levels.length;this.isSingleLevel=1===this.depth;this.isSingleDimension=this.isSingleLevel&&!this.hasCompositeLevels;this.firstDimension=this.depth>0?this.levels[0].dimensions[0]:null;this.rootLabel=a4.get(bh,"rootLabel")||"";this.flatteningMode=a4.get(bh,"flatteningMode")||aL.data.FlatteningMode.None;this._cacheKey=this._calcCacheKey();this.id=this._cacheKey+"##"+bf.join("||")}).add({_calcCacheKey:function(be){return[a4.get(be,"flatteningMode")||this.flatteningMode,a4.get(be,"reverse")||"false",a4.get(be,"isSingleLevel")||this.isSingleLevel,a4.get(be,"rootLabel")||this.rootLabel].join("#")},bind:function(be){this.type=be||a4.fail.argumentRequired("type");this.levels.forEach(function(bf){bf.bind(be)})},dimensions:function(){return a4.query(this.levels).prop("dimensions").selectMany()},dimensionNames:function(){return this._dimNames},view:function(be){return be.view(this.dimensionNames())},isDiscrete:function(){var be;return !this.isSingleDimension||!!(be=this.firstDimension)&&be.type.isDiscrete},firstDimensionType:function(){var be=this.firstDimension;return be&&be.type},firstDimensionName:function(){var be=this.firstDimensionType();return be&&be.name},firstDimensionValueType:function(){var be=this.firstDimensionType();return be&&be.valueType},isNull:function(){return !this.levels.length},ensure:function(bg){var be;if(bg){var bh=this._calcCacheKey(bg);if(bh!==this._cacheKey){var bf=a4.lazy(this,"_groupingCache");be=a4.getOwn(bf,bh);be||(be=bf[bh]=this._ensure(bg))}}return be||this},_ensure:function(bh){var bg=this;if(a4.get(bh,"isSingleLevel")&&!bg.isSingleLevel){return bg._singleLevelGrouping(bh)}if(a4.get(bh,"reverse")){return bg._reverse(bh)}var bf=a4.get(bh,"flatteningMode")||bg.flatteningMode,be=a4.get(bh,"rootLabel")||bg.rootLabel;return bf!==bg.flatteningMode||be!==bg.rootLabel?new aL.data.GroupingSpec(bg.levels,bg.type,{flatteningMode:bf,rootLabel:be}):bg},_singleLevelGrouping:function(bh){var bf=!!a4.get(bh,"reverse"),bg=this.dimensions().select(function(bi){return bf?new aL.data.GroupingDimensionSpec(bi.name,!bi.reverse,bi.type.complexType):bi}),be=new aL.data.GroupingLevelSpec(bg,this.type);return new aL.data.GroupingSpec([be],this.type,{flatteningMode:null,rootLabel:a4.get(bh,"rootLabel")||this.rootLabel})},_reverse:function(bf){var be=a4.query(this.levels).select(function(bg){var bh=a4.query(bg.dimensions).select(function(bi){return new aL.data.GroupingDimensionSpec(bi.name,!bi.reverse,bi.type.complexType)});return new aL.data.GroupingLevelSpec(bh,this.type)});return new aL.data.GroupingSpec(be,this.type,{flatteningMode:a4.get(bf,"flatteningMode")||this.flatteningMode,rootLabel:a4.get(bf,"rootLabel")||this.rootLabel})},toString:function(){return a4.query(this.levels).select(function(be){return""+be}).array().join(", ")}});a4.type("pvc.data.GroupingLevelSpec").init(function(bf,bh){var bg=[],be=[];this.dimensions=a4.query(bf).select(function(bj){bg.push(bj.id);be.push(bj.name);return bj}).array();this._dimNames=be;this.dimensionsInDefOrder=this.dimensions.slice(0);bh&&this._sortDimensions(bh);this.id=bg.join(",");this.depth=this.dimensions.length;var bi=this;this.comparer=function(bk,bj){return bi.compare(bk,bj)}}).add({_sortDimensions:function(be){be.sortDimensionNames(this.dimensionsInDefOrder,function(bf){return bf.name})},_setAccDimNames:function(be){this._accDimNames=be},accDimensionNames:function(){return this._accDimNames},dimensionNames:function(){return this._dimNames},bind:function(be){this._sortDimensions(be);this.dimensions.forEach(function(bf){bf.bind(be)})},compare:function(bg,bf){for(var bj=this.dimensions,bi=this.depth,bh=0;bi>bh;bh++){var be=bj[bh].compareDatums(bg,bf);if(be){return be}}return 0},key:function(bg){for(var bj="",bf=this._dimNames,bl=this.depth,bk=bg.owner.keySep,bh=bg.atoms,bi=0;bl>bi;bi++){var be=bh[bf[bi]].key;bi?bj+=bk+be:bj=be}return bj},atomsInfo:function(bg){for(var bf={},be=this._dimNames,bk=this.depth,bh=bg.atoms,bi=(bg.owner.keySep,0);bk>bi;bi++){var bj=be[bi];bf[bj]=bh[bj]}return{atoms:bf,dimNames:be}},toString:function(){return a4.query(this.dimensions).select(function(be){return""+be}).array().join("|")}});a4.type("pvc.data.GroupingDimensionSpec").init(function(bf,be,bg){this.name=bf;this.reverse=!!be;this.id=bf+":"+(be?"0":"1");bg&&this.bind(bg)}).add({type:null,comparer:null,bind:function(be){be||a4.fail.argumentRequired("type");this.type=be.dimensions(this.name);this.comparer=this.type.atomComparer(this.reverse)},compareDatums:function(bf,be){if(this.type.isComparable){var bg=this.name;return this.comparer(bf.atoms[bg],be.atoms[bg])}return this.reverse?be.id-bf.id:bf.id-be.id},toString:function(){return this.name+(this.reverse?" desc":"")}});aL.data.GroupingSpec.parse=function(bf,be){if(!bf){return new aL.data.GroupingSpec(null,be)}var bh;a4.array.is(bf)?bh=bf:a4.string.is(bf)&&(bh=bf.split(/\s*,\s*/));var bg=a4.query(bh).select(function(bj){var bi=ao(bj,be);return new aL.data.GroupingLevelSpec(bi,be)});return new aL.data.GroupingSpec(bg,be)};var n=/^\s*(.+?)(?:\s+(asc|desc))?\s*$/i;a4.type("pvc.data.DataOper").init(function(be){be||a4.fail.argumentRequired("linkParent");this._linkParent=be}).add({key:null,execute:a4.method({isAbstract:!0})});a4.type("pvc.data.GroupingOper",aL.data.DataOper).init(function(bk,be,bj){be||a4.fail.argumentRequired("groupingSpecs");this.base(bk,bj);this._where=a4.get(bj,"where");this._visible=a4.get(bj,"visible",null);this._selected=a4.get(bj,"selected",null);var bh=this._isNull=a4.get(bj,"isNull",null);this._postFilter=null!=bh?function(bl){return bl.isNull===bh}:null;var bg=null==this._selected,bf="";if(this._where){bf=a4.get(bj,"whereKey");if(!bf){if(bj&&null!==bf){bf=""+a4.nextId("dataOperWhereKey");bj.whereKey=bf}else{bg=!1}}}var bi=[];this._groupSpecs=a4.array.as(be).map(function(bl){if(bl instanceof aL.data.GroupingSpec){if(bl.type!==bk.type){throw a4.error.argumentInvalid("groupingSpecText","Invalid associated complex type.")}}else{bl=aL.data.GroupingSpec.parse(bl,bk.type)}bi.push(bl.id);return bl});bg&&(this.key=bi.join("!!")+"||visible:"+this._visible+"||isNull:"+this._isNull+"||where:"+bf)}).add({execute:function(){var bf=aT(a4.query(this._linkParent._datums),{visible:this._visible,selected:this._selected,where:this._where}),be=this._group(bf);return this._generateData(be,null,this._linkParent)},executeAdd:function(bh,be){var bg=aT(a4.query(be),{visible:this._visible,selected:this._selected,where:this._where}),bf=this._group(bg);this._generateData(bf,null,this._linkParent,bh);return bf.datums},_group:function(bf){var be={isRoot:!0,treeHeight:a4.query(this._groupSpecs).select(function(bh){var bg=bh.levels.length;return bg?bh.flatteningMode?1:bg:0}).reduce(a4.add,0),datums:[]};be.treeHeight>0&&this._groupSpecRecursive(be,a4.query(bf).array(),0);return be},_groupSpecRecursive:function(bh,be,bf){var bg=this._groupSpecs[bf];bg.flatteningMode?this._groupSpecRecursiveFlattened(bh,be,bg,bf):this._groupSpecRecursiveNormal(bh,be,bg,bf)},_groupSpecRecursiveNormal:function(bl,bf,bk,bh){function bj(bq,bt,bs){var bo=bg[bs],bp=bs===be-1,br=bi&&bp;bq.groupSpec=bk;bq.groupLevelSpec=bo;for(var bw=bq.children=this._groupLevelDatums(bo,bq,bt,!1),bu=0,bn=bw.length;bn>bu;bu++){var bm=bw[bu];if(!br){var bv=bm.datums;bm.datums=[];bp?this._groupSpecRecursive(bm,bv,bh+1):bj.call(this,bm,bv,bs+1)}a4.array.append(bq.datums,bm.datums)}}var bg=bk.levels,be=bg.length,bi=bh===this._groupSpecs.length-1;bl.isRoot&&(bl.label=bk.rootLabel);bj.call(this,bl,bf,0)},_groupSpecRecursiveFlattened:function(be,bg,bo,bp){function bk(bv,by,bx){for(var bt=bq[bx],bu=bx===bj-1,bw=bn&&bu,bD=this._groupLevelDatums(bt,bv,by,!0),bA=bn?bv.datums:[],bz=0,bs=bD.length;bs>bz;bz++){var br=bD[bz],bB=br.datums;a4.array.lazy(bv,"_children").push(br);if(a4.hasOwn(bi,br.key)){a4.array.append(bA,bB)}else{var bC=bf.length;if(!bh){bm(br);bv.isFlattenGroup=!0}if(!bw){br.datums=[];bu?this._groupSpecRecursive(br,bB,bp+1):bk.call(this,br,bB,bx+1)}a4.array.append(bA,br.datums);if(bh){if(a4.hasOwn(bi,br.key)){br.isFlattenGroup||a4.assert("Must be a parent for duplicate keys to exist.");if(1===br._children.length){bf.splice(bC,bf.length-bC);br.isDegenerateFlattenGroup=!0}}bm(br);bv.isFlattenGroup=!0}}}bn||this._groupSpecRecursive(bv,bA,bp+1)}var bh=bo.flatteningMode===aL.data.FlatteningMode.DfsPost,bq=bo.levels,bj=bq.length,bn=bp===this._groupSpecs.length-1,bf=[],bi={};be.children=bf;be.childrenByKey=bi;var bl={key:"",absKey:"",atoms:{},datums:[],label:bo.rootLabel,dimNames:[]},bm=function(br){bf.push(br);bi[br.key]=br};bh||bm(bl);bk.call(this,bl,bg,0);bh&&bm(bl);be.datums=bl.datums},_groupLevelDatums:function(bf,bi,bk,bg){for(var bn,bh=[],br={},bo=this._postFilter,bj=bf.comparer,bm=function(bu,bt){return bj(bu.firstDatum,bt.firstDatum)},bl=0,bp=bk.length;bp>bl;bl++){var bq=bk[bl],bs=bf.key(bq),be=a4.hasOwnProp.call(br,bs)&&br[bs];if(be){(!bo||bo(bq))&&be.datums.push(bq)}else{be=bf.atomsInfo(bq);be.key=bs;be.firstDatum=bq;be.datums=!bo||bo(bq)?[bq]:[];if(bg){bn||(bn=bq.owner.keySep);this._onNewChildNodeFlattened(bs,bn,be,bf,bi)}a4.array.insert(bh,be,bm);br[bs]=be}}if(bo){bl=bh.length;for(;bl--;){bh[bl].datums.length||bh.splice(bl,1)}}return bh},_onNewChildNodeFlattened:function(bf,bh,be,bj,bi){a4.copy(be.atoms,bi.atoms);be.dimNames=bj.accDimensionNames();if(bi.dimNames.length){var bg=bi.absKey+bh+bf;be.absKey=bg;be.key=aL.data.Complex.rightTrimKeySep(bg,bh)}else{be.absKey=bf}},_generateData:function(be,bi,bl,bf){var bh,bj;if(be.isRoot){if(bf){bh=bf;e.call(bh,be.datums)}else{bj=!0;bh=new aL.data.Data({linkParent:bl,datums:be.datums});bh.treeHeight=be.treeHeight;bh._groupOper=this}}else{if(bf){bh=bl.child(be.key);bh&&ah.call(bh,be.datums)}if(!bh){bj=!0;var bk,bo;bf&&(bo=bl.childNodes)&&(bk=~a4.array.binarySearch(bo,be.datums[0],bi.groupLevelSpec.comparer));bh=new aL.data.Data({parent:bl,atoms:be.atoms,atomsDimNames:be.dimNames,datums:be.datums,index:bk})}}if(bj){if(be.isFlattenGroup){bh._isFlattenGroup=!0;bh._isDegenerateFlattenGroup=!!be.isDegenerateFlattenGroup}var bn=be.label;if(bn){bh.label+=bn;bh.absLabel+=bn}}var bq=be.children,bm=bq&&bq.length;if(bm){if(bj){bh._groupSpec=be.groupSpec;bh._groupLevelSpec=be.groupLevelSpec}for(var bg=0;bm>bg;bg++){this._generateData(bq[bg],be,bh,bf)}}else{if(bj&&!be.isRoot){var bp=bh.root._leafs;bh.leafIndex=bp.length;bp.push(bh)}}return bh}});a4.type("pvc.data.LinearInterpolationOper").init(function(bk,bh,bm,bi,bg,bj,bf){this._newDatums=[];this._data=bm;var bl=bi.flatten(bk).children(),bn=bg.isBound()?bg.flatten(bh,{visible:!0,isNull:!1}).children().array():[null];this._isCatDiscrete=bi.grouping.isDiscrete();this._firstCatDim=this._isCatDiscrete?null:bk.owner.dimensions(bi.firstDimensionName());this._stretchEnds=bf;var be=this._valDim=bk.owner.dimensions(bj.firstDimensionName()),bo={visible:!0,zeroIfNone:!1};this._catInfos=bl.select(function(bs,bp){var bq=bm.child(bs.key),br={data:bq||bs,value:bs.value,isInterpolated:!1,serInfos:null,index:bp};br.serInfos=bn.map(function(bt){var bv=bq;bv&&bt&&(bv=bv.child(bt.key));var bu=bv?bv.dimensions(be.name).value(bo):null;return{data:bt,group:bv,value:bu,isNull:null==bu,catInfo:br}});return br}).array();this._serCount=bn.length;this._serStates=a4.range(0,this._serCount).select(function(bp){return new aL.data.LinearInterpolationOperSeriesState(this,bp)},this).array()}).add({interpolate:function(){for(var bf;bf=this._catInfos.shift();){bf.serInfos.forEach(this._visitSeries,this)}var be=this._newDatums;be.length&&this._data.owner.add(be)},_visitSeries:function(be,bf){this._serStates[bf].visit(be)},nextUnprocessedNonNullCategOfSeries:function(bi){for(var be=0,bg=this._catInfos.length;bg>be;){var bh=this._catInfos[be++],bf=bh.serInfos[bi];if(!bf.isNull){return bf}}}});a4.type("pvc.data.LinearInterpolationOperSeriesState").init(function(be,bf){this.interpolation=be;this.index=bf;this._lastNonNull(null)}).add({visit:function(be){be.isNull?this._interpolate(be):this._lastNonNull(be)},_lastNonNull:function(be){if(arguments.length){this.__lastNonNull=be;this.__nextNonNull=void 0}return this.__lastNonNull},_nextNonNull:function(){return this.__nextNonNull},_initInterpData:function(){if(void 0===this.__nextNonNull){var bm=this.__lastNonNull,bi=this.__nextNonNull=this.interpolation.nextUnprocessedNonNullCategOfSeries(this.index)||null;if(bi&&bm){var be=bm.value,bk=bi.value,bj=bk-be;if(this.interpolation._isCatDiscrete){var bh=bi.catInfo.index-bm.catInfo.index;bh>=2||a4.assert("Must have at least one interpolation point.");this._stepValue=bj/bh;this._middleIndex=~~(bh/2);var bf=bh-1;this._isOdd=bf%2>0}else{var bn=+bm.catInfo.value,bl=+bi.catInfo.value,bg=bl-bn;this._steep=bj/bg;this._middleCat=(bl+bn)/2}}}},_interpolate:function(bj){this._initInterpData();var bg=this.__nextNonNull,bp=this.__lastNonNull,bh=bg||bp;if(bh){var bm,bo,bf=this.interpolation,bq=bj.catInfo;if(bg&&bp){if(bf._isCatDiscrete){var bn=bq.index-bp.catInfo.index;bm=bp.value+this._stepValue*bn;bo=this._isOdd?bn<this._middleIndex?bp.group:bg.group:bn<=this._middleIndex?bp.group:bg.group}else{var bl=+bq.value,bk=+bp.catInfo.value;bm=bp.value+this._steep*(bl-bk);bo=bl<this._middleCat?bp.group:bg.group}}else{if(!bf._stretchEnds){return}bm=bh.value;bo=bh.group}var bi=Object.create(bo._datums[0].atoms);a4.copyOwn(bi,bq.data.atoms);var be=bf._valDim.intern(bm,!0);bi[be.dimension.name]=be;bf._newDatums.push(new aL.data.InterpolationDatum(bo.owner,bi,"linear"))}}});a4.type("pvc.data.ZeroInterpolationOper").init(function(bk,bh,bm,bi,bg,bj,bf){this._newDatums=[];this._data=bm;var bl=bi.flatten(bk).children(),bn=bg.isBound()?bg.flatten(bh,{visible:!0,isNull:!1}).children().array():[null];this._isCatDiscrete=bi.grouping.isDiscrete();this._firstCatDim=this._isCatDiscrete?null:bk.owner.dimensions(bi.firstDimensionName());this._stretchEnds=bf;var be=this._valDim=bk.owner.dimensions(bj.firstDimensionName()),bo={visible:!0,zeroIfNone:!1};this._catInfos=bl.select(function(bs,bp){var bq=bm.child(bs.key),br={data:bq||bs,value:bs.value,isInterpolated:!1,serInfos:null,index:bp};br.serInfos=bn.map(function(bt){var bv=bq;bv&&bt&&(bv=bv.child(bt.key));var bu=bv?bv.dimensions(be.name).value(bo):null;return{data:bt,group:bv,value:bu,isNull:null==bu,catInfo:br}});return br}).array();this._serCount=bn.length;this._serStates=a4.range(0,this._serCount).select(function(bp){return new aL.data.ZeroInterpolationOperSeriesState(this,bp)},this).array()}).add({interpolate:function(){for(var bf;bf=this._catInfos.shift();){bf.serInfos.forEach(this._visitSeries,this)}var be=this._newDatums;be.length&&this._data.owner.add(be)},_visitSeries:function(be,bf){this._serStates[bf].visit(be)},nextUnprocessedNonNullCategOfSeries:function(bi){for(var be=0,bg=this._catInfos.length;bg>be;){var bh=this._catInfos[be++],bf=bh.serInfos[bi];if(!bf.isNull){return bf}}}});a4.type("pvc.data.ZeroInterpolationOperSeriesState").init(function(be,bf){this.interpolation=be;this.index=bf;this._lastNonNull(null)}).add({visit:function(be){be.isNull?this._interpolate(be):this._lastNonNull(be)},_lastNonNull:function(be){if(arguments.length){this.__lastNonNull=be;this.__nextNonNull=void 0}return this.__lastNonNull},_nextNonNull:function(){return this.__nextNonNull},_initInterpData:function(){if(void 0===this.__nextNonNull){var bg=this.__lastNonNull,bf=this.__nextNonNull=this.interpolation.nextUnprocessedNonNullCategOfSeries(this.index)||null;if(bf&&bg){bg.value,bf.value;if(this.interpolation._isCatDiscrete){var bj=bf.catInfo.index-bg.catInfo.index;bj>=2||a4.assert("Must have at least one interpolation point.");this._middleIndex=~~(bj/2);var bi=bj-1;this._isOdd=bi%2>0}else{var be=+bg.catInfo.value,bh=+bf.catInfo.value;this._middleCat=(bh+be)/2}}}},_interpolate:function(bj){this._initInterpData();var bg=this.__nextNonNull,bn=this.__lastNonNull,bh=bg||bn;if(bh){var bl,bf=this.interpolation,bo=bj.catInfo;if(bg&&bn){if(bf._isCatDiscrete){var bm=bo.index-bn.catInfo.index;bl=this._isOdd?bm<this._middleIndex?bn.group:bg.group:bm<=this._middleIndex?bn.group:bg.group}else{var bk=+bo.value;bl=bk<this._middleCat?bn.group:bg.group}}else{if(!bf._stretchEnds){return}bl=bh.group}var bi=Object.create(bl._datums[0].atoms);a4.copyOwn(bi,bo.data.atoms);var be=bf._zeroAtom||(bf._zeroAtom=bf._valDim.intern(0,!0));bi[be.dimension.name]=be;bf._newDatums.push(new aL.data.InterpolationDatum(bl.owner,bi,"zero"))}}});aL.data.Data.add({load:function(bh,bg){C.call(this);var bi=a4.get(bg,"where"),bf=a4.get(bg,"isNull"),be=a4.query(bh).select(function(bk){var bj=new aL.data.Datum(this,bk);bf&&bf(bj)&&(bj.isNull=!0);return bi&&!bi(bj)?null:bj},this);R.call(this,be,{isAdditive:!1,doAtomGC:!0})},clearVirtuals:function(){var bj=this._datums;if(bj){this._sumAbsCache=null;for(var bk,bh=this._visibleNotNullDatums,bo=this._selectedNotNullDatums,bq=this._datumsByKey,bl=this._datumsById,bi=0,bm=bj.length;bm>bi;){var bn=bj[bi];if(bn.isVirtual){var be=bn.id,bp=bn.key;bj.splice(bi,1);delete bl[be];delete bq[bp];bo&&bn.isSelected&&bo.rem(be);bn.isVisible&&bh.rem(be);bm--;bk=!0}else{bi++}}if(bk){if(!bj.length&&this.parent){this.dispose();return}var bf=this.childNodes;if(bf){bi=0;bm=bf.length;for(;bm>bi;){var bg=bf[bi];bg.clearVirtuals();bg.parent?bi++:bm--}}this._linkChildren&&this._linkChildren.forEach(function(br){br.clearVirtuals()})}}a4.eachOwn(this._dimensions,function(br){x.call(br)})},add:function(be){C.call(this);R.call(this,be,{isAdditive:!0,doAtomGC:!0})},groupBy:function(bi,bf){var be,bh,bg=new aL.data.GroupingOper(this,bi,bf),bj=bg.key;if(bj){be=this._groupByCache;bh=be&&be[bj]}if(bh){aL.debug>=7&&aL.log("[GroupBy] Cache key hit '"+bj+"'")}else{aL.debug>=7&&aL.log("[GroupBy] "+(bj?"Cache key not found: '"+bj+"'":"No Cache key"));bh=bg.execute();bj&&((be||(this._groupByCache={}))[bj]=bh)}return bh},where:function(bh,bg){var be;if(bh){bh=aA.call(this,bh,bg);be=m.call(this,bh,bg)}else{if(!bg){return a4.query(this._datums)}be=aT(a4.query(this._datums),bg)}var bf=ai(bh,bg);return new aL.data.Data({linkParent:this,datums:be,where:bf})},datums:function(bf,be){if(!bf){return be?aT(a4.query(this._datums),be):a4.query(this._datums)}bf=aA.call(this,bf,be);return m.call(this,bf,be)},datum:function(bf,be){bf||a4.fail.argumentRequired("whereSpec");bf=aA.call(this,bf,be);return m.call(this,bf,be).first()||null},dimensionsSumAbs:function(bh,bg){var be=bh+":"+L(bg),bf=a4.getOwn(this._sumAbsCache,be);if(null==bf){bf=this.children().where(function(bi){return !bi._isFlattenGroup||bi._isDegenerateFlattenGroup}).select(function(bi){return bi.dimensions(bh).valueAbs(bg)||0},this).reduce(a4.add,0);(this._sumAbsCache||(this._sumAbsCache={}))[be]=bf}return bf}});aL.data.Data.add({getInfo:function(){var be=["DATA SUMMARY",aL.logSeparator,"  Dimension",aL.logSeparator];a4.eachOwn(this.dimensions(),function(bj,bf){var bi=bj.count(),bh=bj.type,bg=[];bg.push('"'+bh.label+'"');bg.push(bh.valueTypeName);bh.isComparable&&bg.push("comparable");bh.isDiscrete||bg.push("continuous");bh.isHidden&&bg.push("hidden");be.push("  "+bf+" ("+bg.join(", ")+") ("+bi+")\n	"+bj.atoms().slice(0,10).map(function(bk){return bk.label}).join(", ")+(bi>10?"...":""))});return be.join("\n")},getValues:function(){return p.range(0,this.getCategoriesSize()).map(function(be){return this._getValuesForCategoryIndex(be)},this)},_getDimensionValues:function(be){return this.dimensions(be).atoms().map(function(bf){return bf.value})},_getDimensionVisibleValues:function(be){return this.dimensions(be).atoms({visible:!0}).map(function(bf){return bf.value})},getSeries:function(){return this._getDimensionValues("series")},getVisibleSeriesIndexes:function(){return this.dimensions("series").indexes({visible:!0})},getVisibleCategoriesIndexes:function(){return this.dimensions("category").indexes({visible:!0})},getVisibleSeries:function(){return this._getDimensionVisibleValues("series")},getCategories:function(){return this._getDimensionValues("category")},getVisibleCategories:function(){return this._getDimensionVisibleValues("category")},_getValuesForCategoryIndex:function(bg){var bf=this.dimensions("category").atoms()[bg],be=this.datums({category:bf}).uniqueIndex(function(bh){return bh.atoms.series.key});return this.dimensions("series").atoms().map(function(bi){var bh=a4.getOwn(be,bi.key);return bh?bh.atoms.value.value:null})},getSeriesSize:function(){var be=this.dimensions("series",{assertExists:!1});return be?be.count():0},getCategoriesSize:function(){var be=this.dimensions("category",{assertExists:!1});return be?be.count():0}});a4.scope(function(){var be=a4.makeEnum(["Interactive","ShowsActivity","ShowsSelection","ShowsTooltip","Selectable","Unselectable","Hoverable","Clickable","DoubleClickable","SelectableByClick","SelectableByRubberband","SelectableByFocusWindow","Animatable"]);be.ShowsInteraction=be.ShowsActivity|be.ShowsSelection;be.Actionable=be.Hoverable|be.Clickable|be.DoubleClickable|be.SelectableByClick;be.HandlesEvents=be.Actionable|be.ShowsTooltip;be.HandlesClickEvent=be.Clickable|be.SelectableByClick;a4.type("pvc.visual.Interactive").addStatic(be).addStatic({ShowsAny:be.ShowsInteraction|be.ShowsTooltip,SelectableAny:be.Selectable|be.SelectableByClick|be.SelectableByRubberband|be.SelectableByFocusWindow}).add({_ibits:-1}).add(a4.query(a4.ownKeys(be)).object({name:a4.firstLowerCase,value:function(bg){var bf=be[bg];return function(){return !!(this._ibits&bf)}}}))});a4.type("pvc.visual.Scene").init(function(bn,bi){aL.debug>=4&&(this.id=a4.nextId("scene"));this._renderId=0;this.renderState={};p.Dom.Node.call(this,null);this.parent=bn||null;if(bn){this.root=bn.root;var bl=a4.get(bi,"index",null);bn.insertAt(this,bl)}else{this.root=this;this._active=null;this._panel=a4.get(bi,"panel")||a4.fail.argumentRequired("panel","Argument is required on root scene.")}var bh,bo,bm,bk,bg,bj,bf,be=a4.array.to(a4.get(bi,"source"));if(be&&be.length){this.source=be;bh=be[0];if(bh instanceof aL.data.Data){bo=bh;bg=be;bm=bo.firstDatum()||a4.query(bg).select(function(bp){return bp.firstDatum()}).first(a4.notNully)}else{bh instanceof aL.data.Datum||a4.assert("not a datum");bm=bh;bk=be}bj=bh.atoms;bf=bm&&bm.atoms||bh.atoms}else{bj=bf=bn?Object.create(bn.atoms):{}}this.atoms=bj;this.firstAtoms=bf;bg&&(this.groups=bg);bo&&(this.group=bo);bk&&(this._datums=bk);bm&&(this.datum=bm);(!bh||bh.isNull)&&(this.isNull=!0);this.vars=bn?Object.create(bn.vars):{}}).add(p.Dom.Node).add(aL.visual.Interactive).add({source:null,groups:null,group:null,_datums:null,datum:null,isNull:!1,get:function(be,bg){var bf=this.vars[be];return bf&&bf[bg||"value"]},getSeries:function(){return this.get("series")},getCategory:function(){return this.get("category")},getValue:function(){return this.get("value")},getTick:function(){return this.get("tick")},getX:function(){return this.get("x")},getY:function(){return this.get("y")},getSeriesLabel:function(){return this.get("series","label")},getCategoryLabel:function(){return this.get("category","label")},getValueLabel:function(){return this.get("value","label")},getTickLabel:function(){return this.get("tick","label")},getXLabel:function(){return this.get("x","label")},getYLabel:function(){return this.get("y","label")},data:function(){var be=this.group;if(!be){for(var bf=this;!be&&(bf=bf.parent);){be=bf.group}be||(be=this.panel.data)}return be},datums:function(){return this.groups?a4.query(this.groups).selectMany(function(be){return be.datums()}):this._datums?a4.query(this._datums):a4.query()},format:function(be){return a4.format(be,this._formatScope,this)},_formatScope:function(bf){if("#"===bf.charAt(0)){bf=bf.substr(1).split(".");if(bf.length>2){throw a4.error.operationInvalid("Scene format mask is invalid.")}var be=this.firstAtoms[bf[0]];if(be){if(bf.length>1){switch(bf[1]){case"value":return be.value;case"label":break;default:throw a4.error.operationInvalid("Scene format mask is invalid.")}}return be}return null}return a4.getPath(this.vars,bf)},isRoot:function(){return this.root===this},panel:function(){return this.root._panel},chart:function(){return this.root._panel.chart},compatVersion:function(){return this.root._panel.compatVersion()},children:function(){var be=this.childNodes;return be.length?a4.query(be):a4.query()},leafs:function(){function bf(bg){for(;bg.childNodes.length;){bg=bg.childNodes[0]}return bg}var be=this;return a4.query(function(bg){if(!bg){var bi=bf(be);if(bi===be){return 0}this.item=bi;return 1}var bh=this.item.nextSibling;if(bh){this.item=bh;return 1}for(var bj=this.item;bj!==be&&(bj=bj.parentNode);){if(bh=bj.nextSibling){this.item=bf(bh);return 1}}return 0})},anyInteraction:function(){return !!this.root._active||this.anySelected()},isActive:!1,setActive:function(be){be=!!be;this.isActive!==be&&aS.call(this.root,this.isActive?null:this)},clearActive:function(){return aS.call(this.root,null)},anyActive:function(){return !!this.root._active},active:function(){return this.root._active},activeSeries:function(){var bf,be=this.active();return be&&(bf=be.vars.series)&&bf.value},isActiveSeries:function(){if(this.isActive){return !0}var be=this.renderState.isActiveSeries;if(null==be){var bf;be=null!=(bf=this.activeSeries())&&bf===this.vars.series.value;this.renderState.isActiveSeries=be}return be},isActiveDatum:function(){return this.isActive?!0:!1},isActiveDescendantOrSelf:function(){return this.isActive?!0:a4.lazy(this.renderState,"isActiveDescOrSelf",this._calcIsActiveDescOrSelf,this)},_calcIsActiveDescOrSelf:function(){var be=this.active();if(be){for(;be=be.parent;){if(be===this){return !0}}}return !1},isVisible:function(){return this._visibleInfo().is},anyVisible:function(){return this._visibleInfo().any},_visibleInfo:function(){return a4.lazy(this.renderState,"visibleInfo",this._createVisibleInfo,this)},_createVisibleInfo:function(){var bf=this.chart().data.owner.visibleCount()>0,be=bf&&this.datums().any(a4.propGet("isVisible"));return{any:bf,is:be}},isSelected:function(){return this._selectedInfo().is},anySelected:function(){return this._selectedInfo().any},_selectedInfo:function(){return a4.lazy(this.renderState,"selectedInfo",this._createSelectedInfo,this)},_createSelectedInfo:function(){var bf=this.chart().data.owner.selectedCount()>0,be=bf&&this.datums().any(z);return{any:bf,is:be}},select:function(bh){var bg=this,be=bg.datums().array();if(be.length){var bf=bg.chart();bf._updatingSelections(function(){be=bf._onUserSelection(be);be&&be.length&&(bf.options.ctrlSelectMode&&a4.get(bh,"replace",!0)?bf.data.replaceSelected(be):aL.data.Data.toggleSelected(be))})}},isSelectedDescendantOrSelf:function(){return this.isSelected()?!0:a4.lazy(this.renderState,"isSelectedDescOrSelf",this._calcIsSelectedDescOrSelf,this)},_calcIsSelectedDescOrSelf:function(){var be=this.firstChild;if(be){do{if(be.isSelectedDescendantOrSelf()){return !0}}while(be=be.nextSibling)}return !1},toggleVisible:function(){aL.data.Data.toggleVisible(this.datums())&&this.chart().render(!0,!0,!1)}});aL.visual.Scene.prototype.variable=function(bg,bf){var be,bj=this;if(bj._vars&&bj._vars[bg]){void 0!==bf&&(be=a4.set({},"_"+bg+"EvalCore",a4.fun.to(bf)))}else{bj.hasOwnProperty("_vars")||(bj._vars=a4.create(bj._vars));bj._vars[bg]=!0;be={};var bi="_"+bg+"Eval";be[bg]=af(bg,bi);var bh=bi+"Core";a4.hasOwn(bj,bi)||(be[bi]=a4.methodCaller(bh));a4.hasOwn(bj,bh)||(be[bh]=a4.fun.to(void 0===bf?null:bf))}be&&bj.constructor.add(be);return bj};var Y=aL.visual.ValueLabelVar=function(bh,be,bg,bf){this.value=bh;this.label=be;void 0!==bg&&(this.rawValue=bg);void 0!==bf&&(this.absLabel=bf)};a4.set(Y.prototype,"rawValue",void 0,"absLabel",void 0,"setValue",function(be){this.value=be;return this},"setLabel",function(be){this.label=be;return this},"clone",function(){return new Y(this.value,this.label,this.rawValue)},"toString",function(){var be=this.label||this.value;return null==be?"":"string"!=typeof be?""+be:be});Y.fromComplex=function(be){return be?new Y(be.value,be.label,be.rawValue,be.absLabel):new Y(null,"",null)};Y.fromAtom=Y.fromComplex;a4.type("pvc.visual.Context").init(function(be,bg,bf){this.chart=be.chart;this.panel=be;U.call(this,bg,bf)}).add({isPinned:!1,pin:function(){this.isPinned=!0;return this},compatVersion:function(){return this.panel.compatVersion()},finished:function(be){return this.sign.finished(be)},delegate:function(be){return this.sign.delegate(be)},getV1Series:function(){var be;return a4.nullyTo(this.scene.firstAtoms&&(be=this.scene.firstAtoms[this.panel._getV1DimName("series")])&&be.rawValue,"Series")},getV1Category:function(){var be;return this.scene.firstAtoms&&(be=this.scene.firstAtoms[this.panel._getV1DimName("category")])&&be.rawValue},getV1Value:function(){var be;return this.scene.firstAtoms&&(be=this.scene.firstAtoms[this.panel._getV1DimName("value")])&&be.value},getV1Datum:function(){return this.panel._getV1Datum(this.scene)},get:function(be,bf){return this.scene.get(be,bf)},getSeries:function(){return this.scene.get("series")},getCategory:function(){return this.scene.get("category")},getValue:function(){return this.scene.get("value")},getTick:function(){return this.scene.get("tick")},getX:function(){return this.scene.get("x")},getY:function(){return this.scene.get("y")},getSeriesLabel:function(){return this.scene.get("series","label")},getCategoryLabel:function(){return this.scene.get("category","label")},getValueLabel:function(){return this.scene.get("value","label")},getTickLabel:function(){return this.scene.get("tick","label")},getXLabel:function(){return this.scene.get("x","label")},getYLabel:function(){return this.scene.get("y","label")},select:function(be){return this.scene.select(be)},toggleVisible:function(){return this.scene.toggleVisible()},click:function(){var bf=this;bf.clickable()&&bf.panel._onClick(bf);if(bf.selectableByClick()){var be=bf.event;bf.select({replace:!be||!be.ctrlKey})}},doubleClick:function(){this.doubleClickable()&&this.panel._onDoubleClick(this)},clickable:function(){var be=this;return(be.sign?be.sign.clickable():be.panel.clickable())&&(!be.scene||be.scene.clickable())},selectableByClick:function(){var be=this;return(be.sign?be.sign.selectableByClick():be.panel.selectableByClick())&&(!be.scene||be.scene.selectableByClick())},doubleClickable:function(){var be=this;return(be.sign?be.sign.doubleClickable():be.panel.doubleClickable())&&(!be.scene||be.scene.doubleClickable())},hoverable:function(){var be=this;return(be.sign?be.sign.hoverable():be.panel.hoverable())&&(!be.scene||be.scene.hoverable())}});if(Object.defineProperty){try{Object.defineProperty(aL.visual.Context.prototype,"parent",{get:function(){throw a4.error.operationInvalid("The 'this.parent.index' idiom has no equivalent in this version. Please try 'this.pvMark.parent.index'.")}})}catch(a8){}}a4.space("pvc.visual").TraversalMode=a4.makeEnum(["Tree","FlattenedSingleLevel","FlattenDfsPre","FlattenDfsPost"]);a4.type("pvc.visual.Role").init(function(bf,bh){this.name=bf;this.label=a4.get(bh,"label")||aL.buildTitleFromName(bf);this.index=a4.get(bh,"index")||0;this.dimensionDefaults=a4.get(bh,"dimensionDefaults")||{};a4.get(bh,"isRequired",!1)&&(this.isRequired=!0);a4.get(bh,"autoCreateDimension",!1)&&(this.autoCreateDimension=!0);var bi=a4.get(bh,"defaultSourceRole");bi&&(this.defaultSourceRoleName=bi);var bg=a4.get(bh,"defaultDimension");bg&&(this.defaultDimensionName=bg);if(!bg&&this.autoCreateDimension){throw a4.error.argumentRequired("defaultDimension")}var be,bj=a4.get(bh,"requireIsDiscrete");null!=bj&&(bj||(be=!0));if(null!=be){be=a4.get(bh,"requireSingleDimension",!1);if(be){if(a4.get(bh,"isMeasure",!1)){this.isMeasure=!0;a4.get(bh,"isPercent",!1)&&(this.isPercent=!0)}var bl=a4.get(bh,"valueType",null);if(bl!==this.valueType){this.valueType=bl;this.dimensionDefaults.valueType=bl}}}be!==this.requireSingleDimension&&(this.requireSingleDimension=be);if(bj!=this.requireIsDiscrete){this.requireIsDiscrete=!!bj;this.dimensionDefaults.isDiscrete=this.requireIsDiscrete}var bk=a4.get(bh,"traversalMode");null!=bk&&bk!==this.traversalMode&&(this.traversalMode=bk)}).add({isRequired:!1,requireSingleDimension:!1,valueType:null,requireIsDiscrete:null,isMeasure:!1,isPercent:!1,defaultSourceRoleName:null,defaultDimensionName:null,grouping:null,traversalMode:aL.visual.TraversalMode.FlattenedSingleLevel,rootLabel:"",autoCreateDimension:!1,isReversed:!1,label:null,sourceRole:null,isDefaultSourceRole:!1,firstDimensionType:function(){var be=this.grouping;return be&&be.firstDimensionType()},firstDimensionName:function(){var be=this.grouping;return be&&be.firstDimensionName()},firstDimensionValueType:function(){var be=this.grouping;return be&&be.firstDimensionValueType()},isDiscrete:function(){var be=this.grouping;return be&&be.isDiscrete()},setSourceRole:function(bf,be){this.sourceRole=bf;this.isDefaultSourceRole=!!be},setIsReversed:function(be){be?this.isReversed=!0:delete this.isReversed},setTraversalMode:function(bf){var be=aL.visual.TraversalMode;bf=a4.nullyTo(bf,be.FlattenedSingleLevel);bf!==this.traversalMode&&(bf===be.FlattenedSingleLevel?delete this.traversalMode:this.traversalMode=bf)},setRootLabel:function(be){if(be!==this.rootLabel){be?this.rootLabel=be:delete this.rootLabel;this.grouping&&this._updateBind(this.grouping)}},flatten:function(bg,be){var bf=this.flattenedGrouping(be)||a4.fail.operationInvalid("Role is unbound.");return bg.groupBy(bf,be)},flattenedGrouping:function(bf){var bg=this.grouping;if(bg){bf=bf?Object.create(bf):{};var be=bf.flatteningMode;null==be&&(be=bf.flatteningMode=this._flatteningMode());null!=bf.isSingleLevel||be||(bf.isSingleLevel=!0);return bg.ensure(bf)}},_flatteningMode:function(){var be=aL.visual.TraversalMode,bf=aL.data.FlatteningMode;switch(this.traversalMode){case be.FlattenDfsPre:return bf.DfsPre;case be.FlattenDfsPost:return bf.DfsPost}return be.None},select:function(bg,be){var bf=this.grouping;if(bf){a4.setUDefaults(be,"flatteningMode",aL.data.FlatteningMode.None);return bg.groupBy(bf.ensure(be),be)}},view:function(bf){var be=this.grouping;return be?be.view(bf):void 0},preBind:function(be){this.__grouping=be;return this},isPreBound:function(){return !!this.__grouping},preBoundGrouping:function(){return this.__grouping},isBound:function(){return !!this.grouping},postBind:function(be){var bf=this.__grouping;if(bf){delete this.__grouping;bf.bind(be);this.bind(bf)}return this},bind:function(be){be=this._validateBind(be);this._updateBind(be);return this},_validateBind:function(be){if(be){if(be.isNull()){be=null}else{if(this.requireSingleDimension&&!be.isSingleDimension){throw a4.error.operationInvalid("Role '{0}' only accepts a single dimension.",[this.name])}var bg=this.valueType,bf=this.requireIsDiscrete;be.dimensions().each(function(bh){var bi=bh.type;if(bg&&bi.valueType!==bg){throw a4.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'. \nIt only accepts dimensions of type '{2}' and not of type '{3}'.",[this.name,bi.name,aL.data.DimensionType.valueTypeName(bg),bi.valueTypeName])}if(null!=bf&&bi.isDiscrete!==bf){if(!bf){throw a4.error.operationInvalid("Role '{0}' cannot be bound to dimension '{1}'. \nIt only accepts {2} dimensions.",[this.name,bi.name,bf?"discrete":"continuous"])}bi._toDiscrete()}},this)}}return be},_updateBind:function(be){this.grouping&&this.grouping.dimensions().each(function(bf){bf.type&&Q.call(bf.type,this)},this);this.grouping=be;if(this.grouping){this.grouping=this.grouping.ensure({reverse:this.isReversed,rootLabel:this.rootLabel});this.grouping.dimensions().each(function(bf){aR.call(bf.type,this)},this)}}});a4.type("pvc.visual.RoleVarHelper").init(function(bj,bl,bh){var bg=a4.get(bh,"hasPercentSubVar",!1),bf=a4.get(bh,"roleVar"),bi=this.grouping=bl&&bl.grouping;if(bi){this.role=bl;this.sourceRoleName=bl.sourceRole&&bl.sourceRole.name;var be=bj.panel();this.panel=be;if(!bi.isDiscrete()){this.rootContDim=be.data.owner.dimensions(bi.firstDimensionName());bg&&(this.percentFormatter=be.chart.options.percentValueFormat)}}if(!bf){if(!bl){throw a4.error.operationInvalid("Role is not defined, so the roleVar argument is required.")}bf=bl.name}if(!bi){var bk=bj.vars[bf]=new Y(null,"");bg&&(bk.percent=new Y(null,""))}this.roleVarName=bf;bj["is"+a4.firstUpperCase(bf)+"Bound"]=!!bi;a4.get(bh,"allowNestedVars")&&(this.allowNestedVars=!0)}).add({allowNestedVars:!1,isBound:function(){return !!this.grouping},onNewScene:function(bm,bh){if(this.grouping){var bj=this.roleVarName;if(this.allowNestedVars?!a4.hasOwnProp.call(bm.vars,bj):!bm.vars[bj]){var bg=this.sourceRoleName;if(bg){var bl=a4.getOwn(bm.vars,bg);if(bl){bm.vars[bj]=bl.clone();return}}if(bh){var bf,be=this.rootContDim;if(be){var bs,bn,br=bm.group,bk=br?br.singleDatum():bm.datum;if(bk){if(!bk.isNull){bf=Y.fromAtom(bk.atoms[be.name]);if(null!=bf.value&&this.percentFormatter){if(br){bn=br.dimensions(be.name);bs=bn.valuePercent({visible:!0})}else{bs=bm.data().dimensions(be.name).percent(bf.value)}}}}else{if(br){bn=br.dimensions(be.name);var bq=bn.value({visible:!0,zeroIfNone:!1});if(null!=bq){var bp=be.format(bq);bf=new Y(bq,bp,bq);this.percentFormatter&&(bs=bn.valuePercent({visible:!0}))}}}bf&&this.percentFormatter&&(bf.percent=null==bf.value?new Y(null,""):new Y(bs,this.percentFormatter.call(null,bs)))}else{var bi=bm.datum;if(bi&&!bi.isNull){var bo=this.grouping.view(bi);bf=Y.fromComplex(bo)}}if(!bf){bf=new Y(null,"");this.percentFormatter&&(bf.percent=new Y(null,""))}bm.vars[bj]=bf}}}}});Z.prototype.getSign=function(){return this.sign||ac(this)};Z.prototype.getScene=function(){return this.getSign().scene()};Z.prototype.getContext=function(){return this.getSign().context()};Z.prototype.preBuildInstance=function(be){var bf=be.data;bf instanceof aL.visual.Scene&&H.call(bf,this.renderId())};a4.type("pvc.visual.BasicSign").init(function(bf,be){this.chart=bf.chart;this.panel=bf;!be.sign||a4.assert("Mark already has an attached Sign.");this.pvMark=be;be.sign=this}).add({compatVersion:function(){return this.chart.compatVersion()},localProperty:function(be,bf){this.pvMark.localProperty(be,bf);return this},lock:function(be,bf){return this.lockMark(be,this._bindWhenFun(bf,be))},optional:function(bf,bg,be){return this.optionalMark(bf,this._bindWhenFun(bg,bf),be)},lockMark:function(be,bf){return this.pvMark.lock(be,bf),this},optionalMark:function(bf,bg,be){return this.pvMark[bf](bg,be),this},delegate:function(bf,be){return this.pvMark.delegate(bf,be)},delegateExtension:function(be){return this.pvMark.delegate(be,aL.extensionTag)},delegateNotExtension:function(be){return this.pvMark.delegateExcept(be,aL.extensionTag)},hasDelegate:function(be){return this.pvMark.hasDelegate(be)},_createPropInterceptor:function(bf,be){var bg=this;return function(){var bh=this.sign;return bh&&bh===bg?be.apply(bg,arguments):bg._getPvSceneProp(bf,this.index)}},_getPvSceneProp:function(bi,bh){var be=this.pvMark,bg=be.scene;if(bg){var bf=be.hasOwnProperty("index")?be.index:Math.min(bh,bg.length-1);if(null!=bf){return bg[bf][bi]}}throw a4.error.operationInvalid("Cannot evaluate inherited property.")},_bindWhenFun:function(bg,be){if(a4.fun.is(bg)){var bf=this;return bf._createPropInterceptor(be,function(bh){return bg.call(bf,bh)})}return bg},_lockDynamic:function(be,bg){var bf=this;return bf.lockMark(be,bf._createPropInterceptor(be,function(bh){return bf[bg].call(bf,bh)}))},scene:function(){var be=this.pvMark.instance(),bf=be&&be.data;return bf instanceof aL.visual.Scene?bf:null},instanceState:function(be){return this.pvMark.instanceState(be)},context:function(bg,be){var bf;return be||!(bf=this.instanceState())?this._createContext(bg):bf.cccContext||(bf.cccContext=this._createContext(bg))},_createContext:function(be){return new aL.visual.Context(this.panel,this.pvMark,be)}});a4.type("pvc.visual.Sign",aL.visual.BasicSign).init(function(bf,be,bh){var bj=this;bj.base(bf,be,bh);bj._ibits=bf._ibits;var bi=a4.get(bh,"extensionId");null!=bi&&(bj.extensionAbsIds=a4.array.to(bf._makeExtensionAbsId(bi)));bj.isActiveSeriesAware=a4.get(bh,"activeSeriesAware",!0);if(bj.isActiveSeriesAware){var bg=bf.visualRoles,bk=bg&&bg.series;bk&&bk.isBound()||(bj.isActiveSeriesAware=!1)}be.wrapper(a4.get(bh,"wrapper")||bj.createDefaultWrapper());a4.get(bh,"freeColor",!0)||bj._bindProperty("fillStyle","fillColor","color")._bindProperty("strokeStyle","strokeColor","color")}).postInit(function(bf,be,bg){this._addInteractive(bg);bf._addSign(this)}).add({createDefaultWrapper:function(){var be=this;return function(bf){return function(bg){return bf.call(be.context(),bg)}}},property:function(bg){var bk=a4.firstUpperCase(bg),bh="base"+bk,bf="default"+bk,bi="normal"+bk,bj="interactive"+bk,be={};be[bg]=function(bn,bl){this._finished=!1;this._arg=bl;var bm=this[bh](bn,bl);if(null==bm){return null}if(this._finished){return bm}bm=this.showsInteraction()&&bn.anyInteraction()?this[bj](bn,bm,bl):this[bi](bn,bm,bl);this._arg=null;return bm};be[bh]=function(){return this.delegateExtension()};be[bf]=function(){};be[bi]=function(bm,bl){return bl};be[bj]=function(bm,bl){return bl};this.constructor.add(be);return this},anyInteraction:function(be){return be.anyInteraction()},finished:function(be){this._finished=!0;return be},applyExtensions:function(){if(!this._extended){this._extended=!0;var be=this.extensionAbsIds;be&&be.forEach(function(bf){this.panel.extendAbs(this.pvMark,bf)},this)}return this},intercept:function(bf,be){var bg=this._createPropInterceptor(bf,be);return this._intercept(bf,bg)},lockDimensions:function(){this.pvMark.lock("left").lock("right").lock("top").lock("bottom").lock("width").lock("height");return this},_extensionKeyArgs:{tag:aL.extensionTag},_bindProperty:function(be,bk,bj){var bf=this;bj||(bj=bk);var bg="default"+a4.firstUpperCase(bj);if(a4.fun.is(bf[bg])&&!bf.pvMark.hasDelegateValue(be,aL.extensionTag)){var bi=function(bl){return bf[bg](bl,bf._arg)};bf.pvMark.intercept(be,bi,bf._extensionKeyArgs)}var bh=this._createPropInterceptor(be,function(bl){return bf[bk](bl)});return bf._intercept(be,bh)},_intercept:function(bf,be){var bh=this.pvMark,bg=this.extensionAbsIds;bg&&a4.query(bg).select(function(bi){return this.panel._getExtensionAbs(bi,bf)},this).where(a4.notUndef).each(function(bi){bi=bh.wrap(bi,bf);bh.intercept(bf,bi,this._extensionKeyArgs)},this);(bh._intercepted||(bh._intercepted={}))[bf]=!0;bh.intercept(bf,be);return this}}).prototype.property("color").constructor.add(aL.visual.Interactive).add({extensionAbsIds:null,_addInteractive:function(bh){var bg=this,bf=a4.get;if(bg.interactive()){var bi=bg._ibits,be=aL.visual.Interactive;bf(bh,"noTooltip")&&(bi&=~be.ShowsTooltip);bf(bh,"noHover")&&(bi&=~be.Hoverable);bf(bh,"noClick")&&(bi&=~be.Clickable);bf(bh,"noDoubleClick")&&(bi&=~be.DoubleClickable);if(bf(bh,"noSelect")){bi&=~be.SelectableAny}else{if(this.selectable()){bf(bh,"noClickSelect")&&(bi&=~be.SelectableByClick);bf(bh,"noRubberSelect")&&(bi&=~be.SelectableByRubberband)}}if(bg.showsInteraction()){bf(bh,"showsInteraction")===!1&&(bi&=~be.ShowsInteraction);bg.showsActivity()&&bf(bh,"showsActivity")===!1&&(bi&=~be.ShowsActivity);bg.showsSelection()&&bf(bh,"showsSelection")===!1&&(bi&=~be.ShowsSelection)}bg._ibits=bi}if(bg.handlesEvents()){bg.showsTooltip()&&bg._addPropTooltip(bf(bh,"tooltipArgs"));bg.hoverable()&&bg._addPropHoverable();bg.handlesClickEvent()&&bg._addPropClick();bg.doubleClickable()&&bg._addPropDoubleClick()}else{bg.pvMark.events("none")}},fillColor:function(be){return this.color(be,"fill")},strokeColor:function(be){return this.color(be,"stroke")},defaultColor:function(be){return this.defaultColorSceneScale()(be)},dimColor:function(be,bf){return"text"===bf?aL.toGrayScale(be,-0.75,null,null):aL.toGrayScale(be,-0.3,null,null)},defaultColorSceneScale:function(){return a4.lazy(this,"_defaultColorSceneScale",this._initDefColorScale,this)},_initDefColorScale:function(){var be=this.panel.axes.color;return be?be.sceneScale({sceneVarName:"color"}):a4.fun.constant(aL.defaultColor)},mayShowActive:function(bf,be){return this.showsActivity()?bf.isActive||!be&&this.isActiveSeriesAware&&bf.isActiveSeries()||bf.isActiveDatum():!1},mayShowNotAmongSelected:function(be){return this.mayShowAnySelected(be)&&!be.isSelected()},mayShowSelected:function(be){return this.showsSelection()&&be.isSelected()},mayShowAnySelected:function(be){return this.showsSelection()&&be.anySelected()},_addPropTooltip:function(bh){if(!this.pvMark.hasTooltip){var bf=a4.create(this.chart._tooltipOptions,a4.get(bh,"options"));bf.isLazy=a4.get(bh,"isLazy",!0);var bg=a4.get(bh,"buildTooltip")||this._getTooltipFormatter(bf);if(bg){bf.isEnabled=this._isTooltipEnabled.bind(this);var be=a4.get(bh,"tipsyEvent");be||(be="mouseover");this.pvMark.localProperty("tooltip").tooltip(this._createTooltipProp(bg,bf.isLazy)).title(a4.fun.constant("")).ensureEvents().event(be,p.Behavior.tipsy(bf)).hasTooltip=!0}}},_getTooltipFormatter:function(be){return this.panel._getTooltipFormatter(be)},_isTooltipEnabled:function(){return this.panel._isTooltipEnabled()},_createTooltipProp:function(bg,bf){var be,bh=this;be=bf?function(bk){var bj,bi=bh.context(bk,!0);return function(){if(bi){bj=bg(bi);bi=null}return bj}}:function(bj){var bi=bh.context(bj);return bg(bi)};return function(bi){return bi&&!bi.isIntermediate&&bi.showsTooltip()?be(bi):void 0}},_addPropHoverable:function(){var bg,bf,be=this.panel;bg="mouseover";bf="mouseout";this.pvMark.ensureEvents().event(bg,function(bh){if(bh.hoverable()&&!be.selectingByRubberband()&&!be.animating()){bh.setActive(!0);be.renderInteractive()}}).event(bf,function(bh){!bh.hoverable()||be.selectingByRubberband()||be.animating()||bh.clearActive()&&be.renderInteractive()})},_ignoreClicks:0,_propCursorClick:function(bf){var bg=this._ibits&bf._ibits,be=aL.visual.Interactive;return bg&be.HandlesClickEvent||bg&be.DoubleClickable?"pointer":null},_addPropClick:function(){var be=this;be.pvMark.cursor(be._propCursorClick.bind(be)).ensureEvents().event("click",be._handleClick.bind(be))},_addPropDoubleClick:function(){var be=this;be.pvMark.cursor(be._propCursorClick.bind(be)).ensureEvents().event("dblclick",be._handleDoubleClick.bind(be))},_handleClick:function(){var bj=this,bg=bj.pvMark,bf=bg.instance(),bl=bf.data,bk=bj.doubleClickable()&&bl.doubleClickable();if(bk){var bi=bg.scene,be=bg.index,bh=p.event;window.setTimeout(function(){if(bj._ignoreClicks){bj._ignoreClicks--}else{try{p.event=bh;bg.context(bi,be,function(){bj._handleClickCore()})}catch(bm){p.error(bm)}finally{delete p.event}}},bj.chart.options.doubleClickMaxDelay||300)}else{bj._ignoreClicks?bj._ignoreClicks--:bj._handleClickCore()}},_handleClickCore:function(){this._onClick(this.context())},_handleDoubleClick:function(){var be=this,bf=be.scene();if(bf&&bf.doubleClickable()){be._ignoreClicks=2;be._onDoubleClick(be.context(bf))}},_onClick:function(be){be.click()},_onDoubleClick:function(be){be.doubleClick()}});a4.type("pvc.visual.Panel",aL.visual.Sign).init(function(be,bg,bf){var bi=a4.get(bf,"panel");if(!bi){var bh=a4.get(bf,"panelType")||p.Panel;bi=bg.add(bh)}this.base(be,bi,bf)}).add({_addInteractive:function(bf){var be=!0;bf=a4.setDefaults(bf,"noSelect",be,"noHover",be,"noTooltip",be,"noClick",be,"noDoubleClick",be);this.base(bf)}});a4.type("pvc.visual.Label",aL.visual.Sign).init(function(bf,bh,bg){var be=bh.add(p.Label);this.base(bf,be,bg)}).add({_addInteractive:function(bf){var be=!0;bf=a4.setDefaults(bf,"noSelect",be,"noHover",be,"noTooltip",be,"noClick",be,"noDoubleClick",be,"showsInteraction",!1);this.base(bf)},defaultColor:a4.fun.constant(p.Color.names.black)});var am=p.Color.names.white;a4.type("pvc.visual.ValueLabel",aL.visual.Label).init(function(be,bh,bg){this.valuesFont=a4.get(bg,"valuesFont")||be.valuesFont;this.valuesMask=a4.get(bg,"valuesMask")||be.valuesMask;this.valuesOptimizeLegibility=a4.get(bg,"valuesOptimizeLegibility",be.valuesOptimizeLegibility);this.valuesOverflow=a4.get(bg,"valuesOverflow",be.valuesOverflow);this.hideOverflowed="hide"===this.valuesOverflow;this.trimOverflowed=!this.hideOverflowed&&"trim"===this.valuesOverflow;this.hideOrTrimOverflowed=this.hideOverflowed||this.trimOverflowed;var bf;bf=a4.get(bg,"noAnchor",!1)?bh:bh.anchor(be.valuesAnchor);bg&&null==bg.extensionId&&(bg.extensionId="label");this.base(be,bf,bg);this.pvMark.font(this.valuesFont);this._bindProperty("text","text")._bindProperty("textStyle","textColor","color").intercept("visible",this.visible)}).prototype.property("text").property("textStyle").constructor.addStatic({maybeCreate:function(be,bg,bf){return be.valuesVisible&&be.valuesMask?new aL.visual.ValueLabel(be,bg,bf):null},isNeeded:function(be){return be.valuesVisible&&be.valuesMask}}).add({_addInteractive:function(be){be=a4.setDefaults(be,"showsInteraction",!0,"noSelect",!0,"noTooltip",!0,"noClick",!0,"noDoubleClick",!0,"noHover",!0);this.base(be)},visible:function(bg){var bf=this.getAnchoredToMark();if(bf&&!bf.visible()){return !1}if(!this.hideOrTrimOverflowed){return this.delegate(!0)}var bh;if(this.hasDelegate(aL.extensionTag)){bh=this.delegateExtension();if(null!=bh){return bh}}bh=this.delegateNotExtension();if(bh===!1){return !1}if(bg.isActive&&this.showsActivity()){return !0}var be=this.textFitInfo(bg);return !(be&&be.hide)},textFitInfo:function(bg){var bf=bg.renderState,be=bf.textFitInfo;return void 0!==be?be:bf.textFitInfo=this.calcTextFitInfo(bg,this._evalBaseText())||null},calcTextFitInfo:function(){return null},_evalBaseText:function(){var be=this.pvMark,bf=be.binds.properties.text.proto;return be.evalInPropertyContext(this.baseText.bind(this),bf)},baseText:function(bf){var be=bf.renderState,bg=be.baseText;return void 0!==bg?bg:this.base(bf)},defaultText:function(be){return be.format(this.valuesMask)},normalText:function(bf,bg){var be;return this.trimOverflowed&&(be=this.textFitInfo(bf))?this.trimText(bf,bg,be):bg},interactiveText:function(bf,bg){var be;return !this.trimOverflowed||bf.isActive&&this.showsActivity()||!(be=this.textFitInfo(bf))?bg:this.trimText(bf,bg,be)},trimText:function(bg,bh,bf){var be=bf&&bf.widthMax;return null!=be?aL.text.trimToWidthB(be,bh,this.pvMark.font(),".."):bh},textColor:function(be){return this.color(be,"text")},backgroundColor:function(bi,bg){var bh=this.instanceState();if(!bh){return this.calcBackgroundColor(bi,bg)}var bf=a4.lazy(bh,"cccBgColorCache"),be=a4.getOwn(bf,bg);be||(be=bf[bg]=this.calcBackgroundColor(bi,bg));return be},calcBackgroundColor:function(bf){var be=this.getAnchoredToMark();if(be){var bg=be.fillStyle();if(bg&&bg!==am&&this.isAnchoredInside(bf,be)){return bg}}return am},getAnchoredToMark:function(){return this.pvMark.target||this.pvMark.parent},isAnchoredInside:function(bj,bm){if(!bm&&!(bm=this.getAnchoredToMark())){return !1}var be,bi=this.pvMark,bl=bi.text(),bg=p.Text.measure(bl,bi.font()),bh=bi.left(),bn=bi.top();if(null==bh){be=bi.parent;bh=be.width()-(bi.right()||0)}if(null==bn){be||(be=bi.parent);bn=be.height()-(bi.bottom()||0)}var bk=p.Label.getPolygon(bg.width,bg.height,bi.textAlign(),bi.textBaseline(),bi.textAngle(),bi.textMargin()).center().plus(bh,bn),bf=bm.getShape(bm.scene,bi.index);return bf.containsPoint(bk)},maybeOptimizeColorLegibility:function(bh,be,bf){if(this.valuesOptimizeLegibility){var bg=this.backgroundColor(bh,bf);return bg&&bg!==am&&bg.isDark()===be.isDark()?be.complementary().alpha(0.9):be}return be},normalColor:function(bg,be,bf){return this.maybeOptimizeColorLegibility(bg,be,bf)},interactiveColor:function(bg,be,bf){return !this.mayShowActive(bg)&&this.mayShowNotAmongSelected(bg)?this.dimColor(be,bf):this.maybeOptimizeColorLegibility(bg,be,bf)}});a4.type("pvc.visual.Dot",aL.visual.Sign).init(function(bf,bh,bj){var be=bh.add(p.Dot),bi=a4.get(bj,"proto");bi&&be.extend(bi);bj=a4.setDefaults(bj,"freeColor",!1);this.base(bf,be,bj);if(!a4.get(bj,"freePosition",!1)){var bk=bf.isOrientationVertical()?"left":"bottom",bg=bf.anchorOrtho(bk);this._lockDynamic(bk,"x")._lockDynamic(bg,"y")}this._bindProperty("shape","shape")._bindProperty("shapeRadius","radius")._bindProperty("shapeSize","size");this.optional("strokeDasharray",void 0).optional("lineWidth",1.5)}).prototype.property("size").property("shape").constructor.add({y:a4.fun.constant(0),x:a4.fun.constant(0),radius:function(){this.instanceState().cccRadius=this.delegateExtension()},baseSize:function(bf){var be=this.instanceState().cccRadius;return null!=be?a4.sqr(be):this.base(bf)},defaultSize:a4.fun.constant(12),interactiveSize:function(bf,be){return this.mayShowActive(bf,!0)?2.5*Math.max(be,5):be},interactiveColor:function(bg,be,bf){if(this.mayShowActive(bg,!0)){if("stroke"===bf){return be.brighter(1)}}else{if(this.mayShowNotAmongSelected(bg)){if(this.mayShowActive(bg)){return be.alpha(0.8)}switch(bf){case"fill":return this.dimColor(be,bf);case"stroke":return be.alpha(0.45)}}}return this.base(bg,be,bf)}});a4.type("pvc.visual.DotSizeColor",aL.visual.Dot).init(function(bf,bh,bj){this.base(bf,bh,bj);var bg=this.compatVersion()<=1;this._bindProperty("lineWidth","strokeWidth").intercept("visible",function(bk){if(!this.canShow(bk)){return !1}var bl=this.delegateExtension();null==bl&&(bl=bg||this.defaultVisible(bk));return bl});this._initColor();this._initSize();if(this.isSizeBound){var bi=bf.axes.size;if(bi.scaleUsesAbs()){this.isSizeAbs=!0;var be=this._sceneDefColor;this._sceneDefColor=function(bl,bk){return"stroke"===bk&&bl.vars.size.value<0?p.Color.names.black:be.call(this,bl,bk)};this.pvMark.lineCap("round").strokeDasharray(function(bk){return bk.vars.size.value<0?"dash":null})}}}).prototype.property("strokeWidth").constructor.add({isColorBound:!1,isColorDiscrete:!1,isSizeBound:!1,isSizeAbs:!1,canShow:function(be){return !be.isIntermediate},defaultVisible:function(be){return !be.isNull&&(!this.isSizeBound&&!this.isColorBound||this.isSizeBound&&null!=be.vars.size.value||this.isColorBound&&(this.isColorDiscrete||null!=be.vars.color.value))},_initColor:function(){var bg,bi,be=this.panel,bh=be.visualRoles.color;if(bh){this.isColorDiscrete=bh.isDiscrete();var bf=be.axes.color;if(bh.isBound()){this.isColorBound=!0;bi=bf.sceneScale({sceneVarName:"color"})}else{bf&&(bg=bf.option("Unbound"))}}bi||(bi=a4.fun.constant(bg||aL.defaultColor));this._sceneDefColor=bi},_initSize:function(){var bh,bi,bf=this.panel,bj=bf.plot,bl=bj.option("Shape"),bo=bj.option("NullShape"),bn=bf.visualRoles.size;if(bn){var bk=bf.axes.size,bg=bk&&bk.scale,be=!!bg&&bn.isBound();if(be){this.isSizeBound=!0;var bm=bg.min+0.05*(bg.max-bg.min);this.nullSizeShapeHasStrokeOnly="cross"===bo;bi=function(bp){return null!=bp.vars.size.value?bl:bo};bh=function(bp){var bq=bp.vars.size.value;return null!=bq?bg(bq):bo?bm:0}}}if(!bh){bi=a4.fun.constant(bl);bh=function(bp){return this.base(bp)}}this._sceneDefSize=bh;this._sceneDefShape=bi},defaultColor:function(bf,be){return this._sceneDefColor(bf,be)},normalColor:function(bg,be,bf){return"stroke"===bf?be.darker():this.base(bg,be,bf)},interactiveColor:function(bi,be,bg){if(this.mayShowActive(bi,!0)){switch(bg){case"fill":return this.isSizeBound?be.alpha(0.75):be;case"stroke":return be.darker()}}else{if(this.showsSelection()){var bf=bi.isSelected(),bh=!bf&&bi.anySelected();if(bh){if(this.mayShowActive(bi)){return be.alpha(0.8)}switch(bg){case"fill":return this.dimColor(be,bg);case"stroke":return be.alpha(0.45)}}if(bf&&ab(be)){"stroke"===bg&&(be=be.darker(3));return be.darker(2)}}}return"stroke"===bg?be.darker():be},defaultSize:function(be){return this._sceneDefSize(be)},defaultShape:function(be){return this._sceneDefShape(be)},interactiveSize:function(bh,bf){if(!this.mayShowActive(bh,!0)){return bf}var be=Math.sqrt(bf),bg=Math.max(1,Math.min(1.1*be,2));return a4.sqr(be+bg)},defaultStrokeWidth:function(be){return this.nullSizeShapeHasStrokeOnly&&null==be.vars.size.value?1.8:1},interactiveStrokeWidth:function(bf,be){return this.mayShowActive(bf,!0)?2*be:this.mayShowSelected(bf)?1.5*be:be}});p.LineInterm=function(){p.Line.call(this)};p.LineInterm.prototype=p.extend(p.Line);p.LineInterm.prototype.getNearestInstanceToMouse=function(bh,bf){var bg=p.Line.prototype.getNearestInstanceToMouse.call(this,bh,bf),be=bh[bg];be&&be.data&&be.data.isIntermediate&&bg+1<bh.length&&bg++;return bg};a4.type("pvc.visual.Line",aL.visual.Sign).init(function(bf,bj,bi){var be=bj.add(p.LineInterm);this.base(bf,be,bi);this.lock("segmented","smart").lock("antialias",!0);if(!a4.get(bi,"freePosition",!1)){var bg=bf.isOrientationVertical()?"left":"bottom",bh=bf.anchorOrtho(bg);this._lockDynamic(bh,"y")._lockDynamic(bg,"x")}this._bindProperty("strokeStyle","strokeColor","color")._bindProperty("lineWidth","strokeWidth")}).prototype.property("strokeWidth").constructor.add({_addInteractive:function(be){be=a4.setDefaults(be,"noTooltip",!0);this.base(be)},y:a4.fun.constant(0),x:a4.fun.constant(0),defaultStrokeWidth:a4.fun.constant(1.5),interactiveStrokeWidth:function(be,bf){return this.mayShowActive(be)?2.5*Math.max(1,bf):bf},interactiveColor:function(bg,be,bf){return this.mayShowNotAmongSelected(bg)?this.mayShowActive(bg)?p.Color.names.darkgray.darker().darker():this.dimColor(be,bf):this.base(bg,be,bf)}});p.AreaInterm=function(){p.Area.call(this)};p.AreaInterm.prototype=p.extend(p.Area);p.AreaInterm.prototype.getNearestInstanceToMouse=function(bh,bf){var bg=p.Area.prototype.getNearestInstanceToMouse.call(this,bh,bf),be=bh[bg];be&&be.data&&be.data.isIntermediate&&bg+1<bh.length&&bg++;return bg};a4.type("pvc.visual.Area",aL.visual.Sign).init(function(bg,bk,bj){var be=bk.add(p.AreaInterm);bj||(bj={});bj.freeColor=!0;this.base(bg,be,bj);var bf=a4.get(bj,"antialias",!0);this.lock("segmented","smart").lock("antialias",bf);if(!a4.get(bj,"freePosition",!1)){var bh=bg.isOrientationVertical()?"left":"bottom",bi=bg.anchorOrtho(bh),bl=bg.anchorOrthoLength(bi);this._lockDynamic(bh,"x")._lockDynamic(bi,"y")._lockDynamic(bl,"dy")}this._bindProperty("fillStyle","fillColor","color");this.lock("strokeStyle",null).lock("lineWidth",0)}).add({_addInteractive:function(be){be=a4.setDefaults(be,"noTooltip",!0);this.base(be)},y:a4.fun.constant(0),x:a4.fun.constant(0),dy:a4.fun.constant(0),interactiveColor:function(bg,be,bf){return"fill"===bf&&this.mayShowNotAmongSelected(bg)?this.dimColor(be,bf):this.base(bg,be,bf)}});a4.type("pvc.visual.Bar",aL.visual.Sign).init(function(bf,bh,bg){var be=bh.add(p.Bar);bg=a4.setDefaults(bg,"freeColor",!1);this.base(bf,be,bg);this.normalStroke=a4.get(bg,"normalStroke",!1);this._bindProperty("lineWidth","strokeWidth")}).prototype.property("strokeWidth").constructor.add({normalColor:function(bg,be,bf){return"stroke"!==bf||this.normalStroke?be:null},interactiveColor:function(bg,be,bf){if("stroke"===bf){if(this.mayShowActive(bg,!0)){return be.brighter(1.3).alpha(0.7)}if(!this.normalStroke){return null}if(this.mayShowNotAmongSelected(bg)){return this.mayShowActive(bg)?p.Color.names.darkgray.darker().darker():this.dimColor(be,bf)}if(this.mayShowActive(bg)){return be.brighter(1).alpha(0.7)}}else{if("fill"===bf){if(this.mayShowActive(bg,!0)){return be.brighter(0.2).alpha(0.8)}if(this.mayShowNotAmongSelected(bg)){return this.mayShowActive(bg)?p.Color.names.darkgray.darker(2).alpha(0.8):this.dimColor(be,bf)}if(this.mayShowActive(bg)){return be.brighter(0.2).alpha(0.8)}}}return this.base(bg,be,bf)},defaultStrokeWidth:function(){return 0.5},interactiveStrokeWidth:function(be,bf){return this.mayShowActive(be,!0)?1.3*Math.max(1,bf):bf}});p.PieSlice=function(){p.Wedge.call(this)};p.PieSlice.prototype=p.extend(p.Wedge).property("offsetRadius");p.PieSlice.prototype.midAngle=function(){var be=this.instance();return be.startAngle+be.angle/2};p.PieSlice.prototype.defaults=new p.PieSlice().extend(p.Wedge.prototype.defaults).offsetRadius(0);a4.type("pvc.visual.PieSlice",aL.visual.Sign).init(function(bf,bh,bg){var be=bh.add(p.PieSlice);bg=a4.setDefaults(bg,"freeColor",!1);this.base(bf,be,bg);this._activeOffsetRadius=a4.get(bg,"activeOffsetRadius",0);this._maxOffsetRadius=a4.get(bg,"maxOffsetRadius",0);this._resolvePctRadius=a4.get(bg,"resolvePctRadius");this._center=a4.get(bg,"center");this.optional("lineWidth",0.6)._bindProperty("angle","angle")._bindProperty("offsetRadius","offsetRadius")._lockDynamic("bottom","y")._lockDynamic("left","x").lock("top",null).lock("right",null)}).prototype.property("offsetRadius").constructor.add({angle:a4.fun.constant(0),x:function(){return this._center.x+this._offsetSlice("cos")},y:function(){return this._center.y-this._offsetSlice("sin")},_offsetSlice:function(be){var bf=this.pvMark.offsetRadius()||0;bf&&(bf*=Math[be](this.pvMark.midAngle()));return bf},defaultColor:function(bf,be){return"stroke"===be?null:this.base(bf,be)},interactiveColor:function(bg,be,bf){if(this.mayShowActive(bg,!0)){switch(bf){case"fill":return be.brighter(0.2).alpha(0.8);case"stroke":return be.brighter(1.3).alpha(0.7)}}else{if(this.mayShowNotAmongSelected(bg)&&"fill"===bf){return this.dimColor(be,bf)}}return this.base(bg,be,bf)},offsetRadius:function(bf){var be=this.base(bf);return Math.min(Math.max(0,be),this._maxOffsetRadius)},baseOffsetRadius:function(bf){var be=this.base(bf)||0;return this._resolvePctRadius(l.parse(be))},interactiveOffsetRadius:function(bf,be){return be+(this.mayShowActive(bf,!0)?this._activeOffsetRadius:0)}});a4.type("pvc.visual.Rule",aL.visual.Sign).init(function(bf,bg,bi){var be=bg.add(p.Rule),bh=a4.get(bi,"proto");bh&&be.extend(bh);this.base(bf,be,bi);a4.get(bi,"freeStyle")||this._bindProperty("strokeStyle","strokeColor","color")._bindProperty("lineWidth","strokeWidth")}).prototype.property("strokeWidth").constructor.add({_addInteractive:function(bf){var be=!0;bf=a4.setDefaults(bf,"noHover",be,"noSelect",be,"noTooltip",be,"noClick",be,"noDoubleClick",be,"showsInteraction",!1);this.base(bf)},defaultStrokeWidth:a4.fun.constant(1),interactiveStrokeWidth:function(be,bf){return this.mayShowActive(be,!0)?2.2*Math.max(1,bf):bf},interactiveColor:function(bg,be,bf){return bg.datum&&!this.mayShowActive(bg,!0)&&this.mayShowNotAmongSelected(bg)?this.dimColor(be,bf):this.base(bg,be,bf)}});a4.type("pvc.visual.OptionsBase").init(function(bi,bh,bf,bg){this.chart=bi;this.type=bh;this.index=null==bf?0:bf;this.name=a4.get(bg,"name");this.id=this._buildId();this.optionId=this._buildOptionId();var be=this._resolvers=[];this._registerResolversFull(be,bg);this.option=aL.options(this._getOptionsDefinition(),this)}).add({_buildId:function(){return aL.buildIndexedId(this.type,this.index)},_buildOptionId:function(){return this.id},_chartOption:function(be){return this.chart.options[be]},_getOptionsDefinition:a4.method({isAbstract:!0}),_registerResolversFull:function(be,bf){var bg=a4.get(bf,"fixed");if(bg){this._fixed=bg;be.push(aL.options.specify(function(bi){return bg[bi.name]}))}this._registerResolversNormal(be,bf);var bh=a4.get(bf,"defaults");bh&&(this._defaults=bh);be.push(this._resolveDefault)},_registerResolversNormal:function(be,bf){a4.get(bf,"byV1",!0)&&this.chart.compatVersion()<=1&&be.push(this._resolveByV1OnlyLogic);this.name&&be.push(aL.options.specify(function(bg){return this._chartOption(this.name+a4.firstUpperCase(bg.name))}));be.push(this._resolveByOptionId);a4.get(bf,"byNaked",!this.index)&&be.push(this._resolveByNaked)},_resolveFull:function(bh){for(var bf=this._resolvers,bg=0,be=bf.length;be>bg;bg++){if(bf[bg].call(this,bh)){return !0}}return !1},_resolveFixed:aL.options.specify(function(be){return this._fixed?this._fixed[be.name]:void 0}),_resolveByV1OnlyLogic:function(bg){var bf,be=bg.data;return be&&(bf=be.resolveV1)?bf.call(this,bg):void 0},_resolveByName:aL.options.specify(function(be){return this.name?this._chartOption(this.name+a4.firstUpperCase(be.name)):void 0}),_resolveByOptionId:aL.options.specify(function(be){return this._chartOption(this.optionId+a4.firstUpperCase(be.name))}),_resolveByNaked:aL.options.specify(function(be){return this.index?void 0:this._chartOption(a4.firstLowerCase(be.name))}),_resolveDefault:function(bh){var bg,bf=bh.data;if(bf&&(bg=bf.resolveDefault)&&bg.call(this,bh)){return !0}if(this._defaults){var be=this._defaults[bh.name];if(void 0!==be){bh.defaultValue(be);return !0}}},_specifyChartOption:function(bg,be){var bf=this._chartOption(be);if(null!=bf){bg.specify(bf);return !0}}});a4.type("pvc.visual.MultiChart",aL.visual.OptionsBase).init(function(be){this.base(be,"multiChart",0,{byV1:!1,byNaked:!1})}).add({_getOptionsDefinition:function(){return aL.visual.MultiChart.optionsDef}}).addStatic({optionsDef:{Max:{resolve:"_resolveFull",cast:aL.castPositiveNumber,value:1/0},ColumnsMax:{resolve:"_resolveFull",cast:aL.castPositiveNumber,value:3},SingleRowFillsHeight:{resolve:"_resolveFull",cast:Boolean,value:!0},SingleColFillsHeight:{resolve:"_resolveFull",cast:Boolean,value:!0},Overflow:{resolve:"_resolveFull",cast:aL.parseMultiChartOverflow,value:"grow"}}});a4.type("pvc.visual.SmallChart",aL.visual.OptionsBase).init(function(be){this.base(be,"small",0,{byV1:!1,byNaked:!1})}).add({_getOptionsDefinition:function(){return aL.visual.SmallChart.optionsDef}}).addStatic({optionsDef:{Width:{resolve:"_resolveFull",cast:l.parse,value:null},Height:{resolve:"_resolveFull",cast:l.parse,value:null},AspectRatio:{resolve:"_resolveFull",cast:aL.castPositiveNumber,getDefault:function(){return this.chart instanceof aL.PieChart?10/7:5/4}},Margins:{resolve:"_resolveFull",cast:aD.as,value:new aD(new l(0.02))},Paddings:{resolve:"_resolveFull",cast:aD.as,value:0}}});var bd=a4.type("pvc.visual.Axis",aL.visual.OptionsBase).init(function(bh,bg,be,bf){this.base(bh,bg,be,bf);bh._addAxis(this)}).add({scaleTreatsNullAs:function(){return"null"},scaleNullRangeValue:function(){return null},scaleUsesAbs:a4.retFalse,scaleSumNormalized:a4.retFalse,domainVisibleOnly:a4.retTrue,domainIgnoreNulls:a4.retFalse,domainGroupOperator:function(){return"flatten"},domainItemValueProp:function(){return"value"},bind:function(be){var bf=this;be||a4.fail.argumentRequired("dataCells");!bf.dataCells||a4.fail.operationInvalid("Axis is already bound.");bf.dataCells=a4.array.to(be);bf.dataCell=bf.dataCells[0];bf.role=bf.dataCell&&bf.dataCell.role;bf.scaleType=aM(bf.role.grouping);bf._domainData=null;bf._domainValues=null;bf._domainItems=null;bf._checkRoleCompatibility();return this},domainData:function(){this.isBound()||a4.fail.operationInvalid("Axis is not bound.");var bf=this._domainData;if(!bf){var be=this.dataCells.map(j),bg=this.chart.partData(be);this._domainData=bf=this._createDomainData(bg)}return bf},domainCellData:function(be){var bf=this.dataCells;if(1===bf.length){return this.domainData()}var bh=bf[be],bg=this.chart.partData(bh.dataPartValue);return this._createDomainData(bg)},domainCellItems:function(bg){var bf=this.dataCells;if(1===bf.length){return this.domainItems()}var be;be="number"==typeof bg?this.domainCellData(bg):bg;return this._selectDomainItems(be).array()},domainValues:function(){var be=this._domainValues;if(!be){this._calcDomainItems();be=this._domainValues}return be},domainItems:function(){var be=this._domainItems;if(!be){this._calcDomainItems();be=this._domainItems}return be},domainItemValue:function(be){return a4.nullyTo(be[this.domainItemValueProp()],"")},isDiscrete:function(){return !!this.role&&this.role.isDiscrete()},isBound:function(){return !!this.role},setScale:function(be,bf){this.isBound()||a4.fail.operationInvalid("Axis is not bound.");this.scale=be?bf?be:this._wrapScale(be):null;return this},_wrapScale:function(bi){bi.type=this.scaleType;var bh;if("discrete"!==bi.type){var be=this.scaleUsesAbs(),bf=this.scaleTreatsNullAs();if(bf&&"null"!==bf){var bg="min"===bf;bh=be?function(bk){return bi(null==bk?bg?bi.domain()[0]:0:0>bk?-bk:bk)}:function(bk){return bi(null==bk?bg?bi.domain()[0]:0:bk)}}else{var bj=this.scaleNullRangeValue();bh=be?function(bk){return null==bk?bj:bi(0>bk?-bk:bk)}:function(bk){return null==bk?bj:bi(bk)}}}else{bh=function(bk){return bi(null==bk?"":bk)}}return a4.copy(bh,bi)},sceneScale:function(bf){var bj=a4.get(bf,"sceneVarName")||this.role.name,bg=this.role.grouping;if(bg.isSingleDimension&&bg.firstDimensionValueType()===Number){var bi=this.scale,be=a4.get(bf,"nullToZero",!0),bh=function(bl){var bk=bl.vars[bj].value;if(null==bk){if(!be){return bk}bk=0}return bi(bk)};a4.copy(bh,bi);return bh}return this.scale.by1(function(bk){return bk.vars[bj].value})},_checkRoleCompatibility:function(){var be=this.dataCells.length;if(be>1){var bh,bf,bg=this._getBoundRoleGrouping(this.role);if("discrete"===this.scaleType){for(bf=1;be>bf;bf++){bh=this._getBoundRoleGrouping(this.dataCells[bf].role);if(bg.id!==bh.id){throw a4.error.operationInvalid("Discrete roles on the same axis must have equal groupings.")}}}else{if(!bg.firstDimensionType().isComparable){throw a4.error.operationInvalid("Continuous roles on the same axis must have 'comparable' groupings.")}for(bf=1;be>bf;bf++){bh=this._getBoundRoleGrouping(this.dataCells[bf].role);if(this.scaleType!==aM(bh)){throw a4.error.operationInvalid("Continuous roles on the same axis must have scales of the same type.")}}}}},_getBoundRoleGrouping:function(bf){var be=bf.grouping;if(!be){throw a4.error.operationInvalid("Axis' role '"+bf.name+"' is unbound.")}return be},_createDomainData:function(bf){var be={visible:this.domainVisibleOnly()?!0:null,isNull:this.chart.options.ignoreNulls||this.domainIgnoreNulls()?!1:null};return this.role[this.domainGroupOperator()](bf,be)},_selectDomainItems:function(be){return be.children()},_calcDomainItems:function(){var be=a4.hasOwnProp,bg={},bi=[],bf=[],bh=(this.domainItemValueProp(),this.domainData());this._selectDomainItems(bh).each(function(bj){var bk=this.domainItemValue(bj);if(!be.call(bg,bk)){bg[bk]=1;bi.push(bk);bf.push(bj)}},this);this._domainItems=bf;this._domainValues=bi},_getOptionsDefinition:function(){return aV}}),aV={},aO=a4.type("pvc.visual.CartesianAxis",bd).init(function(bj,bi,bf,bh){var be=bj.options;this.orientation=aO.getOrientation(bi,be.orientation);this.orientedId=aO.getOrientedId(this.orientation,bf);bj._allowV1SecondAxis&&1===bf&&(this.v1SecondOrientedId="second"+this.orientation.toUpperCase());this.base(bj,bi,bf,bh);var bg=this.extensionPrefixes=[this.id+"Axis",this.orientedId+"Axis"];this.v1SecondOrientedId&&bg.push(this.v1SecondOrientedId+"Axis");this._extPrefAxisPosition=bg.length;bg.push("axis")}).add({bind:function(be){this.base(be);this._syncExtensionPrefixes();return this},_syncExtensionPrefixes:function(){var bf=this.extensionPrefixes;bf.length=this._extPrefAxisPosition;var be=this.scaleType;if(be){bf.push(be+"Axis");"discrete"!==be&&bf.push("continuousAxis")}bf.push("axis")},setScale:function(bh){var bf=this.scale;this.base(bh);if(bf){delete this.domain;delete this.ticks;delete this._roundingPaddings}if(bh&&!bh.isNull&&"discrete"!==this.scaleType){this.domain=bh.domain();this.domain.minLocked=!!bh.minLocked;this.domain.maxLocked=!!bh.maxLocked;var be=this.option("DomainRoundMode");"nice"===be&&bh.nice();var bg=this.option("TickFormatter");bg&&bh.tickFormatter(bg)}return this},setTicks:function(bf){var bg=this.scale;bg&&!bg.isNull||a4.fail.operationInvalid("Scale must be set and non-null.");this.ticks=bf;if("discrete"!==bg.type&&"tick"===this.option("DomainRoundMode")){delete this._roundingPaddings;var be=bf&&bf.length;be?this.scale.domain(bf[0],bf[be-1]):this.scale.domain(this.domain[0],this.domain[1])}},setScaleRange:function(bf){var bg=this.scale;bg.min=0;bg.max=bf;bg.size=bf;if("discrete"===bg.type){if(bg.domain().length>0){var be=this.chart.options.panelSizeRatio||0.8;bg.splitBandedCenter(bg.min,bg.max,be)}}else{bg.range(bg.min,bg.max)}return bg},getScaleRoundingPaddings:function(){var bf=this._roundingPaddings;if(!bf){bf={begin:0,end:0,beginLocked:!1,endLocked:!1};var bj=this.scale;if(bj&&!bj.isNull&&"discrete"!==bj.type){var bg=this.domain;bf.beginLocked=bg.minLocked;bf.endLocked=bg.maxLocked;if("numeric"===bj.type&&"none"!==this.option("DomainRoundMode")){var be=bj.domain(),bh=this.domain||a4.assert("Original domain must be set"),bk=be[1]-be[0];if(bk){var bi=bh[0]-be[0];bi>0&&(bf.begin=bi/bk);bi=be[1]-bh[1];bi>0&&(bf.end=bi/bk)}}}this._roundingPaddings=bf}return bf},calcContinuousTicks:function(be){null==be&&(be=this.option("DesiredTickCount"));return this.scale.ticks(be,{roundInside:"tick"!==this.option("DomainRoundMode"),numberExponentMin:this.option("TickExponentMin"),numberExponentMax:this.option("TickExponentMax")})},_getOptionsDefinition:function(){return aw},_buildOptionId:function(){return this.id+"Axis"},_registerResolversNormal:function(be){this.chart.compatVersion()<=1&&be.push(this._resolveByV1OnlyLogic);be.push(this._resolveByOptionId,this._resolveByOrientedId);1===this.index&&be.push(this._resolveByV1OptionId);be.push(this._resolveByScaleType,this._resolveByCommonId)},_resolveByOrientedId:aL.options.specify(function(be){return this._chartOption(this.orientedId+"Axis"+be.name)}),_resolveByV1OptionId:aL.options.specify(function(be){return this._chartOption("secondAxis"+be.name)}),_resolveByScaleType:aL.options.specify(function(bh){var bf=this.scaleType;if(bf){var be=bh.name,bg=this._chartOption(bf+"Axis"+be);void 0===bg&&"discrete"!==bf&&(bg=this._chartOption("continuousAxis"+be));return bg}}),_resolveByCommonId:aL.options.specify(function(be){return this._chartOption("axis"+be.name)})});aO.getOrientation=function(bf,be){return"base"===bf==("vertical"===be)?"x":"y"};aO.getOrientedId=function(be,bf){return 0===bf?be:be+(bf+1)};var ba={resolve:"_resolveFull",data:{resolveV1:function(be){this.index||"ortho"!==this.type||this._specifyChartOption(be,this.id+be.name);return !0}}},aN={resolveV1:function(be){if(this.index){if(this._resolveByV1OptionId(be)){return !0}}else{if(this._resolveByOrientedId(be)){return !0}}this._resolveDefault(be);return !0}},c=aL.options.defaultValue(function(){if(!this.typeIndex){return"x"===this.orientation?"bottom":"left"}var bf=this.chart.axesByType[this.type].first,be=bf.option("Position");return aL.BasePanel.oppositeAnchor[be]}),aw=a4.create(aV,{Visible:{resolve:"_resolveFull",data:{resolveV1:function(bf){if(this.index<=1){var be=0===this.index?a4.firstUpperCase(this.orientation):"Second";this._specifyChartOption(bf,"show"+be+"Scale")}return !0}},cast:Boolean,value:!0},Composite:{resolve:function(be){if(this.index>0){be.specify(!1);return !0}return this._resolveFull(be)},data:{resolveV1:function(be){this._specifyChartOption(be,"useCompositeAxis");return !0}},cast:Boolean,value:!1},Size:{resolve:"_resolveFull",data:aN,cast:a0},SizeMax:{resolve:"_resolveFull",cast:a0},Position:{resolve:"_resolveFull",data:{resolveV1:aN.resolveV1,resolveDefault:c},cast:ap},FixedMin:ba,FixedMax:ba,OriginIsZero:{resolve:"_resolveFull",data:{resolveV1:function(be){switch(this.index){case 0:this._specifyChartOption(be,"originIsZero");break;case 1:this.chart._allowV1SecondAxis&&this._specifyChartOption(be,"secondAxisOriginIsZero")}return !0}},cast:Boolean,value:!0},DomainScope:{resolve:"_resolveFull",cast:av,value:"global"},Offset:{resolve:"_resolveFull",data:{resolveV1:function(be){switch(this.index){case 0:this._specifyChartOption(be,"axisOffset");break;case 1:if(this.chart._allowV1SecondAxis){this._specifyChartOption(be,"secondAxisOffset");break}}return !0}},cast:aL.castNumber},LabelSpacingMin:{resolve:"_resolveFull",cast:aL.castNumber},OverlappedLabelsMode:{resolve:"_resolveFull",cast:aL.parseOverlappedLabelsMode,value:"rotatethenhide"},Grid:{resolve:"_resolveFull",data:{resolveV1:function(be){this.index||this._specifyChartOption(be,this.orientation+"AxisFullGrid");return !0}},cast:Boolean,value:!1},GridCrossesMargin:{resolve:"_resolveFull",cast:Boolean,value:!0},EndLine:{resolve:"_resolveFull",cast:Boolean},ZeroLine:{resolve:"_resolveFull",cast:Boolean,value:!0},RuleCrossesMargin:{resolve:"_resolveFull",cast:Boolean,value:!0},Ticks:{resolve:"_resolveFull",cast:Boolean},DesiredTickCount:{resolve:"_resolveFull",data:{resolveV1:aN.resolveV1,resolveDefault:function(be){if(this.chart.compatVersion()<=1){be.defaultValue(5);return !0}}},cast:aL.castNumber},MinorTicks:{resolve:"_resolveFull",data:aN,cast:Boolean,value:!0},TickFormatter:{resolve:"_resolveFull",cast:a4.fun.as},DomainRoundMode:{resolve:"_resolveFull",data:{resolveV1:aN.resolveV1,resolveDefault:function(be){if(this.chart.compatVersion()<=1){be.defaultValue("none");return !0}}},cast:aL.parseDomainRoundingMode,value:"tick"},TickExponentMin:{resolve:"_resolveFull",cast:aL.castNumber},TickExponentMax:{resolve:"_resolveFull",cast:aL.castNumber},Title:{resolve:"_resolveFull",cast:String},TitleSize:{resolve:"_resolveFull",cast:al},TitleSizeMax:{resolve:"_resolveFull",cast:al},TitleFont:{resolve:"_resolveFull",cast:String},TitleMargins:{resolve:"_resolveFull",cast:aD.as},TitlePaddings:{resolve:"_resolveFull",cast:aD.as},TitleAlign:{resolve:"_resolveFull",cast:function(bf){var be=this.option("Position");return aL.parseAlign(be,bf)}},Font:{resolve:"_resolveFull",cast:String},ClickAction:{resolve:"_resolveFull",data:aN},DoubleClickAction:{resolve:"_resolveFull",data:aN},TooltipEnabled:{resolve:"_resolveFull",cast:Boolean,value:!0},TooltipFormat:{resolve:"_resolveFull",cast:a4.fun.as,value:null},TooltipAutoContent:{resolve:"_resolveFull",cast:aL.parseTooltipAutoContent,value:"value"}});a4.type("pvc.visual.CartesianAxisRootScene",aL.visual.Scene);a4.type("pvc.visual.CartesianAxisTickScene",aL.visual.Scene).init(function(bf,be){this.base(bf,be);this.vars.tick=new Y(a4.get(be,"tick"),a4.get(be,"tickLabel"),a4.get(be,"tickRaw"));a4.get(be,"isHidden")&&(this.isHidden=!0)}).add({isHidden:!1});a4.type("pvc.visual.CartesianFocusWindow",aL.visual.OptionsBase).init(function(be){this.base(be,"focusWindow",0,{byNaked:!1});var bf=be.axes.base;this.base=new aL.visual.CartesianFocusWindowAxis(this,bf)}).add({_getOptionsDefinition:function(){return K},_exportData:function(){return{base:a4.copyProps(this.base,aL.visual.CartesianFocusWindow.props)}},_importData:function(be){var bf=be.base;this.base.option.specify({Begin:bf.begin,End:bf.end,Length:bf.length})},_initFromOptions:function(){this.base._initFromOptions()},_onAxisChanged:function(){var be=this.option("Changed");be&&be.call(this.chart.basePanel.context())}});var K=a4.create(aV,{Changed:{resolve:"_resolveFull",cast:a4.fun.as}});a4.type("pvc.visual.CartesianFocusWindowAxis",aL.visual.OptionsBase).init(function(bf,be){this.window=bf;this.axis=be;this.isDiscrete=be.isDiscrete();this.base(be.chart,"focusWindow"+a4.firstUpperCase(be.type),0,{byNaked:!1})}).addStatic({props:["begin","end","length"]}).add({_getOptionsDefinition:function(){return V},_initFromOptions:function(){var be=this.option;this.set({begin:be("Begin"),end:be("End"),length:be("Length")})},set:function(bm){var bx,bw,bs,bz=this,bB=a4.get(bm,"render"),bo=a4.get(bm,"select",!0);bm=bz._readArgs(bm);if(bm){bx=bm.begin;bw=bm.end;bs=bm.length}else{if(null!=this.begin&&null!=this.end&&null!=this.length){return}}var by,bl,bf=bz.axis,bA=bf.scale,bk=bz.isDiscrete,bg=bk?null:bf.role.firstDimensionType().cast,bC=bA.domain();if(bk){bl=bC.length;var bp,bn,bq;if(null!=bx){var bj=+bx;if(!isNaN(bj)){if(1/0===bj){bp=bl-1;bx=bC[bp]}else{if(bj===-1/0){bp=0;bx=bC[bp]}}}if(null==bp){bp=bC.indexOf(""+bx);if(0>bp){bp=0;bx=bC[bp]}}}if(null!=bw){var bh=+bw;if(!isNaN(bh)){if(1/0===bh){bn=bl-1;bw=bC[bn]}else{if(bh===-1/0){bn=0;bw=bC[bn]}}}if(null==bn){bn=bC.indexOf(""+bw);if(0>bn){bn=bl-1;bw=bC[bn]}}}if(null!=bs){bs=+bs;if(isNaN(bs)){bs=null}else{if(0>bs&&(null!=bx||null!=bw)){by=bx;bq=bp;bx=bw,bp=bn,bw=by,bn=bq;bs=-bs}}}if(null!=bx){if(null!=bw){if(bp>bn){by=bx;bq=bp;bx=bw,bp=bn,bw=by,bn=bq}bs=bn-bp+1}else{null==bs&&(bs=bl-bp);bn=bp+bs-1;if(bn>bl-1){bn=bl-1;bs=bn-bp+1}bw=bC[bn]}}else{if(null!=bw){null==bs&&(bs=bn);bp=bn-bs+1;if(0>bp){bp=0;bs=bn-bp+1}bx=bC[bp]}else{null==bs&&(bs=Math.max(~~(bl/3),1));if(bs>bl){bs=bl;bp=0;bn=bl-1}else{bq=~~(bl/2);bp=bq-~~(bs/2);bn=bp+bs-1}bx=bC[bp];bw=bC[bn]}}}else{if(null!=bs){bs=+bs;if(isNaN(bs)){bs=null}else{if(0>bs&&(null!=bx||null!=bw)){by=bx;bx=bw,bw=by;bs=-bs}}}var br=bC[0],bt=bC[1];bl=bt-br;if(null!=bx){br>bx&&(bx=br);bx>bt&&(bx=bt)}if(null!=bw){br>bw&&(bw=br);bw>bt&&(bw=bt)}if(null!=bx){if(null!=bw){if(bx>bw){by=bx;bx=bw,bw=by}bs=bw-bx}else{null==bs&&(bs=bt-bx);bw=bx+bs;if(bw>bt){bw=bt;bs=bw-bx}}}else{if(null!=bw){null==bs&&(bs=bw-br);bx=bw-bs;if(br>bx){bx=br;bs=bw-bx}}else{null==bs&&(bs=Math.max(~~(bl/3),1));if(bs>bl){bs=bl;bx=br;bw=bt}else{by=~~(bl/2);bx=by-~~(bs/2);var bv=+bx,bi=+bs;bw=bv+bi}}}bx=bg(bx);bw=bg(bw);bs=bg(bs);var be=bz.option("Constraint");if(be){var bu={type:"new",target:"begin",value:bx,length:bs,length0:bs,min:br,max:bt,minView:br,maxView:bt};be(bu);bx=bg(bu.value);bs=bg(bu.length);var bv=+bx,bi=+bs;bw=bg(bv+bi)}}bz._set(bx,bw,bs,bo,bB)},_updatePosition:function(bm,bf,bq,bg){var bp,bn,bk,bo=this,bi=bo.axis,bj=bi.scale;if(bo.isDiscrete){var bh=bj.invertIndex(bm),be=bj.invertIndex(bf)-1,bl=bj.domain();bp=bl[bh];bn=bl[be];bk=be-bh+1}else{bp=bj.invert(bm);bn=bj.invert(bf);bk=bn-bp}this._set(bp,bn,bk,bq,bg)},_constraintPosition:function(bt){var be,bz=this,bk=bz.axis,bA=bk.scale;if(bz.isDiscrete){var bq=Math.floor(bA.invertIndex(bt.point,!0));if(bq>=0){var bv=bA.range(),bs=bA.domain().length,bo=(bv.max-bv.min)/bs;bq>=bs&&("new"===bt.type||"resize-begin"===bt.type)&&(bq=bs-1);bt.point=bq*bo}}else{if(be=bz.option("Constraint")){var bi,bj,bn,bm=bk.role.firstDimensionType().cast,bu=bm(bA.invert(bt.point)),by="begin"===bt.target?1:-1,bB=bt.point+by*bt.length,bw=bm(bA.invert(bB)),bg=bm(by*(bw-bu));if(bt.length===bt.length0){bi=bg}else{bj=bt.point+by*bt.length0;bn=bm(bA.invert(bj));bi=by*(bn-bu)}var bp=bm(bA.invert(bt.min)),br=bm(bA.invert(bt.max)),bx={type:bt.type,target:bt.target,value:bu,length:bg,length0:bi,min:bp,max:br,minView:bm(bA.invert(bt.minView)),maxView:bm(bA.invert(bt.maxView))};be(bx);if(+bx.value!==+bu){bu=bx.value;bt.point=bA(bu)}var bf=bx.length;if(+bf!==+bg){if(+bf===+bi){bt.length=bt.length0}else{var bl=+bu+by*+bf,bh=bA(bl);bt.length=bh-by*bt.point}}+bx.min!==+bp&&(bt.min=bA(bx.min));+bx.max!==+br&&(bt.max=bA(bx.max))}}},_compare:function(bf,be){return this.isDiscrete?""+bf==""+be:+bf===+be},_set:function(bf,bj,bg,be,bh){var bi=this,bk=!1;if(!bi._compare(bf,bi.begin)){bi.begin=bf;bk=!0}if(!bi._compare(bj,bi.end)){bi.end=bj;bk=!0}if(!bi._compare(bg,bi.length)){bi.length=bg;bk=!0}bk&&bi.window._onAxisChanged(this);be&&bi._updateSelection({render:bh});return bk},_readArgs:function(bf){if(bf){var be={},bh=0,bg=function(bj){var bi=bf[bj];null!=bi?bh=!0:bi=this[bj];be[bj]=bi};aL.visual.CartesianFocusWindowAxis.props.forEach(bg,this);if(bh){return be}}},_updateSelection:function(bl){var bf,bm,bo=this,bg=bo.axis,bp=bg.isDiscrete(),bn=bg.chart,bs=bg.dataCell,bk=bs.role,be=bn.partData(bs.dataPartValue);if(bp){bm=bk.flatten(be);var bj=bm.child(bo.begin),br=bm.child(bo.end);if(bj&&br){var bi=bj.childIndex(),bq=br.childIndex();bf=a4.range(bi,bq-bi+1).select(function(bt){return bm.childNodes[bt]}).selectMany(a4.propGet("_datums")).where(ay).distinct(a4.propGet("key"))}}else{bm=be;var bh=bk.firstDimensionName();bf=a4.query(be._datums).where(ay).where(function(bu){var bt=bu.atoms[bh].value;return null!=bt&&bt>=bo.begin&&bt<=bo.end})}if(bf){bn.data.replaceSelected(bf);bn.root.updateSelections(bl)}}});var V=a4.create(aV,{Resizable:{resolve:"_resolveFull",cast:Boolean,value:!0},Movable:{resolve:"_resolveFull",cast:Boolean,value:!0},Begin:{resolve:"_resolveFull"},End:{resolve:"_resolveFull"},Length:{resolve:"_resolveFull"},Constraint:{resolve:"_resolveFull",cast:a4.fun.as}});a4.type("pvc.visual.ColorAxis",bd).add({scaleNullRangeValue:function(){return this.option("Missing")||null},scaleUsesAbs:function(){return this.option("UseAbs")},domainVisibleOnly:function(){return"discrete"!==this.scaleType},bind:function(be){this.base(be);this._legendGroupScene=null;this._plotList=a4.query(be).select(function(bf){return bf.plot}).distinct(function(bf){return bf&&bf.id}).array();return this},_wrapScale:function(bf){var bg;bg="discrete"===this.scaleType?this.option.isSpecified("Transform")||!this.option.isSpecified("Colors")&&!this.option.isSpecified("Map"):!0;if(bg){var be=this.option("Transform");be&&(bf=bf.transform(be))}return this.base(bf)},scheme:function(){return a4.lazy(this,"_scheme",this._createScheme,this)},_createColorMapFilter:function(be){var bf=a4.uniqueIndex(be,function(bg){return bg.key});return{domain:function(bg){return !a4.hasOwn(be,bg)},color:function(bg){return !a4.hasOwn(bf,bg.key)}}},_getBaseScheme:function(){return this.option("Colors")},_createScheme:function(){var bh=this,bf=bh._getBaseScheme();if("discrete"!==bh.scaleType){return function(){var bi=bf.apply(null,arguments);return bh._wrapScale(bi)}}var be=bh.option("Map");if(!be){return function(){var bi=bf.apply(null,arguments);return bh._wrapScale(bi)}}var bg=this._createColorMapFilter(be);return function(bn){var bm;bn instanceof Array||(bn=a4.array.copy(arguments));bn=bn.filter(bg.domain);var bk=bf(bn),bj=bk.range().filter(bg.color);bk.range(bj);bm=function(bo){var bp=a4.getOwn(be,bo);return bp||bk(bo)};a4.copy(bm,bk);var bi,bl;bm.domain=function(){if(arguments.length){throw a4.operationInvalid("The scale cannot be modified.")}bi||(bi=a4.array.append(a4.ownKeys(be),bn));return bi};bm.range=function(){if(arguments.length){throw a4.operationInvalid("The scale cannot be modified.")}bl||(bl=a4.array.append(a4.own(be),bj));return bl};return bh._wrapScale(bm)}},sceneScale:function(bf){var bh=a4.get(bf,"sceneVarName")||this.role.name,bg=this.scalesByCateg;if(bg){var be=this.option("Missing");return function(bk){var bi=bk.vars[bh].value;if(null==bi){return be}var bj=bk.group.parent.absKey;return bg[bj](bi)}}return this.scale.by1(function(bi){return bi&&bi.vars[bh].value})},_buildOptionId:function(){return this.id+"Axis"},_getOptionsDefinition:function(){return f},_resolveByNaked:aL.options.specify(function(be){return this.index?void 0:this._chartOption(this.id+a4.firstUpperCase(be.name))}),_specifyV1ChartOption:function(bf,be){return !this.index&&this.chart.compatVersion()<=1&&this._specifyChartOption(bf,be)?!0:void 0}});var aC,r={resolveDefault:function(be){return !this.index&&this._specifyChartOption(be,a4.firstLowerCase(be.name))?!0:void 0}},f=a4.create(aV,{Colors:{resolve:"_resolveFull",getDefault:y,data:{resolveV1:function(be){"discrete"===this.scaleType?0===this.index?this._specifyChartOption(be,"colors"):1===this.index&&this.chart._allowV1SecondAxis&&this._specifyChartOption(be,"secondAxisColor"):this._specifyChartOption(be,"colorRange");return !0},resolveDefault:function(be){0===this.index&&this._specifyChartOption(be,"colors")}},cast:aL.colorScheme},Map:{resolve:"_resolveFull",cast:aP},Transform:{resolve:"_resolveFull",data:{resolveDefault:function(bg){var bf=this._plotList;if(bf.length<=2){var be=a4.query(bf).all(function(bi){var bh=bi.name;return"plot2"===bh||"trend"===bh});if(be){bg.defaultValue(aL.brighterColorTransform);return !0}}}},cast:a4.fun.to},NormByCategory:{resolve:function(be){if(!this.chart._allowColorPerCategory){be.specify(!1);return !0}return this._resolveFull(be)},data:{resolveV1:function(be){this._specifyV1ChartOption(be,"normPerBaseCategory");return !0}},cast:Boolean,value:!1},ScaleType:{resolve:"_resolveFull",data:{resolveV1:function(be){this._specifyV1ChartOption(be,"scalingType");return !0}},cast:aL.parseContinuousColorScaleType,value:"linear"},UseAbs:{resolve:"_resolveFull",cast:Boolean,value:!1},Domain:{resolve:"_resolveFull",data:{resolveV1:function(be){this._specifyV1ChartOption(be,"colorRangeInterval");return !0}},cast:a4.array.to},Min:{resolve:"_resolveFull",data:{resolveV1:function(be){this._specifyV1ChartOption(be,"minColor");return !0}},cast:p.color},Max:{resolve:"_resolveFull",data:{resolveV1:function(be){this._specifyV1ChartOption(be,"maxColor");return !0}},cast:p.color},Missing:{resolve:"_resolveFull",data:{resolveV1:function(be){this._specifyV1ChartOption(be,"nullColor");return !0}},cast:p.color,value:p.color("lightgray")},Unbound:{resolve:"_resolveFull",getDefault:function(){var be=this.option("Colors");return be().range()[0]||aL.defaultColor},cast:p.color},LegendVisible:{resolve:"_resolveFull",data:r,cast:Boolean,value:!0},LegendClickMode:{resolve:"_resolveFull",data:r,cast:aL.parseLegendClickMode,value:"togglevisible"},LegendDrawLine:{resolve:"_resolveFull",data:r,cast:Boolean,value:!1},LegendDrawMarker:{resolve:"_resolveFull",data:r,cast:Boolean,value:!0},LegendShape:{resolve:"_resolveFull",data:r,cast:aL.parseShape}});a4.type("pvc.visual.SizeAxis",bd).init(function(bh,bg,be,bf){bf=a4.set(bf,"byNaked",!1);this.base(bh,bg,be,bf)}).add({_buildOptionId:function(){return this.id+"Axis"},scaleTreatsNullAs:function(){return"min"},scaleUsesAbs:function(){return this.option("UseAbs")},setScaleRange:function(be){var bf=this.scale;bf.min=be.min;bf.max=be.max;bf.size=be.max-be.min;bf.range(bf.min,bf.max);aL.debug>=4&&aL.log("Scale: "+aL.stringify(a4.copyOwn(bf)));return this},_getOptionsDefinition:function(){return b}});var b=a4.create(aV,{OriginIsZero:{resolve:"_resolveFull",cast:Boolean,value:!1},FixedMin:{resolve:"_resolveFull",cast:aL.castNumber},FixedMax:{resolve:"_resolveFull",cast:aL.castNumber},UseAbs:{resolve:"_resolveFull",cast:Boolean,value:!1}});a4.type("pvc.visual.NormalizedAxis",bd).init(function(bh,bg,be,bf){bf=a4.set(bf,"byNaked",!1);this.base(bh,bg,be,bf)}).add({_buildOptionId:function(){return this.id+"Axis"},scaleTreatsNullAs:function(){return"zero"},scaleUsesAbs:a4.retTrue,scaleSumNormalized:a4.retTrue,setScaleRange:function(be){var bf=this.scale;bf.min=be.min;bf.max=be.max;bf.size=be.max-be.min;bf.range(bf.min,bf.max);aL.debug>=4&&aL.log("Scale: "+aL.stringify(a4.copyOwn(bf)));return this},_getOptionsDefinition:function(){return i}});var i=a4.create(aV,{OriginIsZero:{value:!0}});a4.type("pvc.visual.Legend",aL.visual.OptionsBase).init(function(bh,bg,be,bf){bf=a4.set(bf,"byNaked",!1);this.base(bh,bg,be,bf)}).add({_getOptionsDefinition:function(){return k}});var k={Position:{resolve:"_resolveFull",cast:aL.parsePosition,value:"bottom"},Size:{resolve:"_resolveFull",cast:S},SizeMax:{resolve:"_resolveFull",cast:S},Align:{resolve:"_resolveFull",data:{resolveDefault:function(bf){var bg,be=this.option("Position");"top"!==be&&"bottom"!==be?bg="top":this.chart.compatVersion()<=1&&(bg="left");bf.defaultValue(bg);return !0}},cast:ad},Margins:{resolve:"_resolveFull",data:{resolveDefault:function(bg){if(this.chart.compatVersion()>1){var be=this.option("Position"),bf=a4.set({},aL.BasePanel.oppositeAnchor[be],5);bg.defaultValue(bf)}return !0}},cast:aD.as},Paddings:{resolve:"_resolveFull",cast:aD.as,value:5},Font:{resolve:"_resolveFull",cast:String},ItemSize:{resolve:"_resolveFull",cast:ax}};a4.type("pvc.visual.legend.BulletRootScene",aL.visual.Scene).init(function(bf,be){this.base(bf,be);this._unresolvedMarkerDiam=a4.get(be,"markerSize");this._unresolvedItemPadding=new aD(a4.get(be,"itemPadding",5));this._unresolvedItemSize=s.to(a4.get(be,"itemSize"))||new s();a4.set(this.vars,"horizontal",a4.get(be,"horizontal",!1),"font",a4.get(be,"font"),"textMargin",a4.get(be,"textMargin",6)-3)}).add({layout:function(br){function bs(bJ){var bA=bJ.labelTextSize(),bF=!bA||!bA.width||!bA.height;bJ.isHidden=bF;if(!bF){var bB,bI={width:bh+bA.width,height:Math.max(bA.height,bw)},bH={width:bf.width||bu.width+bI.width,height:bf.height||bu.height+bI.height},bC={width:Math.max(0,bH.width-bu.width),height:Math.max(0,bH.height-bu.height)};if(bm){bB=!bm.items.length}else{bm=new aL.visual.legend.BulletItemSceneSection(0);bB=!0}var bE=bm.size[bz]+bC[bz];bB||(bE+=bu[bz]);if(!bB&&bE>bk){by(!1);bE=bC[bz]}var bD=bm.size;bD[bz]=bE;bD[bn]=Math.max(bD[bn],bC[bn]);var bG=bm.items.length;bm.items.push(bJ);a4.set(bJ.vars,"section",bm,"sectionIndex",bG,"textSize",bA,"itemSize",bH,"itemClientSize",bC,"itemContentSize",bI)}}function by(bB){var bA=bm.size;bi[bn]+=bA[bn];bq.length&&(bi[bn]+=bu[bn]);bi[bz]=Math.max(bi[bz],bA[bz]);bq.push(bm);bB||(bm=new aL.visual.legend.BulletItemSceneSection(bq.length))}var bj=br.clientSize;if(!(bj.width>0&&bj.height>0)){return new s(0,0)}var bx=br.desiredClientSize,bu=this._unresolvedItemPadding.resolve(bj),bv={width:bj.width+bu.width,height:bj.height+bu.height},bf=this._unresolvedItemSize.resolve(bv),bg={width:bf.width&&Math.max(0,bf.width-bu.width),height:bf.height&&Math.max(0,bf.height-bu.height)},bw=this._unresolvedMarkerDiam||bg.height||15;this.vars.itemPadding=bu;this.vars.desiredItemSize=bf;this.vars.desiredItemClientSize=bg;this.vars.markerSize=bw;var bh=bw+this.vars.textMargin,bp=Math.max(0,Math.min(bg.width||1/0,bx.width||1/0,bj.width)-bh),bz=this.vars.horizontal?"width":"height",bn=aL.BasePanel.oppositeLength[bz],bk=bx[bz];(!bk||0>bk)&&(bk=bj[bz]);var bm,bq=[],bi={width:0,height:0};this.childNodes.forEach(function(bA){bA.childNodes.forEach(bs,this)},this);if(!bm){return new s(0,0)}by(!0);a4.set(this.vars,"sections",bq,"contentSize",bi,"labelWidthMax",bp);var bl=this.compatVersion()<=1,bt=bl?bk:bi[bz],be=bx[bn];(!be||0>be)&&(be=bi[bn]);var bo=this.vars.size=a4.set({},bz,Math.min(bt,bj[bz]),bn,Math.min(be,bj[bn]));return bo},defaultGroupSceneType:function(){var be=this._bulletGroupType;if(!be){be=a4.type(aL.visual.legend.BulletGroupScene);this._bulletGroupType=be}return be},createGroup:function(bf){var be=this.defaultGroupSceneType();return new be(this,bf)}});a4.type("pvc.visual.legend.BulletItemSceneSection").init(function(be){this.index=be;this.items=[];this.size={width:0,height:0}});a4.type("pvc.visual.legend.BulletGroupScene",aL.visual.Scene).init(function(bf,be){this.base(bf,be);this.extensionPrefix=a4.get(be,"extensionPrefix")||"";this._renderer=a4.get(be,"renderer");this.colorAxis=a4.get(be,"colorAxis");this.clickMode=a4.get(be,"clickMode");!this.clickMode&&this.colorAxis&&(this.clickMode=this.colorAxis.option("LegendClickMode"))}).add({hasRenderer:function(){return !!this._renderer},renderer:function(bg){if(null!=bg){this._renderer=bg}else{bg=this._renderer;if(!bg){var bf,be=this.colorAxis;be&&(bf={drawRule:be.option("LegendDrawLine"),drawMarker:be.option("LegendDrawMarker"),markerShape:be.option("LegendShape")});bg=new aL.visual.legend.BulletItemDefaultRenderer(bf);this._renderer=bg}}return bg},itemSceneType:function(){var bi=this._itemSceneType;if(!bi){bi=a4.type(aL.visual.legend.BulletItemScene);var bg=this.clickMode;switch(bg){case"toggleselected":bi.add(aL.visual.legend.BulletItemSceneSelection);break;case"togglevisible":bi.add(aL.visual.legend.BulletItemSceneVisibility)}var bf=this.panel();bf._extendSceneType("item",bi,["isOn","executable","execute","value","labelText"]);var bh=aL.makeExtensionAbsId(aL.makeExtensionAbsId("ItemScene",[this.extensionPrefix,"$"]),bf._getExtensionPrefix()),be=bf.chart._getExtension(bh,"value");void 0!==be&&bi.prototype.variable("value",be);this._itemSceneType=bi}return bi},createItem:function(be){var bf=this.itemSceneType();return new bf(this,be)}});a4.type("pvc.visual.legend.BulletItemScene",aL.visual.Scene).init(function(){this.base.apply(this,arguments);if(!this.executable()){var be=aL.visual.Interactive;this._ibits=be.Interactive|be.ShowsInteraction|be.Hoverable|be.SelectableAny}}).add({isOn:a4.fun.constant(!0),executable:a4.fun.constant(!1),execute:a4.fun.constant(),labelText:function(){return this.value().label},labelTextSize:function(){return p.Text.measure(this.labelText(),this.vars.font)},_valueEval:function(){var be=this._valueEvalCore();be instanceof Y||(be=new Y(be,be));return be},_valueEvalCore:function(){var bi,bh,be,bf,bj,bg=this.group||this.datum;if(bg){bi=bg.value;bh=bg.rawValue;bj=this._getTrendLineSuffix(bg);be=bg.ensureLabel()+bj;bf=bg.absLabel?bg.absLabel+bj:be}return new Y(bi||null,be||"",bh,bf)},_getTrendLineSuffix:function(bg){var be,bf;return(be=bg.firstDatum())&&(bf=be.trend)?" ("+bf.label+")":""}}).prototype.variable("value");a4.type("pvc.visual.legend.BulletItemSceneSelection").add({isOn:function(){var be=this.group||this.datum;return !be.owner.selectedCount()||this.isSelected()},executable:function(){return this.chart().selectableByClick()},execute:function(){var be=this.datums().array();if(be.length){var bf=this.chart();bf._updatingSelections(function(){be=bf._onUserSelection(be);be&&be.length&&aL.data.Data.toggleSelected(be,!0)})}}});a4.type("pvc.visual.legend.BulletItemSceneVisibility").add({isOn:function(){return this.datums().any(function(be){return !be.isNull&&be.isVisible})},executable:a4.fun.constant(!0),execute:function(){aL.data.Data.toggleVisible(this.datums())&&this.chart().render(!0,!0,!1)}});a4.type("pvc.visual.legend.BulletItemRenderer");a4.type("pvc.visual.legend.BulletItemDefaultRenderer",aL.visual.legend.BulletItemRenderer).init(function(be){this.drawRule=a4.get(be,"drawRule",!1);this.drawRule&&(this.rulePvProto=a4.get(be,"rulePvProto"));this.drawMarker=!this.drawRule||a4.get(be,"drawMarker",!0);if(this.drawMarker){this.markerShape=a4.get(be,"markerShape","square");this.markerPvProto=a4.get(be,"markerPvProto")}}).add({drawRule:!1,drawMarker:!0,markerShape:null,rulePvProto:null,markerPvProto:null,create:function(bo,bh,bl,be){var bm={},bi=this.drawRule,bg=function(bp){return bp.color};if(bi){var bn=new Z().left(0).top(function(){return this.parent.height()/2}).width(function(){return this.parent.width()}).lineWidth(1,aL.extensionTag).strokeStyle(bg,aL.extensionTag),bj=this.rulePvProto;bj&&(bn=bj.extend(bn));bm.pvRule=new aL.visual.Rule(bo,bh,{proto:bn,noSelect:!1,noHover:!1,activeSeriesAware:!1,extensionId:bl+"Rule",extensionId:aL.makeExtensionAbsId("Rule",[bl,"$"]),showsInteraction:!0,wrapper:be}).pvMark}if(this.drawMarker){var bk=new Z().left(function(){return this.parent.width()/2}).top(function(){return this.parent.height()/2}).shapeSize(function(){return this.parent.width()},aL.extensionTag).lineWidth(2,aL.extensionTag).fillStyle(bg,aL.extensionTag).strokeStyle(bg,aL.extensionTag).shape(this.markerShape,aL.extensionTag).angle(bi?0:Math.PI/2,aL.extensionTag).antialias(function(){var bp=Math.abs(Math.cos(this.angle()));if(0!==bp&&1!==bp){switch(this.shape()){case"square":case"bar":return !1}}return !0},aL.extensionTag),bf=this.markerPvProto;bf&&(bk=bf.extend(bk));bm.pvDot=new aL.visual.Dot(bo,bh,{proto:bk,freePosition:!0,activeSeriesAware:!1,noTooltip:!0,noClick:!0,extensionId:aL.makeExtensionAbsId("Dot",[bl,"$"]),wrapper:be}).pvMark}return bm}});a4.type("pvc.visual.DataCell").init(function(bi,bf,bg,be,bh){this.plot=bi;this.axisType=bf;this.axisIndex=bg;this.role=bi.chart.visualRoles[be]||a4.fail.argumentInvalid("roleName","Role is not defined.");this.dataPartValue=bh});a4.type("pvc.visual.ColorDataCell",aL.visual.DataCell).init(function(bi,bf,bg,be,bh){this.base(bi,bf,bg,be,bh);this._legendGroupScene=null}).add({legendGroupScene:function(be){if(arguments.length){this._legendGroupScene=be;return this}return this._legendGroupScene}});a4.type("pvc.visual.Plot",aL.visual.OptionsBase).init(function(bh,bg){var bj=a4.getPath(bh,["plotsByType",this.type]),bf=bj?bj.length:0,be=bh.plotList.length;bg=a4.set(bg,"byNaked",!be);this.base(bh,this.type,bf,bg);bh._addPlot(this);var bi=this.extensionPrefixes=[this.id];this.globalIndex||bi.push("");this.name&&bi.push(this.name)}).add({_getOptionsDefinition:function(){return aL.visual.Plot.optionsDef},_resolveByNaked:aL.options.specify(function(be){return this.globalIndex?void 0:this._chartOption(a4.firstLowerCase(be.name))}),collectDataCells:function(be){var bf=this._getColorDataCell();bf&&be.push(bf)},_getColorDataCell:function(){var be=this.option("ColorRole");return be?new aL.visual.ColorDataCell(this,"color",this.option("ColorAxis")-1,be,this.option("DataPart")):void 0}});aL.visual.Plot.optionsDef={Orientation:{resolve:function(be){be.specify(this._chartOption("orientation")||"vertical");return !0},cast:String},ValuesVisible:{resolve:"_resolveFull",data:{resolveV1:function(bf){if(0===this.globalIndex){var be=this._chartOption("showValues");if(void 0!==be){bf.specify(be)}else{be="point"!==this.type;bf.defaultValue(be)}return !0}}},cast:Boolean,value:!1},ValuesAnchor:{resolve:"_resolveFull",cast:aL.parseAnchor},ValuesFont:{resolve:"_resolveFull",cast:String,value:"10px sans-serif"},ValuesMask:{resolve:"_resolveFull",cast:String,value:"{value}"},ValuesOptimizeLegibility:{resolve:"_resolveFull",cast:Boolean,value:!1},ValuesOverflow:{resolve:"_resolveFull",cast:aL.parseValuesOverflow,value:"hide"},DataPart:{resolve:"_resolveFixed",cast:String,value:"0"},ColorRole:{resolve:"_resolveFixed",cast:String,value:"color"},ColorAxis:{resolve:aL.options.resolvers([function(be){if(0===this.globalIndex){be.specify(1);return !0}},"_resolveFull"]),cast:function(be){be=aL.castNumber(be);be=null!=be?a4.between(be,1,10):1;return be},value:1}};a4.type("pvc.visual.CartesianOrthoDataCell",aL.visual.DataCell).init(function(bl,bf,bi,be,bk,bj,bh,bg){this.base(bl,bf,bi,be,bk);this.isStacked=bj;this.nullInterpolationMode=bh;this.trend=bg});a4.type("pvc.visual.CartesianPlot",aL.visual.Plot).add({collectDataCells:function(bh){this.base(bh);bh.push(new aL.visual.DataCell(this,"base",this.option("BaseAxis")-1,this.option("BaseRole"),this.option("DataPart")));var bf=a4.array.to(this.option("OrthoRole")),bk=this.option("DataPart"),bi=this.option("OrthoAxis")-1,bj=this.option.isDefined("Stacked")?this.option("Stacked"):void 0,bg=this.option("NullInterpolationMode"),be=this.option("Trend");bf.forEach(function(bl){bh.push(new aL.visual.CartesianOrthoDataCell(this,"ortho",bi,bl,bk,bj,bg,be))},this)},_getOptionsDefinition:function(){return aL.visual.CartesianPlot.optionsDef}});aL.visual.CartesianPlot.optionsDef=a4.create(aL.visual.Plot.optionsDef,{BaseAxis:{value:1},BaseRole:{resolve:"_resolveFixed",cast:String},OrthoAxis:{resolve:function(be){if(0===this.globalIndex){be.specify(1);return !0}return this._resolveFull(be)},data:{resolveV1:function(be){"plot2"===this.name&&this.chart._allowV1SecondAxis&&this._chartOption("secondAxisIndependentScale")&&be.specify(2);return !0}},cast:function(be){be=aL.castNumber(be);return null!=be?a4.between(be,1,10):1},value:1},OrthoRole:{resolve:aL.options.resolvers(["_resolveFixed","_resolveDefault"])},Trend:{resolve:"_resolveFull",data:{resolveDefault:function(bf){var be=this.option("TrendType");if(be){bf.defaultValue({type:be});return !0}}},cast:aI},TrendType:{resolve:"_resolveFull",cast:aL.parseTrendType},TrendLabel:{resolve:"_resolveFull",cast:String},NullInterpolationMode:{resolve:"_resolveFull",cast:aL.parseNullInterpolationMode,value:"none"}});a4.type("pvc.visual.CategoricalPlot",aL.visual.CartesianPlot).add({_getOptionsDefinition:function(){return aL.visual.CategoricalPlot.optionsDef}});aL.visual.CategoricalPlot.optionsDef=a4.create(aL.visual.CartesianPlot.optionsDef,{Stacked:{resolve:"_resolveFull",cast:Boolean,value:!1},BaseRole:{value:"category"},OrthoRole:{value:"value"}});a4.type("pvc.visual.BarPlotAbstract",aL.visual.CategoricalPlot).add({_getOptionsDefinition:function(){return aL.visual.BarPlotAbstract.optionsDef}});aL.visual.BarPlotAbstract.optionsDef=a4.create(aL.visual.CategoricalPlot.optionsDef,{BarSizeRatio:{resolve:"_resolveFull",cast:function(be){be=aL.castNumber(be);null==be?be=1:0.05>be?be=0.05:be>1&&(be=1);return be},value:0.9},BarSizeMax:{resolve:"_resolveFull",data:{resolveV1:function(be){this._specifyChartOption(be,"maxBarSize");return !0}},cast:function(be){be=aL.castNumber(be);null==be?be=1/0:1>be&&(be=1);return be},value:2000},BarOrthoSizeMin:{resolve:"_resolveFull",cast:aL.castNonNegativeNumber,value:1.5},BarStackedMargin:{resolve:"_resolveFull",cast:function(be){be=aL.castNumber(be);null!=be&&0>be&&(be=0);return be},value:0},OverflowMarkersVisible:{resolve:"_resolveFull",cast:Boolean,value:!0},ValuesAnchor:{value:"center"}});a4.type("pvc.visual.BarPlot",aL.visual.BarPlotAbstract).add({type:"bar"});a4.type("pvc.visual.NormalizedBarPlot",aL.visual.BarPlotAbstract).add({type:"bar",_getOptionsDefinition:function(){return aL.visual.NormalizedBarPlot.optionsDef}});aL.visual.NormalizedBarPlot.optionsDef=a4.create(aL.visual.BarPlotAbstract.optionsDef,{Stacked:{resolve:null,value:!0}});a4.type("pvc.visual.WaterfallPlot",aL.visual.BarPlotAbstract).add({type:"water",_getOptionsDefinition:function(){return aL.visual.WaterfallPlot.optionsDef}});aL.visual.WaterfallPlot.optionsDef=a4.create(aL.visual.BarPlotAbstract.optionsDef,{Stacked:{resolve:null,value:!0},TotalLineLabel:{resolve:"_resolveFull",cast:String,value:"Accumulated"},TotalValuesVisible:{resolve:"_resolveFull",data:{resolveDefault:function(be){be.defaultValue(this.option("ValuesVisible"));return !0}},cast:Boolean},Direction:{resolve:"_resolveFull",cast:aL.parseWaterDirection,value:"down"},AreasVisible:{resolve:"_resolveFull",cast:Boolean,value:!0},AllCategoryLabel:{resolve:"_resolveFull",cast:String,value:"All"}});a4.type("pvc.visual.PointPlot",aL.visual.CategoricalPlot).add({type:"point",_getOptionsDefinition:function(){return aL.visual.PointPlot.optionsDef}});aL.visual.PointPlot.optionsDef=a4.create(aL.visual.CategoricalPlot.optionsDef,{DotsVisible:{resolve:"_resolveFull",data:aJ("Dots",!0),cast:Boolean,value:!1},LinesVisible:{resolve:"_resolveFull",data:aJ("Lines",!0),cast:Boolean,value:!1},AreasVisible:{resolve:"_resolveFull",data:aJ("Areas",!1),cast:Boolean,value:!1},ValuesAnchor:{value:"right"}});a4.type("pvc.visual.MetricXYPlot",aL.visual.CartesianPlot).add({_getOptionsDefinition:function(){return aL.visual.MetricXYPlot.optionsDef}});aL.visual.MetricXYPlot.optionsDef=a4.create(aL.visual.CartesianPlot.optionsDef,{BaseRole:{value:"x"},OrthoAxis:{resolve:null},OrthoRole:{value:"y"}});a4.type("pvc.visual.MetricPointPlot",aL.visual.MetricXYPlot).add({type:"scatter",collectDataCells:function(be){this.base(be);if(this.option("DotsVisible")){var bf=this.chart.visualRole(this.option("SizeRole"));bf.isBound()&&be.push(new aL.visual.DataCell(this,"size",this.option("SizeAxis")-1,bf.name,this.option("DataPart")))}},_getOptionsDefinition:function(){return aL.visual.MetricPointPlot.optionsDef}});aL.visual.MetricPointPlot.optionsDef=a4.create(aL.visual.MetricXYPlot.optionsDef,{SizeRole:{resolve:"_resolveFixed",value:"size"},SizeAxis:{resolve:"_resolveFixed",value:1},Shape:{resolve:"_resolveFull",cast:aL.parseShape,value:"circle"},NullShape:{resolve:"_resolveFull",cast:aL.parseShape,value:"cross"},DotsVisible:{resolve:"_resolveFull",data:aa("Dots"),cast:Boolean,value:!1},LinesVisible:{resolve:"_resolveFull",data:aa("Lines"),cast:Boolean,value:!1},ValuesAnchor:{value:"right"},ValuesMask:{value:"{x},{y}"}});a4.type("pvc.visual.PiePlot",aL.visual.Plot).add({type:"pie",collectDataCells:function(be){this.base(be);var bf=this.option("DataPart");be.push(new aL.visual.DataCell(this,"category",0,"category",bf));be.push(new aL.visual.DataCell(this,"angle",0,"value",bf))},_getOptionsDefinition:function(){return aL.visual.PiePlot.optionsDef}});aL.visual.PiePlot.optionsDef=a4.create(aL.visual.Plot.optionsDef,{ActiveSliceRadius:{resolve:"_resolveFull",cast:l.parse,value:new l(0.05)},ExplodedSliceRadius:{resolve:"_resolveFull",cast:l.parse,value:0},ExplodedSliceIndex:{resolve:"_resolveFull",cast:aL.castNumber,value:null},ValuesAnchor:{cast:aL.parseAnchorWedge,value:"outer"},ValuesVisible:{value:!0},ValuesLabelStyle:{resolve:function(bf){var be=this.chart.compatVersion()<=1;if(be){bf.specify("inside");return !0}return this._resolveFull(bf)},cast:function(be){switch(be){case"inside":case"linked":return be}aL.debug>=2&&aL.log("[Warning] Invalid 'ValuesLabelStyle' value: '"+be+"'.");return"linked"},value:"linked"},ValuesMask:{resolve:"_resolveFull",data:{resolveDefault:function(be){be.defaultValue("linked"===this.option("ValuesLabelStyle")?"{value} ({value.percent})":"{value}");return !0}}},LinkInsetRadius:{resolve:"_resolveFull",cast:l.parse,value:new l(0.05)},LinkOutsetRadius:{resolve:"_resolveFull",cast:l.parse,value:new l(0.025)},LinkMargin:{resolve:"_resolveFull",cast:l.parse,value:new l(0.025)},LinkHandleWidth:{resolve:"_resolveFull",cast:aL.castNumber,value:0.5},LinkLabelSize:{resolve:"_resolveFull",cast:l.parse,value:new l(0.15)},LinkLabelSpacingMin:{resolve:"_resolveFull",cast:aL.castNumber,value:0.5}});a4.type("pvc.visual.HeatGridPlot",aL.visual.CategoricalPlot).add({type:"heatGrid",collectDataCells:function(be){this.base(be);if(this.option("UseShapes")){var bf=this.chart.visualRole(this.option("SizeRole"));bf.isBound()&&be.push(new aL.visual.DataCell(this,"size",this.option("SizeAxis")-1,bf.name,this.option("DataPart")))}},_getOptionsDefinition:function(){return aL.visual.HeatGridPlot.optionsDef}});aL.visual.HeatGridPlot.optionsDef=a4.create(aL.visual.CategoricalPlot.optionsDef,{SizeRole:{value:"size"},SizeAxis:{value:1},UseShapes:{resolve:"_resolveFull",cast:Boolean,value:!1},Shape:{resolve:"_resolveFull",cast:aL.parseShape,value:"square"},NullShape:{resolve:"_resolveFull",cast:aL.parseShape,value:"cross"},ValuesVisible:{getDefault:function(){return !this.option("UseShapes")},value:null},ValuesMask:{value:null},ValuesAnchor:{value:"center"},OrthoRole:{value:"series"},OrthoAxis:{resolve:null},NullInterpolationMode:{resolve:null,value:"none"},Stacked:{resolve:null,value:!1}});a4.type("pvc.visual.BoxPlot",aL.visual.CategoricalPlot).add({type:"box",_getOptionsDefinition:function(){return aL.visual.BoxPlot.optionsDef}});aL.visual.BoxPlot.optionsDef=a4.create(aL.visual.CategoricalPlot.optionsDef,{Stacked:{resolve:null,value:!1},OrthoRole:{value:["median","lowerQuartil","upperQuartil","minimum","maximum"]},BoxSizeRatio:{resolve:"_resolveFull",cast:function(be){be=aL.castNumber(be);null==be?be=1:0.05>be?be=0.05:be>1&&(be=1);return be},value:1/3},BoxSizeMax:{resolve:"_resolveFull",data:{resolveV1:function(be){this._specifyChartOption(be,"maxBoxSize");return !0}},cast:function(be){be=aL.castNumber(be);null==be?be=1/0:1>be&&(be=1);return be},value:1/0}});a4.type("pvc.visual.BulletPlot",aL.visual.Plot).add({type:"bullet",_getOptionsDefinition:function(){return aL.visual.BulletPlot.optionsDef}});aL.visual.BulletPlot.optionsDef=a4.create(aL.visual.Plot.optionsDef,{ValuesVisible:{value:!0},ColorRole:{value:null}});a4.type("pvc.visual.TreemapPlot",aL.visual.Plot).add({type:"treemap",_getOptionsDefinition:function(){return aL.visual.TreemapPlot.optionsDef},collectDataCells:function(be){this.base(be);var bf=this.option("SizeRole");bf&&be.push(new aL.visual.DataCell(this,"size",this.option("SizeAxis")-1,bf,this.option("DataPart")))}});aL.visual.TreemapPlot.optionsDef=a4.create(aL.visual.Plot.optionsDef,{SizeRole:{resolve:"_resolveFixed",value:"size"},SizeAxis:{resolve:"_resolveFixed",value:1},ValuesAnchor:{cast:aL.parseAnchor,value:"center"},ValuesVisible:{value:!0},ValuesMask:{resolve:"_resolveFull",value:"{category}"},ValuesOptimizeLegibility:{value:!0},LayoutMode:{resolve:"_resolveFull",cast:aL.parseTreemapLayoutMode,value:"squarify"},ColorMode:{resolve:"_resolveFull",cast:aL.parseTreemapColorMode,value:"byparent"},RootCategoryLabel:{resolve:"_resolveFull",cast:String,value:"All"}});a4.type("pvc.visual.SunburstPlot",aL.visual.Plot).add({type:"sunburst",_getOptionsDefinition:function(){return aL.visual.SunburstPlot.optionsDef},collectDataCells:function(be){this.base(be);var bf=this.option("SizeRole");bf&&be.push(new aL.visual.DataCell(this,"size",this.option("SizeAxis")-1,bf,this.option("DataPart")))}});aL.visual.SunburstPlot.optionsDef=a4.create(aL.visual.Plot.optionsDef,{SizeRole:{resolve:"_resolveFixed",value:"size"},SizeAxis:{resolve:"_resolveFixed",value:1},ValuesAnchor:{cast:aL.parseAnchor,value:"center"},ValuesVisible:{value:!0},ValuesMask:{resolve:"_resolveFull",value:"{category}"},ValuesOptimizeLegibility:{value:!0},RootCategoryLabel:{resolve:"_resolveFull",cast:String,value:"All"},SliceOrder:{resolve:"_resolveFull",cast:aL.parseSunburstSliceOrder,value:"bySizeDescending"},EmptySlicesVisible:{resolve:"_resolveFull",cast:Boolean,value:!1},EmptySlicesLabel:{resolve:"_resolveFull",cast:String,value:""}});a4.type("pvc.Abstract").init(function(){this._syncLog()}).add({invisibleLineWidth:0.001,defaultLineWidth:1.5,_logInstanceId:null,_syncLog:function(){if(aL.debug&&"undefined"!=typeof console){var be=this._getLogInstanceId();["log","info",["trace","debug"],"error","warn",["group","groupCollapsed"],"groupEnd"].forEach(function(bf){bf=bf instanceof Array?bf:[bf,bf];aW(this,"_"+bf[0],bf[1],be)},this)}},_getLogInstanceId:function(){return this._logInstanceId||(this._logInstanceId=this._processLogInstanceId(this._createLogInstanceId()))},_createLogInstanceId:function(){return""+this.constructor},_processLogInstanceId:function(bf){var be=30,bg=bf.substr(0,be);bg.length<be&&(bg+=a4.array.create(be-bg.length," ").join(""));return"["+bg+"]"}});a4.scope(function(){var bf=aL.Abstract.prototype,be=function(){this._syncLog()};["log","info","trace","error","warn","group","groupEnd"].forEach(function(bg){bf["_"+bg]=be})});a4.type("pvc.BaseChart",aL.Abstract).add(aL.visual.Interactive).init(function(be){var bg=be,bf=this.parent=a4.get(be,"parent")||null;bf?be||a4.fail.argumentRequired("options"):be=a4.mixin.copy({},this.defaults,be);this.options=be;if(bf){this.root=bf.root;this.smallColIndex=be.smallColIndex;this.smallRowIndex=be.smallRowIndex}else{this.root=this}this.base();aL.debug>=3&&this._info("NEW CHART\n"+aL.logSeparator.replace(/-/g,"=")+"\n  DebugLevel: "+aL.debug);if(aL.debug>=3&&!bf&&bg){this._info("OPTIONS:\n",bg);aL.debug>=5&&this._trace(aL.stringify(be,{ownOnly:!1,funs:!0}))}bf&&bf._addChild(this);this._constructData(be);this._constructVisualRoles(be)}).add({_disposed:!1,_animatable:!1,parent:null,children:null,root:null,isCreated:!1,_createVersion:0,renderCallback:void 0,multiChartPageCount:null,multiChartPageIndex:null,_multiChartOverflowClipped:!1,left:0,top:0,width:null,height:null,margins:null,paddings:null,_allowV1SecondAxis:!1,compatVersion:function(be){return(be||this.options).compatVersion},_createLogInstanceId:function(){return""+this.constructor+this._createLogChildSuffix()},_createLogChildSuffix:function(){return this.parent?" ("+(this.smallRowIndex+1)+","+(this.smallColIndex+1)+")":""},_addChild:function(be){be.parent===this||a4.assert("Not a child of this chart.");this.children.push(be)},_create:function(be){this._createPhase1(be);this._createPhase2(be)},_createPhase1:function(bf){this._createVersion++;this.isCreated=!1;aL.debug>=3&&this._log("Creating");this.children=[];this.parent||aL.removeTipsyLegends();this._processOptions();this.parent||this._checkNoDataI();if(!this.parent&&!this.data){this._initVisualRoles();this._bindVisualRolesPreI();this._complexTypeProj=this._createComplexTypeProject();this._bindVisualRolesPreII()}this._initData(bf);this.parent||this._checkNoDataII();var be=this.visualRoles.multiChart.isBound(),bg=this._chartLevel();this._initPlots(be);this._initAxes(be);be&&!this.parent&&this._initMultiCharts();if(!this.parent){this._interpolate(be);this._generateTrends(be)}this._setAxesScales(bg)},_createPhase2:function(){var be=this.visualRoles.multiChart.isBound();this._initChartPanels(be);this.isCreated=!0},_setSmallLayout:function(be){if(be){var bf=this.basePanel;this._setProp("left",be)|this._setProp("top",be)&&bf&&a4.set(bf.position,"left",this.left,"top",this.top);this._setProp("width",be)|this._setProp("height",be)&&bf&&(bf.size=new s(this.width,this.height));this._setProp("margins",be)&&bf&&(bf.margins=new aD(this.margins));this._setProp("paddings",be)&&bf&&(bf.paddings=new aD(this.paddings))}},_setProp:function(bg,bf){var be=bf[bg];if(null!=be){this[bg]=be;return !0}},_processOptions:function(){var be=this.options;if(!this.parent){this.width=be.width;this.height=be.height;this.margins=be.margins;this.paddings=be.paddings}this.compatVersion()<=1&&(be.plot2=this._allowV1SecondAxis&&!!be.secondAxis);this._processOptionsCore(be);this._processExtensionPoints();return be},_processOptionsCore:function(bh){if(this.parent){this._ibits=this.parent._ibits;this._tooltipOptions=this.parent._tooltipOptions}else{var be="batik"!==p.renderer();if(be){be=bh.interactive;null==be&&(be=!0)}var bi;if(be){var bg=aL.visual.Interactive;bi=bg.Interactive|bg.ShowsInteraction;this._processTooltipOptions(bh)&&(bi|=bg.ShowsTooltip);bh.animate&&$.support.svg&&(bi|=bg.Animatable);var bf=!1;if(bh.selectable){bi|=bg.Selectable;switch(aL.parseSelectionMode(bh.selectionMode)){case"rubberband":bi|=bg.SelectableByRubberband|bg.SelectableByClick;break;case"focuswindow":bi|=bg.SelectableByFocusWindow;bf=!0}}bf||"emptyspaceclick"!==aL.parseClearSelectionMode(bh.clearSelectionMode)||(bi|=bg.Unselectable);bh.hoverable&&(bi|=bg.Hoverable);bh.clickable&&(bi|=bg.Clickable|bg.DoubleClickable)}else{bi=0}this._ibits=bi}},_tooltipDefaults:{gravity:"s",delayIn:200,delayOut:80,offset:2,opacity:0.9,html:!0,fade:!0,useCorners:!1,arrowVisible:!0,followMouse:!1,format:void 0},_processTooltipOptions:function(bf){var bh=this.compatVersion()<=1,bg=bf.tooltip,be=bf.tooltipEnabled;if(null==be){bg&&(be=bg.enabled);if(null==be){bh&&(be=bf.showTooltips);null==be&&(be=!0)}}if(be){bg||(bg={});bh&&this._importV1TooltipOptions(bg,bf);a4.eachOwn(this._tooltipDefaults,function(bi,bk){var bj=bf["tooltip"+a4.firstUpperCase(bk)];void 0!==bj?bg[bk]=bj:void 0===bg[bk]&&(bg[bk]=bi)})}else{bg={}}this._tooltipOptions=bg;return be},_importV1TooltipOptions:function(bg,bf){var be=bf.tipsySettings;if(be){this.extend(be,"tooltip");for(var bh in be){void 0===bg[bh]&&(bg[bh]=be[bh])}null==bg.html&&(bg.html=!1)}},render:function(bh,bg,bf){var be;aL.debug>1&&aL.group("CCC RENDER");this._suspendSelectionUpdate();try{this.useTextMeasureCache(function(){try{for(;;){!this.isCreated||bg?this._create({reloadData:bf}):!this.parent&&this.isCreated&&aL.removeTipsyLegends();this.basePanel.render({bypassAnimation:bh,recreate:bg});if(!this._isMultiChartOverflowClip){this._isMultiChartOverflowClipRetry=!1;break}bg=!0;bf=!1;this._isMultiChartOverflowClipRetry=!0;this._isMultiChartOverflowClip=!1;this._multiChartOverflowClipped=!0}}catch(bi){if(bi instanceof NoDataException){aL.debug>1&&this._log("No data found.");this._addErrorPanelMessage("No data found",!0)}else{be=!0;aL.logError(bi.message);aL.debug>0&&this._addErrorPanelMessage("Error: "+bi.message,!1)}}})}finally{be||this._resumeSelectionUpdate();aL.debug>1&&aL.groupEnd()}return this},_addErrorPanelMessage:function(bi,bh){var be=this.options,bg=new p.Panel().canvas(be.canvas).width(this.width).height(this.height),bf=bg.anchor("center").add(p.Label).text(bi);bh&&this.extend(bf,"noDataMessage");bg.render()},useTextMeasureCache:function(bg,bf){var be=this.root,bh=be._textMeasureCache||(be._textMeasureCache=p.Text.createCache());return p.Text.usingCache(bh,bg,bf||this)},animate:function(bf,be){return this.basePanel.animate(bf,be)},animatingStart:function(){return this.basePanel.animatingStart()},animatable:function(){return this._animatable&&this.base()},isOrientationVertical:function(be){return(be||this.options.orientation)===aL.orientation.vertical},isOrientationHorizontal:function(be){return(be||this.options.orientation)===aL.orientation.horizontal},dispose:function(){this._disposed||(this._disposed=!0)},defaults:{width:400,height:300,orientation:"vertical",ignoreNulls:!0,crosstabMode:!0,isMultiValued:!1,seriesInRows:!1,groupedLabelSep:void 0,animate:!0,titlePosition:"top",titleAlign:"center",legend:!1,legendPosition:"bottom",v1StyleTooltipFormat:function(bg,bh,bf,be){return bg+", "+bh+":  "+this.chart.options.valueFormat(bf)+(be&&be.percent?" ("+be.percent.label+")":"")},valueFormat:a4.scope(function(){var be=p.Format.number().fractionDigits(0,2);return function(bf){return be.format(bf)}}),percentValueFormat:a4.scope(function(){var be=p.Format.number().fractionDigits(0,1);return function(bf){return be.format(100*bf)+"%"}}),clickable:!1,doubleClickMaxDelay:300,hoverable:!1,selectable:!1,selectionMode:"rubberband",ctrlSelectMode:!0,clearSelectionMode:"emptySpaceClick",compatVersion:1/0}});aL.BaseChart.add({visualRoles:null,visualRoleList:null,_serRole:null,_dataPartRole:null,_measureVisualRoles:null,visualRole:function(be){var bf=a4.getOwn(this.visualRoles,be);if(!bf){throw a4.error.operationInvalid("roleName","There is no visual role with name '{0}'.",[be])}return bf},measureVisualRoles:function(){return this._measureVisualRoles},measureDimensionsNames:function(){return a4.query(this._measureVisualRoles).select(function(be){return be.firstDimensionName()}).where(a4.notNully).array()},_constructVisualRoles:function(){var be=this.parent;if(be){this.visualRoles=be.visualRoles;this.visualRoleList=be.visualRoleList;this._measureVisualRoles=be._measureVisualRoles;["_multiChartRole","_serRole","_colorRole","_dataPartRole"].forEach(function(bg){var bf=be[bg];bf&&(this[bg]=bf)},this)}else{this.visualRoles={};this.visualRoleList=[];this._measureVisualRoles=[]}},_hasDataPartRole:a4.fun.constant(!1),_getSeriesRoleSpec:a4.fun.constant(null),_getColorRoleSpec:a4.fun.constant(null),_addVisualRole:function(be,bf){bf=a4.set(bf,"index",this.visualRoleList.length);var bg=new aL.visual.Role(be,bf);this.visualRoleList.push(bg);this.visualRoles[be]=bg;bg.isMeasure&&this._measureVisualRoles.push(bg);return bg},_initVisualRoles:function(){this._multiChartRole=this._addVisualRole("multiChart",{defaultDimension:"multiChart*",requireIsDiscrete:!0});this._hasDataPartRole()&&(this._dataPartRole=this._addVisualRole("dataPart",{defaultDimension:"dataPart",requireSingleDimension:!0,requireIsDiscrete:!0,dimensionDefaults:{isHidden:!0,comparer:a4.compare}}));var bf=this._getSeriesRoleSpec();bf&&(this._serRole=this._addVisualRole("series",bf));var be=this._getColorRoleSpec();be&&(this._colorRole=this._addVisualRole("color",be))},_assertUnboundRoleIsOptional:function(be){if(be.isRequired){throw a4.error.operationInvalid("Chart type requires unassigned role '{0}'.",[be.name])}},_bindVisualRolesPreI:function(){a4.eachOwn(this.visualRoles,function(bj){bj.setIsReversed(!1)});var bi=[],bg=this.options,bh=bg.visualRoles;this.visualRoleList.forEach(function(bl){var bj=bl.name,bk=bg[bj+"Role"];if(void 0!==bk){bh||(bh=bg.visualRoles={});void 0===bh[bj]&&(bh[bj]=bk)}});var bf;if(bh){bf={};var be=a4.query(a4.keys(bh)).select(this.visualRole,this).array();be.sort(function(bk,bj){return bk.index-bj.index});be.forEach(function(bp){var bk,bm,bj=bp.name,bo=bh[bj];if(a4.object.is(bo)){a4.nullyTo(bo.isReversed,!1)&&bp.setIsReversed(!0);bm=bo.from;if(bm&&bm!==bj){var bn=this.visualRoles[bm]||a4.fail.operationInvalid("Source role '{0}' is not supported by the chart type.",[bm]);bp.setSourceRole(bn);bi.push(bp)}else{bk=bo.dimensions}}else{bk=bo}if(void 0!==bk){bk||this._assertUnboundRoleIsOptional(bp);var bl=aL.data.GroupingSpec.parse(bk);bp.preBind(bl);bl.dimensions().each(function(bq){a4.hasOwn(bf,bq.name)?delete bf[bq.name]:bf[bq.name]=bp})}},this)}this._sourcedRoles=bi;this._dimsBoundToSingleRole=bf},_bindVisualRolesPreII:function(){var be=this._dimsBoundToSingleRole;if(be){delete this._dimsBoundToSingleRole;a4.eachOwn(be,this._setRoleBoundDimensionDefaults,this)}var bf=this._sourcedRoles;delete this._sourcedRoles;a4.query(this.visualRoleList).where(function(bg){return bg.defaultSourceRoleName&&!bg.sourceRole&&!bg.isPreBound()}).each(function(bh){var bg=this.visualRoles[bh.defaultSourceRoleName];if(bg){bh.setSourceRole(bg,!0);bf.push(bh)}},this);bf.forEach(function(bh){var bg=bh.sourceRole;bg.isReversed&&bh.setIsReversed(!bh.isReversed);!bh.defaultDimensionName&&bg.isPreBound()&&bh.preBind(bg.preBoundGrouping())})},_setRoleBoundDimensionDefaults:function(bf,be){this._complexTypeProj.setDimDefaults(be,bf.dimensionDefaults)},_bindVisualRolesPostI:function(){function be(br,bs){a4.array.lazy(bf,br).push(bs)}function bo(br){return bp.hasDim(br)}function bl(bs,br){a4.array.is(br)?br.forEach(function(bt){be(bt,bs)}):be(br,bs);bs.setSourceRole(null);bs.preBind(aL.data.GroupingSpec.parse(br))}function bi(bs,br){br.length&&(bs.requireSingleDimension?bl(bs,br[0]):bl(bs,br))}function bg(bs,br){bp.setDim(br,{isHidden:!0});bl(bs,br)}function bj(br){bn._assertUnboundRoleIsOptional(br);br.bind(null);br.setSourceRole(null)}function bq(br){br.preBoundGrouping().dimensionNames().forEach(be)}function bh(bw){if(!bw.sourceRole||bw.isDefaultSourceRole){var bu=bw.defaultDimensionName;if(bu){var bs=bu.match(/^(.*?)(\*)?$/)||a4.fail.argumentInvalid("defaultDimensionName"),bt=bs[1],bv=bs[2];if(bv){var br=bp.groupDimensionsNames(bt);if(br){bi(bw,br);return}}else{if(bo(bt)){bl(bw,bt);return}}bw.autoCreateDimension?bg(bw,bt):bw.sourceRole?bm.push(bw):bj(bw)}else{bw.sourceRole?bm.push(bw):bj(bw)}}else{bm.push(bw)}}function bk(bs){var br=bs.sourceRole;br.isPreBound()?bs.preBind(br.preBoundGrouping()):bj(bs)}var bn=this,bp=bn._complexTypeProj,bf={},bm=[];a4.query(bn.visualRoleList).where(function(br){return br.isPreBound()}).each(bq);a4.query(bn.visualRoleList).where(function(br){return !br.isPreBound()}).each(bh);bm.forEach(bk);a4.query(a4.ownKeys(bf)).where(function(br){return 1===bf[br].length}).each(function(br){var bs=bf[br][0];bn._setRoleBoundDimensionDefaults(bs,br)})},_bindVisualRolesPostII:function(be){a4.query(this.visualRoleList).where(function(bf){return bf.isPreBound()}).each(function(bf){bf.postBind(be)})},_logVisualRoles:function(){var bg=a4.ownKeys(this.visualRoles),be=Math.max(10,a4.query(bg).select(function(bi){return bi.length}).max()),bh=a4.string.padRight("VisualRole",be)+" < Dimension(s)",bf=["VISUAL ROLES MAP SUMMARY",aL.logSeparator,bh,a4.string.padRight("",be+1,"-")+"+--------------"];a4.eachOwn(this.visualRoles,function(bj,bi){bf.push(a4.string.padRight(bi,be)+" | "+(bj.grouping||"-"))});bf.push("");this._log(bf.join("\n"))},_getDataPartDimName:function(){var bf=this._dataPartRole;if(bf){if(bf.isBound()){return bf.firstDimensionName()}var be=bf.preBoundGrouping();return be?be.firstDimensionName():bf.defaultDimensionName}}});aL.BaseChart.add({dataEngine:null,data:null,_partsDataCache:null,_visibleDataCache:null,resultset:[],metadata:[],_trendable:!1,_interpolatable:!1,_constructData:function(be){this.parent&&(this.dataEngine=this.data=be.data||a4.fail.argumentRequired("options.data"))},_checkNoDataI:function(){if(!this.allowNoData&&!this.resultset.length){throw new NoDataException()}},_checkNoDataII:function(){if(!(this.allowNoData||this.data&&this.data.count())){this.data=null;throw new NoDataException()}},_initData:function(be){if(!this.parent){var bf=this.data;if(bf){if(a4.get(be,"reloadData",!0)){this._onReloadData()}else{bf.disposeChildren();bf.clearVirtuals()}}else{this._onLoadData()}}delete this._partsDataCache;delete this._visibleDataCache;aL.debug>=3&&this._log(this.data.getInfo())},_onLoadData:function(){var bg=this.data,be=this._translation;!bg&&!be||a4.assert("Invalid state.");var bl=this.options,bf=this._getDataPartDimName(),bi=this._complexTypeProj||a4.assert("Invalid state."),bj=this._createTranslationOptions(bf);be=this._translation=this._createTranslation(bj);if(aL.debug>=3){this._log(be.logSource());this._log(be.logTranslatorType())}be.configureType();bf&&!bi.isReadOrCalc(bf)&&this._addDefaultDataPartCalculation(bf);aL.debug>=3&&this._log(be.logVItem());this._bindVisualRolesPostI();var bm=new aL.data.ComplexType();bi.configureComplexType(bm,bj);this._bindVisualRolesPostII(bm);aL.debug>=10&&this._log(bm.describe());aL.debug>=3&&this._logVisualRoles();bg=this.dataEngine=this.data=new aL.data.Data({type:bm,labelSep:bl.groupedLabelSep,keySep:bj.separator});var bh={where:this._getLoadFilter(),isNull:this._getIsNullDatum()},bk=be.execute(bg);bg.load(bk,bh)},_onReloadData:function(){var bf=this.data,bh=this._translation;bf&&bh||a4.assert("Invalid state.");this.options;bh.setSource(this.resultset);aL.debug>=3&&this._log(bh.logSource());var bg={where:this._getLoadFilter(),isNull:this._getIsNullDatum()},be=bh.execute(bf);bf.load(be,bg)},_createComplexTypeProject:function(){var be=this.options,bi=new aL.data.ComplexTypeProject(be.dimensionGroups),bg=be.dimensions;for(var bh in bg){bi.setDim(bh,bg[bh])}var bf=this._getDataPartDimName();if(bf){bi.setDim(bf);this._addPlot2SeriesDataPartCalculation(bi,bf)}var bj=be.calculations;bj&&bj.forEach(function(bk){bi.setCalc(bk)});return bi},_getLoadFilter:function(){},_getIsNullDatum:function(){var be=this.measureDimensionsNames(),bf=be.length;return bf?function(bh){for(var bg=bh.atoms,bi=0;bf>bi;bi++){if(null!=bg[be[bi]].value){return !1}}return !0}:void 0},_createTranslation:function(be){var bf=this._getTranslationClass(be);return new bf(this,this._complexTypeProj,this.resultset,this.metadata,be)},_getTranslationClass:function(be){return be.crosstabMode?aL.data.CrosstabTranslationOper:aL.data.RelationalTranslationOper},_createTranslationOptions:function(bg){var bp=this.options,bo=bp.dataOptions||{},bf=bp.dataSeparator;void 0===bf&&(bf=bo.separator);bf||(bf="~");var bh=bp.dataMeasuresInColumns;void 0===bh&&(bh=bo.measuresInColumns);var bk=bp.dataCategoriesCount;void 0===bk&&(bk=bo.categoriesCount);var bj=bp.dataIgnoreMetadataLabels;void 0===bj&&(bj=bo.ignoreMetadataLabels);var bm,bl=bp.plot2,bi=bp.valueFormat;bi&&bi!==this.defaults.valueFormat&&(bm=function(bq){return null!=bq?bi(bq):""});var bn,be;if(bl){if(this._allowV1SecondAxis&&this.compatVersion()<=1){be=bp.secondAxisIdx}else{bn=null!=this._serRole&&bp.plot2Series&&a4.array.as(bp.plot2Series);if(!bn||!bn.length){bn=null;be=bp.plot2SeriesIndexes}}bn||(be=aL.parseDistinctIndexArray(be,-1/0)||-1)}return{compatVersion:this.compatVersion(),plot2DataSeriesIndexes:be,seriesInRows:bp.seriesInRows,crosstabMode:bp.crosstabMode,isMultiValued:bp.isMultiValued,dataPartDimName:bg,dimensionGroups:bp.dimensionGroups,dimensions:bp.dimensions,readers:bp.readers,measuresIndexes:bp.measuresIndexes,multiChartIndexes:bp.multiChartIndexes,separator:bf,measuresInColumns:bh,categoriesCount:bk,measuresIndex:bo.measuresIndex||bo.measuresIdx,measuresCount:bo.measuresCount||bo.numMeasures,isCategoryTimeSeries:bp.timeSeries,timeSeriesFormat:bp.timeSeriesFormat,valueNumberFormatter:bm,ignoreMetadataLabels:bj}},_addPlot2SeriesDataPartCalculation:function(bj,bi){if(!(this.compatVersion()<=1)){var bo=this.options,bg=this._serRole,bl=null!=bg&&bo.plot2&&bo.plot2Series&&a4.array.as(bo.plot2Series);if(bl&&bl.length){var be,bk,bh,bf,bn=!1,bm=a4.query(bl).uniqueIndex();bj.setCalc({names:bi,calculation:function(br,bq){if(!bn){if(bg.isBound()){be=bg.grouping.dimensionNames();bk=br.owner.dimensions(bi)}bn=!0}if(bk){var bp=aL.data.Complex.compositeKey(br,be);bq[bi]=a4.hasOwnProp.call(bm,bp)?bf||(bf=bk.intern("1")):bh||(bh=bk.intern("0"))}}})}}},_addDefaultDataPartCalculation:function(be){var bf,bg;this._complexTypeProj.setCalc({names:be,calculation:function(bi,bh){bf||(bf=bi.owner.dimensions(be));bh[be]=bg||(bg=bf.intern("0"))}})},partData:function(bf,bj){bj||(bj=this.data);if(null==bf){return bj}if(this.parent){return this.root.partData(bf,bj)}var bi=this._dataPartRole;if(!bi||!bi.isBound()){return bj}var bh="\x00"+bj.id+":"+a4.nullyTo(bf,""),bg=a4.lazy(this,"_partsDataCache"),be=bg[bh];if(!be){be=this._createPartData(bj,bi,bf);bg[bh]=be}return be},_createPartData:function(bj,bi,bh){var bg=bi.firstDimensionName(),be=bj.dimensions(bg).getDistinctAtoms(a4.array.to(bh)),bf=au([a4.set({},bg,be)]);return bj.where(null,{where:bf})},visibleData:function(bm,bj){var bh=a4.get(bj,"baseData")||this.data;if(this.parent){bj=bj?Object.create(bj):{};bj.baseData=bh;return this.root.visibleData(bm,bj)}var bg=!!a4.get(bj,"inverted",!1),bk=!(!this.options.ignoreNulls&&!a4.get(bj,"ignoreNulls",!0)),bl="\x00"+bh.id+"|"+bg+"|"+bk+"|"+(null!=bm?bm:null),be=a4.lazy(this,"_visibleDataCache"),bi=be[bl];if(!bi){var bf=this.partData(bm,bh);bj=bj?Object.create(bj):{};bj.visible=!0;bj.isNull=bk?!1:null;bi=be[bl]=this._createVisibleData(bf,bj)}return bi},_createVisibleData:function(bg,bf){var be=this._serRole;return be&&be.isBound()?be.flatten(bg,bf):bg.where(null,bf)},_initMultiCharts:function(){var bi=this;bi.multiOptions=new aL.visual.MultiChart(bi);bi.smallOptions=new aL.visual.SmallChart(bi);var bk,bj,bf,be,bl=bi.multiOptions.option,bg=bi.visualRoles.multiChart.flatten(bi.data,{visible:!0,isNull:null}),bm=bg.childNodes;if(bi._isMultiChartOverflowClipRetry){bj=bi._clippedMultiChartRowsMax;bk=bi._clippedMultiChartColsMax;be=bk;bf=bj*bk}else{bf=bl("Max")}var bh=Math.min(bm.length,bf);if(0===bh){bk=bj=be=0}else{if(!bi._isMultiChartOverflowClipRetry){be=bl("ColumnsMax");bk=Math.min(bh,be);bk>=1&&isFinite(bk)||a4.assert("Must be at least 1 and finite");bj=Math.ceil(bh/bk);bj>=1||a4.assert("Must be at least 1")}}bi._multiInfo={data:bg,smallDatas:bm,count:bh,rowCount:bj,colCount:bk,colsMax:be}},_interpolate:function(be){if(this._interpolatable){var bf=a4.query(this.axesList).selectMany(a4.propGet("dataCells")).where(function(bh){var bg=bh.nullInterpolationMode;return !!bg&&"none"!==bg}).distinct(function(bg){return bg.role.name+"|"+(bg.dataPartValue||"")}).array();this._eachLeafDatasAndDataCells(be,bf,this._interpolateDataCell,this)}},_generateTrends:function(bf){var bh=this._getDataPartDimName();if(this._trendable&&bh){var bg=a4.query(this.axesList).selectMany(a4.propGet("dataCells")).where(a4.propGet("trend")).distinct(function(bi){return bi.role.name+"|"+(bi.dataPartValue||"")}).array(),be=[];this._eachLeafDatasAndDataCells(bf,bg,function(bj,bi){this._generateTrendsDataCell(be,bj,bi)},this);be.length&&this.data.owner.add(be)}},_eachLeafDatasAndDataCells:function(bm,bg,bh,bl){var bf=bg.length;if(bf){var bk,be;if(bm){bk=this._multiInfo.smallDatas;be=this._multiInfo.count}else{bk=[this.data];be=1}for(var bi=0;be>bi;bi++){for(var bn=bk[bi],bj=0;bf>bj;bj++){bh.call(bl,bg[bj],bn,bj,bi)}}}},_interpolateDataCell:function(){},_generateTrendsDataCell:function(){},_getTrendDataPartAtom:function(){var be=this._getDataPartDimName();return be?this.data.owner.dimensions(be).intern("trend"):void 0},setData:function(bf,be){this.setResultset(bf&&bf.resultset);this.setMetadata(bf&&bf.metadata);$.extend(this.options,be);return this},setResultset:function(be){!this.parent||a4.fail.operationInvalid("Can only set resultset on root chart.");this.resultset=be||[];this.resultset.length||this._warn("Resultset is empty");return this},setMetadata:function(be){!this.parent||a4.fail.operationInvalid("Can only set metadata on root chart.");this.metadata=be||[];this.metadata.length||this._warn("Metadata is empty");return this}});aL.BaseChart.add({_initPlots:function(bf){this.plotPanelList=null;if(this.parent){var be=this.root;this.plots=be.plots;this.plotList=be.plotList;this.plotsByType=be.plotsByType}else{this.plots={};this.plotList=[];this.plotsByType={};this._initPlotsCore(bf)}},_initPlotsCore:function(){},_addPlot:function(bi){var bl=this.plotsByType,bk=this.plots,bh=bi.type,be=bi.index,bf=bi.name,bg=bi.id;if(bf&&a4.hasOwn(bk,bf)){throw a4.error.operationInvalid("Plot name '{0}' already taken.",[bf])}if(a4.hasOwn(bk,bg)){throw a4.error.operationInvalid("Plot id '{0}' already taken.",[bg])}var bj=a4.array.lazy(bl,bh);if(a4.hasOwn(bj,be)){throw a4.error.operationInvalid("Plot index '{0}' of type '{1}' already taken.",[be,bh])}bi.globalIndex=this.plotList.length;bj[be]=bi;this.plotList.push(bi);bk[bg]=bi;bf&&(bk[bf]=bi)},_collectPlotAxesDataCells:function(bg,bf){var be=[];bg.collectDataCells(be);be.length&&a4.query(be).where(function(bh){return bh.role.isBound()}).each(function(bh){var bi=a4.array.lazy(bf,bh.axisType);a4.array.lazy(bi,bh.axisIndex).push(bh)})},_addPlotPanel:function(be){a4.lazy(this,"plotPanels")[be.plot.id]=be;a4.array.lazy(this,"plotPanelList").push(be)},_createPlotPanels:function(){throw a4.error.notImplemented()}});aL.BaseChart.add({colors:null,axes:null,axesList:null,axesByType:null,_axisClassByType:{color:aL.visual.ColorAxis,size:aL.visual.SizeAxis,base:aO,ortho:aO},_axisCreateChartLevel:{color:1,size:2,base:3,ortho:3},_axisSetScaleChartLevel:{color:1,size:2,base:2,ortho:2},_axisCreationOrder:["color","size","base","ortho"],_axisCreateIfUnbound:{},_chartLevel:function(){var be=0;this.parent||(be|=1);(this.parent||!this.visualRoles.multiChart.isBound())&&(be|=2);return be},_initAxes:function(){this.axes={};this.axesList=[];this.axesByType={};delete this._rolesColorScale;var be;if(this.parent){be=this.root._dataCellsByAxisTypeThenIndex}else{be={};this.plotList.forEach(function(bg){this._collectPlotAxesDataCells(bg,be)},this);this._dataCellsByAxisTypeThenIndex=be}var bf=this._chartLevel();this._axisCreationOrder.forEach(function(bg){if(0!==(this._axisCreateChartLevel[bg]&bf)){var bh,bi=be[bg];if(bi){bh=this._axisClassByType[bg];bh&&bi.forEach(function(bk,bj){new bh(this,bg,bj)},this)}else{if(this._axisCreateIfUnbound[bg]){bh=this._axisClassByType[bg];bh&&new bh(this,bg,0)}}}},this);this.parent&&this.root.axesList.forEach(function(bg){a4.hasOwn(this.axes,bg.id)||this._addAxis(bg)},this);a4.eachOwn(be,function(bh,bg){this._axisCreateChartLevel[bg]&bf&&bh.forEach(function(bj,bi){var bk=this.axes[aL.buildIndexedId(bg,bi)];bk.isBound()||bk.bind(bj)},this)},this)},_addAxis:function(bf){this.axes[bf.id]=bf;bf.chart===this&&(bf.axisIndex=this.axesList.length);this.axesList.push(bf);var bg=a4.array.lazy(this.axesByType,bf.type),be=bg.count||0;bf.typeIndex=be;bg[bf.index]=bf;be||(bg.first=bf);bg.count=be+1;"color"===bf.type&&bf.isBound()&&this._onColorAxisScaleSet(bf);return this},_getAxis:function(bf,be){var bg=this.axesByType[bf];return bg&&null!=be&&+be>=0?bg[be]:void 0},_setAxesScales:function(be){this.axesList.forEach(function(bf){this._axisSetScaleChartLevel[bf.type]&be&&bf.isBound()&&this._setAxisScale(bf,be)},this)},_setAxisScale:function(be,bf){this._setAxisScaleByScaleType(be,bf)},_setAxisScaleByScaleType:function(be,bf){switch(be.scaleType){case"discrete":this._setDiscreteAxisScale(be,bf);break;case"numeric":this._setNumericAxisScale(be,bf);break;case"timeSeries":this._setTimeSeriesAxisScale(be,bf);break;default:throw a4.error("Unknown axis scale type.")}},_describeScale:function(be,bf){bf.isNull&&aL.debug>=3&&this._log(a4.format("{0} scale for axis '{1}'- no data",[be.scaleType,be.id]))},_setDiscreteAxisScale:function(bf){if("color"!==bf.type){var be=bf.domainValues(),bg=new p.Scale.ordinal();be.length?bg.domain(be):bg.isNull=!0;this._describeScale(bf,bg);bf.setScale(bg)}else{this._setDiscreteColorAxisScale(bf)}},_setTimeSeriesAxisScale:function(bi){var bh=this._getContinuousVisibleExtentConstrained(bi),bk=new p.Scale.linear();if(bh){var bj=bh.min,bg=bh.max,be=1,bf=function(){var bl=bg-bj;if(bl&&Math.abs(bl)<be){bg=bj=new Date(Math.round((bj+bg)/2));bl=0}if(bl){0>bl&&(!bh.maxLocked||bh.minLocked?bg=new Date(bj.getTime()+aL.time.intervals.h):bj=new Date(bg.getTime()-aL.time.intervals.h))}else{bh.minLocked||(bj=new Date(bj.getTime()-aL.time.intervals.h));(!bh.maxLocked||bh.minLocked)&&(bg=new Date(bg.getTime()+aL.time.intervals.h))}};bf();bk.domain(bj,bg);bk.minLocked=bh.minLocked;bk.maxLocked=bh.maxLocked}else{bk.isNull=!0}this._describeScale(bi,bk);bi.setScale(bk)},_setNumericAxisScale:function(bi){if("color"!==bi.type){var bh=this._getContinuousVisibleExtentConstrained(bi),bl=new p.Scale.linear();if(bh){var bk=bh.min,bg=bh.max,be=1e-10,bf=function(){var bm=bg-bk;if(bm&&Math.abs(bm)<=be){bk=(bk+bg)/2;bk=bg=+bk.toFixed(10);bm=0}if(bm){0>bm&&(!bh.maxLocked||bh.minLocked?bg=Math.abs(bk)>be?1.01*bk:0.1:bk=Math.abs(bg)>be?0.99*bg:-0.1)}else{bh.minLocked||(bk=Math.abs(bk)>be?0.99*bk:-0.1);(!bh.maxLocked||bh.minLocked)&&(bg=Math.abs(bg)>be?1.01*bg:0.1)}};bf();var bj=bi.option.isDefined("OriginIsZero")&&bi.option("OriginIsZero");if(bj){if(0===bk){bh.minLocked=!0}else{if(0===bg){bh.maxLocked=!0}else{if(bk*bg>0){if(bk>0){if(!bh.minLocked){bh.minLocked=!0;bk=0}}else{if(!bh.maxLocked){bh.maxLocked=!0;bg=0}}bf()}}}}bl.domain(bk,bg);bl.minLocked=bh.minLocked;bl.maxLocked=bh.maxLocked}else{bl.isNull=!0}this._describeScale(bi,bl);bi.setScale(bl)}else{this._setNumericColorAxisScale(bi)}},_warnSingleContinuousValueRole:function(be){be.grouping.isSingleDimension||this._warn("A linear scale can only be obtained for a single dimension role.");be.grouping.isDiscrete()&&this._warn(a4.format("The single dimension of role '{0}' should be continuous.",[be.name]))},_getContinuousVisibleExtentConstrained:function(bg,bf,be){var bk,bi=function(){return bk||(bk=this.data.owner.dimensions(bg.role.grouping.firstDimensionName()))},bl=!1,bj=!1;if(null==bf&&bg.option.isDefined("FixedMin")){bf=bg.option("FixedMin");null!=bf&&(bf=bi.call(this).read(bf));bl=null!=bf;if(bl){bf=bf.value;0>bf&&bg.scaleUsesAbs()&&(bf=-bf)}}if(null==be&&bg.option.isDefined("FixedMax")){be=bg.option("FixedMax");null!=be&&(be=bi.call(this).read(be));bj=null!=be;if(bj){be=be.value;0>be&&bg.scaleUsesAbs()&&(be=-be)}}if(null==bf||null==be){var bh=this._getContinuousVisibleExtent(bg);if(!bh){return null}null==bf&&(bf=bh.min);null==be&&(be=bh.max)}return{min:bf,max:be,minLocked:bl,maxLocked:bj}},_getContinuousVisibleExtent:function(bf){var be=bf.dataCells;return 1===be.length?this._getContinuousVisibleCellExtent(bf,be[0]):a4.query(be).select(function(bg){return this._getContinuousVisibleCellExtent(bf,bg)},this).reduce(aL.unionExtents,null)},_getContinuousVisibleCellExtent:function(bn,bh){var be=bh.role;this._warnSingleContinuousValueRole(be);if("series"===be.name){throw a4.error.notImplemented()}var bf=bn.scaleSumNormalized(),bi=this.visibleData(bh.dataPartValue),bg=be.firstDimensionName();if(bf){var bk=bi.dimensionsSumAbs(bg);if(bk){return{min:0,max:bk}}}else{var bl=bn.scaleUsesAbs(),bo=bi.dimensions(bg).extent({abs:bl});if(bo){var bm=bo.min.value,bj=bo.max.value;return{min:bl?Math.abs(bm):bm,max:bl?Math.abs(bj):bj}}}},_setDiscreteColorAxisScale:function(be){var bg=be.domainValues(),bf=be.scheme()(bg);this._describeScale(be,bf);be.setScale(bf,!0);this._onColorAxisScaleSet(be)},_setNumericColorAxisScale:function(bg){if(1!==bg.dataCells.length){throw a4.error("Can't handle multiple continuous datacells in color axis.")}this._warnSingleContinuousValueRole(bg.role);var bf=this.visibleData(bg.dataCell.dataPartValue),bh=bg.option("NormByCategory"),be={type:bg.option("ScaleType"),colors:bg.option("Colors")().range(),colorDomain:bg.option("Domain"),colorMin:bg.option("Min"),colorMax:bg.option("Max"),colorMissing:bg.option("Missing"),data:bf,colorDimension:bg.role.firstDimensionName(),normPerBaseCategory:bh};if(bh){bg.scalesByCateg=B(be)}else{var bi=aK(be);this._describeScale(bg,bi);bg.setScale(bi)}this._onColorAxisScaleSet(bg)},_onColorAxisScaleSet:function(be){switch(be.index){case 0:this.colors=be.scheme();break;case 1:this._allowV1SecondAxis&&(this.secondAxisColor=be.scheme())}},_getRoleColorScale:function(be){return a4.lazy(a4.lazy(this,"_rolesColorScale"),be,this._createRoleColorScale,this)},_createRoleColorScale:function(be){function bg(bk){var bj=""+bk;a4.hasOwnProp.call(bf,bj)||(bf[bj]=bi(bk))}var bh,bi,bf={};this.axesByType.color.forEach(function(bl){var bk=bl.role,bj=bk.name===be||bk.sourceRole&&bk.sourceRole.name===be;if(bj&&bl.scale&&(0===bl.index||bl.option.isSpecified("Colors")||bl.option.isSpecified("Map"))){bi=bl.scale;bh||(bh=bi);bl.domainValues().forEach(bg)}},this);if(!bh){return aL.createColorScheme()()}bi=function(bl){var bk=""+bl;if(a4.hasOwnProp.call(bf,bk)){return bf[bk]}var bj=bh(bl);bf[bk]=bj;return bj};a4.copy(bi,bh);return bi},_onLaidOut:function(){}});aL.BaseChart.add({basePanel:null,titlePanel:null,legendPanel:null,_multiChartPanel:null,_initChartPanels:function(bg){this._initBasePanel();this._initTitlePanel();var bf=this._initLegendPanel(),be=bg&&!this.parent;be&&this._initMultiChartPanel();bf&&this._initLegendScenes(bf);if(!be){var bh=this.options;this._createContent({margins:bg?bh.smallContentMargins:bh.contentMargins,paddings:bg?bh.smallContentPaddings:bh.contentPaddings,clickAction:bh.clickAction,doubleClickAction:bh.doubleClickAction})}},_createContent:function(){},_initBasePanel:function(){var be=this.parent;this.basePanel=new aL.BasePanel(this,be&&be._multiChartPanel,{margins:this.margins,paddings:this.paddings,size:{width:this.width,height:this.height}})},_initTitlePanel:function(){var be=this,bg=be.options,bf=bg.title;if(!a4.empty(bf)){!be.parent;this.titlePanel=new aL.TitlePanel(be,be.basePanel,{title:bf,font:bg.titleFont,anchor:bg.titlePosition,align:bg.titleAlign,alignTo:bg.titleAlignTo,offset:bg.titleOffset,keepInBounds:bg.titleKeepInBounds,margins:bg.titleMargins,paddings:bg.titlePaddings,titleSize:bg.titleSize,titleSizeMax:bg.titleSizeMax})}},_initLegendPanel:function(){var bf=this.options;if(bf.legend){var be=new aL.visual.Legend(this,"legend",0);return this.legendPanel=new aL.LegendPanel(this,this.basePanel,{anchor:be.option("Position"),align:be.option("Align"),alignTo:bf.legendAlignTo,offset:bf.legendOffset,keepInBounds:bf.legendKeepInBounds,size:be.option("Size"),sizeMax:be.option("SizeMax"),margins:be.option("Margins"),paddings:be.option("Paddings"),font:be.option("Font"),scenes:a4.getPath(bf,"legend.scenes"),textMargin:bf.legendTextMargin,itemPadding:bf.legendItemPadding,itemSize:be.option("ItemSize"),markerSize:bf.legendMarkerSize})}},_getLegendBulletRootScene:function(){return this.legendPanel&&this.legendPanel._getBulletRootScene()},_initMultiChartPanel:function(){var bf=this.basePanel,be=this.options;this._multiChartPanel=new aL.MultiChartPanel(this,bf,{margins:be.contentMargins,paddings:be.contentPaddings});this._multiChartPanel.createSmallCharts();bf._children.unshift(bf._children.pop())},_coordinateSmallChartsLayout:function(){},_initLegendScenes:function(bk){var bh=this.axesByType.color;if(bh){var bl,bj,bg,bf=0,bi=this,be=function(bo,bn){if("togglevisible"===bo.option("LegendClickMode")){if(void 0===bl){bl=bi._getTrendDataPartAtom()||null;bl&&(bj=bl.dimension.name)}if(bl&&bn.firstAtoms()[bj]===bl){return"none"}}},bm=function(){return bg||(rootScene=bk._getBulletRootScene())};a4.query(bh).where(function(bn){return bn.option("LegendVisible")&&bn.isBound()&&bn.isDiscrete()}).each(function(bs){for(var br=bs.scale,bp=-1,bq=bs.dataCells,bu=bq.length;++bp<bu;){var bt=bq[bp],bo=bs.domainCellData(bp),bn=bm().createGroup({source:bo,colorAxis:bs,clickMode:be(bs,bo),extensionPrefix:aL.buildIndexedId("",bf++)});bt.legendGroupScene(bn);bs.domainCellItems(bo).forEach(function(bv){var bx=bn.createItem({source:bv}),bw=bs.domainItemValue(bv);bx.color=br(bw)})}})}}});aL.BaseChart.add({_updateSelectionSuspendCount:0,_lastSelectedDatums:null,clearSelections:function(){this.data.owner.clearSelected()&&this.updateSelections();return this},_updatingSelections:function(bf,be){this._suspendSelectionUpdate();try{bf.call(be||this)}finally{this._resumeSelectionUpdate()}},_suspendSelectionUpdate:function(){this===this.root?this._updateSelectionSuspendCount++:this.root._suspendSelectionUpdate()},_resumeSelectionUpdate:function(){this===this.root?this._updateSelectionSuspendCount>0&&(--this._updateSelectionSuspendCount||this.updateSelections()):this.root._resumeSelectionUpdate()},updateSelections:function(bg){if(this===this.root){if(this._inUpdateSelections||this._updateSelectionSuspendCount){return this}var bf=this._calcSelectedChangedDatums();if(!bf){return this}aL.removeTipsyLegends();this._inUpdateSelections=!0;try{var bi=this.options.selectionChangedAction;if(bi){var be=this.data.selectedDatums(),bh=bf.values();bi.call(this.basePanel.context(),be,bh)}a4.get(bg,"render",!0)&&this.useTextMeasureCache(function(){this.basePanel.renderInteractive()},this)}finally{this._inUpdateSelections=!1}}else{this.root.updateSelections()}return this},_calcSelectedChangedDatums:function(){if(this.data){var bg,be=this.data.selectedDatumMap(),bf=this._lastSelectedDatums;if(bf){bg=bf.symmetricDifference(be);if(!bg.count){return}}else{if(!be.count){return}bg=be.clone()}this._lastSelectedDatums=be;return bg}},_onUserSelection:function(be){if(!be||!be.length){return be}if(this===this.root){var bf=this.options.userSelectionAction;return bf?bf.call(this.basePanel.context(),be)||be:be}return this.root._onUserSelection(be)}});aL.BaseChart.add({_processExtensionPoints:function(){var bh;if(this.parent){bh=this.parent._components}else{var bg=this.options.extensionPoints;bh={};if(bg){for(var bi in bg){var bk,bj,bf=bi.indexOf("_");if(bf>0){bk=bi.substring(0,bf);bj=bi.substr(bf+1);if(bk&&bj){var be=a4.getOwn(bh,bk)||(bh[bk]=new a4.OrderedMap());be.add(bj,bg[bi])}}}}}this._components=bh},extend:function(bg,bf,be){a4.array.is(bf)?bf.forEach(function(bh){this._extendCore(bg,bh,be)},this):this._extendCore(bg,bf,be)},_extendCore:function(bk,bg,bl){if(bk){var bn=a4.getOwn(this._components,bg);if(bn){bk.borderPanel&&(bk=bk.borderPanel);var be=aL.debug>=3?[]:null,bi=a4.get(bl,"constOnly",!1),bh=bk.wrap,bm={tag:aL.extensionTag},bf=bk instanceof Z,bj=bf&&(bh||bi),bo=function(br,bq){if(null!=br){var bs=typeof br;if("object"===bs){if("svg"===bq||"css"===bq){var bt=bk.propertyValue(bq);bt&&(br=a4.copy(bt,br))}else{if(br instanceof Array){return br.map(function(bu){return bo(bu,bq)})}}}else{if(bj&&"function"===bs){if(bi){return}"add"!==bq&&"call"!==bq&&(br=bh.call(bk,br,bq))}}}return br},bp=function(br,bq){bq instanceof Array?br.apply(bk,bq):br.call(bk,bq)};bn.forEach(function(br,bq){if(bk.isLocked&&bk.isLocked(bq)){be&&be.push(bq+": locked extension point!")}else{if(bk.isIntercepted&&bk.isIntercepted(bq)){be&&be.push(bq+":"+aL.stringify(br)+" (controlled)")}else{be&&be.push(bq+": "+aL.stringify(br));br=bo(br,bq);if(void 0!==br){var bs=bk[bq];"function"==typeof bs?bf&&bk.properties[bq]?bk.intercept(bq,br,bm):br instanceof Array?br.forEach(function(bt){bp(bs,bt)}):bp(bs,br):bk[bq]=br}}}});be&&(be.length?this._log("Applying Extension Points for: '"+bg+"'\n	* "+be.join("\n	* ")):aL.debug>=5&&this._log("No Extension Points for: '"+bg+"'"))}}else{aL.debug>=4&&this._log("Applying Extension Points for: '"+bg+"' (target mark does not exist)")}},_getExtension:function(bi,bh){var be;if(a4.array.is(bi)){for(var bg,bf=bi.length-1;bf>=0;){be=a4.getOwn(this._components,bi[bf--]);if(be&&void 0!==(bg=be.get(bh))){return bg}}}else{be=a4.getOwn(this._components,bi);if(be){return be.get(bh)}}},_getComponentExtensions:function(be){return a4.getOwn(this._components,be)},_getConstantExtension:function(bg,bf){var be=this._getExtension(bg,bf);return a4.fun.is(be)?void 0:be}});a4.type("pvc.BasePanel",aL.Abstract).add(aL.visual.Interactive).init(function(bh,bn,bp){this.chart=bh;this.base();this.axes=Object.create(bh.axes);if(bp){if(bp.scenes){this._sceneTypeExtensions=bp.scenes;delete bp.scenes}var bg=bp.axes;if(bg){a4.copy(this.axes,bg);delete bp.axes}}$.extend(this,bp);this.axes.color||(this.axes.color=bh.axes.color);this.position={};var bj=bp&&bp.margins;bn||void 0!==bj||(bj=3);this.margins=new aD(bj);this.paddings=new aD(bp&&bp.paddings);this.size=new s(bp&&bp.size);this.sizeMax=new s(bp&&bp.sizeMax);if(bn){this.parent=bn;this.isTopRoot=!1;this.isRoot=bn.chart!==bh;this.root=this.isRoot?this:bn.root;this.topRoot=bn.topRoot;this._ibits=bn._ibits;if(this.isRoot){this.position.left=bh.left;this.position.top=bh.top}bn._addChild(this)}else{this.parent=null;this.root=this;this.topRoot=this;this.isRoot=!0;this.isTopRoot=!0;this._ibits=bh._ibits}this.data=(this.isRoot?bh:bn).data;if(this.isRoot){this.anchor=null;this.align=null;this.alignTo=null;this.offset=null}else{this.align=aL.parseAlign(this.anchor,this.align);var bf=this.alignTo,bi=this.anchor;null==bf||""===bf||"left"!==bi&&"right"!==bi?bf=this.align:"page-middle"!==bf&&(bf=isNaN(+bf.charAt(0))?aL.parseAlign(bi,bf):l.parse(bf));this.alignTo=bf;this.offset=new aZ(this.offset)}if(null==this.borderWidth){var be,bo=this._getExtensionId();if(bo){var bk=this._getExtension(bo,"strokeStyle");if(null!=bk){be=+this._getConstantExtension(bo,"lineWidth");(isNaN(be)||!isFinite(be))&&(be=null)}}this.borderWidth=null==be?0:1.5}var bm=aL.visual.Interactive,bl=this._ibits;bl=a4.bit.set(bl,bm.Clickable,bh._ibits&bm.Clickable&&!!this.clickAction);bl=a4.bit.set(bl,bm.DoubleClickable,bh._ibits&bm.DoubleClickable&&!!this.doubleClickAction);this._ibits=bl}).add({chart:null,parent:null,_children:null,type:p.Panel,_extensionPrefix:"",_rubberSelectableMarks:null,height:null,width:null,borderWidth:null,anchor:"top",pvPanel:null,margins:null,paddings:null,isRoot:!1,isTopRoot:!1,root:null,topRoot:null,_layoutInfo:null,_signs:null,data:null,dataPartValue:null,_animating:0,_selectingByRubberband:!1,_v1DimRoleName:{series:"series",category:"category",value:"value"},_sceneTypeExtensions:null,clickAction:null,doubleClickAction:null,compatVersion:function(be){return this.chart.compatVersion(be)},_createLogInstanceId:function(){return""+this.constructor+this.chart._createLogChildSuffix()},_getLegendBulletRootScene:function(){return this.chart._getLegendBulletRootScene()},_addChild:function(be){be.parent===this||a4.assert("Child has a != parent.");(this._children||(this._children=[])).push(be)},_addSign:function(be){a4.array.lazy(this,"_signs").push(be);be.selectableByRubberband()&&a4.array.lazy(this,"_rubberSelectableMarks").push(be.pvMark)},visibleData:function(be){return this.chart.visibleData(this.dataPartValue,be)},partData:function(){return this.chart.partData(this.dataPartValue)},layout:function(bp,bk){if(!this._layoutInfo||a4.get(bk,"force",!1)){var bo=a4.get(bk,"referenceSize");!bo&&bp&&(bo=a4.copyOwn(bp));var bi=this.size.resolve(bo),bj=this.sizeMax.resolve(bo);if(!bp){if(null==bi.width||null==bi.height){throw a4.error.operationInvalid("Panel layout without width or height set.")}bp=a4.copyOwn(bi)}!bo&&bp&&(bo=a4.copyOwn(bp));null!=bj.width&&bp.width>bj.width&&(bp.width=bj.width);null!=bj.height&&bp.height>bj.height&&(bp.height=bj.height);var bs=this.borderWidth/2,bm=(a4.get(bk,"margins")||this.margins).resolve(bo),bu=(a4.get(bk,"paddings")||this.paddings).resolve(bo),be=aD.inflate(bm,bs),bf=aD.inflate(bu,bs),bg=be.width+bf.width,bw=be.height+bf.height,bt=new s(Math.max(bp.width-bg,0),Math.max(bp.height-bw,0)),bv=a4.copyOwn(bi);null!=bv.width&&(bv.width=Math.max(bv.width-bg,0));null!=bv.height&&(bv.height=Math.max(bv.height-bw,0));var bn=this._layoutInfo||null,bl=a4.get(bk,"canChange",!0),br=this._layoutInfo={canChange:bl,referenceSize:bo,realMargins:bm,realPaddings:bu,borderWidth:this.borderWidth,margins:be,paddings:bf,desiredClientSize:bv,clientSize:bt,pageClientSize:bn?bn.pageClientSize:bt.clone(),previous:bn};if(bn){delete bn.previous;delete bn.pageClientSize}var bq,bh=this._calcLayout(br);if(bh){br.clientSize=bh;bq={width:bh.width+bg,height:bh.height+bw}}else{bq=bp;bh=bt}this.isVisible=bh.width>0&&bh.height>0;delete br.desiredClientSize;this.width=bq.width;this.height=bq.height;!bl&&bn&&delete br.previous;if(aL.debug>=5){this._log("Size       = "+aL.stringify(bq));this._log("Margins    = "+aL.stringify(br.margins));this._log("Paddings   = "+aL.stringify(br.paddings));this._log("ClientSize = "+aL.stringify(br.clientSize))}this._onLaidOut()}},_onLaidOut:function(){this.isRoot&&this.chart._onLaidOut()},_calcLayout:function(bn){function bv(bB,bz,by){for(var bA=0;bB--;){if(bz.call(by,bB,bA)===!1){return !0}bA++}return !1}function bf(bB,bA){be&&bu._group("LayoutCycle #"+(bA+1)+" (remaining: "+bB+")");try{var bC=bB>0;bg=new aD(0);bl=a4.copyOwn(bj);for(var bD,by=0,bz=bo.length;bz>by;){bD=bo[by];be&&bu._group("SIDE Child #"+(by+1)+" at "+bD.anchor);try{if(br.call(this,bD,bC)){return !0}}finally{be&&bu._groupEnd()}by++}by=0;bz=bh.length;for(;bz>by;){bD=bh[by];be&&bu._group("FILL Child #"+(by+1));try{if(br.call(this,bD,bC)){return !0}}finally{be&&bu._groupEnd()}by++}return !1}finally{be&&bu._groupEnd()}}function br(bB,bA){var bz,by=!1;bt.canChange=bA;bv(3,function(bE,bD){be&&bu._group("Attempt #"+(bD+1));try{bt.paddings=bz;bt.canChange=bE>0;bB.layout(new s(bl),bt);if(bB.isVisible){by=bi.call(this,bB,bA);if(by){return !1}var bC=bB._layoutInfo.requestPaddings;if(bs(bz,bC)){bz=bC;if(bE>0){bz=new aD(bz);be&&this._log("Child requested paddings change: "+aL.stringify(bz));return !0}aL.debug>=2&&this._warn("Child requests paddings change but iterations limit has been reached.")}bx.call(this,bB);"fill"!==bB.anchor&&bk.call(this,bB)}return !1}finally{be&&bu._groupEnd()}},this);return by}function bs(by,bz){return bz?a4.query(aD.names).each(function(bC){var bB=by&&by[bC]||0,bA=bz&&bz[bC]||0;return Math.abs(bA-bB)>=0.1?!1:void 0}):!1}function bi(bC,bB){var bz=!1,bA=bC.width-bl.width;if(bA>0){aL.debug>=3&&this._log("Child added width = "+bA);if(bB){bz=!0;bl.width+=bA;bj.width+=bA}else{aL.debug>=2&&this._warn("Child wanted more width, but layout iterations limit has been reached.")}}var by=bC.height-bl.height;if(by>0){aL.debug>=3&&this._log("Child added height ="+by);if(bB){bz=!0;bl.height+=by;bj.height+=by}else{aL.debug>=2&&this._warn("Child wanted more height, but layout iterations limit has been reached.")}}return bz}function bx(by){var bz,bI=by.anchor,bF=by.align,bG=by.alignTo;if("fill"===bI){bI="left";bz=bg.left+bl.width/2-by.width/2;bF=bG="middle"}else{bz=bg[bI]}var bB,bH;switch(bF){case"top":case"bottom":case"left":case"right":bB=bF;bH=0;break;case"center":case"middle":bB=bw[bm[bI]];bH=-by[bp[bB]]/2}var bA,bE;switch(bG){case"top":case"bottom":case"left":case"right":bE=bG;bA=bE!==bB?bl[bp[bB]]:0;break;case"center":case"middle":bE=bw[bm[bI]];bA=bl[bp[bB]]/2;break;case"page-center":case"page-middle":bE=bw[bm[bI]];var bD=bp[bB],bK=Math.min(bl[bD],bn.pageClientSize[bD]);bA=bK/2}var bC=bg[bE]+bA+bH,bJ=by.offset.resolve(bl);if(bJ){bz+=bJ[bq[bI]]||0;bC+=bJ[bq[bB]]||0}if(by.keepInBounds){0>bz&&(bz=0);0>bC&&(bC=0)}by.setPosition(a4.set({},bI,bz,bB,bC))}function bk(bB){var bz=bB.anchor,by=bp[bz],bA=bB[by];bg[bz]+=bA;bl[by]-=bA}var bj,bg,bl,be,bu=this;if(bu._children){var bp=aL.BasePanel.orthogonalLength,bm=aL.BasePanel.relativeAnchor,bw=aL.BasePanel.leftTopAnchor,bq=aZ.namesSidesToOffset,bh=[],bo=[];bu._children.forEach(function(bz){var by=bz.anchor;if(by){if("fill"===by){bh.push(bz)}else{a4.hasOwn(bm,by)||a4.fail.operationInvalid("Unknown anchor value '{0}'",[by]);bo.push(bz)}}});be=aL.debug>=5;bj=a4.copyOwn(bn.clientSize);var bt={force:!0,referenceSize:bj};be&&bu._group("CCC DOCK LAYOUT clientSize = "+aL.stringify(bj));try{bv(5,bf,bu)}finally{be&&bu._groupEnd()}}return bj},invalidateLayout:function(){this._layoutInfo=null;this._children&&this._children.forEach(function(be){be.invalidateLayout()})},_create:function(be){if(!this.pvPanel||be){var bp;delete this._invalidDataError;this.pvPanel=null;this.pvRootPanel&&(this.pvRootPanel=null);delete this._signs;try{this.layout()}catch(bl){if(!(bl instanceof InvalidDataException)){throw bl}this._invalidDataError=bp=bl}if(this.isTopRoot&&this.chart._isMultiChartOverflowClip){return}if(!this.isVisible){return}this.isRoot&&this._creating();var bm=this._layoutInfo.margins,bh=this._layoutInfo.paddings;if(this.isTopRoot){this.pvRootPanel=this.pvPanel=new p.Panel().canvas(this.chart.options.canvas);var bj=new aL.visual.Scene(null,{panel:this});this.pvRootPanel.lock("data",[bj]);if(bm.width>0||bm.height>0){this.pvPanel.width(this.width).height(this.height);this.pvPanel=this.pvPanel.add(p.Panel)}}else{this.pvPanel=this.parent.pvPanel.add(this.type)}var bg=this.pvPanel,bf=this.width-bm.width,bq=this.height-bm.height;bg.width(bf).height(bq);aL.debug>=15&&(bm.width>0||bm.height>0)&&(this.isTopRoot?this.pvRootPanel:this.parent.pvPanel).add(this.type).width(this.width).height(this.height).left(null!=this.position.left?this.position.left:null).right(null!=this.position.right?this.position.right:null).top(null!=this.position.top?this.position.top:null).bottom(null!=this.position.bottom?this.position.bottom:null).strokeStyle("orange").lineWidth(1).strokeDasharray("- .");var bk={};a4.eachOwn(this.position,function(br,bs){bg[bs](br+bm[bs]);bk[this.anchorLength(bs)]=!0},this);if(!bk.width){bm.left>0&&bg.left(bm.left);bm.right>0&&bg.right(bm.right)}if(!bk.height){bm.top>0&&bg.top(bm.top);bm.bottom>0&&bg.bottom(bm.bottom)}(bh.width>0||bh.height>0)&&(this.pvPanel=bg.add(p.Panel).width(bf-bh.width).height(bq-bh.height).left(bh.left).top(bh.top));bg.borderPanel=bg;bg.paddingPanel=this.pvPanel;this.pvPanel.paddingPanel=this.pvPanel;this.pvPanel.borderPanel=bg;if(aL.debug>=15){this.pvPanel.strokeStyle("lightgreen").lineWidth(1).strokeDasharray("- ");this.pvPanel!==bg&&bg.strokeStyle("blue").lineWidth(1).strokeDasharray(". ")}var bo=this._getExtensionId();new aL.visual.Panel(this,null,{panel:bg,extensionId:bo});if(!bp){try{this._createCore(this._layoutInfo)}catch(bl){if(!(bl instanceof InvalidDataException)){throw bl}this._invalidDataError=bp=bl}}if(bp){var bn=bg.anchor("center").add(p.Label).text(bp.message);this.chart.extend(bn,"invalidDataMessage")}if(this.isTopRoot){this.chart._multiChartOverflowClipped&&this._addMultichartOverflowClipMarker();this._initSelection()}this.applyExtensions();if(this.isRoot&&aL.debug>5){var bi=["SCALES SUMMARY",aL.logSeparator];this.chart.axesList.forEach(function(br){var bu=br.scale;if(bu){var bt=bu.domain&&bu.domain(),bs=bu.range&&bu.range();bi.push(br.id);bi.push("    domain: "+(bt?aL.stringify(bt):"?"));bi.push("    range : "+(bs?aL.stringify(bs):"?"))}},this);this._log(bi.join("\n"))}}},_creating:function(){this._children&&this._children.forEach(function(be){be._creating()})},_createCore:function(){this._children&&this._children.forEach(function(be){be._create()})},render:function(bh){if(!this.isTopRoot){return this.topRoot.render(bh)}this._create(a4.get(bh,"recreate",!1));if((!this.isTopRoot||!this.chart._isMultiChartOverflowClip)&&this.isVisible){var bi=this.pvRootPanel;if(this._invalidDataError){bi.render()}else{this._onRender();var bg=(this.chart.options,this._animating),be=this.chart.animatable();this._animating=be&&!a4.get(bh,"bypassAnimation",!1)?1:0;try{bi.render();if(this._animating){this._animating=2;var bf=this;bi.transition().duration(2000).ease("cubic-in-out").start(function(){if(bg){bg=0}else{bf._animating=0;bf._onRenderEnd(!0)}})}else{this._onRenderEnd(!1)}}finally{this._animating=0}}}},_onRender:function(){var bf=this.chart.options.renderCallback;if(bf){if(this.compatVersion()<=1){bf.call(this.chart)}else{var be=this.context();bf.call(be,be.scene)}}},_onRenderEnd:function(be){this._children&&this._children.forEach(function(bf){bf._onRenderEnd(be)})},renderInteractive:function(){if(this.isVisible){var be=this._getSelectableMarks();if(be&&be.length){be.forEach(function(bf){bf.render()})}else{if(!this._children){this.pvPanel.render();return}}this._children&&this._children.forEach(function(bf){bf.renderInteractive()})}},_getSelectableMarks:function(){return this._rubberSelectableMarks},animate:function(bf,be){return 1===this.topRoot._animating?bf:be},animatingStart:function(){return 1===this.topRoot._animating},animating:function(){return this.topRoot._animating>0},setPosition:function(be){for(var bf in be){if(a4.hasOwn(aD.namesSet,bf)){var bg=be[bf];if(null===bg){delete this.position[bf]}else{bg=+bg;!isNaN(bg)&&isFinite(bg)&&(this.position[bf]=bg)}}}},createAnchoredSize:function(bf,be){return this.isAnchorTopOrBottom()?new s(be.width,Math.min(be.height,bf)):new s(Math.min(be.width,bf),be.height)},applyExtensions:function(){this._signs&&this._signs.forEach(function(be){be.applyExtensions()})},extend:function(bg,bf,be){this.chart.extend(bg,this._makeExtensionAbsId(bf),be)},extendAbs:function(bg,be,bf){this.chart.extend(bg,be,bf)},_extendSceneType:function(bg,bf,bh){var be=a4.get(this._sceneTypeExtensions,bg);be&&aL.extendType(bf,be,bh)},_absBaseExtId:{abs:"base"},_absSmallBaseExtId:{abs:"smallBase"},_getExtensionId:function(){return this.isRoot?this.chart.parent?this._absSmallBaseExtId:this._absBaseExtId:void 0},_getExtensionPrefix:function(){return this._extensionPrefix},_makeExtensionAbsId:function(be){return aL.makeExtensionAbsId(be,this._getExtensionPrefix())},_getExtension:function(bf,be){return this.chart._getExtension(this._makeExtensionAbsId(bf),be)},_getExtensionAbs:function(be,bf){return this.chart._getExtension(be,bf)},_getConstantExtension:function(bf,be){return this.chart._getConstantExtension(this._makeExtensionAbsId(bf),be)},getPvPanel:function(bf){var bg=this.pvPanel;if(!bf){return bg}if(!this.parent){throw a4.error.operationInvalid("Layers are not possible in a root panel.")}if(!bg){throw a4.error.operationInvalid("Cannot access layer panels without having created the main panel.")}var bi=null;this._layers?bi=this._layers[bf]:this._layers={};if(!bi){var be=this.parent.pvPanel;bi=be.borderPanel.add(this.type).extend(bg.borderPanel);var bh=bi;bg!==bg.borderPanel&&(bi=bh.add(p.Panel).extend(bg));bh.borderPanel=bh;bh.paddingPanel=bi;bi.paddingPanel=bi;bi.borderPanel=bh;this.initLayerPanel(bi,bf);this._layers[bf]=bi}return bi},initLayerPanel:function(){},_getV1DimName:function(bf){var be=this._v1DimName||(this._v1DimNameCache={}),bg=be[bf];if(null==bg){var bh=this.chart.visualRoles[this._v1DimRoleName[bf]];bg=bh?bh.firstDimensionName():"";be[bf]=bg}return bg},_getV1Datum:function(be){return be.datum},context:function(){var be=this._context;!be||be.isPinned?be=this._context=new aL.visual.Context(this):U.call(be);return be},_isTooltipEnabled:function(){return !this.selectingByRubberband()&&!this.animating()},_getTooltipFormatter:function(bf){var be=this.compatVersion()<=1,bg=bf.format;if(!bg){if(!be){return this._summaryTooltipFormatter}bg=this.chart.options.v1StyleTooltipFormat;if(!bg){return}}return be?function(bh){return bg.call(bh.panel,bh.getV1Series(),bh.getV1Category(),bh.getV1Value()||"",bh.getV1Datum())}:function(bh){return bg.call(bh,bh.scene)}},_summaryTooltipFormatter:function(bf){function bm(bv,bu){bs.push("<b>"+bv+"</b>: "+(a4.html.escape(bu)||" - ")+"<br/>")}function bg(bu,bw){var bv;bv=bo?bo.dimensions(bw).valuePercent(bq):bk.dimensions(bw).percent(bu.value,bq);return bh(bv)}var bl=bf.scene;if(!bl.datum){return""}var bo=bl.group,bt=bo&&bo.count()>1,bi=bl.datum;if(!bt&&(!bi||bi.isNull)){return""}var bk=bl.data(),bq={visible:!0},bs=[];bi.isInterpolated?bs.push("<i>Interpolation</i>: "+a4.html.escape(bi.interpolation)+"<br/>"):bi.isTrend&&bs.push("<i>"+a4.html.escape(bi.trend.label)+"</i><br/>");var br=bk.type,bp=bf.panel.stacked===!1?null:br.getPlayingPercentVisualRoleDimensionMap(),bh=bp?bf.chart.options.percentValueFormat:null,bn=bt?bo.atoms:bl.datum.atoms,bj=br.sortDimensionNames(a4.keys(bn)),be=!1;bj.forEach(function(bv){var bu=bn[bv],bx=bu.dimension.type;if(!(bx.isHidden||bt&&null==bu.value)){be=!0;var bw=bu.label;bp&&bp.has(bv)&&(bw+=" ("+bg(bu,bv)+")");bm(a4.html.escape(bu.dimension.type.label),bw)}});if(bt){be&&bs.push("<hr />");bs.push("<b>#</b>: "+bo._datums.length+"<br/>");br.sortDimensionNames(bo.freeDimensionsNames()).forEach(function(bw){var bv=bo.dimensions(bw);if(!bv.type.isHidden){var bx,bu=a4.html.escape(bv.type.label);if(bv.type.valueType===Number){bx=bv.format(bv.value(bq));bp&&bp.has(bw)&&(bx+=" ("+bg(null,bw)+")");bu="&sum; "+bu}else{bx=bv.atoms(bq).map(function(by){return by.label||"- "}).join(", ")}bm(bu,bx)}})}return'<div style="text-align: left;">'+bs.join("\n")+"</div>"},_onClick:function(be){var bf=this.clickAction;bf&&(this.compatVersion()<=1?this._onV1Click(be,bf):bf.call(be,be.scene))},_onDoubleClick:function(be){var bf=this.doubleClickAction;bf&&(this.compatVersion()<=1?this._onV1DoubleClick(be,bf):bf.call(be,be.scene))},_onV1Click:function(be,bf){bf.call(be.pvMark,be.getV1Series(),be.getV1Category(),be.getV1Value(),be.event,be.getV1Datum())},_onV1DoubleClick:function(be,bf){bf.call(be.pvMark,be.getV1Series(),be.getV1Category(),be.getV1Value(),be.event,be.getV1Datum())},_addMultichartOverflowClipMarker:function(){function bh(bk){var bj=bk.shapeRadius();if(null==bj){var bi=bk.shapeSize();null!=bi&&(bj=Math.sqrt(bi))}return bj||bg}var be=10,bg=5,bf=new aL.visual.Dot(this,this.pvPanel,{noSelect:!0,noHover:!0,noClick:!0,noDoubleClick:!0,noTooltip:!1,freePosition:!0,extensionId:"multiChartOverflowMarker"}).lock("data").pvMark.shape("triangle").shapeRadius(bg).top(null).left(null).bottom(function(){return bh(this)+be}).right(function(){return bh(this)+be}).shapeAngle(0).lineWidth(1.5).strokeStyle("red").fillStyle("rgba(255, 0, 0, 0.2)");a4.fun.is(bf.tooltip)&&bf.tooltip("Some charts did not fit the available space.")},selectingByRubberband:function(){return this.topRoot._selectingByRubberband},_initSelection:function(){var bm=this,bl=bm.chart;if(bm.interactive()){var bi=bm.unselectable(),bo=bm.selectableByRubberband();if(bo||bi){var bh=bm.data,bg=bm.pvRootPanel||bm.pvPanel.paddingPanel;bm._getExtensionAbs("base","fillStyle")||bg.fillStyle(aL.invisibleFill);bg.lock("events","all");if(bo){var bj=4;bm._selectingByRubberband=!1;var bk,bf,bn,be=this.selectBar=new aL.visual.Bar(bm,bg,{extensionId:"rubberBand",normalStroke:!0,noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0}).override("defaultStrokeWidth",a4.fun.constant(1.5)).override("defaultColor",function(bq,bp){return"stroke"===bp?"#86fe00":"rgba(203, 239, 163, 0.6)"}).override("interactiveColor",function(bq,bp){return bp}).pvMark.lock("visible",function(){return !!bf}).lock("left",function(){return bf.x}).lock("right").lock("top",function(){return bf.y}).lock("bottom").lock("width",function(){return bf.dx}).lock("height",function(){return bf.dy}).lock("cursor").lock("events","none");bg.intercept("data",function(){var bp=this.delegate();bp&&bp.forEach(function(bq){null==bq.x&&(bq.x=bq.y=bq.dx=bq.dy=0)});return bp}).event("mousedown",p.Behavior.select().autoRender(!1)).event("select",function(bp){if(bf){bf=new p.Shape.Rect(bp.x,bp.y,bp.dx,bp.dy)}else{if(bm.animating()){return}if(bp.dx*bp.dx+bp.dy*bp.dy<=bj){return}bf=new p.Shape.Rect(bp.x,bp.y,bp.dx,bp.dy);bm._selectingByRubberband=!0;bk||(bk=bg.toScreenTransform());bm.rubberBand=bf.apply(bk)}be.render()}).event("selectend",function(){if(bf){var bp=arguments[arguments.length-1];bk||(bk=bg.toScreenTransform());var bq=bf.apply(bk);bf=null;bm._selectingByRubberband=!1;be.render();try{bm._processRubberBand(bq,bp)}finally{bn=new Date()}}});bi&&bg.event("click",function(){if(bn){var bp=new Date()-bn;if(300>bp){bn=null;return}}bh.clearSelected()&&bl.updateSelections()})}else{bi&&bg.event("click",function(){bh.clearSelected()&&bl.updateSelections()})}}}},_processRubberBand:function(bg,bf,be){this.rubberBand=bg;try{this._onRubberBandSelectionEnd(bf,be)}finally{this.rubberBand=null}},_onRubberBandSelectionEnd:function(bh,bg){aL.debug>=20&&this._log("rubberBand "+aL.stringify(this.rubberBand));bg=Object.create(bg||{});bg.toggle=!1;var be=this._getDatumsOnRubberBand(bh,bg);if(be){var bf=this.chart;bf._updatingSelections(function(){var bi=!bh.ctrlKey&&bf.options.ctrlSelectMode;if(bi){bf.data.owner.clearSelected();aL.data.Data.setSelected(be,!0)}else{bg.toggle?aL.data.Data.toggleSelected(be):aL.data.Data.setSelected(be,!0)}})}},_getDatumsOnRubberBand:function(bh,bg){var bf=new a4.Map();this._getDatumsOnRect(bf,this.rubberBand,bg);var be=bf.values();if(be.length){be=this.chart._onUserSelection(be);be&&!be.length&&(be=null)}return be},_getDatumsOnRect:function(bh,bg,bf){this._getOwnDatumsOnRect(bh,bg,bf);var be=this._children;be&&be.forEach(function(bi){bi._getDatumsOnRect(bh,bg,bf)})},_getOwnDatumsOnRect:function(bi,bk,bg){var bj=this;if(!bj.isVisible){return !1}var bf=bj._getSelectableMarks();if(!bf||!bf.length){return !1}var bn=bi.count,bm=a4.get(bg,"markSelectionMode"),bl=function(bo){bo.isNull||bi.set(bo.id,bo)},be=function(bo){bo.selectableByRubberband()&&bo.datums().each(bl)},bh=function(bo){bo.eachSceneWithDataOnRect(bk,be,null,bm)};bf.forEach(bh);return bn<bi.count},isAnchorTopOrBottom:function(be){be||(be=this.anchor);return"top"===be||"bottom"===be},isOrientationVertical:function(be){return this.chart.isOrientationVertical(be)},isOrientationHorizontal:function(be){return this.chart.isOrientationHorizontal(be)}}).addStatic({relativeAnchor:{top:"left",bottom:"left",left:"bottom",right:"bottom"},leftBottomAnchor:{top:"bottom",bottom:"bottom",left:"left",right:"left"},leftTopAnchor:{top:"top",bottom:"top",left:"left",right:"left"},horizontalAlign:{top:"right",bottom:"left",middle:"center",right:"right",left:"left",center:"center"},verticalAlign:{top:"top",bottom:"bottom",middle:"middle",right:"bottom",left:"top",center:"middle"},verticalAlign2:{top:"top",bottom:"bottom",middle:"middle",right:"top",left:"bottom",center:"middle"},relativeAnchorMirror:{top:"right",bottom:"right",left:"top",right:"top"},oppositeAnchor:{top:"bottom",bottom:"top",left:"right",right:"left"},parallelLength:{top:"width",bottom:"width",right:"height",left:"height"},orthogonalLength:{top:"height",bottom:"height",right:"width",left:"width"},oppositeLength:{width:"height",height:"width"}});a4.scope(function(){var bg=aL.BasePanel,bf={},be={anchorOrtho:"relativeAnchor",anchorOrthoMirror:"relativeAnchorMirror",anchorOpposite:"oppositeAnchor",anchorLength:"parallelLength",anchorOrthoLength:"orthogonalLength"};a4.eachOwn(be,function(bi,bh){var bj=bg[bi];bf[bh]=function(bk){return bj[bk||this.anchor]}});bg.add(bf)});a4.type("pvc.PlotPanel",aL.BasePanel).init(function(bi,bh,bj,bf){this.base(bi,bh,bf);this.plot=bj;this._extensionPrefix=bj.extensionPrefixes;this.dataPartValue=bj.option("DataPart");this.axes.color=bi._getAxis("color",(bj.option("ColorAxis")||0)-1);this.orientation=bj.option("Orientation");this.valuesVisible=bj.option("ValuesVisible");this.valuesAnchor=bj.option("ValuesAnchor");this.valuesMask=bj.option("ValuesMask");this.valuesFont=bj.option("ValuesFont");this.valuesOverflow=bj.option("ValuesOverflow");this.valuesOptimizeLegibility=bj.option("ValuesOptimizeLegibility");var bg=this.visualRoles=Object.create(bi.visualRoles),be=bj.option("ColorRole");bg.color=be?bi.visualRole(be):null;this.chart._addPlotPanel(this)}).add({anchor:"fill",visualRoles:null,_getExtensionId:function(){var be=["chart","plot"];this.plotName&&be.push(this.plotName);return be},defaultLegendGroupScene:function(){var be=this.axes.color;return be&&be.option("LegendVisible")&&be.isBound()?a4.query(be.dataCells).where(function(bf){return bf.plot===this.plot},this).select(function(bf){return bf.legendGroupScene()}).first(a4.notNully):void 0},isOrientationVertical:function(){return this.orientation===aL.orientation.vertical},isOrientationHorizontal:function(){return this.orientation===aL.orientation.horizontal}});a4.type("pvc.MultiChartPanel",aL.BasePanel).add({anchor:"fill",createSmallCharts:function(){var bg,bn=this.chart,bv=bn._multiInfo;if(bv&&(bg=bv.count)){var bq,bf,bi,bt=this._getCoordinatedRootAxesByScopeType();if(bt){bq={};bf=function(bx,by,bw){var bz=a4.array.lazy(bq,by);a4.array.lazy(bz,bw).push(bx)};bi=function(bw){bt.row&&bf(bw,"row",bw.smallRowIndex);bt.column&&bf(bw,"column",bw.smallColIndex);bt.global&&bf(bw,"global",0)}}for(var be=this._buildSmallChartsBaseOptions(),bj=bn.constructor,bs=bv.smallDatas,bo=bv.colCount,bh=0;bg>bh;bh++){var bm=bs[bh],bp=bh%bo,bk=Math.floor(bh/bo),br=a4.set(Object.create(be),"smallColIndex",bp,"smallRowIndex",bk,"title",bm.absLabel,"data",bm),bl=new bj(br);if(bt){bl._createPhase1();bi(bl)}else{bl._create()}}if(bt){var bu=this;a4.eachOwn(bt,function(bx,bw){bx.forEach(function(by){bq[bw].forEach(function(bz){bu._coordinateScopeAxes(by.id,bz)})})});bn.children.forEach(function(bw){bw._createPhase2()})}bv.coordScopesByType=bq}},_getCoordinatedRootAxesByScopeType:function(){var bf=!1,be=a4.query(this.chart.axesList).multipleIndex(function(bh){if("discrete"!==bh.scaleType&&bh.option.isDefined("DomainScope")){var bg=bh.option("DomainScope");if("cell"!==bg){bf=!0;return bg}}});return bf?be:null},_coordinateScopeAxes:function(be,bf){var bg=a4.query(bf).select(function(bh){var bj=bh.axes[be].scale;if(!bj.isNull){var bi=bj.domain();return{min:bi[0],max:bi[1]}}}).reduce(aL.unionExtents,null);bg&&bf.forEach(function(bh){var bi=bh.axes[be],bj=bi.scale;if(!bj.isNull){bj.domain(bg.min,bg.max);bi.setScale(bj)}})},_buildSmallChartsBaseOptions:function(){var bf=this.chart,be=bf.options;return a4.set(Object.create(be),"parent",bf,"legend",!1,"titleFont",be.smallTitleFont,"titlePosition",be.smallTitlePosition,"titleAlign",be.smallTitleAlign,"titleAlignTo",be.smallTitleAlignTo,"titleOffset",be.smallTitleOffset,"titleKeepInBounds",be.smallTitleKeepInBounds,"titleMargins",be.smallTitleMargins,"titlePaddings",be.smallTitlePaddings,"titleSize",be.smallTitleSize,"titleSizeMax",be.smallTitleSizeMax)},_calcLayout:function(br){var bn=this.chart,bx=bn._multiInfo;if(bx){var bw=bn.multiOptions.option,bt=bn.smallOptions.option,bg=br.clientSize,bi=br.previous,bj=bi?bi.initialClientWidth:bg.width,be=bi?bi.initialClientHeight:bg.height,bp=bt("Width");null!=bp&&(bp=l.resolve(bp,bj));var bu=bt("Height");null!=bu&&(bu=l.resolve(bu,be));var bq=bt("AspectRatio"),bk=bx.rowCount,bo=bx.colCount;if(null==bp){if(isFinite(bx.colsMax)){bp=bg.width/bo}else{null==bu&&(bu=be);bp=bq*bu}}null==bu&&(bu=1===bk&&bw("SingleRowFillsHeight")||1===bo&&bw("SingleColFillsHeight")?be:bp/bq);var bs=bp*bo,bf=bu*bk;if(!bn._isMultiChartOverflowClipRetry){bn._isMultiChartOverflowClip=!1;switch(bw("Overflow")){case"fit":if(bs>bj){bs=bj;bp=bs/bo}if(bf>be){bf=be;bu=bf/bk}break;case"clip":var bm=bo,bh=bk,bl=bs>bj;bl&&(bm=Math.floor(bj/bp));var bv=bf>be;bv&&(bh=Math.floor(be/bu));if(bv||bl){bn._isMultiChartOverflowClip=!0;bn._clippedMultiChartRowsMax=bh;bn._clippedMultiChartColsMax=bm}}}a4.set(br,"initialClientWidth",bj,"initialClientHeight",be,"width",bp,"height",bu);return{width:bs,height:Math.max(bg.height,bf)}}},_getExtensionId:function(){return"content"},_createCore:function(be){var bk=this.chart;!bk._isMultiChartOverflowClip||a4.assert("Overflow&clip condition should be resolved.");var bi=bk._multiInfo;if(bi){var bh=bk.smallOptions.option,bj=bh("Margins"),bg=bh("Paddings");bk.children.forEach(function(bl){bl._setSmallLayout({left:bl.smallColIndex*be.width,top:bl.smallRowIndex*be.height,width:be.width,height:be.height,margins:this._buildSmallMargins(bl,bj,bi),paddings:bg})},this);var bf=bi.coordScopesByType;bf&&bk._coordinateSmallChartsLayout(bf);this.base(be)}},_buildSmallMargins:function(be,bg,bf){var bk=bf.colCount-1,bh=bf.rowCount-1,bl=be.smallColIndex,bi=be.smallRowIndex,bj={};bl>0&&(bj.left=bg.left);bk>bl&&(bj.right=bg.right);bi>0&&(bj.top=bg.top);bh>bi&&(bj.bottom=bg.bottom);return bj}});a4.type("pvc.TitlePanelAbstract",aL.BasePanel).init(function(bj,bi,bf){bf||(bf={});var be=bf.anchor||this.anchor;if(null==bf.size){var bg=bf.titleSize;null!=bg&&(bf.size=new s().setSize(bg,{singleProp:this.anchorOrthoLength(be)}))}if(null==bf.sizeMax){var bk=bf.titleSizeMax;null!=bk&&(bf.sizeMax=new s().setSize(bk,{singleProp:this.anchorOrthoLength(be)}))}null==bf.paddings&&(bf.paddings=this.defaultPaddings);this.base(bj,bi,bf);if(void 0===bf.font){var bh=this._getExtension("label","font");"string"==typeof bh&&(this.font=bh)}}).add({pvLabel:null,anchor:"top",title:null,titleSize:void 0,font:"12px sans-serif",defaultPaddings:2,_extensionPrefix:"title",_calcLayout:function(bh){var br=new s(),bm=this.anchor,bs=this.anchorLength(bm),be=this.anchorOrthoLength(bm),bk=p.Text.measureWidth(this.title,this.font)+2,bp=bh.clientSize[bs],bl=bh.desiredClientSize[bs];null==bl?bl=bk>bp?bp:bk:bl>bp&&(bl=bp);var bt;bt=bk>bl?aL.text.justify(this.title,bl,this.font):this.title?[this.title]:[];var bo=p.Text.fontHeight(this.font),bj=bt.length*bo,bg=bh.clientSize[be],bf=bh.desiredClientSize[be];null==bf?bf=bj:bf>bg&&(bf=bg);if(bj>bf){var bi=Math.max(1,Math.floor(bf/bo));if(bt.length>bi){var bq=bt[bi];bt.length=bi;bj=bf=bi*bo;var bn=bt[bi-1]+" "+bq;bt[bi-1]=aL.text.trimToWidthB(bl,bn,this.font,"..")}}bh.lines=bt;bh.topOffset=(bf-bj)/2;bh.lineSize={width:bl,height:bo};bh.a_width=bs;bh.a_height=be;br[bs]=bl;br[be]=bf;return br},_createCore:function(bi){var bj,bh=this._buildScene(bi),bg={top:0,right:Math.PI/2,bottom:0,left:-Math.PI/2},bf=aL.BasePanel.horizontalAlign[this.align],be=aL.BasePanel.leftTopAnchor[this.anchor];this.compatVersion()<=1&&(bj=function(bk){return function(){return bk.call(this)}});this.pvLabel=new aL.visual.Label(this,this.pvPanel,{extensionId:"label",wrapper:bj}).lock("data",bh.lineScenes).pvMark[be](function(bk){return bi.topOffset+bk.vars.size.height/2+this.index*bk.vars.size.height}).textAlign(bf)[this.anchorOrtho(be)](function(bk){switch(this.textAlign()){case"center":return bk.vars.size.width/2;case"left":return 0;case"right":return bk.vars.size.width}}).text(function(bk){return bk.vars.textLines[this.index]}).font(this.font).textBaseline("middle").textAngle(bg[this.anchor])},_buildScene:function(bg){var bf=new aL.visual.Scene(null,{panel:this,source:this.chart.data}),be=bg.lines;bf.vars.size=bg.lineSize;bf.vars.textLines=be;bf.lineScenes=a4.array.create(be.length,bf);return bf},_getExtensionId:a4.fun.constant("")});a4.type("pvc.TitlePanel",aL.TitlePanelAbstract).init(function(bi,bh,be){be||(be={});var bg=bi.compatVersion()<=1;if(bg){var bf=be.titleSize;null==bf&&(be.titleSize=25)}this._extensionPrefix=bi.parent?"smallTitle":"title";this.base(bi,bh,be)}).add({font:"14px sans-serif",defaultPaddings:4});a4.type("pvc.LegendPanel",aL.BasePanel).init(function(bi,bh,bf){this.base(bi,bh,bf);if(void 0===bf.font){var bg=this._getConstantExtension("label","font");bg&&(this.font=bg)}var be=aL.visual.Interactive;this._ibits&be.Interactive&&(this._ibits|=be.Clickable)}).add({pvRule:null,pvDot:null,pvLabel:null,anchor:"bottom",pvLegendPanel:null,textMargin:6,itemPadding:2.5,itemSize:null,markerSize:15,font:"10px sans-serif",_calcLayout:function(be){return this._getBulletRootScene().layout(be)},_createCore:function(bo){var bi=bo.clientSize,bv=this._getBulletRootScene(),bs=bv.vars.itemPadding,bh=bv.vars.contentSize,bk=this.isAnchorTopOrBottom(),bn=bk?"top":"left",bf=this.anchorOpposite(bn),bu=this.anchorLength(bn),bl=this.anchorOrthoLength(bn),br=bk?"center":"middle",bp=bk?"left":"top",bg=this.anchorOpposite(bp),bm=0;switch(this.align){case bg:bm=bi[bu]-bh[bu];break;case br:bm=(bi[bu]-bh[bu])/2}this.pvPanel.borderPanel.overflow("hidden");var bj,bt=this.pvPanel.add(p.Panel).data(bv.vars.sections)[bp](bm)[bn](function(){var bw=this.sibling();return bw?bw[bn]+bw[bl]+bs[bl]:0})[bu](function(bw){return bw.size[bu]})[bl](function(bw){return bw.size[bl]});this.compatVersion()<=1&&(bj=function(bw){return function(bx){return bw.call(this,bx.vars.value.rawValue)}});var bq=this.pvLegendPanel=new aL.visual.Panel(this,bt,{extensionId:"panel",wrapper:bj,noSelect:!1,noHover:!0,noClick:!1,noClickSelect:!0}).pvMark.lock("data",function(bw){return bw.items})[bg](null)[bf](null)[bp](function(bx){var by=bx.vars.itemPadding,bw=this.sibling();return bw?bw[bp]+bw[bu]+by[bu]:0})[bn](bk?function(bx){var bw=bx.vars;return bw.section.size.height/2-bw.itemClientSize.height/2}:0).height(function(bw){return bw.vars.itemClientSize.height}).width(bk?function(bw){return bw.vars.itemClientSize.width}:function(){return this.parent.width()}).def("hidden","false").fillStyle(function(){return"true"==this.hidden()?"rgba(200,200,200,1)":"rgba(200,200,200,0.0001)"}),be=new aL.visual.Panel(this,bq,{extensionId:"markerPanel"}).pvMark.left(0).top(0).right(null).bottom(null).width(function(bw){return bw.vars.markerSize}).height(function(bw){return bw.vars.itemClientSize.height});if(aL.debug>=20){bt.strokeStyle("red").lineWidth(0.5).strokeDasharray(".");bq.strokeStyle("green").lineWidth(0.5).strokeDasharray(".");be.strokeStyle("blue").lineWidth(0.5).strokeDasharray(".")}bv.childNodes.forEach(function(bw){var bx=new aL.visual.Panel(this,be).pvMark.visible(function(by){return by.parent===bw});bw.renderer().create(this,bx,bw.extensionPrefix,bj)},this);this.pvLabel=new aL.visual.Label(this,be.anchor("right"),{extensionId:"label",noTooltip:!1,noClick:!1,wrapper:bj}).intercept("textStyle",function(bx){var bw=this.delegateExtension()||"black";return bx.isOn()?bw:aL.toGrayScale(bw,null,void 0,150)}).pvMark.textAlign("left").text(function(by){var bx=by.labelText(),bw=by.vars;bw.textSize.width>bw.labelWidthMax&&(bx=aL.text.trimToWidthB(bw.labelWidthMax,bx,bw.font,"..",!1));return bx}).textMargin(function(bw){return bw.vars.textMargin}).font(function(bw){return bw.vars.font}).textDecoration(function(bw){return bw.isOn()?"":"line-through"});aL.debug>=16&&be.anchor("right").add(p.Panel)[this.anchorLength()](0)[this.anchorOrthoLength()](0).fillStyle(null).strokeStyle(null).lineWidth(0).add(p.Line).data(function(bz){var by=bz.vars,bx=aL.text.getLabelBBox(Math.min(by.labelWidthMax,by.textSize.width),2*by.textSize.height/3,"left","middle",0,by.textMargin),bw=bx.source.points();bw.length>1&&(bw=bw.concat(bw[0]));return bw}).left(function(bw){return bw.x}).top(function(bw){return bw.y}).strokeStyle("red").lineWidth(0.5).strokeDasharray("-")},_onClick:function(be){var bf=be.scene;a4.fun.is(bf.execute)&&bf.executable()&&bf.execute()},_getExtensionPrefix:function(){return"legend"},_getExtensionId:function(){return"area"},_getSelectableMarks:function(){return[this.pvLegendPanel]},_getBulletRootScene:function(){var be=this._rootScene;if(!be){be=new aL.visual.legend.BulletRootScene(null,{panel:this,source:this.chart.data,horizontal:this.isAnchorTopOrBottom(),font:this.font,markerSize:this.markerSize,textMargin:this.textMargin,itemPadding:this.itemPadding,itemSize:this.itemSize});this._rootScene=be}return be},_getTooltipFormatter:function(be){be.isLazy=!1;return function(bh){var bi=bh.scene.vars.value,bg=bi.absLabel||bi.label,bf=bh.pvMark.text();return bg!==bf?bg:""}}});a4.type("pvc.CartesianAbstract",aL.BaseChart).init(function(be){this.axesPanels={};this.base(be)}).add({_gridDockPanel:null,axesPanels:null,yAxisPanel:null,xAxisPanel:null,secondXAxisPanel:null,secondYAxisPanel:null,yScale:null,xScale:null,_getSeriesRoleSpec:function(){return{isRequired:!0,defaultDimension:"series*",autoCreateDimension:!0,requireIsDiscrete:!0}},_getColorRoleSpec:function(){return{isRequired:!0,defaultDimension:"color*",defaultSourceRole:"series",requireIsDiscrete:!0}},_addAxis:function(be){this.base(be);switch(be.type){case"base":case"ortho":this.axes[be.orientedId]=be;be.v1SecondOrientedId&&(this.axes[be.v1SecondOrientedId]=be)}return this},_setAxisScale:function(bf,bh){this.base(bf,bh);var be="ortho"===bf.type,bg=be||"base"===bf.type;bg&&(be&&1===bf.index?this.secondScale=bf.scale:bf.index||(this[bf.orientation+"Scale"]=bf.scale))},_createContent:function(be){this._createFocusWindow();this._gridDockPanel=new aL.CartesianGridDockingPanel(this,this.basePanel,{margins:be.margins,paddings:be.paddings});["base","ortho"].forEach(function(bf){var bg=this.axesByType[bf];bg&&a4.query(bg).reverse().each(function(bh){this._createAxisPanel(bh)},this)},this);this._createPlotPanels(this._gridDockPanel,{clickAction:be.clickAction,doubleClickAction:be.doubleClickAction})},_createFocusWindow:function(){if(this.selectableByFocusWindow()){var be,bf=this.focusWindow;bf&&(be=bf._exportData());bf=this.focusWindow=new aL.visual.CartesianFocusWindow(this);be&&bf._importData(be);bf._initFromOptions()}else{this.focusWindow&&delete this.focusWindow}},_createAxisPanel:function(bf){if(bf.option("Visible")){var bg,bh=bf.option("Title");a4.empty(bh)||(bg=new aL.AxisTitlePanel(this,this._gridDockPanel,bf,{title:bh,font:bf.option("TitleFont")||bf.option("Font"),anchor:bf.option("Position"),align:bf.option("TitleAlign"),margins:bf.option("TitleMargins"),paddings:bf.option("TitlePaddings"),titleSize:bf.option("TitleSize"),titleSizeMax:bf.option("TitleSizeMax")}));var be=new aL.AxisPanel(this,this._gridDockPanel,bf,{anchor:bf.option("Position"),size:bf.option("Size"),sizeMax:bf.option("SizeMax"),clickAction:bf.option("ClickAction"),doubleClickAction:bf.option("DoubleClickAction"),useCompositeAxis:bf.option("Composite"),font:bf.option("Font"),labelSpacingMin:bf.option("LabelSpacingMin"),grid:bf.option("Grid"),gridCrossesMargin:bf.option("GridCrossesMargin"),ruleCrossesMargin:bf.option("RuleCrossesMargin"),zeroLine:bf.option("ZeroLine"),desiredTickCount:bf.option("DesiredTickCount"),showTicks:bf.option("Ticks"),showMinorTicks:bf.option("MinorTicks")});bg&&(be.titlePanel=bg);this.axesPanels[bf.id]=be;this.axesPanels[bf.orientedId]=be;bf.index<=1&&bf.v1SecondOrientedId&&(this[bf.v1SecondOrientedId+"AxisPanel"]=be);return be}},_onLaidOut:function(){this.plotPanelList&&this.plotPanelList[0]&&["base","ortho"].forEach(function(be){var bf=this.axesByType[be];bf&&bf.forEach(this._setCartAxisScaleRange,this)},this)},_setCartAxisScaleRange:function(bf){var bh=this.plotPanelList[0]._layoutInfo,be=bh.clientSize,bg="x"===bf.orientation?be.width:be.height;bf.setScaleRange(bg);return bf.scale},_getAxesRoundingPaddings:function(){function bh(bj,bl,bi){var bk=bf[bj];if(null==bk||bl>bk){bf[bj]=bl;bf[bj+"Locked"]=bi}else{bi&&(bf[bj+"Locked"]=bi)}}function bg(bi){if(bi){var bj=bi.getScaleRoundingPaddings();if(bj){var bk="x"===bi.orientation;bh(bk?"left":"bottom",bj.begin,bj.beginLocked);bh(bk?"right":"top",bj.end,bj.endLocked)}}}var bf={},be=this.axesByType;["base","ortho"].forEach(function(bi){var bj=be[bi];bj&&bj.forEach(bg)});return bf},markEventDefaults:{strokeStyle:"#5BCBF5",lineWidth:"0.5",textStyle:"#5BCBF5",verticalOffset:10,verticalAnchor:"bottom",horizontalAnchor:"right",forceHorizontalAnchor:!1,horizontalAnchorSwapLimit:80,font:"10px sans-serif"},markEvent:function(bt,bn,bh){var bz=this,bq=bz.axes.base,bo=bz.axes.ortho,bl=bq.role,bi=bq.scale,bv=bz.data.owner.dimensions(bl.grouping.firstDimensionName());bv.type;if(bq.isDiscrete()){bz._warn("Can only mark events in charts with a continuous base scale.");return bz}var bw=$.extend({},bz.markEventDefaults,bh),bs=bv.read(bt,bn),bg=bi(bs.value),bx=bi.range(),bj=bx[1];if(bg<bx[0]||bg>bj){this._warn("Cannot mark event because it is outside the base scale's domain.");return this}var bf=this.plotPanelList[0].pvPanel,by=bo.scale.range()[1],bk=bw.horizontalAnchor;if(!bw.forceHorizontalAnchor){var br="right"===bk,bu=br?bj-bg:bg,bm=p.Text.measureWidth(bs.label,bw.font);bm>bu&&(bk=br?"left":"right")}var be="top"===bw.verticalAnchor?bw.verticalOffset:by-bw.verticalOffset,bp=bf.add(p.Line).data([0,by]).bottom(a4.identity).left(bg).lineWidth(bw.lineWidth).strokeStyle(bw.strokeStyle);bp.anchor(bk).visible(function(){return !this.index}).top(be).add(p.Label).font(bw.font).text(bs.label).textStyle(bw.textStyle);return bz},defaults:{panelSizeRatio:0.9,timeSeries:!1,timeSeriesFormat:"%Y-%m-%d"}});a4.type("pvc.GridDockingPanel",aL.BasePanel).add({anchor:"fill",_calcLayout:function(bz){function bg(bP,bN){be&&bG._group("LayoutCycle "+(bC?"- Disaster MODE":"#"+(bN+1)));try{var bK,bM,bQ,bJ,bL=bz.canChange!==!1&&!bC&&bP>0,bO=!1;bK=0;bM=bA.length;for(;bM>bK;){be&&bG._group("SIDE Child #"+(bK+1));try{bQ=bn(bA[bK],bL);if(!bC&&bQ){bJ=!1;if(0!==(bQ&bw)){be&&bG._log("SIDE Child #"+(bK+1)+" changed overflow paddings");if(!bO){bO=!0;bz.requestPaddings=bz.paddings}}if(0!==(bQ&bE)){if(bP>0){be&&bG._log("SIDE Child #"+(bK+1)+" changed normal paddings");bJ=!0}else{aL.debug>=2&&bG._warn("SIDE Child #"+(bK+1)+" changed paddings but no more iterations possible.")}}if(0!==(bQ&bF)){bC=!0;bg(0);return !1}if(bJ){return !0}}}finally{be&&bG._groupEnd()}bK++}if(bO){be&&bG._log("Restarting due to overflowPaddings change");return !1}bK=0;bM=bj.length;for(;bM>bK;){be&&bG._group("FILL Child #"+(bK+1));try{bQ=bk(bj[bK],bL);if(!bC&&bQ){bJ=!1;if(0!==(bQ&bE)){if(bP>0){aL.debug>=5&&bG._log("FILL Child #"+(bK+1)+" increased paddings");bJ=!0}else{aL.debug>=2&&bG._warn("FILL Child #"+(bK+1)+" increased paddings but no more iterations possible.")}}if(0!==(bQ&bF)){bC=!0;bg(0);return !1}if(bJ){return !0}}}finally{be&&bG._groupEnd()}bK++}return !1}finally{be&&bG._groupEnd()}}function bH(bL,bJ){for(var bK=0;bL--;){if(bJ(bL,bK)===!1){return !0}bK++}return !1}function bI(bL){var bJ=bL.anchor;if(bJ){if("fill"===bJ){bj.push(bL);var bK=bL.paddings.resolve(bD.referenceSize);bo=aD.resolvedMax(bo,bK)}else{a4.hasOwn(bx,bJ)||a4.fail.operationInvalid("Unknown anchor value '{0}'",[bJ]);bA.push(bL)}}}function bu(bM,bK){be&&bG._group("SIDE Child #"+(bK+1));try{var bL=0,bJ=bM.anchor;bD.paddings=bt(bJ,bo);bM.layout(new s(bv),bD);if(bM.isVisible){bL|=br(bJ,bo,bM);bf(bJ,bM);bs(bJ,bM)}return bL}finally{be&&bG._groupEnd()}}function bk(bM,bK){var bL=0,bJ=bM.anchor;bD.paddings=bt(bJ,bo);bD.canChange=bK;bM.layout(new s(bv),bD);if(bM.isVisible){bL|=br(bJ,bo,bM,bK);bf(bJ,bM);bi(bM,bJ)}return bL}function bn(bJ,bR){var bL=0;if(bJ.isVisible){var bP=bJ.anchor,bN=bm[bP],bQ=bB[bP],bK=bv[bN],bM=bJ[bQ],bO=new s(a4.set({},bN,bK,bQ,bM));bD.paddings=bt(bP,bo);bD.canChange=bR;bJ.layout(bO,bD);if(bJ.isVisible){bL=br(bP,bo,bJ,bR)|bl(bP,bz.paddings,bJ,bR);bL||bi(bJ,bJ.align)}}return bL}function bf(bJ,bL){var bK;if("fill"===bJ){bJ="left";bK=bh.left+bv.width/2-bL.width/2}else{bK=bh[bJ]}bL.setPosition(a4.set({},bJ,bK))}function bs(bK,bM){var bJ=bB[bK],bL=bM[bJ];bh[bK]+=bL;bv[bJ]-=bL}function bi(bM,bL){var bK;"fill"===bL&&(bL="middle");var bJ;switch(bL){case"top":case"bottom":case"left":case"right":bK=bL;bJ=bh[bK];break;case"middle":bK="bottom";bJ=bh.bottom+bv.height/2-bM.height/2;break;case"center":bK="left";bJ=bh.left+bv.width/2-bM.width/2}bM.setPosition(a4.set({},bK,bJ))}function bt(bJ,bL){var bK=new aD();by(bJ).forEach(function(bM){bK.set(bM,bL[bM])});return bK}function br(bJ,bL,bP,bM){var bN=bP._layoutInfo.requestPaddings,bO=0;if(bN){if(be&&aL.debug>=10){bG._log("=> clientSize="+aL.stringify(bP._layoutInfo.clientSize));bG._log("<= requestPaddings="+aL.stringify(bN))}by(bJ).forEach(function(bQ){var bS=bL[bQ]||0,bT=Math.floor(10000*(bN[bQ]||0))/10000,bU=bT-bS,bR=Math.max(1,Math.abs(0.01*bS));if(0!==bU&&Math.abs(bU)>=bR){if(bM){bO|=bE;bL[bQ]=bT;be&&bG._log("Changed padding "+bQ+" <- "+bT)}else{aL.debug>=2&&bG._warn("CANNOT change but child wanted to: "+bQ+"="+bT)}}});if(bO){var bK=aD.names.map(function(bQ){return(bL[bQ]||0).toFixed(0)}).join("|");if(a4.hasOwn(bq,bK)){aL.debug>=2&&bG._warn("LOOP detected!!!!");bO|=bF}else{bq[bK]=!0}bL.width=bL.left+bL.right;bL.height=bL.top+bL.bottom}}return bO}function bl(bK,bJ,bO,bL){var bN=bO._layoutInfo.overflowPaddings||bp,bM=0;be&&aL.debug>=10&&bG._log("<= overflowPaddings="+aL.stringify(bN));by(bK).forEach(function(bP){if(bN.hasOwnProperty(bP)){var bR=bJ[bP]||0,bS=Math.floor(10000*(bN[bP]||0))/10000;bS-=bh[bP];var bT=bS-bR,bQ=Math.max(1,Math.abs(0.05*bR));if(bT>=bQ){if(bL){bM|=bw;bJ[bP]=bS;be&&bG._log("changed overflow padding "+bP+" <- "+bS)}else{aL.debug>=2&&bG._warn("CANNOT change overflow padding but child wanted to: "+bP+"="+bS)}}}});if(bM){bJ.width=bJ.left+bJ.right;bJ.height=bJ.top+bJ.bottom}return bM}function by(bJ){switch(bJ){case"left":case"right":return aD.vnames;case"top":case"bottom":return aD.hnames;case"fill":return aD.names}}var bG=this;if(bG._children){var be=aL.debug>=5,bh=new aD(0),bo=new aD(0),bv=a4.copyOwn(bz.clientSize),bB=aL.BasePanel.orthogonalLength,bx=aL.BasePanel.relativeAnchor,bm=aL.BasePanel.parallelLength,bD={force:!0,referenceSize:bz.clientSize},bj=[],bA=[],bq={},bF=1,bE=2,bw=4,bp=new aD(),bC=!1;be&&bG._group("CCC GRID LAYOUT clientSize = "+aL.stringify(bv));try{this._children.forEach(bI);be&&bG._group("Phase 1 - Determine MARGINS and FILL SIZE from SIDE panels");try{bA.forEach(bu)}finally{if(be){bG._groupEnd();bG._log("Final FILL margins = "+aL.stringify(bh));bG._log("Final FILL border size = "+aL.stringify(bv))}}be&&bG._group("Phase 2 - Determine COMMON PADDINGS");try{bH(9,bg)}finally{if(be){bG._groupEnd();bG._log("Final FILL clientSize = "+aL.stringify({width:bv.width-bo.width,height:bv.height-bo.height}));bG._log("Final COMMON paddings = "+aL.stringify(bo))}}bz.gridMargins=new aD(bh);bz.gridPaddings=new aD(bo);bz.gridSize=new s(bv)}finally{be&&bG._groupEnd()}}}});a4.type("pvc.CartesianGridDockingPanel",aL.GridDockingPanel).init(function(bg,bf,be){this.base(bg,bf,be);this._plotBgPanel=new aL.PlotBgPanel(bg,this)}).add({_getExtensionId:function(){return this.chart.parent?"smallContent":"content"},_createCore:function(bj){var bg=this.chart,bi=bg.axes,bh=bi.x,bf=bi.y;bh.isBound()||(bh=null);bf.isBound()||(bf=null);bh&&bh.option("Grid")&&(this.xGridRule=this._createGridRule(bh));bf&&bf.option("Grid")&&(this.yGridRule=this._createGridRule(bf));this.base(bj);bg.focusWindow&&this._createFocusWindow(bj);var be;be=bg.compatVersion()<=1?!(!bh.option("EndLine")&&!bf.option("EndLine")):a4.get(bg.options,"plotFrameVisible",!0);be&&(this.pvFrameBar=this._createFrame(bj,bi));bh&&"discrete"!==bh.scaleType&&bh.option("ZeroLine")&&(this.xZeroLine=this._createZeroLine(bh,bj));bf&&"discrete"!==bf.scaleType&&bf.option("ZeroLine")&&(this.yZeroLine=this._createZeroLine(bf,bj))},_createGridRule:function(bg){var bv=bg.scale;if(!bv.isNull){var bk=bg.role.grouping.isDiscrete(),bu=this._getAxisGridRootScene(bg);if(bu){var bf=this._layoutInfo.gridMargins,bh=this._layoutInfo.gridPaddings,bi="x"===bg.orientation?"left":"bottom",bq=this.anchorLength(bi),bm=this.anchorOrtho(bi),br=this.anchorOpposite(bm),bl=bf[bi]+bh[bi],bs=bf[bm],bo=bf[br],bt=bu.leafs().array(),be=bt.length;bk&&be&&bt.push(bt[be-1]);var bj;this.compatVersion()<=1&&(bj=function(bw){return function(bx){return bw.call(this,bx.vars.tick.rawValue)}});var bp=new aL.visual.Rule(this,this.pvPanel,{extensionId:bg.extensionPrefixes.map(function(bw){return bw+"Grid"}),wrapper:bj}).lock("data",bt).lock(bq,null).override("defaultColor",a4.fun.constant(p.color("#f0f0f0"))).pvMark.antialias(!0)[bm](bs)[br](bo).zOrder(-12).events("none");if(bk){var bn=bv.range().step/2;bp[bi](function(bx){var bw=bl+bv(bx.vars.tick.value),by=this.index===be;return bw+(by?bn:-bn)})}else{bp[bi](function(bw){return bl+bv(bw.vars.tick.value)})}return bp}}},_getAxisGridRootScene:function(bf){var be=bf.isDiscrete(),bi=be?bf.domainData():this.data,bh=new aL.visual.CartesianAxisRootScene(null,{panel:this,source:bi});if(be){bi.childNodes.forEach(function(bj){new aL.visual.CartesianAxisTickScene(bh,{source:bj,tick:bj.value,tickRaw:bj.rawValue,tickLabel:bj.label})})}else{var bg=bf.ticks||bf.calcContinuousTicks();bg.forEach(function(bj){new aL.visual.CartesianAxisTickScene(bh,{tick:bj,tickRaw:bj,tickLabel:bf.scale.tickFormat(bj)})},this)}return bh},_createFrame:function(bl,bk){if(!bk.base.scale.isNull&&(!bk.ortho.scale.isNull||bk.ortho2&&!bk.ortho2.scale.isNull)){var bj=bl.gridMargins,bi=bj.left,bf=bj.right,bh=bj.top,be=bj.bottom,bg=[];if(this.compatVersion()<=1){bg.push("xAxisEndLine");bg.push("yAxisEndLine")}bg.push("plotFrame");return new aL.visual.Panel(this,this.pvPanel,{extensionId:bg}).pvMark.lock("left",bi).lock("right",bf).lock("top",bh).lock("bottom",be).lock("fillStyle",null).events("none").strokeStyle("#666666").lineWidth(1).antialias(!1).zOrder(-8)}},_createZeroLine:function(bg,bj){var bi=bg.scale;if(!bi.isNull){var bl=bi.domain();if(bl[0]*bl[1]<-1e-12){var bq="x"===bg.orientation?"left":"bottom",br=this.anchorLength(bq),bh=this.anchorOrtho(bq),be=this.anchorOpposite(bh),bo=bj.gridMargins,bf=bj.gridPaddings,bn=bo[bq]+bf[bq]+bi(0),bp=bo[bh],bk=bo[be],bm=new aL.visual.Scene(null,{panel:this});return new aL.visual.Rule(this,this.pvPanel,{extensionId:bg.extensionPrefixes.map(function(bs){return bs+"ZeroLine"})}).lock("data",[bm]).lock(br,null).lock(bh,bp).lock(be,bk).lock(bq,bn).override("defaultColor",a4.fun.constant(p.color("#666666"))).pvMark.events("none").lineWidth(1).antialias(!0).zOrder(-9)}}},_createFocusWindow:function(bW){function bD(){bE[bB]=0-bO[bH];bE[bU]=bT+bO[bH]+bO[bQ]}function bl(){var b3=arguments[arguments.length-1],b4="end"===b3.drag.phase;bs._selectingByRubberband=!b4;bp.render();bq.render();var b5=bE[bC],b2=bE[bC]+bE[bX];if(!bv){var b1=bM-b5;b5=bM-b2;b2=b1}bA._updatePosition(b5,b2,b4,!0)}function bJ(b7,b8){var b4,b9,b2=b7.m,b1=b2[bG],b5=bE[be];switch(b8){case"new":b4=0;b9="begin";break;case"resize-begin":b4=b5;b9="begin";break;case"move":b4=b5;b9="begin";break;case"resize-end":b4=b1-bE[bG];b9="end"}var b6=b7.min[bG],ca=b7.max[bG],b3={type:b8,target:b9,point:b1,length:b4,length0:b5,min:b6,max:ca,minView:0,maxView:bM};bA._constraintPosition(b3);b2[bG]=b3.point;switch(b8){case"resize-begin":b3.max=Math.min(b3.max,bE[bG]+bE[be]);break;case"resize-end":b3.min=Math.max(b3.min,bE[bG])}b7.min[bG]=b3.min;b7.max[bG]=b3.max}var bu=this,bs=bu.topRoot,bY=bu.chart,bA=bY.focusWindow.base,by=bA.axis,bI=by.scale;if(!bI.isNull){var bK=bA.option("Resizable"),bw=bA.option("Movable"),bP=by.isDiscrete(),bv=bY.isOrientationVertical(),bn=bv?"left":"top",bH=bv?"top":"left",br=bu.anchorOrthoLength(bn),bh=bu.anchorOpposite(bn),bR=bu.anchorOrthoLength(bH),bQ=bu.anchorOpposite(bH),bC=bv?"x":"y",bX="d"+bC,bB=bv?"y":"x",bU="d"+bB,bm=bW.gridMargins,bO=bW.gridPaddings,bS={left:bm.left+bO.left,right:bm.right+bO.right,top:bm.top+bO.top,bottom:bm.bottom+bO.bottom};bS.width=bS.left+bS.right;bS.height=bS.top+bS.bottom;var bj=bW.clientSize,bg=bj[br],b0=bj[bR],bM=bg-bS[br],bT=b0-bS[bR],bZ=bO[bn],bo=bO[bh],bE=new aL.visual.Scene(null,{panel:this}),bf=bP?bI.range().step:0,bi=bf/2;bE[bC]=bI(bA.begin)-bi,bE[bX]=bf+(bI(bA.end)-bi)-bE[bC],bD();var bt=function(b1){return function(){return bE[b1]}},bk=function(){var b1=bE[bC];return Math.max(0,Math.min(bM,b1))},bx=function(){var b2=bk(),b1=bE[bC]+bE[bX];b1=Math.max(0,Math.min(bM,b1));return b1-b2},bN=function(b1,b2){return new aL.visual.Bar(bu,b1,{extensionId:b2,normalStroke:!0,noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0,showsInteraction:!1}).pvMark.lock("data").lock("visible").lock(bn,bk).lock(br,bx).lock(bH,bt(bB)).lock(bR,bt(bU)).lock(bQ).lock(bh).sign},bp=this._plotBgPanel.pvPanel.borderPanel;bp.lock("data",[bE]);bw&&bK?bp.paddingPanel.lock("events","all").lock("cursor","crosshair").event("mousedown",p.Behavior.select().autoRender(!1).collapse(bv?"y":"x").positionConstraint(function(b1){var b2="start"===b1.phase?"new":"resize-end";return bJ(b1,b2)})).event("selectstart",function(b1){bD();bl(b1)}).event("select",bl).event("selectend",bl):bp.paddingPanel.events("all");var bF=bN(bp.paddingPanel,"focusWindowBg").override("defaultColor",a4.fun.constant(aL.invisibleFill)).pvMark;bw?bF.lock("events","all").lock("cursor","move").event("mousedown",p.Behavior.drag().autoRender(!1).collapse(bv?"y":"x").positionConstraint(function(b1){bJ(b1,"move")})).event("drag",bl).event("dragend",bl):bF.events("none");var bq=new aL.visual.Panel(bu,bu.pvPanel).pvMark.lock("data",[bE]).lock("visible").lock("fillStyle",aL.invisibleFill).lock("left",bS.left).lock("right",bS.right).lock("top",bS.top).lock("bottom",bS.bottom).lock("zOrder",10).lock("events",function(){var b1=bE.drag;return b1&&"end"!==b1.phase?"all":"none"}).lock("cursor",function(){var b1=bE.drag;return b1&&"end"!==b1.phase?"drag"===b1.type||"select"===b1.type&&!bK?"move":bv?"ew-resize":"ns-resize":null}).antialias(!1),bz="rgba(20, 20, 20, 0.1)";new aL.visual.Bar(bu,bq,{extensionId:"focusWindowBaseCurtain",normalStroke:!0,noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0,showsInteraction:!1}).override("defaultColor",function(b2,b1){return"stroke"===b1?null:bz}).pvMark.lock("data",[bE,bE]).lock("visible").lock("events","none").lock(bn,function(){return this.index?bk()+bx():-bZ}).lock(bh,function(){return this.index?-bo:null}).lock(br,function(){return this.index?null:bZ+bk()}).lock(bH,bt(bB)).lock(bR,bt(bU)).lock(bQ);var bV=bN(bq,"focusWindow").override("defaultColor",a4.fun.constant(null)).pvMark.lock("events","none"),bL=function(b3){var b6="left"===b3||"top"===b3?"begin":"end",b4=bu.anchorOpposite(b3),b5="linear-gradient(to "+b4+", "+bz+", #444 90%)",b2=new aL.visual.Bar(bu,bV.anchor(b3),{extensionId:bA.id+"Grip"+a4.firstUpperCase(b6),normalStroke:!0,noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0,showsInteraction:!1}).override("defaultColor",function(b8,b7){return"stroke"===b7?null:b5}).pvMark.lock("data").lock("visible")[bH](bE[bB])[bR](bE[bU]);if(bK){var b1="resize-"+b6;b2.lock("events","all")[br](5).cursor(bv?"ew-resize":"ns-resize").event("mousedown",p.Behavior.resize(b3).autoRender(!1).positionConstraint(function(b7){bJ(b7,b1)}).preserveOrtho(!0)).event("resize",bl).event("resizeend",bl)}else{b2.events("none")[br](1)}return b2};bL(bn);bL(bh);var bG=bC,be=bX}},_getDatumsOnRect:function(bl,bk,bj){var bg,bh,bi=this.chart,be=bi.axesPanels.x,bf=bi.axesPanels.y;if(be){bg=new a4.Map();be._getDatumsOnRect(bg,bk,bj);bg.count||(bg=null)}if(bf){bh=new a4.Map();bf._getOwnDatumsOnRect(bh,bk,bj);bh.count||(bh=null)}if(bg&&bh){bg.intersect(bh,bl);bj.toggle=!0}else{bg?bl.copy(bg):bh?bl.copy(bh):bi.plotPanelList.forEach(function(bm){bm._getDatumsOnRect(bl,bk,bj)},this)}}});a4.type("pvc.CartesianAbstractPanel",aL.PlotPanel).init(function(bm,bn,bk,bo){function bg(bp){bl[bp.type]=bp;bl[bp.orientedId]=bp;bp.v1SecondOrientedId&&(bl[bp.v1SecondOrientedId]=bp)}function bf(bp,br){var bq=bh[bp];if(null==bq||br>bq){be=!0;bh[bp]=br}}function bi(bp){var bq=bp&&bp.option("Offset");if(null!=bq&&bq>0&&1>bq){if("x"===bp.orientation){bf("left",bq);bf("right",bq)}else{bf("top",bq);bf("bottom",bq)}}}this.base(bm,bn,bk,bo);var bl=this.axes;bg(bm._getAxis("base",bk.option("BaseAxis")-1));bg(bm._getAxis("ortho",bk.option("OrthoAxis")-1));var bh={},be=!1,bj=bm.axesByType;["base","ortho"].forEach(function(bp){var bq=bj[bp];bq&&bq.forEach(bi)});be&&(this.offsetPaddings=bh)}).add({offsetPaddings:null,_calcLayout:function(be){be.requestPaddings=this._calcRequestPaddings(be)},_calcRequestPaddings:function(bi){var be,bh=this.offsetPaddings;if(bh){var bg=this.chart._getAxesRoundingPaddings(),bf=bi.clientSize,bj=bi.paddings;aD.names.forEach(function(bm){var bp=aL.BasePanel.orthogonalLength[bm],bl=bf[bp],bq=bj[bp],bk=bl+bq;if(!bg[bm+"Locked"]){var bo=bk*(bh[bm]||0),bn=bl*(bg[bm]||0);(be||(be={}))[bm]=Math.max(bo-bn,0)}},this)}return be},_createCore:function(){this.pvPanel.zOrder(-10);var bf,be=this.chart.options.leafContentOverflow||"auto";bf="auto"===be?a4.query(["ortho","base"]).select(function(bg){return this.axes[bg]},this).any(function(bg){return null!=bg.option("FixedMin")||null!=bg.option("FixedMax")}):"hidden"===be;bf&&this.pvPanel.borderPanel.overflow("hidden")}});a4.type("pvc.PlotBgPanel",aL.BasePanel).init(function(bg,bf,be){this.base(bg,bf,be)}).add({anchor:"fill",_getExtensionId:function(){return"plotBg"},_createCore:function(be){this.pvPanel.borderPanel.lock("zOrder",-13).antialias(!1);this.base(be)}});a4.type("pvc.CategoricalAbstract",aL.CartesianAbstract).init(function(be){this.base(be);var bf=this.parent;bf&&(this._catRole=bf._catRole)}).add({_interpolatable:!0,_initVisualRoles:function(){this.base();this._catRole=this._addVisualRole("category",this._getCategoryRoleSpec())},_getCategoryRoleSpec:function(){return{isRequired:!0,defaultDimension:"category*",autoCreateDimension:!0}},_createVisibleData:function(bh,bf){var bg=this._serRole&&this._serRole.flattenedGrouping(),be=this._catRole.flattenedGrouping();return bg?bh.groupBy(a4.get(bf,"inverted",!1)?[bg,be]:[be,bg],bf):bh.groupBy(be,bf)},_interpolateDataCell:function(bg,bi){var bf=this._getNullInterpolationOperType(bg.nullInterpolationMode);if(bf){this._warnSingleContinuousValueRole(bg.role);var bj=bg.dataPartValue,be=this.partData(bj,bi),bh=this.visibleData(bj,{baseData:bi});bh.childCount()>0&&new bf(bi,be,bh,this._catRole,this._serRole,bg.role,!0).interpolate()}},_getNullInterpolationOperType:function(be){switch(be){case"linear":return aL.data.LinearInterpolationOper;case"zero":return aL.data.ZeroInterpolationOper;case"none":break;default:throw a4.error.argumentInvalid("nullInterpolationMode",""+be)}},_generateTrendsDataCell:function(bp,bm,bi){function bq(bz){var bB=bo?null:function(bC){return bC.atoms[bl].value},bA=function(bD){var bC=bw.child(bD.key);bC&&bz&&(bC=bC.child(bz.key));return bC?bC.dimensions(bs).value(bh):null},by=a4.create(bn,{rows:a4.query(bt),x:bB,y:bA}),bx=bu.model(by);bx&&bt.forEach(function(bJ,bF){var bH=bo?bF:bJ.atoms[bl].value,bE=bx.sample(bH,bA(bJ),bF);if(null!=bE){var bC,bI=bw.child(bJ.key),bG=bI||bJ;if(bz){var bD=bI&&bI.child(bz.key);if(bD){bC=Object.create(bD._datums[0].atoms)}else{bC=Object.create(bG._datums[0].atoms);a4.copyOwn(bC,bz.atoms)}}else{bC=Object.create(bG._datums[0].atoms)}bC[bs]=bE;bC[bj]=bf;bp.push(new aL.data.TrendDatum(bG.owner,bC,bn))}},this)}var be=this._serRole,bg=this._catRole,br=bm.role,bn=bm.trend,bu=bn.info;this._warnSingleContinuousValueRole(br);var bl,bs=br.firstDimensionName(),bo=bg.isDiscrete();bo||(bl=bg.firstDimensionName());var bh={zeroIfNone:!1},bv=this.partData(bm.dataPartValue,bi),bw=this.visibleData(bm.dataPartValue,{baseData:bi}),bf=this._getTrendDataPartAtom(),bj=bf.dimension.name,bt=bg.flatten(bi,{visible:!0}).childNodes,bk=be&&be.isBound()?be.flatten(bv,{visible:!0}).children():a4.query([null]);bk.each(bq,this)},_getContinuousVisibleCellExtent:function(bk,bh){var bf=bh.role;switch(bf.name){case"series":case"category":return this.base(bk,bh)}this._warnSingleContinuousValueRole(bf);var bj=bh.dataPartValue,bg=bf.firstDimensionName(),bi=this.visibleData(bj),be=bk.scaleUsesAbs();return"ortho"===bk.type&&bh.isStacked?bi.children().select(function(bm){var bl=this._getStackedCategoryValueExtent(bm,bg,be);return bl?{range:bl,group:bm}:void 0},this).where(a4.notNully).reduce(function(bl,bm){return this._reduceStackedCategoryValueExtent(bl,bm.range,bm.group)}.bind(this),null):bi.leafs().select(function(bl){var bm=bl.dimensions(bg).value();return be&&0>bm?-bm:bm}).range()},_getStackedCategoryValueExtent:function(bi,bh,bg){var bf=null,be=null;bi.children().select(function(bj){var bk=bj.dimensions(bh).value();return bg&&0>bk?-bk:bk}).each(function(bj){null!=bj&&(bj>=0?bf+=bj:be+=bj)});return null==bf&&null==be?null:{max:bf||0,min:be||0}},_reduceStackedCategoryValueExtent:function(bf,be){return aL.unionExtents(bf,be)},_coordinateSmallChartsLayout:function(bh){this.base(bh);var bg,bf=0,be=null,bi={};this.children.forEach(function(bk){bk.basePanel.layout();var bl,bj=bk.titlePanel;if(bj){bg||(bg=bj.anchorOrthoLength());bl=bj[bg];bl>bf&&(bf=bl)}var bm=bk.axesPanels;be||(be=a4.query(a4.ownKeys(bm)).where(function(bn){return bn===bm[bn].axis.id}).select(function(bn){bi[bn]={axis:0,title:0};return bn}).array());be.forEach(function(br){var bn=bm[br],bq=bi[br],bo="x"===bn.axis.orientation?"height":"width";bl=bn[bo];bl>bq.axis&&(bq.axis=bl);var bp=bn.titlePanel;if(bp){bl=bp[bo];bl>bq.title&&(bq.title=bl)}})},this);this.children.forEach(function(bk){if(bf>0){var bj=bk.titlePanel;bj.size=bj.size.clone().set(bg,bf)}var bl=bk.axesPanels;be.forEach(function(bq){var bm=bl[bq],bp=bi[bq],bn="x"===bm.axis.orientation?"height":"width";bm.size=bm.size.clone().set(bn,bp.axis);var bo=bm.titlePanel;bo&&(bo.size=bo.size.clone().set(bn,bp.title))});bk.basePanel.invalidateLayout()},this)}});a4.type("pvc.CategoricalAbstractPanel",aL.CartesianAbstractPanel).init(function(bg,bf,bh,be){this.base(bg,bf,bh,be);this.stacked=bh.option("Stacked")});a4.type("pvc.AxisPanel",aL.BasePanel).init(function(bj,bi,bh,bf){bf=a4.create(bf,{anchor:bh.option("Position")});var be=bf.anchor||this.anchor;this.axis=bh;this.base(bj,bi,bf);this.roleName=bh.role.name;this.isDiscrete=bh.role.isDiscrete();this._extensionPrefix=bh.extensionPrefixes;null==this.labelSpacingMin&&(this.labelSpacingMin=this.isDiscrete?0.25:1.5);null==this.showTicks&&(this.showTicks=!this.isDiscrete);if(void 0===bf.font){var bg=this._getConstantExtension("label","font");bg&&(this.font=bg)}if(void 0===bf.tickLength){var bk=+this._getConstantExtension("ticks",this.anchorOrthoLength(be));!isNaN(bk)&&isFinite(bk)&&(this.tickLength=bk)}}).add({pvRule:null,pvTicks:null,pvLabel:null,pvRuleGrid:null,pvScale:null,isDiscrete:!1,roleName:null,axis:null,anchor:"bottom",tickLength:6,scale:null,ruleCrossesMargin:!0,font:"9px sans-serif",labelSpacingMin:null,desiredTickCount:null,showMinorTicks:!0,showTicks:null,hiddenLabelText:"",_isScaleSetup:!1,_createLogInstanceId:function(){return this.base()+" - "+this.axis.id},getTicks:function(){return this._layoutInfo&&this._layoutInfo.ticks},_calcLayout:function(be){var bf=this.axis.scale;if(!this._isScaleSetup){this.pvScale=bf;this.scale=bf;this.extend(bf,"scale");this._isScaleSetup=!0}bf.isNull?be.axisSize=0:this._calcLayoutCore(be);return this.createAnchoredSize(be.axisSize,be.clientSize)},_calcLayoutCore:function(be){var bf=be.desiredClientSize[this.anchorOrthoLength()];be.axisSize=bf;if(this.isDiscrete&&this.useCompositeAxis){null==be.axisSize&&(be.axisSize=50)}else{this._readTextProperties(be);this._calcTicks();"discrete"===this.scale.type&&(this._tickIncludeModulo=this._calcDiscreteTicksIncludeModulo());this._calcAxisSizeFromLabel(be);null==be.axisSize&&(be.axisSize=be.requiredAxisSize);this._calcMaxTextLengthThatFits();this._calcOverflowPaddings()}},_calcAxisSizeFromLabel:function(be){this._calcTicksLabelBBoxes(be);this._calcAxisSizeFromLabelBBox(be)},_readTextProperties:function(bg){var be=this._getExtension("label","textAngle");bg.isTextAngleFixed=null!=be;bg.textAngle=a4.number.as(be,0);bg.textMargin=a4.number.as(this._getExtension("label","textMargin"),3);var bh=this._getExtension("label","textAlign");"string"!=typeof bh&&(bh=this.isAnchorTopOrBottom()?"center":"left"==this.anchor?"right":"left");bg.textAlign=bh;var bf=this._getExtension("label","textBaseline");if("string"!=typeof bf){switch(this.anchor){case"right":case"left":case"center":bf="middle";break;case"bottom":bf="top";break;default:bf="bottom"}}bg.textBaseline=bf},_calcAxisSizeFromLabelBBox:function(bg){var be=bg.maxLabelBBox,bf=this._getLabelBBoxQuadrantLength(be,this.anchor),bi=this.tickLength+bf,bh=be.sourceAngle;0===bh&&this.isAnchorTopOrBottom()||(bi+=this.tickLength);bg.requiredAxisSize=bi},_getLabelBBoxQuadrantLength:function(bf,be){var bg;switch(be){case"left":bg=-bf.x;break;case"right":bg=bf.x2;break;case"top":bg=-bf.y;break;case"bottom":bg=bf.y2}return Math.max(bg,0)},_calcOverflowPaddings:function(){this._layoutInfo.canChange?this._calcOverflowPaddingsFromLabelBBox():aL.debug>=2&&this._warn("Layout cannot change. Skipping calculation of overflow paddings.")},_calcOverflowPaddingsFromLabelBBox:function(){var br=null,bl=this,bp=bl._layoutInfo,bo=bp.ticks,bg=bo.length;if(bg){var bj=bp.ticksBBoxes,bh=bp.paddings,bk=bl.isAnchorTopOrBottom(),bf=bk?"left":"bottom",bq=bk?"right":"top",bi=bl.scale,bm="discrete"===bi.type,bn=bp.clientSize[bl.anchorLength()];this.axis.setScaleRange(bn);var be=function(bv,bz,bs,by){var bA=bl._getLabelBBoxQuadrantLength(bv,bz);if(bA>1){var bu=bi(bm?bo[by].value:bo[by]),bw=bs?bu-bA:bu+bA,bt=Math.max(0,bs?-bw:bw-bn);if(bt>1){bt-=bh[bz]||0;if(bt>1){bm&&(bt*=1.05);if(br){var bx=br[bz];(null==bx||bt>bx)&&(br[bz]=bt)}else{br=a4.set({},bz,bt)}}}}};bj.forEach(function(bs,bt){be(bs,bf,!0,bt);be(bs,bq,!1,bt)});aL.debug>=6&&br&&bl._log("OverflowPaddings = "+aL.stringify(br))}bp.overflowPaddings=br},_calcMaxTextLengthThatFits:function(){var bs=this._layoutInfo;if(this.compatVersion()<=1){bs.maxTextWidth=null}else{var br=bs.clientSize[this.anchorOrthoLength()],bg=Math.min(bs.axisSize,br);if(bg>=bs.requiredAxisSize-this.tickLength){bs.maxTextWidth=null}else{var bi,bC,bl=bs.maxLabelBBox,bk=bg-2*this.tickLength;switch(this.anchor){case"left":bC=p.vector(0,1);bi=p.vector(-bk,0);break;case"right":bC=p.vector(0,1);bi=p.vector(bk,0);break;case"top":bC=p.vector(1,0);bi=p.vector(0,-bk);break;case"bottom":bC=p.vector(1,0);bi=p.vector(0,bk)}var bz=bi.norm(),bt=bl.source.points(),by=bt[0],bu=bt[1],bf=bt[2],bj=bt[3],bh=bf.minus(bj),bw=bu.minus(by),bx=p.SvgScene.lineIntersect,bA=bx(bi,bC,by,bw),bm=bx(bi,bC,bj,bh),bB=bl.sourceTextWidth,bv=bB,bq=bA.minus(by),bp=bq.length();bB>=bp&&bq.dot(bh)>=0&&(bv=by.dot(bz)<bu.dot(bz)?bp:bA.minus(bu).length());var bo=bm.minus(bj),bn=bo.length();bB>=bn&&bo.dot(bh)>=0&&(bv=bj.dot(bz)<bf.dot(bz)?Math.min(bv,bn):Math.min(bv,bm.minus(bf).length()));if("center"===bl.sourceAlign){var be=bB-bv;bv-=be}bs.maxTextWidth=bv;aL.debug>=3&&this._log("Trimming labels' text at length "+bv.toFixed(2)+"px maxOrthoLength="+bk.toFixed(2)+"px")}}},_calcTicks:function(){var bf=this._layoutInfo;bf.textHeight=2*p.Text.fontHeight(this.font)/3;bf.maxTextWidth=null;this.axis.setTicks(null);switch(this.scale.type){case"discrete":this._calcDiscreteTicks();break;case"timeSeries":this._calcTimeSeriesTicks();break;case"numeric":this._calcNumberTicks(bf);break;default:throw a4.error.operationInvalid("Undefined axis scale type")}this.axis.setTicks(bf.ticks);var be=bf.clientSize[this.anchorLength()];this.axis.setScaleRange(be);null==bf.maxTextWidth&&this._calcTicksTextLength(bf)},_calcDiscreteTicks:function(){var bg=this.axis,bi=this._layoutInfo;bi.ticks=bg.domainItems();var bk,bl,bf=bg.role.grouping;if(bf.isSingleDimension&&(bl=bf.firstDimensionType())&&bl.valueType===Date){var bm=a4.query(bg.domainValues()).range();if(bm&&bm.min!==bm.max){var bh=new p.Scale.linear(bm.min,bm.max);bh.ticks();var bj=bg.option("TickFormatter");bj&&bh.tickFormatter(bj);var be=bg.domainValues();bk=function(bo,bn){return bh.tickFormat(be[bn])}}}bk||(bk=function(bn){return bn.absLabel});bi.ticksText=bi.ticks.map(bk);this._clearTicksTextDeps(bi)},_clearTicksTextDeps:function(be){be.maxTextWidth=be.ticksTextLength=be.ticksBBoxes=null},_calcTimeSeriesTicks:function(){this._calcContinuousTicks(this._layoutInfo,this.desiredTickCount)},_calcNumberTicks:function(){var be=this.desiredTickCount;if(null==be){if(this.isAnchorTopOrBottom()){this._calcNumberHTicks();return}be=this._calcNumberVDesiredTickCount()}this._calcContinuousTicks(this._layoutInfo,be)},_calcContinuousTicks:function(be,bf){this._calcContinuousTicksValue(be,bf);this._calcContinuousTicksText(be)},_calcContinuousTicksValue:function(be,bf){be.ticks=this.axis.calcContinuousTicks(bf);if(aL.debug>4){this._log("DOMAIN: "+aL.stringify(this.scale.domain()));this._log("TICKS:  "+aL.stringify(be.ticks))}},_calcContinuousTicksText:function(be){var bf=be.ticksText=be.ticks.map(function(bg){return this.scale.tickFormat(bg)},this);this._clearTicksTextDeps(be);return bf},_calcTicksTextLength:function(bh){var be=0,bg=this.font,bi=bh.ticksText||this._calcContinuousTicksText(bh),bf=bh.ticksTextLength=bi.map(function(bk){var bj=p.Text.measureWidth(bk,bg);bj>be&&(be=bj);return bj});bh.maxTextWidth=be;bh.ticksBBoxes=null;return bf},_calcTicksLabelBBoxes:function(bi){var bf,bj=this,be=bj._layoutInfo,bh=bi.ticksTextLength||bj._calcTicksTextLength(bi),bg=be.maxTextWidth;bi.ticksBBoxes=bh.map(function(bk){var bl=bj._calcLabelBBox(bk);bf||bk!==bg||(bf=bl);return bl},bj);be.maxLabelBBox=bf},_calcLabelBBox:function(bf){var be=this._layoutInfo;return aL.text.getLabelBBox(bf,be.textHeight,be.textAlign,be.textBaseline,be.textAngle,be.textMargin)},_calcDiscreteTicksIncludeModulo:function(){var bm=this.axis.option("OverlappedLabelsMode");if("hide"!==bm&&"rotatethenhide"!==bm){return 1}var bl=this._layoutInfo,bt=bl.ticks,be=bt.length;if(2>=be){return 1}var bq=this.scale.range().step,bp=bl.textHeight,bk=bl.maxTextWidth;if(!(bk>0&&bp>0&&bq>0)){return 1}var bg=bp*this.labelSpacingMin,bj=bg,bv=p.Text.measureWidth("x",this.font),bf=bv+bg,br=bl.textAngle,bo=this.isAnchorTopOrBottom(),bh=Math.abs(Math[bo?"sin":"cos"](br)),bu=Math.abs(Math[bo?"cos":"sin"](br)),bi=1e-8>bh?1/0:Math.ceil((bj+bp)/(bq*bh)),bs=1e-8>bu?1/0:Math.ceil((bf+bk)/(bq*bu)),bn=Math.min(bi,bs);(!isFinite(bn)||1>bn||Math.ceil(be/bn)<2)&&(bn=1);return bn},_tickMultipliers:[1,2,5,10],_calcNumberVDesiredTickCount:function(){var bo=this._layoutInfo,bm=bo.textHeight*(1+Math.max(0,this.labelSpacingMin)),bl=bo.clientSize[this.anchorLength()],bf=Math.max(1,~~(bl/bm));if(1>=bf){return 1}var bh=this.scale.domain(),bn=bh[1]-bh[0];if(0>=bn){return bf}for(var bg,bk=bn/bf,bj=Math.floor(p.log(bk,10)),bp=Math.pow(10,bj),be=this._tickMultipliers,bi=0;bi<be.length;bi++){bg=be[bi]*bp;if(bg>=bk){break}}return Math.max(1,Math.floor(bn/bg))},_calcNumberHTicks:function(){for(var bg,bk,bi,br,bl,bh=this._layoutInfo,bq=bh.clientSize[this.anchorLength()],bn=bh.textHeight*Math.max(0,this.labelSpacingMin),bf=this._calcNumberHDesiredTickCount(bn),bp=aL.debug>=7;;){bp&&this._log("calculateNumberHTicks TickCount IN desired = "+bf);bi={};this._calcContinuousTicksValue(bi,bf);var bs=bi.ticks,bo=bs.length;if(bs.exponentOverflow){if(null!=bg){if(1===bg){br&&(bi=br);break}bl&&(bi=bl);break}if(bs.exponent===this.exponentMin){br=bi;bg=1}else{bl=bi;bg=-1}}else{if(null==bk||bo!==bk){bp&&this._log("calculateNumberHTicks TickCount desired/resulting = "+bf+" -> "+bo);bk=bo;this._calcContinuousTicksText(bi);var be=this._calcNumberHLength(bi,bn),bj=bi.excessLength=be-bq,bm=bi.error=Math.abs(bj/bq);if(bp){this._log("calculateNumberHTicks error="+(bj>=0?"+":"-")+(100*bi.error).toFixed(0)+"% count="+bo+" step="+bs.step);this._log("calculateNumberHTicks Length client/resulting = "+bq+" / "+be+" spacing = "+bn)}if(bj>0){if(1===bf){if(3===bo&&1>=bm){bi.ticks.splice(1,1);bi.ticksText.splice(1,1);bi.ticks.step*=2}else{bi.ticks.length=1;bi.ticksText.length=1}delete bi.maxTextWidth;break}if(br){bi=br;break}bl=bi;bg=-1}else{if(0.05>=bm||-1===bg){break}br=bi;bg=1}}}bf+=bg}if(bi){bh.ticks=bi.ticks;bh.ticksText=bi.ticksText;bh.maxTextWidth=bi.maxTextWidth;aL.debug>=5&&this._log("calculateNumberHTicks RESULT error="+(bi.excessLength>=0?"+":"-")+(100*bi.error).toFixed(0)+"% count="+bi.ticks.length+" step="+bi.ticks.step)}bp&&this._log("calculateNumberHTicks END")},_calcNumberHDesiredTickCount:function(bi){var bh=this._layoutInfo,be=this.scale.domain().map(function(bj){bj=+bj.toFixed(2);var bk=this.scale.tickFormat(bj);return p.Text.measureWidth(bk,this.font)},this),bg=Math.max((be[1]+be[0])/2,bh.textHeight),bf=bh.clientSize[this.anchorLength()];return Math.max(1,~~(bf/(bg+bi)))},_calcNumberHLength:function(be,bh){var bf=be.ticksText,bg=a4.query(bf).select(function(bi){return p.Text.measureWidth(bi,this.font)},this).max();return Math.max(bg,(bf.length-1)*(bg+bh))},_createCore:function(){if(!this.scale.isNull){var bg=this._layoutInfo.clientSize,bf=this._layoutInfo.paddings,bh=this.anchorOrtho(),bm=this.anchorOpposite(bh),bl=this.anchorOrthoLength(bh),bk=this.ruleCrossesMargin?-bf[bh]:0,be=bg[bl]+(this.ruleCrossesMargin?bf[bm]:0),bj=be-bk;this._rSize=bj;var bi=this._getRootScene();this.pvRule=new aL.visual.Rule(this,this.pvPanel,{extensionId:"rule"}).lock("data",[bi]).override("defaultColor",a4.fun.constant("#666666")).lock(this.anchorOpposite(),0).lock(bh,bk).lock(bl,bj).pvMark.zOrder(30).strokeDasharray(null).lineCap("square");this.isDiscrete?this.useCompositeAxis?this.renderCompositeOrdinalAxis():this.renderOrdinalAxis():this.renderLinearAxis()}},_getExtensionId:function(){return""},_getRootScene:function(){if(!this._rootScene){var bg=this._rootScene=new aL.visual.CartesianAxisRootScene(null,{panel:this,source:this._getRootData()}),bf=this._layoutInfo,bl=bf.ticks,bn=bf.ticksText;if(this.isDiscrete){if(this.useCompositeAxis){this._buildCompositeScene(bg)}else{var bi=this._tickIncludeModulo,bm=this.hiddenLabelText;bg.vars.tickIncludeModulo=bi;bg.vars.hiddenLabelText=bm;var bo,bk,bj,be;if(bi>2){aL.debug>=3&&this._info("Showing only one in every "+bi+" tick labels");var bh=bg.group.owner.keySep;bj=function(){var bq=bo.map(function(bs){return bs.key}).join(bh),bp=bk.slice(0,10).join(", ")+(bk.length>10?", ...":""),br=new aL.visual.CartesianAxisTickScene(bg,{source:bo,tick:bq,tickRaw:bq,tickLabel:bp,isHidden:!0});br.dataIndex=be;bo=bk=be=null}}bl.forEach(function(bs,bp){var bq=bp%bi!==0;if(bq&&bi>2){null==be&&(be=bp);(bo||(bo=[])).push(bs);(bk||(bk=[])).push(bn[bp])}else{bo&&bj();var br=new aL.visual.CartesianAxisTickScene(bg,{source:bs,tick:bs.value,tickRaw:bs.rawValue,tickLabel:bn[bp],isHidden:bq});br.dataIndex=bp}});bo&&bj()}}else{bl.forEach(function(bq,bp){var br=new aL.visual.CartesianAxisTickScene(bg,{tick:bq,tickRaw:bq,tickLabel:bn[bp]});br.dataIndex=bp},this)}}return this._rootScene},_buildCompositeScene:function(bg){function be(bj){var bi=bj.group;if(bf){var bh=bj.vars.tick;bj.nodeValue=bj.value=bh.rawValue;bj.nodeLabel=bj.label=bh.label}bi.childCount()&&bi.children().each(function(bl){var bk=new aL.visual.CartesianAxisTickScene(bj,{source:bl,tick:bl.value,tickRaw:bl.rawValue,tickLabel:bl.label});bk.dataIndex=bl.childIndex();be(bk)})}var bf=this.compatVersion()<=1;bg.vars.tick=new Y("","");be(bg)},_getRootData:function(){var bg;if(this.isDiscrete&&this.useCompositeAxis){var be=this.anchor,bf={visible:this.axis.domainVisibleOnly()?!0:null,isNull:this.chart.options.ignoreNulls||this.axis.domainIgnoreNulls()?!1:null,reverse:"bottom"==be||"left"==be};bg=this.axis.role.select(this.data,bf)}else{bg=this.data}return bg},renderOrdinalAxis:function(){var be,bl=this.scale,br=this.hiddenLabelText,bp=this._tickIncludeModulo,bf=bp*bl.range().step/2,bj=this.anchorOpposite(),bu=this.anchorLength(),bq=this.anchorOrtho(),bo=this.anchorOrthoLength(),bh=this.pvRule,bm=this._getRootScene(),bk=this._layoutInfo,bt=this.compatVersion()<=1;if(bt){var bs=function(bv){this.value=this.absValue=bv.rawValue;this.nodeName=""+(this.value||"");this.path=this.nodeName?[this.nodeName]:[];this.label=this.absLabel=bv.label};bs.prototype.toString=function(){return""+this.value};be=function(bv){return function(bw){var bx=Object.create(this);bx.index=this.parent.index;return bv.call(bx,new bs(bw.vars.tick))}}}var bn=new aL.visual.Panel(this,this.pvPanel,{extensionId:"ticksPanel"}).lock("data",bm.childNodes).lock(bj,0).lockMark(bq,function(bv){return bv.isHidden?bl(bv.previousSibling.vars.tick.value)+bf:bl(bv.vars.tick.value)}).lock("strokeDasharray",null).lock("strokeStyle",null).lock("fillStyle",null).lock("lineWidth",0).pvMark.zOrder(20);if(bt||this.showTicks){this.pvTicks=new aL.visual.Rule(this,bn,{extensionId:"ticks",wrapper:be}).lock("data").intercept("visible",function(bv){return !bv.isHidden&&this.delegateExtension(!0)}).optional("lineWidth",1).lock(bj,0).lock(bq,0).lock(bu,null).optional(bo,2*this.tickLength/3).override("defaultColor",function(){return bt?p.Color.names.transparent:bh.scene?bh.scene[0].strokeStyle:"#666666"}).pvMark}var bi=this.font,bg=this._layoutInfo.maxTextWidth;isFinite(bg)||(bg=0);this.pvLabel=new aL.visual.Label(this,bn,{extensionId:"label",showsInteraction:!0,noClick:!1,noDoubleClick:!1,noSelect:!1,noTooltip:!1,noHover:!1,wrapper:be}).intercept("visible",function(bv){return bv.isHidden?!!bv.vars.hiddenLabelText:this.delegateExtension(!0)}).intercept("text",function(bv){var bw;if(bv.isHidden){bw=br}else{bw=this.delegateExtension();void 0===bw&&(bw=bv.vars.tick.label);!bg||this.showsInteraction()&&bv.isActive||(bw=aL.text.trimToWidthB(bg,bw,bi,"..",!1))}return bw}).pvMark.zOrder(40).lock(bj,this.tickLength).lock(bq,0).font(bi).textStyle("#666666").textAlign(bk.textAlign).textBaseline(bk.textBaseline);this._debugTicksPanel(bn)},_getTooltipFormatter:function(bf){if(this.axis.option("TooltipEnabled")){bf.gravity=this._calcTipsyGravity();var bg=this.axis.option("TooltipFormat");if(bg){return function(bh){return bg.call(bh,bh.scene)}}var be=this.axis.option("TooltipAutoContent");if("summary"===be){return this._summaryTooltipFormatter}if("value"===be){bf.isLazy=!1;return function(bh){return bh.scene.vars.tick.label}}}},_debugTicksPanel:function(bg){if(aL.debug>=16){var be=(this.font,this._layoutInfo),bf=be.ticksBBoxes||this._calcTicksLabelBBoxes(be);bg.add(p.Panel)[this.anchorOpposite()](this.tickLength)[this.anchorOrtho()](0)[this.anchorLength()](0)[this.anchorOrthoLength()](0).fillStyle(null).strokeStyle(null).lineWidth(0).visible(function(bh){return !bh.isHidden}).add(p.Line).data(function(bj){var bi=bf[bj.dataIndex],bh=bi.source.points();bh.length>1&&(bh=bh.concat(bh[0]));return bh}).left(function(bh){return bh.x}).top(function(bh){return bh.y}).strokeStyle("red").lineWidth(0.5).strokeDasharray("-")}},renderLinearAxis:function(){var bf,bj=this.scale,bg=this.pvRule,bh=this.anchorOpposite(),br=this.anchorLength(),bq=this.anchorOrtho(),bo=this.anchorOrthoLength(),bk=this._getRootScene();this.compatVersion()<=1&&(bf=function(bs){return function(bt){var bu=Object.create(this);bu.index=this.parent.index;return bs.call(bu,bt.vars.tick.rawValue)}});var bn=new aL.visual.Panel(this,this.pvPanel,{extensionId:"ticksPanel"}).lock("data",bk.childNodes).lock(bh,0).lockMark(bq,function(bs){return bj(bs.vars.tick.value)}).lock("strokeStyle",null).lock("fillStyle",null).lock("lineWidth",0).pvMark.zOrder(20);if(this.showTicks){var bm=this.pvTicks=new aL.visual.Rule(this,bn,{extensionId:"ticks",wrapper:bf}).lock("data").override("defaultColor",function(){return bg.scene?bg.scene[0].strokeStyle:"#666666"}).lock(bh,0).lock(bq,0).lock(br,null).optional(bo,this.tickLength).pvMark;if(this.showMinorTicks){var bi=this._layoutInfo,bp=bi.ticks,be=bp.length,bl=be>1?Math.abs(bj(bp[1])-bj(bp[0]))/2:0;this.pvMinorTicks=new aL.visual.Rule(this,this.pvTicks,{extensionId:"minorTicks",wrapper:bf}).lock("data").intercept("visible",function(bs){var bt=bs.childIndex()<be-1&&(!bm.scene||bm.scene[0].visible);return bt&&this.delegateExtension(!0)}).override("defaultColor",function(){return bm.scene?bm.scene[0].strokeStyle:p.Color.names.d}).lock(bh,0).lock(br,null).optional(bo,this.tickLength/2).lockMark(bq,bl).pvMark}}this.renderLinearAxisLabel(bn,bf);this._debugTicksPanel(bn)},renderLinearAxisLabel:function(bl,bk){var bg=(this.pvTicks,this.anchorOpposite()),bh=this.anchorOrtho(),bf=(this.scale,this.font),bi=this._layoutInfo.maxTextWidth;isFinite(bi)||(bi=0);var be=this.pvLabel=new aL.visual.Label(this,bl,{extensionId:"label",noHover:!1,showsInteraction:!0,wrapper:bk}).lock("data").intercept("text",function(bm){var bn=bm.vars.tick.label;!bi||this.showsInteraction()&&bm.isActive||(bn=aL.text.trimToWidthB(bi,bn,bf,"..",!1));return bn}).pvMark.lock(bg,this.tickLength).lock(bh,0).zOrder(40).font(this.font).textStyle("#666666"),bj=this.pvPanel.root;this.isAnchorTopOrBottom()?be.textBaseline(bg).textAlign(function(bm){var bn;if(0===this.index){bn=be.toScreenTransform().transformHPosition(be.left());if(0>=bn){return"left"}}else{if(this.index===bm.parent.childNodes.length-1){bn=be.toScreenTransform().transformHPosition(be.left());if(bn>=bj.width()){return"right"}}}return"center"}):be.textAlign(bg).textBaseline(function(bm){var bn;if(0===this.index){bn=be.toScreenTransform().transformVPosition(be.top());if(bn>=bj.height()){return"bottom"}}else{if(this.index===bm.parent.childNodes.length-1){bn=be.toScreenTransform().transformVPosition(be.top());if(0>=bn){return"top"}}}return"middle"})},_onV1Click:function(be,bf){this.isDiscrete&&this.useCompositeAxis&&bf.call(be.pvMark,be.scene,be.event)},_onV1DoubleClick:function(be,bf){this.isDiscrete&&this.useCompositeAxis&&bf.call(be.pvMark,be.scene,be.event)},_getSelectableMarks:function(){return this.isDiscrete&&this.isVisible&&this.pvLabel?this.base():void 0},renderCompositeOrdinalAxis:function(){var bi=this.isAnchorTopOrBottom(),bo=bi?"h":"v",bm=2,bg=2,bf=this.font,bj=p.Text.fontHeight(bf)/2,bk=this._pvLayout=this._getCompositeLayoutSingleCluster();bk.node.def("fitInfo",null).height(function(bp){var bq=aL.text.getFitInfo(bp.dx,bp.dy,bp.vars.tick.label,bf,bj);bq.h||("v"===bo&&bq.v?bg=Math.min(bm,bp.depth):bm=Math.min(bm,bp.depth));this.fitInfo(bq);return bp.dy});bk.node.add(p.Bar).fillStyle("rgba(127,127,127,.001)").strokeStyle(function(bp){return 1!==bp.maxDepth&&bp.maxDepth?"rgba(127,127,127,0.3)":null}).lineWidth(function(bp){return 1!==bp.maxDepth&&bp.maxDepth?0.5:0}).text(function(bp){return bp.vars.tick.label});var be,bh=0.3,bn=1.27,bl=bi?"center":"left"==this.anchor?"right":"left";this.compatVersion()<=1&&(be=function(bp){return function(bq){return bp.call(this,bq)}});this.pvLabel=new aL.visual.Label(this,bk.label,{extensionId:"label",noClick:!1,noDoubleClick:!1,noSelect:!1,noTooltip:!1,noHover:!1,showsInteraction:!0,wrapper:be,tooltipArgs:{options:{offset:2*bj}}}).pvMark.def("lblDirection","h").textAngle(function(bp){if(bp.depth>=bg&&bp.depth<bm){this.lblDirection("v");return -Math.PI/2}if(bp.depth>=bm){var bq=bp.dy/bp.dx,br=Math.atan(bq);if(br>bn){this.lblDirection("v");return -Math.PI/2}if(br>bh){this.lblDirection("d");return -br}}this.lblDirection("h");return 0}).textMargin(1).textAlign(function(bp){return"v"!=bo||bp.depth>=bg||bp.depth>=bm?"center":bl}).left(function(bp){return"v"!=bo||bp.depth>=bg||bp.depth>=bm?bp.x+bp.dx/2:"right"==bl?bp.x+bp.dx:bp.x}).font(bf).textStyle("#666666").text(function(bq){var bp=bq.vars.tick.label;if(!bq.isActive||!this.sign.showsInteraction()){var br=this.fitInfo();switch(this.lblDirection()){case"h":if(!br.h){return aL.text.trimToWidthB(bq.dx,bp,bf,"..")}break;case"v":if(!br.v){return aL.text.trimToWidthB(bq.dy,bp,bf,"..")}break;case"d":if(!br.d){var bs=Math.sqrt(a4.sqr(bq.dy)+a4.sqr(bq.dx));return aL.text.trimToWidthB(bs-bj,bp,bf,"..")}}}return bp})},_getCompositeLayoutSingleCluster:function(){var bi=this._getRootScene(),bf=this.anchor,bg=bi.group.treeHeight,bk=this._layoutInfo.axisSize;bg++;var bj=bk/bg,bh=bg>2?1/12*bk:0;bj-=bh;var bm=bg/(bg-1),bn=aL.BasePanel.orthogonalLength[bf],bl="width"==bn?"left"===bf?[-bj,0]:[bj,0]:"top"===bf?[0,-bj]:[0,bj];this.pvRule.sign.override("defaultColor",a4.fun.constant(null)).override("defaultStrokeWidth",a4.fun.constant(0));var be=this.pvRule.add(p.Panel)[bn](bk).strokeStyle(null).lineWidth(0).add(p.Panel)[bn](bk*bm).strokeStyle(null).lineWidth(0);be.transform(p.Transform.identity.translate(bl[0],bl[1]));return be.add(p.Layout.Cluster.Fill).nodes(bi.nodes()).orient(bf)},_calcTipsyGravity:function(){switch(this.anchor){case"bottom":return"s";case"top":return"n";case"left":return"w";case"right":return"e"}return"s"}});a4.type("pvc.AxisTitlePanel",aL.TitlePanelAbstract).init(function(bh,bg,bf,be){this.axis=bf;this.base(bh,bg,be);this._extensionPrefix=bf.extensionPrefixes.map(function(bi){return bi+"Title"})}).add({_calcLayout:function(be){var bf=this.axis.scale;return !bf||bf.isNull?new s(0,0):this.base(be)},_createCore:function(be){var bf=this.axis.scale;return bf&&!bf.isNull?this.base(be):void 0}});a4.type("pvc.PiePanel",aL.PlotPanel).init(function(bh,bg,bi,bf){var be=bi.option("ValuesLabelStyle");this.base(bh,bg,bi,bf);this.explodedOffsetRadius=bi.option("ExplodedSliceRadius");this.explodedSliceIndex=bi.option("ExplodedSliceIndex");this.activeOffsetRadius=bi.option("ActiveSliceRadius");this.labelStyle=be;if("linked"===be){this.linkInsetRadius=bi.option("LinkInsetRadius");this.linkOutsetRadius=bi.option("LinkOutsetRadius");this.linkMargin=bi.option("LinkMargin");this.linkHandleWidth=bi.option("LinkHandleWidth");this.linkLabelSize=bi.option("LinkLabelSize");this.linkLabelSpacingMin=bi.option("LinkLabelSpacingMin")}}).add({pvPie:null,pvPieLabel:null,valueRoleName:"value",_getV1Datum:function(bg){var be=bg.datum;if(be){var bf=Object.create(be);bf.percent=bg.vars.value.percent;be=bf}return be},_calcLayout:function(br){function bA(bD){return a4.between(l.resolve(bD,by),0,by)}function bm(bD){return a4.between(l.resolve(bD,bv),0,bv)}var bi=br.clientSize,bv=bi.width,by=Math.min(bv,bi.height)/2;if(!by){return new s(0,0)}var bz=p.vector(bi.width/2,bi.height/2),bl=this._getConstantExtension("label","font");a4.string.is(bl)||(bl=this.valuesFont);var bp=by;if(this.valuesVisible&&"linked"===this.labelStyle){var bs=bA(this.linkInsetRadius),bu=bA(this.linkOutsetRadius),bh=bm(this.linkMargin),bg=bm(this.linkLabelSize),bC=a4.number.to(this._getConstantExtension("label","textMargin"),3),be=2*p.Text.fontHeight(bl)/3,bn=this.linkHandleWidth*be;bh+=bn;var bx=this.linkLabelSpacingMin*be,bq=Math.max(0,bv/2-by),bj=Math.max(0,bu+bh+bg-bq),bB=bu+be,bk=Math.max(0,bB,bj);if(bk>=bp){this.valuesVisible=!1;aL.debug>=2&&this._log("Hiding linked labels due to insufficient space.")}else{bp-=bk;br.link={insetRadius:bs,outsetRadius:bu,elbowRadius:bp+bu,linkMargin:bh,handleWidth:bn,labelSize:bg,maxTextWidth:bg-bC,labelSpacingMin:bx,textMargin:bC,lineHeight:be}}}var bo=bA(this.explodedOffsetRadius),bt=0;this.hoverable()&&(bt=bA(this.activeOffsetRadius));var bw=bo+bt,bf=bp-bw;if(0>bf){return new s(0,0)}br.resolvePctRadius=bA;br.center=bz;br.clientRadius=by;br.normalRadius=bf;br.explodedOffsetRadius=bo;br.activeOffsetRadius=bt;br.maxOffsetRadius=bw;br.labelFont=bl},_createCore:function(bg){var bf,bm=this,bl=bm.chart,bj=this._buildScene(),be=bg.center,bi=bg.normalRadius,bp=["slice"];if(this.compatVersion()<=1){bp.push("");bf=function(bq){return function(br){return bq.call(this,br.vars.value.value)}}}this.pvPie=new aL.visual.PieSlice(this,this.pvPanel,{extensionId:bp,center:be,activeOffsetRadius:bg.activeOffsetRadius,maxOffsetRadius:bg.maxOffsetRadius,resolvePctRadius:bg.resolvePctRadius,wrapper:bf,tooltipArgs:{options:{useCorners:!0,gravity:function(){var bs=this.midAngle(),br=Math.cos(bs)>=0,bq=Math.sin(bs)>=0;return br?bq?"nw":"sw":bq?"ne":"se"}}}}).lock("data",bj.childNodes).override("angle",function(bq){return bq.vars.value.angle}).override("defaultOffsetRadius",function(){var bq=bm.explodedSliceIndex;return null==bq||bq==this.pvMark.index?bg.explodedOffsetRadius:0}).lockMark("outerRadius",function(){return bl.animate(0,bi)}).localProperty("innerRadiusEx",l.parse).intercept("innerRadius",function(){var br=this.delegateExtension();if(null==br){var bq=this.pvMark.innerRadiusEx();br=null!=bq?l.resolve(bq,this.pvMark.outerRadius())||0:0}return br>0?bl.animate(0,br):0}).pvMark;if(this.valuesVisible){this.valuesFont=bg.labelFont;if("inside"===this.labelStyle){this.pvPieLabel=aL.visual.ValueLabel.maybeCreate(this,this.pvPie,{wrapper:bf}).override("defaultText",function(bq){return bq.vars.value.sliceLabel}).override("calcTextFitInfo",function(bJ,bD){var bL=this.pvMark,bt=bL.textMargin();if(!(-0.000001>bt)){var bz=bL.textBaseline();if("middle"===bz){var bq=aL.normAngle(bm.pvPie.midAngle()),bH=aL.normAngle(bL.textAngle()),bE=Math.abs(bq-bH)<0.000001,bu=!1;if(!bE){var bG=aL.normAngle(bH+Math.PI);bu=Math.abs(bq-bG)<0.000001}if(bE||bu){var br=bL.name(),bA=bL.textAlign(),bI="outer"===br?bA===(bE?"right":"left"):!1;if(bI){var bC=!1,bF=p.Text.measure(bD,bL.font()),bv=0.85*bF.height,by=bm.pvPie.outerRadius(),bw=bm.pvPie.innerRadius(),bK=bJ.vars.value.angle,bs=bv+bt/2,bB=bK<Math.PI?Math.max(bw,bs/(2*Math.tan(bK/2))):bw,bx=by-bt-bB;bC|=0>=bx;bx-=bt;bC|=this.hideOverflowed&&bF.width>bx;return{hide:bC,widthMax:bx}}}}}}).pvMark.textMargin(10)}else{if("linked"===this.labelStyle){var bn=bg.link;bj.layoutLinkLabels(bg);this.pvLinkPanel=this.pvPanel.add(p.Panel).data(bj.childNodes).localProperty("pieSlice").pieSlice(function(){return bm.pvPie.scene[this.index]});var bk=!1,bo=!0;this.pvLinkLine=new aL.visual.Line(this,this.pvLinkPanel,{extensionId:"linkLine",freePosition:bo,noClick:bo,noDoubleClick:bo,noSelect:bo,noTooltip:bo,noHover:bo,showsActivity:bk}).lockMark("data",function(bv){var br=this.parent.pieSlice(),bu=br.startAngle+br.angle/2,bt=br.outerRadius-bn.insetRadius,bq=br.left+bt*Math.cos(bu),bw=br.top+bt*Math.sin(bu),bs=bv.childNodes[0];if(bs&&bs._isFirstDynamicScene){bs.x=bq;bs.y=bw}else{bs=new aL.visual.PieLinkLineScene(bv,bq,bw,0);bs._isFirstDynamicScene=bo}return bv.childNodes}).override("defaultColor",function(br,bq){return"stroke"===bq?"black":this.base(br,bq)}).override("defaultStrokeWidth",a4.fun.constant(0.5)).pvMark.lock("visible").lock("top",function(bq){return bq.y}).lock("left",function(bq){return bq.x});this.pvPieLabel=new aL.visual.Label(this,this.pvLinkPanel,{extensionId:"label",noClick:bk,noDoubleClick:bk,noSelect:bk,noHover:bk,showsInteraction:bo}).lockMark("data",function(bq){return bq.lineScenes}).intercept("textStyle",function(br){this._finished=bk;var bq=this.delegate();bq&&!this._finished&&!this.mayShowActive(br)&&this.mayShowNotAmongSelected(br)&&(bq=this.dimColor(bq,"text"));return bq}).pvMark.lock("visible").left(function(bq){return bq.vars.link.labelX}).top(function(bq){return bq.vars.link.labelY+(this.index+1)*bn.lineHeight}).textAlign(function(bq){return bq.vars.link.labelAnchor}).textMargin(bn.textMargin).textBaseline("bottom").text(function(bq){return bq.vars.link.labelLines[this.index]});if(aL.debug>=20){this.pvPanel.add(p.Panel).zOrder(-10).left(be.x-bg.clientRadius).top(be.y-bg.clientRadius).width(2*bg.clientRadius).height(2*bg.clientRadius).strokeStyle("red");this.pvPanel.strokeStyle("green");var bh=p.Colors.category10();this.pvLinkLine.segmented(bo).strokeStyle(function(){return bh(this.index)})}}}this.pvPieLabel.font(bg.labelFont)}},_getExtensionId:function(){var be=[{abs:"content"}];this.chart.parent&&be.push({abs:"smallContent"});return be.concat(this.base())},renderInteractive:function(){this.pvPanel.render()},_buildScene:function(){var be=new aL.visual.PieRootScene(this);this.sum=be.vars.sumAbs.value;return be}});a4.type("pvc.visual.PieRootScene",aL.visual.Scene).init(function(be){function bk(bs,bt){if(bt){var br=bt._datums;if(1===br.length){return br[0].atoms[bf].label}}return bl.format(bs)}var bp=be.axes.category,bo=bp.domainData();this.base(null,{panel:be,source:bo});var bq=new aL.visual.RoleVarHelper(this,be.visualRoles.color,{roleVar:"color"}),bf=be.visualRoles[be.valueRoleName].firstDimensionName(),bl=bo.dimensions(bf),bg=be.chart.options.percentValueFormat,bn=be.axes.angle.scale,bm=bn.isNull?0:bn.domain()[1];this.vars.sumAbs=new Y(bm,bk(bm));var bj=this,bh=a4.type(aL.visual.PieCategoryScene).init(function(bu,bt){this.base(bj,{source:bu});this.vars.category=Y.fromComplex(bu);var br=new Y(bt,bk(bt,bu));br.angle=bn(bt);var bs=Math.abs(bt)/bm;br.percent=new Y(bs,bg(bs));this.vars.value=br;br.sliceLabel=this.sliceLabel();bq.onNewScene(this,!0)});be._extendSceneType("category",bh,["sliceLabel","sliceLabelMask"]);var bi=bp.domainItems();if(bi.length){bi.forEach(function(bs){var br=bs.dimensions(bf).value();0!==br&&new bh(bs,br)});if(!bj.childNodes.length&&!be.visualRoles.multiChart.isBound()){throw new InvalidDataException("Unable to create a pie chart, please check the data values.")}}}).add({layoutLinkLabels:function(bf){var be=-Math.PI/2,bg=[],bh=[];this.childNodes.forEach(function(bi){be=bi.layoutI(bf,be);(bi.vars.link.dir>0?bh:bg).push(bi)});this._distributeLabels(-1,bg,bf);this._distributeLabels(1,bh,bf)},_distributeLabels:function(bf,be,bg){be.sort(function(bi,bh){return a4.compare(bi.vars.link.targetY,bh.vars.link.targetY)});this._distributeLabelsDownwards(be,bg)&&this._distributeLabelsUpwards(be,bg)&&this._distributeLabelsEvenly(be,bg);be.forEach(function(bh){bh.layoutII(bg)})},_distributeLabelsDownwards:function(bh,bj){for(var bp=bj.link,bg=bp.labelSpacingMin,bi=bj.clientSize.height,be=!1,bk=0,bo=bh.length-1;bo>bk;bk++){var br=bh[bk].vars.link;!bk&&br.labelTop()<0&&(be=!0);var bq=bh[bk+1].vars.link,bf=br.labelBottom()+bg;if(bq.labelTop()<bf){var bl=bq.labelHeight/2,bm=bf+bl,bn=bi-bl;if(bm>bn){be=!0;bq.targetY=bn}else{bq.targetY=bm}}}return be},_distributeLabelsUpwards:function(bg,bi){for(var bm=bi.link,bf=bm.labelSpacingMin,be=!1,bj=bg.length-1;bj>0;bj--){var bn=bg[bj-1].vars.link,bo=bg[bj].vars.link;1===bj&&bn.labelTop()<0&&(be=!0);var bp=bo.labelTop()-bf;if(bn.labelBottom()>bp){var bk=bn.labelHeight/2,bl=bp-bk,bh=bk;if(bh>bl){be=!0;bn.targetY=bh}else{bn.targetY=bl}}}return be},_distributeLabelsEvenly:function(be,bh){var bf=0;be.forEach(function(bk){bf+=bk.vars.link.labelHeight});var bi=bh.clientSize.height-bf,bg=bi;be.length>1&&(bg/=be.length-1);var bj=0;be.forEach(function(bm){var bk=bm.vars.link,bl=bk.labelHeight/2;bj+=bl;bk.targetY=bj;bj+=bl+bg});return !0}});a4.type("pvc.visual.PieLinkLabelVar").add({labelTop:function(){return this.targetY-this.labelHeight/2},labelBottom:function(){return this.targetY+this.labelHeight/2}});a4.type("pvc.visual.PieCategoryScene",aL.visual.Scene).add({sliceLabelMask:function(){return this.panel().valuesMask},sliceLabel:function(){return this.format(this.sliceLabelMask())},layoutI:function(bp,bu){var bh=this.vars.value,br=bu+bh.angle,bj=(bu+br)/2,bi=this.vars.link=new aL.visual.PieLinkLabelVar(),bl=bp.link,bg=aL.text.justify(bh.sliceLabel,bl.maxTextWidth,bp.labelFont),bs=bg.length;bi.labelLines=bg;bi.labelHeight=bs*bl.lineHeight;this.lineScenes=a4.array.create(bs,this);var bv=Math.cos(bj),bm=Math.sin(bj),be=bv>=0,bq=be?1:-1;bi.labelAnchor=be?"left":"right";var bw=bp.center,bt=bl.elbowRadius,bo=bw.x+bt*bv,bn=bw.y+bt*bm,bf=bw.x+bq*bt,bk=bf+bq*bl.linkMargin;new aL.visual.PieLinkLineScene(this,bo,bn);new aL.visual.PieLinkLineScene(this,bf,bn);bi.elbowY=bn;bi.targetY=bn+0;bi.targetX=bk;bi.dir=bq;return br},layoutII:function(bi){var bf=this.vars.link,bg=bf.targetY,bh=bf.targetX,be=bi.link.handleWidth;be>0&&new aL.visual.PieLinkLineScene(this,bh-bf.dir*be,bg);new aL.visual.PieLinkLineScene(this,bh,bg);bf.labelX=bh;bf.labelY=bg-bf.labelHeight/2}});a4.type("pvc.visual.PieLinkLineScene",aL.visual.Scene).init(function(bg,be,bh,bf){this.base(bg,{source:bg.group,index:bf});this.x=be;this.y=bh}).add(p.Vector);a4.type("pvc.PieChart",aL.BaseChart).add({_animatable:!0,_axisClassByType:{category:aL.visual.Axis,angle:aL.visual.NormalizedAxis},_axisCreateChartLevel:{category:2,angle:2},_axisSetScaleChartLevel:{category:2,angle:2},_axisCreationOrder:function(){var be=aL.BaseChart.prototype._axisCreationOrder.slice();be.push("category","angle");return be}(),pieChartPanel:null,_getColorRoleSpec:function(){return{isRequired:!0,defaultSourceRole:"category",defaultDimension:"color*",requireIsDiscrete:!0}},_initVisualRoles:function(){this.base();this._addVisualRole("category",{isRequired:!0,defaultDimension:"category*",autoCreateDimension:!0});this._addVisualRole("value",{isMeasure:!0,isRequired:!0,isPercent:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"value"})},_initPlotsCore:function(){new aL.visual.PiePlot(this)},_createVisibleData:function(bf,be){return this.visualRoles.category.flatten(bf,be)},_setAxisScale:function(be,bf){this.base(be,bf);2&bf&&"angle"===be.type&&be.setScaleRange({min:0,max:2*Math.PI})},_createContent:function(bg){this.base();var be=this.compatVersion()<=1;if(be){var bf=aL.castNumber(this.options.innerGap)||0.95;bf=a4.between(bf,0.1,1);bg.paddings=(100*(1-bf)/2).toFixed(2)+"%"}else{null==bg.paddings&&(bg.paddings=new l(0.025))}var bh=this.plots.pie;this.pieChartPanel=new aL.PiePanel(this,this.basePanel,bh,a4.create(bg,{scenes:a4.getPath(this.options,"pie.scenes")}))}});a4.type("pvc.BarAbstractPanel",aL.CategoricalAbstractPanel).add({pvBar:null,pvBarLabel:null,pvCategoryPanel:null,pvSecondLine:null,pvSecondDot:null,_creating:function(){var be=this.defaultLegendGroupScene();if(be&&!be.hasRenderer()){var bf=be.colorAxis,bi=bf.option("LegendDrawLine"),bh=!bi||bf.option("LegendDrawMarker");if(bh){var bg={drawMarker:!0,markerShape:bf.option("LegendShape"),drawRule:bi,markerPvProto:new Z()};this.extend(bg.markerPvProto,"",{constOnly:!0});be.renderer(new aL.visual.legend.BulletItemDefaultRenderer(bg))}}},_createCore:function(){this.base();var bs,bz,bG=this,bt=bG.chart,bx=bG.plot,bn=!!bG.stacked,bo=bG.isOrientationVertical(),bH=bG.visibleData({ignoreNulls:!1}),bp=bG.axes.ortho,bq=bG.axes.base,bj=bq.domainItems(),bi=bG.visualRoles.series.flatten(bG.partData(),{visible:!0,isNull:bt.options.ignoreNulls?!1:null}).childNodes,bI=bG._buildScene(bH,bi,bj),bC=bp.scale,by=bC(0),bl=bp.sceneScale({sceneVarName:"value",nullToZero:!1}),bF=bq.sceneScale({sceneVarName:"category"}),bv=bx.option("BarSizeRatio"),be=bx.option("BarSizeMax"),bu=bx.option("BarStackedMargin"),bE=bx.option("BarOrthoSizeMin"),bB=bq.scale.range(),bf=bB.band,bw=bB.step,bg=bB.margin,bh=bo===bn;if(bn){bs=bf}else{bz=bi.length;bs=bz?1===bz?bf:bv*bf/bz:0}bs>be&&(bs=be);bG.barWidth=bs;bG.barStepWidth=bw;var bk;bG.compatVersion()<=1&&(bk=function(bJ){return function(bN){var bK=Object.create(this.parent),bO=Object.create(this);bO.parent=bK;var bM=bN.parent.childIndex(),bL=bN.childIndex();if(bn){bK.index=bM;bO.index=bL}else{bK.index=bL;bO.index=bM}return bJ.call(bO,bN.vars.value.rawValue)}});bG.pvBarPanel=new aL.visual.Panel(bG,bG.pvPanel,{panelType:p.Layout.Band,extensionId:"panel"}).lock("layers",bI.childNodes).lockMark("values",function(bJ){return bJ.childNodes}).lockMark("orient",bo?"bottom-left":"left-bottom").lockMark("layout",bn?"stacked":"grouped").lockMark("verticalMode",bG._barVerticalMode()).lockMark("yZero",by).optionalMark("hZero",bE).pvMark.band.x(bF).w(bf).differentialControl(bG._barDifferentialControl()).item.order(bh?"reverse":null).h(function(bJ){var bK=bl(bJ);return null!=bK?bt.animate(0,bK-by):null}).w(bs).horizontalRatio(bv).verticalMargin(bu).end;var bD=4>=bs||2>bg,bA=this.pvBar=new aL.visual.Bar(bG,bG.pvBarPanel.item,{extensionId:"",freePosition:!0,wrapper:bk}).lockDimensions().pvMark.antialias(function(bK){if(bD){return !0}var bL=bl(bK),bJ=null==bL?0:Math.abs(bL-by);return 1e-8>bJ});bx.option("OverflowMarkersVisible")&&this._addOverflowMarkers(bk);var bm=aL.visual.ValueLabel.maybeCreate(bG,bA,{wrapper:bk});if(bm){var br;if(bm.hideOrTrimOverflowed){br=bf;!bn&&bz>1&&(br/=bz)}bG.pvBarLabel=bm.override("calcTextFitInfo",function(b2,bU){var b4=this.pvMark,bK=b4.textMargin();if(!(-0.000001>bK)){var b3=b4.textAngle(),bL=Math.sin(b3),b1=Math.abs(bL)<0.000001,bT=!b1&&Math.abs(Math.cos(b3))<0.000001;if(b1||bT&&bo){var bO,bN,b0,bX=bA.height(),bS=bA.width(),bZ=bo?bX:bS,bW=bo?bS:bX,bV=p.Text.measure(bU,b4.font()),bM=0.75*bV.height,b5=bV.width,bJ=b4.name(),bP=b4.textBaseline(),bQ=b4.textAlign(),bY="center"===bJ,bR=!1;if(bo){if(b1){bN=bY||bJ===bP;if(!bN){return}bR|=bY&&"middle"!==bP?bM+bK>bZ/2:bM+2*bK>bZ}else{bR|=bM>bZ;b0="center"===bQ;bN=bY;bN||b0||(bN=bL>=0.000001?"left"===bQ?"top"===bJ:"bottom"===bJ:"left"===bQ?"bottom"===bJ:"top"===bJ);if(bN){bO=!bY||b0?bZ-2*bK:(bZ-bK)/2;bR|=("middle"===bP?bM>bW:bM>bW/2)||this.hideOverflowed&&b5>bO}else{bR|=bM>=Math.max(bW,br)}}}else{bR|=bM>bZ;bN=bY||bJ===bQ;if(bN){bO=bY&&"center"!==bQ?(bZ-bK)/2:bZ-2*bK;bR|=("middle"===bP?bM>bW:bM>bW/2)||this.hideOverflowed&&b5>bO}else{bR|=bM>=Math.max(bW,br)}}return{hide:bR,widthMax:bO}}}}).pvMark}},_barVerticalMode:function(){return null},_barDifferentialControl:function(){return null},_getV1Datum:function(bg){var be=bg.datum;if(be){var bf=Object.create(be);bf.percent=bg.vars.value.percent;be=bf}return be},_addOverflowMarkers:function(bf){var be=this.axes.ortho;null!=be.option("FixedMax")&&(this.pvOverflowMarker=this._addOverflowMarker(!1,be.scale,bf));null!=be.option("FixedMin")&&(this.pvUnderflowMarker=this._addOverflowMarker(!0,be.scale,bf))},_addOverflowMarker:function(bi,bl,bf){var bj,bm=this.isOrientationVertical(),bg=bm?"bottom":"left",bk=this.anchorOpposite(bg),be=this.anchorOrthoLength(bg),bo=this.anchorLength(bg),bh=this._layoutInfo.paddings,bn=bi?bl.min-bh[bg]:bl.max+bh[bk];bj=bi?bm?0:Math.PI/2:bm?Math.PI:-Math.PI/2;return new aL.visual.Dot(this,this.pvBar.anchor("center"),{noSelect:!0,noHover:!0,noClick:!0,noDoubleClick:!0,noTooltip:!0,freePosition:!0,extensionId:bi?"underflowMarker":"overflowMarker",wrapper:bf}).intercept("visible",function(bs){var bt=this.delegateExtension();if(void 0!==bt&&!bt){return !1}var br=bs.vars.value.value;if(null==br){return !1}var bp=this.pvMark.scene.target[this.pvMark.index],bq=bp[bg]+(br>0?bp[be]:0);return bi?bn>bq:bq>bn}).lock(bk,null).lock("shapeSize").pvMark.shape("triangle").shapeRadius(function(){return Math.min(Math.sqrt(10),this.scene.target[this.index][bo]/2)}).shapeAngle(bj).lineWidth(1.5).strokeStyle("red").fillStyle("white")[bg](function(){return bn+(bi?1:-1)*(this.shapeRadius()+2)})},renderInteractive:function(){this.pvPanel.render()},_buildScene:function(bl,bk,bj){function bi(bn){var bo=new aL.visual.Scene(bh,{source:bn}),bm=bn.key;bo.vars.series=Y.fromComplex(bn);be.onNewScene(bo,!1);bj.forEach(function(bq){var bt=bl.child(bq.key),bs=bt&&bt.child(bm),br=new aL.visual.Scene(bo,{source:bs}),bp=br.vars.category=Y.fromComplex(bt);bp.group=bt;bg.onNewScene(br,!0);be.onNewScene(br,!0)})}var bh=new aL.visual.Scene(null,{panel:this,source:bl}),bf=(bl.childNodes,this.visualRoles),bg=new aL.visual.RoleVarHelper(bh,bf.value,{roleVar:"value",hasPercentSubVar:this.stacked}),be=new aL.visual.RoleVarHelper(bh,bf.color,{roleVar:"color"});bk.forEach(bi);return bh}});a4.type("pvc.BarAbstract",aL.CategoricalAbstract).init(function(be){this.base(be);var bf=this.parent;bf&&(this._valueRole=bf._valueRole)}).add({_initVisualRoles:function(){this.base();this._addVisualRole("value",{isMeasure:!0,isRequired:!0,isPercent:this.options.stacked,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"value"});this._valueRole=this.visualRoles.value},_getCategoryRoleSpec:function(){var be=this.base();be.requireIsDiscrete=!0;return be},_initData:function(){this.base.apply(this,arguments);var be=this.data;this._valueDim=be.dimensions(this._valueRole.firstDimensionName())}});a4.type("pvc.BarPanel",aL.BarAbstractPanel).add({});a4.type("pvc.BarChart",aL.BarAbstract).add({_animatable:!0,_trendable:!0,_allowV1SecondAxis:!0,_initPlotsCore:function(){var bh=this.options,be=new aL.visual.BarPlot(this),bg=be.option("Trend");if(bh.plot2){var bf=new aL.visual.PointPlot(this,{name:"plot2",fixed:{DataPart:"1"},defaults:{ColorAxis:2,LinesVisible:!0,DotsVisible:!0}});bg||(bg=bf.option("Trend"))}this._trendable=!!bg;bg&&new aL.visual.PointPlot(this,{name:"trend",fixed:{DataPart:"trend",TrendType:"none",ColorRole:"series",NullInterpolatioMode:"none"},defaults:{ColorAxis:2,LinesVisible:!0,DotsVisible:!1}})},_hasDataPartRole:function(){return !0},_createPlotPanels:function(bh,bj){var bl=this.plots,bg=bl.bar,bf=new aL.BarPanel(this,bh,bg,Object.create(bj));this.barChartPanel=bf;var bi=bl.plot2;if(bi){aL.debug>=3&&this._log("Creating Point panel.");var bk=new aL.PointPanel(this,bh,bi,Object.create(bj));bf.pvSecondLine=bk.pvLine;bf.pvSecondDot=bk.pvDot;bk._applyV1BarSecondExtensions=!0}var be=bl.trend;if(be){aL.debug>=3&&this._log("Creating Trends Point panel.");new aL.PointPanel(this,bh,be,Object.create(bj))}}});a4.type("pvc.NormalizedBarPanel",aL.BarAbstractPanel).add({_barVerticalMode:function(){return"expand"}});a4.type("pvc.NormalizedBarChart",aL.BarAbstract).add({_processOptionsCore:function(be){be.stacked=!0;this.base(be)},_getContinuousVisibleExtentConstrained:function(bg,bf,be){return"ortho"===bg.type?{min:0,max:100,minLocked:!0,maxLocked:!0}:this.base(bg,bf,be)},_initPlotsCore:function(){new aL.visual.NormalizedBarPlot(this)},_createPlotPanels:function(bf,bg){var be=this.plots.bar;this.barChartPanel=new aL.NormalizedBarPanel(this,bf,be,Object.create(bg))}});a4.type("pvc.visual.legend.WaterfallBulletGroupScene",aL.visual.legend.BulletGroupScene).init(function(bf,be){be=a4.set(be,"clickMode","none");this.base(bf,be);this.createItem(be)}).add({renderer:function(be){null!=be&&(this._renderer=be);return this._renderer},itemSceneType:function(){return aL.visual.legend.WaterfallBulletItemScene}});a4.type("pvc.visual.legend.WaterfallBulletItemScene",aL.visual.legend.BulletItemScene).init(function(bg,bf){this.base.apply(this,arguments);var be=aL.visual.Interactive;this._ibits=be.Interactive|be.ShowsInteraction;this.color=a4.get(bf,"color");this.vars.value=new Y(null,a4.get(bf,"label"))});a4.type("pvc.WaterfallPanel",aL.BarAbstractPanel).add({pvWaterfallLine:null,ruleData:null,_barDifferentialControl:function(){var be=this.chart._isFalling;return function(bh){if(be&&!this.index){return 1}var bg=bh.vars.category.group,bf=bg._isFlattenGroup&&!bg._isDegenerateFlattenGroup;return bf?-2:be?-1:1}},_creating:function(){var bg=this._getLegendBulletRootScene();if(bg){var be=bg.firstChild;if(be&&!be.hasRenderer()){var bf={drawRule:!0,drawMarker:!1,rulePvProto:new Z()};this.extend(bf.rulePvProto,"line",{constOnly:!0});be.renderer(new aL.visual.legend.BulletItemDefaultRenderer(bf))}}},_createCore:function(){this.base();var bn=this.chart,bk=this.isOrientationVertical(),bh=bk?"bottom":"left",bo=this.anchorOrtho(bh),bu=this._buildRuleScene(),bs=bn.axes.ortho.scale,br=bs(0),bi=bn.axes.ortho.sceneScale({sceneVarName:"value"}),bv=bn.axes.base.sceneScale({sceneVarName:"category"}),be=bn.axes.base.scale,bw=this.barWidth/2,bm=this.barWidth,bq=this.barStepWidth,bg=bn._isFalling,bp=bn._waterColor;if(this.plot.option("AreasVisible")){var bt=p.Colors.category10(),bf=this._buildWaterGroupScene(),bj=bs.range(),bl=0.04*(bj[1]-bj[0]);this.pvWaterfallGroupPanel=new aL.visual.Panel(this,this.pvPanel,{extensionId:"group"}).lock("data",bf.childNodes).pvMark.zOrder(-1).fillStyle(function(){return bt(0).alpha(0.15)})[bo](function(bx){var by=bx.vars.category;return be(by.valueLeft)-bq/2})[this.anchorLength(bh)](function(by){var bz=by.vars.category,bx=Math.abs(be(bz.valueRight)-be(bz.valueLeft));return bx+bq})[bh](function(bz){var by=bz.vars.value,bx=bs(by.valueBottom)-bl/2;return bn.animate(br,bx)})[this.anchorOrthoLength(bh)](function(bz){var bx=bz.vars.value,by=bs(bx.valueTop)-bs(bx.valueBottom)+bl;return bn.animate(0,by)})}this.pvBar.sign.override("baseColor",function(bz,by){var bx=this.base(bz,by);return"fill"!==by||bz.vars.category.group._isFlattenGroup?bx:p.color(bx).alpha(0.5)});this.pvWaterfallLine=new aL.visual.Rule(this,this.pvPanel,{extensionId:"line",noTooltip:!1,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1}).lock("data",bu.childNodes).optional("visible",function(bx){return bg&&!!bx.previousSibling||!bg&&!!bx.nextSibling}).optional(bh,function(bx){return br+bn.animate(0,bi(bx)-br)}).optional(this.anchorLength(bh),bq+bm).optional(bo,bg?function(bx){return bv(bx)-bq-bw}:function(bx){return bv(bx)-bw}).override("defaultColor",a4.fun.constant(bp)).pvMark.antialias(!0).lineCap("butt");this.plot.option("TotalValuesVisible")&&(this.pvWaterfallLabel=new aL.visual.Label(this,this.pvWaterfallLine,{extensionId:"lineLabel"}).intercept("visible",function(bx){return bx.vars.category.group._isFlattenGroup?!1:bg||!!bx.nextSibling}).pvMark[bh](function(bx){return br+bn.animate(0,bi(bx)-br)})[this.anchorOrtho(bh)](bv).textAlign(bk?"center":"left").textBaseline(function(bx){if(!bk){return"middle"}var by=bx.vars.direction;if(null==by){return"bottom"}var bz=!bg;return bz===("up"===by)?"bottom":"top"}).textStyle(p.Color.names.darkgray.darker(2)).textMargin(5).text(function(bx){return bx.vars.value.label}))},_buildRuleScene:function(){function bg(bl){var bp=bl.group,bn=new aL.visual.Scene(bh,{source:bp}),bm=bn.vars.category=Y.fromComplex(bp);bm.group=bp;var bo=bl.offset;bn.vars.value=new Y(bo,this.chart._valueDim.format(bo))}function be(bm,bl){var bn=bm.vars.value.value;bm.vars.direction=bl&&bj!==bn?bk===bn>bj?"up":"down":null;bj=bn}var bj,bk,bh=new aL.visual.Scene(null,{panel:this,source:this.visibleData({ignoreNulls:!1})}),bf=this.chart._ruleInfos;if(bf){bf.forEach(bg,this);var bi=a4.query(bh.childNodes);bk=!this.chart._isFalling;bk||(bi=bi.reverse());bi.each(be,this)}return bh},_buildWaterGroupScene:function(){function bl(bo,bq){var bp=bo.children().where(function(br){return""!==br.key});if(bp.next()){bq&&bg(bo,bq);bq++;do{bl(bp.item,bq)}while(bp.next())}}function bg(bs,bq){var bw=new aL.visual.Scene(bi,{source:bs}),bB=bw.vars.category=Y.fromComplex(bs);bB.group=bs;bB.level=bq;var bC,bz,br,bo,by,bp=bw.vars.value={},bx=bk[bs.absKey],bt=bx.offset,bu=bx.range,bA=-bu.min+bu.max;if(be){bC=bj(bs);bz=bk[bC.absKey];br=bx.group.value;bo=bz.group.value;by=bt-bu.max}else{bC=bh(bs);bz=bk[bC.absKey];br=bz.group.value;bo=bx.group.value;by=bt-bu.max}bB.valueLeft=br;bB.valueRight=bo;bp.valueHeight=bA;bp.valueBottom=by;bp.valueTop=by+bA}function bh(bp){var bo=bp.childNodes,bq=bo&&bo[0];return bq?bh(bq):bp}function bj(bq){var bo=bq.childNodes,bp=bo&&bo[bo.length-1];return bp?bj(bp):bq}var bk,be,bm=this.chart,bn=bm._catRole.select(bm.partData(this.dataPartValue),{visible:!0}),bi=new aL.visual.Scene(null,{panel:this,source:bn}),bf=bm._ruleInfos;if(bf){bk=a4.query(bf).object({name:function(bo){return bo.group.absKey}});be=bm._isFalling;bl(bn,0)}return bi}});a4.type("pvc.WaterfallChart",aL.BarAbstract).init(function(be){this.base(be);var bf=this.parent;bf&&(this._isFalling=bf._isFalling)}).add({_animatable:!0,_isFalling:!0,_ruleInfos:null,_waterColor:p.color("#1f77b4").darker(),_processOptionsCore:function(be){be.stacked=!0;be.baseAxisComposite=!1;this.base(be);be.plot2=!1},_initPlotsCore:function(){var bf=(this.options,new aL.visual.WaterfallPlot(this));this._isFalling="down"===bf.option("Direction");var be=this._isFalling?"FlattenDfsPre":"FlattenDfsPost";this._catRole.setTraversalMode(aL.visual.TraversalMode[be]);this._catRole.setRootLabel(bf.option("AllCategoryLabel"))},_initLegendScenes:function(bf){var bh=this.plots.water,be=aL.makeExtensionAbsId("line",bh.extensionPrefixes),bi=this._getConstantExtension(be,"strokeStyle");bi&&(this._waterColor=p.color(bi));var bg=bf._getBulletRootScene();new aL.visual.legend.WaterfallBulletGroupScene(bg,{extensionPrefix:aL.buildIndexedId("",1),label:bh.option("TotalLineLabel"),color:this._waterColor});this.base(bf)},_reduceStackedCategoryValueExtent:function(bq,bp,bi){var bn,bk=bq?bq.offset:0,bl=bp.min+bp.max;if(!bq){if(bp){bn=bk+bl;this._ruleInfos=[{offset:bn,group:bi,range:bp}];return{min:bp.min,max:bp.max,offset:bn}}return null}var bf=this._isFalling,bm=bi._isFlattenGroup&&!bi._isDegenerateFlattenGroup;if(bm){var bg=-bp.min;if(bg>0){var bo=bk+bg;bo>bq.max&&(bq.max=bo)}var bh=-bp.max;if(0>bh){var be=bk+bh;be<bq.min&&(bq.min=be)}}else{var bj=bf?-1:1;bn=bq.offset=bk+bj*bl;bn>bq.max?bq.max=bn:bn<bq.min&&(bq.min=bn)}this._ruleInfos.push({offset:bf?bk:bq.offset,group:bi,range:bp});return bq},_createPlotPanels:function(be,bf){this.wfChartPanel=new aL.WaterfallPanel(this,be,this.plots.water,a4.create(bf,{waterfall:this.options.waterfall}))}});a4.type("pvc.PointPanel",aL.CategoricalAbstractPanel).init(function(bg,bf,bh,be){this.base(bg,bf,bh,be);this.linesVisible=bh.option("LinesVisible");this.dotsVisible=bh.option("DotsVisible");this.areasVisible=bh.option("AreasVisible");if(!this.linesVisible&&!this.dotsVisible&&!this.areasVisible){this.linesVisible=!0;bh.option.specify({LinesVisible:!0})}this.visualRoles.value=bg.visualRole(bh.option("OrthoRole"))}).add({pvLine:null,pvArea:null,pvDot:null,pvLabel:null,pvScatterPanel:null,_creating:function(){var bf=this.defaultLegendGroupScene();if(bf&&!bf.hasRenderer()){var bg=bf.colorAxis,bi=a4.nullyTo(bg.option("LegendDrawMarker",!0),this.dotsVisible||this.areasVisible),bj=!bi||a4.nullyTo(bg.option("LegendDrawLine",!0),this.linesVisible&&!this.areasVisible);if(bi||bj){var bh={drawMarker:bi,drawRule:bj};if(bi){var be=bg.option("LegendShape",!0);if(this.dotsVisible){be||(be="circle");bh.markerPvProto=new p.Dot().lineWidth(1.5,aL.extensionTag).shapeSize(12,aL.extensionTag)}else{bh.markerPvProto=new Z()}bh.markerShape=be;this._applyV1BarSecondExtensions&&this.chart.extend(bh.markerPvProto,"barSecondDot",{constOnly:!0});this.extend(bh.markerPvProto,"dot",{constOnly:!0})}if(bj){bh.rulePvProto=new p.Line().lineWidth(1.5,aL.extensionTag);this._applyV1BarSecondExtensions&&this.chart.extend(bh.rulePvProto,"barSecondLine",{constOnly:!0});this.extend(bh.rulePvProto,"line",{constOnly:!0})}bf.renderer(new aL.visual.legend.BulletItemDefaultRenderer(bh))}}},_createCore:function(){this.base();var bu=this,br=this.chart,bn=this.stacked,bv=this.dotsVisible,bh=this.areasVisible,bp=this.linesVisible,bl=this.isOrientationVertical()?"bottom":"left",bo=this.axes.base,bi=bo.domainItems(),bs=bo.role.grouping.isDiscrete(),bz=this.visibleData({ignoreNulls:!1}),bA=this._buildScene(bz,bi,bs);this.pvPanel.zOrder(bh?-7:1);this.pvScatterPanel=new aL.visual.Panel(this,this.pvPanel,{extensionId:"panel"}).lock("data",bA.childNodes).pvMark;var bj,bq=bh&&bp&&!bn?0.5:null;this.compatVersion()<=1&&(bj=bn?function(bB){return function(bC){return bB.call(this,bC.vars.value.rawValue)}}:function(bB){return function(bC){var bE={category:bC.vars.category.rawValue,value:bC.vars.value.rawValue},bD=Object.create(this);bD.index=bC.dataIndex;return bB.call(bD,bE)}});var bt=bs&&bn?function(bB){return !bB.isNull||bB.isIntermediate}:function(bB){return !bB.isNull},bw=br.selectableByFocusWindow();this.pvArea=new aL.visual.Area(this,this.pvScatterPanel,{extensionId:"area",noTooltip:!1,wrapper:bj,noSelect:bw,noRubberSelect:!0,showsSelection:!bw}).lockMark("data",function(bB){return bB.childNodes}).lockMark("visible",bt).override("x",function(bB){return bB.basePosition}).override("y",function(bB){return bB.orthoPosition}).override("dy",function(bB){return br.animate(0,bB.orthoLength)}).override("color",function(bC,bB){return bh?this.base(bC,bB):null}).override("baseColor",function(bD,bC){var bB=this.base(bD,bC);!this._finished&&bB&&null!=bq&&(bB=bB.alpha(bq));return bB}).override("dimColor",function(bB,bC){return bn?aL.toGrayScale(bB,1,null,null).brighter():this.base(bB,bC)}).lock("events",bh?"painted":"none").pvMark;var bx=bv&&!bp&&!bh,bf=bn&&bh,be=["line"];this._applyV1BarSecondExtensions&&be.push({abs:"barSecondLine"});var by=!bx&&bt,bk=bh&&!bp;this.pvLine=new aL.visual.Line(this,this.pvArea.anchor(this.anchorOpposite(bl)),{extensionId:be,freePosition:!0,wrapper:bj,noTooltip:bk,noDoubleClick:bk,noClick:bk,noHover:bk,noSelect:bk||bw,showsSelection:!bw}).lockMark("visible",by).override("defaultColor",function(bD,bC){var bB=this.base(bD,bC);!this._finished&&bf&&bB&&(bB=bB.darker(0.6));return bB}).override("normalColor",function(bC,bB){return bp?bB:null}).override("interactiveColor",function(bD,bB,bC){return bp||this.mayShowAnySelected(bD)||this.mayShowActive(bD)?this.base(bD,bB,bC):null}).override("baseStrokeWidth",function(bB){var bC;bp&&(bC=this.base(bB));return null==bC?1.5:bC}).intercept("strokeDasharray",function(bF){var bB=this.delegateExtension();if(void 0===bB){var bC=bF.isInterpolated;if(!bC){var bD=bF.nextSibling;bC=bD&&bD.isIntermediate&&bD.isInterpolated;if(!bC){var bE=bF.previousSibling;bC=bE&&bF.isIntermediate&&bE.isInterpolated}}bB=bC?". ":null}return bB}).pvMark;var bg=!(bh&&bs&&bn);be=["dot"];this._applyV1BarSecondExtensions&&be.push({abs:"barSecondDot"});this.pvDot=new aL.visual.Dot(this,this.pvLine,{extensionId:be,freePosition:!0,wrapper:bj}).intercept("visible",function(bB){return !bB.isNull&&!bB.isIntermediate&&this.delegateExtension(!0)}).override("color",function(bD,bC){if(!bv){var bE=bD.isActive||!bg&&bD.isSingle||bg&&bD.isAlone;if(!bE){return aL.invisibleFill}}var bB=this.base(bD,bC);return bD.isInterpolated&&"fill"===bC?bB&&p.color(bB).brighter(0.5):bB}).override("defaultColor",function(bD,bC){var bB=this.base(bD,bC);!this._finished&&bf&&bB&&(bB=bB.darker(0.6));return bB}).override("baseSize",function(bC){if(!bv){var bD=bC.isActive||!bg&&bC.isSingle||bg&&bC.isAlone;if(bD&&!bC.isActive){var bB=Math.max(bu.pvLine.lineWidth(),0.2)/2;return a4.sqr(bB)}}return bC.isInterpolated?0.8*this.base(bC):this.base(bC)}).pvMark;var bm=aL.visual.ValueLabel.maybeCreate(this,this.pvDot,{wrapper:bj});bm&&(this.pvLabel=bm.pvMark)},renderInteractive:function(){this.pvScatterPanel.render()},_buildScene:function(bA,bk,bq){function bj(bD){for(var bI,bF=[],bB=bD.childNodes,bK=0,bH=null,bJ=0,bL=0,bG=bB.length;bG>bJ;bJ++,bL++){var bC=bB[bL],bE=2*bJ;bF[bE]=bC;bo.call(this,bI,bC,bs&&bs[bE]);bC.isAlone&&!bH&&(bH=bC);bC.isNull||bK++;if(bI){var bM=bh.call(this,bD,bI,bC,bL,bs&&bs[bE-1]);if(bM){bF[bE-1]=bM;bL++}}bI=bC}1===bK&&bH&&1===bG&&(bH.isSingle=!0);bn&&(bs=bF)}function bo(bH,bD,bF){var bC=bD.vars.value.accValue;if(bF){bD.isNull&&!bq?bC=bm:bC+=bF.vars.value.accValue;bD.vars.value.accValue=bC}bD.basePosition=by(bD);bD.orthoPosition=bu;bD.orthoLength=bx(bC)-bu;var bG=!bH||bH.isNull,bB=bG&&!bD.isNull;if(bB){var bE=bD.nextSibling;bB=!bE||bE.isNull}bD.isAlone=bB;bD.isSingle=!1}function bh(bF,bL,bE,bN,bK){var bM=bL.isNull||bE.isNull;if(bM&&!this.areasVisible){return null}var bG,bI,bB;if(bM){if(bK&&bq){var bH=bK.vars.value;bI=bH.accValue;bG=bH[br.name]}else{bG=bI=bm}bB=bn&&bq?bE.basePosition-by.range().step/2:bL.isNull?bE.basePosition:bL.basePosition}else{var bC=bL.vars.value,bJ=bE.vars.value;bG=(bJ.value+bC.value)/2;bI=(bJ.accValue+bC.accValue)/2;bB=(bE.basePosition+bL.basePosition)/2}var bO=new aL.visual.Scene(bF,{index:bN,source:bE.source});bO.dataIndex=bE.dataIndex;bO.vars.category=bE.vars.category;var bD=new Y(bG,bg.format(bG),bG);bD.accValue=bI;bO.vars.value=bD;bO.ownerScene=bE;bO.isInterpolated=bE.isInterpolated;bO.isIntermediate=!0;bO.isSingle=!1;bO.isNull=bM;bO.isAlone=bM&&bE.isNull&&bL.isNull;bO.basePosition=bB;bO.orthoPosition=bu;bO.orthoLength=bx(bI)-bu;bv.onNewScene(bO,!0);return bO}function bi(bE){for(var bF,bC,bD=bE.childNodes,bB=bD.length;bB&&(bF=bD[0]).isNull;){bC=bF.nextSibling;if(bC&&!bC.isNull){break}bE.removeAt(0);bB--}for(;bB&&(bF=bD[bB-1]).isNull;){bC=bF.previousSibling;if(bC&&!bC.isNull){break}bE.removeAt(bB-1);bB--}}var bz=new aL.visual.Scene(null,{panel:this,source:bA}),bp=this.chart,be=this.visualRoles.series,br=this.visualRoles.value,bn=this.stacked,bf=new aL.visual.RoleVarHelper(bz,br,{roleVar:"value",hasPercentSubVar:bn}),bv=new aL.visual.RoleVarHelper(bz,this.visualRoles.color,{roleVar:"color"}),bw=br.firstDimensionName(),bg=bA.owner.dimensions(bw),bt=be.isBound()?be.flatten(this.partData(),{visible:!0,isNull:bp.options.ignoreNulls?!1:null}):null,bx=this.axes.ortho.scale,bm=a4.scope(function(){var bC=bx.domain(),bB=bC[0],bD=bC[1];return bB*bD>=0?bB>=0?bB:bD:0}),bu=bx(bm),by=this.axes.base.sceneScale({sceneVarName:"category"});(bt?bt.children():a4.query([null])).each(function(bB){var bC=new aL.visual.Scene(bz,{source:bB||bA});bC.vars.series=Y.fromComplex(bB);bv.onNewScene(bC,!1);bk.forEach(function(bF,bK){var bJ=bA.child(bF.key),bI=bJ;bI&&bB&&(bI=bI.child(bB.key));var bH=new aL.visual.Scene(bC,{source:bI});bH.dataIndex=bK;bH.vars.category=Y.fromComplex(bJ);bf.onNewScene(bH,!0);var bE=bH.vars.value,bG=bE.value;bE.accValue=null!=bG?bG:bm;bv.onNewScene(bH,!0);var bD=null!=bI&&bI.datums().prop("isInterpolated").any(a4.truthy);bH.isInterpolated=bD;bH.isNull=null==bG;bH.isIntermediate=!1},this)},this);var bs,bl=bz.children().reverse().array();bl.forEach(bj,this);bl.forEach(bi,this);return bz}});a4.type("pvc.PointAbstract",aL.CategoricalAbstract).add({_animatable:!0,_trendable:!0,_processOptionsCore:function(be){be.panelSizeRatio=1;this.base(be)},_hasDataPartRole:function(){return !0},_initVisualRoles:function(){this.base();this._addVisualRole("value",{isMeasure:!0,isRequired:!0,isPercent:this.options.stacked,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"value"})},_initPlotsCore:function(){var bh=this.options,be=this._createPointPlot(),bg=be.option("Trend");if(bh.plot2){var bf=new aL.visual.PointPlot(this,{name:"plot2",fixed:{DataPart:"1"},defaults:{ColorAxis:2,LinesVisible:!0,DotsVisible:!0}});bg||(bg=bf.option("Trend"))}this._trendable=!!bg;bg&&new aL.visual.PointPlot(this,{name:"trend",fixed:{DataPart:"trend",TrendType:"none",ColorRole:"series",NullInterpolatioMode:"none"},defaults:{ColorAxis:2,LinesVisible:!0,DotsVisible:!1}})},_initAxes:function(be){this.base(be);var bf=this.axesByType.base;bf&&bf.forEach(function(bh){var bg="discrete"===bh.scaleType;bg||bh.option.defaults({Offset:0.01})});bf=this.axesByType.ortho;bf&&bf.forEach(function(bg){bg.option.defaults({Offset:0.04})})},_createPlotPanels:function(bg,bi){var bj=this.plots,bf=bj.point;this.scatterChartPanel=new aL.PointPanel(this,bg,bf,Object.create(bi));var bh=bj.plot2;if(bh){aL.debug>=3&&this._log("Creating second Point panel.");new aL.PointPanel(this,bg,bh,Object.create(bi))}var be=bj.trend;if(be){aL.debug>=3&&this._log("Creating Trends Point panel.");new aL.PointPanel(this,bg,be,Object.create(bi))}},defaults:{tooltipOffset:10}});a4.type("pvc.DotChart",aL.PointAbstract).add({_createPointPlot:function(){return new aL.visual.PointPlot(this,{fixed:{DotsVisible:!0}})}});a4.type("pvc.LineChart",aL.PointAbstract).add({_createPointPlot:function(){return new aL.visual.PointPlot(this,{fixed:{LinesVisible:!0}})}});a4.type("pvc.AreaChart",aL.PointAbstract).add({_createPointPlot:function(){return new aL.visual.PointPlot(this,{fixed:{AreasVisible:!0}})}});aL.mStackedLineChart=a4.type("pvc.StackedLineChart",aL.PointAbstract).add({_createPointPlot:function(){return new aL.visual.PointPlot(this,{fixed:{LinesVisible:!0,Stacked:!0}})}});a4.type("pvc.StackedDotChart",aL.PointAbstract).add({_createPointPlot:function(){return new aL.visual.PointPlot(this,{fixed:{DotsVisible:!0,Stacked:!0}})}});aL.mStackedAreaChart=a4.type("pvc.StackedAreaChart",aL.PointAbstract).add({_createPointPlot:function(){return new aL.visual.PointPlot(this,{fixed:{AreasVisible:!0,Stacked:!0},defaults:{LinesVisible:!0}})}});a4.type("pvc.HeatGridPanel",aL.CategoricalAbstractPanel).init(function(bh,bg,bj,be){this.base(bh,bg,bj,be);this.axes.size=bh._getAxis("size",bj.option("SizeAxis")-1);var bf=this.visualRoles,bi=bj.option("SizeRole");bf.size=bh.visualRole(bi);this.useShapes=bj.option("UseShapes");this.shape=bj.option("Shape");this.nullShape=bj.option("NullShape")}).add({defaultBorder:1,nullBorder:2,selectedBorder:2,_createCore:function(){var by=this;by.base();var bg=by._calcCellSize(),bh=by.isOrientationVertical()?"bottom":"left",bt=aL.BasePanel.relativeAnchor[bh],bz=aL.BasePanel.parallelLength[bh],bq=aL.BasePanel.orthogonalLength[bh],bu=by.visualRoles.series.flatten(by.partData(),{visible:!0,isNull:by.chart.options.ignoreNulls?!1:null}),bA=by._buildScene(by.visibleData({ignoreNulls:!1}),bu,bg),bk=bA.isColorBound,bp=bA.isSizeBound,bl=by._buildSignsWrapper(bA),bn=by.compatVersion()<=1,bf=this.axes.base.scale,bj=this.axes.ortho.scale,bv=bf.range().step,bx=bj.range().step,bm=bv/2,br=bx/2,bi=new aL.visual.Panel(by,by.pvPanel).pvMark.data(bA.childNodes)[bh](function(bB){return bj(bB.vars.series.value)-br})[bq](bx),be=["panel"];bn&&be.push("");var bs={extensionId:be,wrapper:bl};if(!by.useShapes){var bw=!1;a4.copy(bs,{noSelect:bw,noHover:bw,noClick:bw,noDoubleClick:bw,freeColor:bw,noTooltip:bn})}by.pvHeatGrid=new aL.visual.Panel(by,bi,bs).pvMark.lock("data",function(bB){return bB.childNodes}).lock(bt,function(bB){return bf(bB.vars.category.value)-bm}).lock(bz,bv).antialias(!1);by.shapes=by.useShapes?by._createShapesHeatMap(bg,bl,bk,bp):by._createNoShapesHeatMap(bk);by.valuesVisible&&!by.valuesMask&&(by.valuesMask=by._getDefaultValuesMask(bk,bp));var bo=aL.visual.ValueLabel.maybeCreate(by,by.pvHeatGrid,{wrapper:bl});bo&&(by.pvHeatGridLabel=bo.pvMark)},_calcCellSize:function(){var bi=this.axes.x.scale,bh=this.axes.y.scale,be=(bi.max-bi.min)/bi.domain().length,bg=(bh.max-bh.min)/bh.domain().length;if(!this.isOrientationVertical()){var bf=be;be=bg;bg=bf}return{width:be,height:bg}},_buildSignsWrapper:function(be){if(this.compatVersion()>1){return null}var bf=a4.query(be.childNodes).object({name:function(bg){return""+bg.vars.series.value},value:function(bg){return a4.query(bg.childNodes).object({name:function(bh){return""+bh.vars.category.value},value:function(bi){var bh=bi.vars.color;return bh?""+bh.value:null}})}});return function(bg){return function(bn){var bj=bf[bn.vars.series.value],bh=bn.vars.category.rawValue,bk=Object.create(this.parent),bm=Object.create(this);bm.parent=bk;var bi=bn.childIndex(),bl=bn.parent.childIndex();bk.index=bi;bm.index=bl;return bg.call(bm,bj,bh)}}},_getDefaultValuesMask:function(bi,bh){var bg=this.visualRoles,be=bi?"color":bh?"size":null;if(be){var bf=bg[be].firstDimensionName();return"{#"+bf+"}"}},_createNoShapesHeatMap:function(bf){var be=this._buildGetBaseFillColor(bf);return this.pvHeatGrid.sign.override("defaultColor",function(bh,bg){return"stroke"===bg?null:be.call(this.pvMark,bh)}).override("interactiveColor",function(bi,bg,bh){return bi.isActive?bg.alpha(0.6):bi.anySelected()&&!bi.isSelected()?this.dimColor(bg,bh):this.base(bi,bg,bh)}).override("dimColor",function(bg){return aL.toGrayScale(bg,0.6)}).pvMark.lineWidth(1.5)},_buildGetBaseFillColor:function(bf){var be=this.axes.color;return bf?be.sceneScale({sceneVarName:"color"}):a4.fun.constant(be.option("Unbound"))},_createShapesHeatMap:function(bl,bk,bj,bi){var bg=this,be=bg._calcDotAreaRange(bl);bi&&bg.axes.size.setScaleRange(be);var bf={extensionId:"dot",freePosition:!0,activeSeriesAware:!1,wrapper:bk,tooltipArgs:bg._buildShapesTooltipArgs(bj,bi)},bh=new aL.visual.DotSizeColor(bg,bg.pvHeatGrid,bf).override("dimColor",function(bm){return aL.toGrayScale(bm,0.6)}).pvMark;bi||bh.sign.override("defaultSize",a4.fun.constant(be.max));return bh},_calcDotAreaRange:function(bk){var bg=bk.width,bh=bk.height,bi=Math.min(bg,bh)/2;"diamond"===this.shape&&(bi/=Math.SQRT2);bi-=2;var bf=a4.sqr(bi),bj=12,be=bf-bj;if(1>=be){bf=Math.max(bf,2);bj=1;be=bf-bj;aL.debug>=2&&this._warn("Using rescue mode dot area calculation due to insufficient space.")}return{min:bj,max:bf,span:be}},_buildShapesTooltipArgs:function(bl,bk){var bj=this.chart;if(this.compatVersion()<=1&&this.showsTooltip()){var bf=bj.options,bi=bf.customTooltip;bi||(bi=function(bm,bo,bn){return null!=bn&&void 0!==bn[0]?bn.join(", "):bn});var bh=this.visualRoles,bg=bh.series.grouping.dimensionNames(),be=bh.category.grouping.dimensionNames();return{buildTooltip:bf.isMultiValued?function(bm){var bp=bm.scene.group;if(!bp){return""}var bn=aL.data.Complex.values(bp,bg),br=aL.data.Complex.values(bp,be),bq=[],bo=bm.scene.vars;bk&&(bq[bf.sizeValIdx||0]=bo.size.value);bl&&(bq[bf.colorValIdx||0]=bo.color.value);return bi.call(bf,bn,br,bq)}:function(bm){var bp=bm.scene.vars,bo=bp.series.rawValue,br=bp.category.rawValue,bn=bp[bl?"color":"size"],bq=bn?bn.value:null;return bi.call(bf,bo,br,bq)}}}},renderInteractive:function(){this.pvPanel.render()},_buildScene:function(bi,bn,be){function bf(bq){var bp=new aL.visual.Scene(bk,{source:bq});bp.vars.series=Y.fromComplex(bq);bj.forEach(function(br){bg.call(bm,bp,br,bq)})}function bg(bp,bt,bq){var bs=bi.child(bt.key).child(bq.key),br=new aL.visual.Scene(bp,{source:bs});br.vars.category=Y.fromComplex(bt);bo.onNewScene(br,!0);bh.onNewScene(br,!0)}var bm=this,bk=new aL.visual.Scene(null,{panel:bm,source:bi}),bj=bi.childNodes,bl=bm.visualRoles,bo=new aL.visual.RoleVarHelper(bk,bl.color,{roleVar:"color"}),bh=new aL.visual.RoleVarHelper(bk,bl.size,{roleVar:"size"});bk.cellSize=be;bn.children().each(bf);return bk}});a4.type("pvc.HeatGridChart",aL.CategoricalAbstract).add({_allowColorPerCategory:!0,_interpolatable:!1,_axisCreateIfUnbound:{color:!0},_processOptionsCore:function(bf){this.base(bf);a4.set(bf,"legend",!1,"panelSizeRatio",1);var bg="value",be="value2";if(this.compatVersion()<=1){switch(this.options.colorValIdx){case 0:bg="value";break;case 1:bg="value2";break;default:bg="value"}switch(this.options.sizeValIdx){case 0:be="value";break;case 1:be="value2";break;default:be="value"}}this._colorDimName=bg;this._sizeDimName=be},_getCategoryRoleSpec:function(){var be=this.base();be.requireIsDiscrete=!0;return be},_getColorRoleSpec:function(){return{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:this._colorDimName}},_initVisualRoles:function(){this.base();this._addVisualRole("size",{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:this._sizeDimName})},_initPlotsCore:function(){new aL.visual.HeatGridPlot(this)},_createPlotPanels:function(bf,bg){var be=this.plots.heatGrid;this.heatGridChartPanel=new aL.HeatGridPanel(this,bf,be,Object.create(bg))},defaults:{colorValIdx:0,sizeValIdx:1,measuresIndexes:[2],axisOffset:0,plotFrameVisible:!1,colorNormByCategory:!0,numSD:2}});a4.type("pvc.MetricXYAbstract",aL.CartesianAbstract).add({_processOptionsCore:function(be){this.base(be);be.panelSizeRatio=1},_initVisualRoles:function(){this.base();this._addVisualRole("x",{isMeasure:!0,isRequired:!0,requireSingleDimension:!0,requireIsDiscrete:!1,defaultDimension:"x",dimensionDefaults:{valueType:this.options.timeSeries?Date:Number}});this._addVisualRole("y",{isMeasure:!0,isRequired:!0,requireSingleDimension:!0,requireIsDiscrete:!1,defaultDimension:"y",dimensionDefaults:{valueType:Number}})},_generateTrendsDataCell:function(bn,bq,bl){function br(bs){var bx=function(by){return by.atoms[bk].value},bw=function(by){return by.atoms[bg].value},bt=bs.datums().sort(null,bx).array(),bv=a4.create(bo,{rows:a4.query(bt),x:bx,y:bw}),bu=bf.model(bv);bu&&bt.forEach(function(bz,bB){var bC=bx(bz);if(bC){var bA=bu.sample(bC,bw(bz),bB);if(null!=bA){var by=a4.set(Object.create(bs.atoms),bk,bC,bg,bA,bj,bp);bn.push(new aL.data.TrendDatum(bm.owner,by,bo))}}})}var be=this._serRole,bi=this.visualRoles.x,bh=bq.role,bo=bq.trend,bf=bo.info;this._warnSingleContinuousValueRole(bh);var bk=bi.firstDimensionName(),bg=bh.firstDimensionName(),bm=this.visibleData(bq.dataPartValue,{baseData:bl}),bp=this._getTrendDataPartAtom(),bj=bp.dimension.name;(be.isBound()?bm.children():a4.query([bm])).each(br,this)}});a4.type("pvc.data.MetricPointChartTranslationOper").add({_meaLayoutRoles:["x","y","color","size"],configureType:function(){var be=[],bh=[];this.collectFreeDiscreteAndConstinuousIndexes(bh,be);var bk,bj=[],bi=be.length;if(bi>0){for(var bg=this._meaLayoutRoles.length,bf=0;bg>bf&&bj.length<bi;){this._getUnboundRoleDefaultDimNames(this._meaLayoutRoles[bf],1,bj);bf++}bk=bj.length;if(bk>0){be.length=bk;this.defReader({names:bj,indexes:be})}}bi=bh.length;if(bi>0){bj.length=0;this._getUnboundRoleDefaultDimNames("series",bi,bj);bk=bj.length;if(bk>0){bh.length=bk;this.defReader({names:bj,indexes:bh})}}}});a4.type("pvc.MetricPointPanel",aL.CartesianAbstractPanel).init(function(bg,bf,bi,be){this.base(bg,bf,bi,be);this.axes.size=bg._getAxis("size",(bi.option("SizeAxis")||0)-1);var bh=bi.option("SizeRole");this.visualRoles.size=bh?bg.visualRole(bh):null;this.linesVisible=bi.option("LinesVisible");this.dotsVisible=bi.option("DotsVisible");if(!this.linesVisible&&!this.dotsVisible){this.linesVisible=!0;bi.option.specify({LinesVisible:!0})}this.offsetPaddings||(this.offsetPaddings=new aD(0.01))}).add({sizeAxisRatio:0.2,sizeAxisRatioTo:"minWidthHeight",autoPaddingByDotSize:!0,_v1DimRoleName:{category:"x",value:"y"},_creating:function(){var be=this.defaultLegendGroupScene();if(be&&!be.hasRenderer()){var bf=be.colorAxis,bh=a4.nullyTo(bf.option("LegendDrawMarker",!0),this.dotsVisible),bi=a4.nullyTo(bf.option("LegendDrawLine",!0),this.linesVisible);if(bh||bi){var bg={drawMarker:bh,drawRule:bi};if(bh){bg.markerShape=bf.option("LegendShape",!0)||"circle";bg.markerPvProto=new p.Dot().lineWidth(1.5,aL.extensionTag).shapeSize(12,aL.extensionTag);this.extend(bg.markerPvProto,"dot",{constOnly:!0})}if(bi){bg.rulePvProto=new p.Line().lineWidth(1.5,aL.extensionTag);this.extend(bg.rulePvProto,"line",{constOnly:!0})}be.renderer(new aL.visual.legend.BulletItemDefaultRenderer(bg))}}},_getRootScene:function(){return a4.lazy(this,"_rootScene",this._buildScene,this)},_calcLayout:function(bf){var be=this._getRootScene();be.isSizeBound&&this.axes.size.setScaleRange(this._calcDotAreaRange(bf));this._calcAxesPadding(bf,be)},_getDotDiameterRefLength:function(bg){var bf=bg.clientSize,be=bg.paddings;switch(this.sizeAxisRatioTo){case"minWidthHeight":return Math.min(bf.width+be.width,bf.height+be.height);case"width":return bf.width+be.width;case"height":return bf.height+be.height}aL.debug>=2&&this._log(a4.format("Invalid option 'sizeAxisRatioTo' value. Assuming 'minWidthHeight'.",[this.sizeAxisRatioTo]));this.sizeRatioTo="minWidthHeight";return this._getDotDiameterRefLength(bg)},_calcDotRadiusRange:function(bh){var bf=this._getDotDiameterRefLength(bh),be=this.sizeAxisRatio/2*bf,bg=Math.sqrt(12);return{min:bg,max:be}},_calcDotAreaRange:function(bh){var bg=this._calcDotRadiusRange(bh);if("diamond"===this.shape){bg.max/=Math.SQRT2;bg.min/=Math.SQRT2}var bf=a4.sqr(bg.max),bi=a4.sqr(bg.min),be=bf-bi;if(1>=be){bf=Math.max(bf,2);bi=1;be=bf-bi;bg={min:Math.sqrt(bi),max:Math.sqrt(bf)};aL.debug>=3&&this._log("Using rescue mode dot area calculation due to insufficient space.")}return{min:bi,max:bf,span:be}},_calcAxesPadding:function(bl,bo){var be;if(this.autoPaddingByDotSize){var bs=this.axes,bm=bl.clientSize,bj=bl.paddings;be={};bs.x.setScaleRange(bm.width);bs.y.setScaleRange(bm.height);var bf=this.isOrientationVertical(),bk=bs.x.sceneScale({sceneVarName:bf?"x":"y"}),br=bs.y.sceneScale({sceneVarName:bf?"y":"x"}),bp=bs.x.scale.max,bi=bs.y.scale.max,bu=bo.isSizeBound,bh=bu?bs.size.scale:null;if(!bh){var bt=a4.number.as(this._getExtension("dot","shapeRadius"),0);if(0>=bt){bt=a4.number.as(this._getExtension("dot","shapeSize"),0);0>=bt&&(bt=12)}else{bt=a4.sqr(bt)}bh=a4.fun.constant(bt)}be={};var bq;if(this.offsetPaddings){bq={};aD.names.forEach(function(bv){var bw=aL.BasePanel.orthogonalLength[bv];bq[bv]=(this.offsetPaddings[bv]||0)*(bm[bw]+bj[bw])},this)}var bg=function(bv,bx){bq&&(bx+=bq[bv]||0);0>bx&&(bx=0);var bw=be[bv];(null==bw||bx>bw)&&(be[bv]=bx)},bn=function(bx){var bv=bk(bx),by=br(bx),bw=Math.sqrt(bh(bu?bx.vars.size.value:0));bg("left",bw-bv);bg("bottom",bw-by);bg("right",bv+bw-bp);bg("top",by+bw-bi)};bo.children().selectMany(function(bv){return bv.childNodes}).each(bn)}else{be=this._calcRequestPaddings(bl)}bl.requestPaddings=be},_createCore:function(){var bj=this;bj.base();var bi=bj.chart,bg=bj._getRootScene(),bf=bj._buildSignsWrapper(),bn=bj.compatVersion()<=1;this._finalizeScene(bg);bj.pvPanel.zOrder(1);this.pvScatterPanel=new aL.visual.Panel(bj,bj.pvPanel,{extensionId:"panel"}).lock("data",bg.childNodes).pvMark;var bh=bi.selectableByFocusWindow(),bl=bg.isColorBound&&this.visualRoles.color.isDiscrete(),bo=new aL.visual.Line(bj,bj.pvScatterPanel,{extensionId:"line",wrapper:bf,noTooltip:!1,noSelect:bh,showsSelection:!bh}).lockMark("data",function(bp){return bp.childNodes}).intercept("visible",function(bp){if(!bj.linesVisible){return !1}var bq=this.delegateExtension();null==bq&&(bq=!bp.isNull&&(!bg.isSizeBound&&!bg.isColorBound||bg.isSizeBound&&null!=bp.vars.size.value||bg.isColorBound&&(bl||null!=bp.vars.color.value)));return bq}).override("x",function(bp){return bp.basePosition}).override("y",function(bp){return bp.orthoPosition});bj.pvLine=bo.pvMark;var be=new aL.visual.DotSizeColor(bj,bj.pvLine,{extensionId:"dot",wrapper:bf,activeSeriesAware:bj.linesVisible}).override("x",function(bp){return bp.basePosition}).override("y",function(bp){return bp.orthoPosition}).override("color",function(bq,bp){return bj.dotsVisible||bq.isActive||bq.isSingle?this.base(bq,bp):aL.invisibleFill});bg.isSizeBound?bj.autoPaddingByDotSize&&"minWidthHeight"===bj.sizeAxisRatioTo||bj.pvPanel.borderPanel.overflow("hidden"):be.override("baseSize",function(bq){if(!bj.dotsVisible&&bq.isSingle){var bp=Math.max(bj.pvLine.scene[this.pvMark.index].lineWidth,0.2)/2;return a4.sqr(bp)}return this.base(bq)});bj.pvDot=be.pvMark;bj.pvDot.rubberBandSelectionMode="center";if(aL.visual.ValueLabel.isNeeded(bj)){var bm=["label"];bn&&bm.push("lineLabel");var bk=aL.visual.ValueLabel.maybeCreate(bj,bj.pvDot,{extensionId:bm,wrapper:bf});bk&&(bj.pvHeatGridLabel=bk.pvMark)}},_buildSignsWrapper:function(){return this.compatVersion()>1?null:function(be){return function(bg){var bh={category:bg.vars.x.rawValue,value:bg.vars.y.rawValue},bf=Object.create(this);bf.index=bg.dataIndex;return be.call(bf,bh)}}},renderInteractive:function(){this.pvScatterPanel.render()},_buildScene:function(){function be(bp){var bo=new aL.visual.Scene(bj,{source:bp});bo.vars.series=Y.fromComplex(bp);bn.onNewScene(bo,!1);bp.datums().each(function(bq,bs){var bu=bq.atoms[bf.name];if(null!=bu.value){var br=bq.atoms[bm.name];if(null!=br.value){var bt=new aL.visual.Scene(bo,{source:bq});bt.dataIndex=bs;bt.vars.x=Y.fromAtom(bu);bt.vars.y=Y.fromAtom(br);bh.onNewScene(bt,!0);bn.onNewScene(bt,!0);bt.isIntermediate=!1}}})}function bg(bs){for(var bv,br=bs.childNodes,bu=0,bq=0,bt=br.length;bt>bu;bu++,bq++){var bp=br[bq];bp.isSingle=!bv&&!bp.nextSibling;if(bv){var bo=bk(bs,bv,bp,bq);bo&&bq++}bv=bp}}function bk(br,bv,bq,bw){var by=+bq.vars.y.value,bu=+bv.vars.y.value,bs=+bq.vars.x.value,bp=+bv.vars.x.value,bt=bm.type.cast.call(null,(by+bu)/2),bo=bf.type.cast.call(null,(bs+bp)/2),bx=new aL.visual.Scene(br,{index:bw,source:bq.datum});bx.dataIndex=bq.dataIndex;bx.vars.x=new Y(bo,bf.format(bo),bo);bx.vars.y=new Y(bt,bm.format(bt),bt);bh.onNewScene(bx,!0);bn.onNewScene(bx,!0);bx.ownerScene=bq;bx.isIntermediate=!0;bx.isSingle=!1;return bx}var bi=this.visibleData({ignoreNulls:!1}),bj=new aL.visual.Scene(null,{panel:this,source:bi}),bl=this.visualRoles,bn=(this.axes,new aL.visual.RoleVarHelper(bj,bl.color,{roleVar:"color"})),bh=new aL.visual.RoleVarHelper(bj,bl.size,{roleVar:"size"}),bf=bi.owner.dimensions(bl.x.firstDimensionName()),bm=bi.owner.dimensions(bl.y.firstDimensionName());bi.children().each(be,this);bj.children().each(bg,this);return bj},_finalizeScene:function(be){var bh=this.axes,bg=bh.base.sceneScale({sceneVarName:"x"}),bf=bh.ortho.sceneScale({sceneVarName:"y"});be.children().selectMany(function(bi){return bi.childNodes}).each(function(bi){bi.basePosition=bg(bi);bi.orthoPosition=bf(bi)});return be}});a4.type("pvc.MetricPointAbstract",aL.MetricXYAbstract).add({_trendable:!0,_initPlotsCore:function(){var be=this._createPointPlot(),bf=be.option("Trend");(this._trendable=!!bf)&&new aL.visual.MetricPointPlot(this,{name:"trend",fixed:{DataPart:"trend",TrendType:"none",NullInterpolatioMode:"none",ColorRole:"series",SizeRole:null,SizeAxis:null,OrthoAxis:1},defaults:{ColorAxis:2,LinesVisible:!0,DotsVisible:!1}})},_hasDataPartRole:function(){return !0},_getColorRoleSpec:function(){return{defaultSourceRole:"series",defaultDimension:"color*",dimensionDefaults:{valueType:Number}}},_initVisualRoles:function(){this.base();this._addVisualRole("size",{isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,defaultDimension:"size",dimensionDefaults:{valueType:Number}})},_getTranslationClass:function(be){return a4.type(this.base(be)).add(aL.data.MetricPointChartTranslationOper)},_createPlotPanels:function(bf,bh){var bg=this.options,bj=a4.set(Object.create(bh),"sizeAxisRatio",bg.sizeAxisRatio,"sizeAxisRatioTo",bg.sizeAxisRatioTo,"autoPaddingByDotSize",bg.autoPaddingByDotSize),bi=this.plots.scatter;this.scatterChartPanel=new aL.MetricPointPanel(this,bf,bi,bj);var be=this.plots.trend;be&&new aL.MetricPointPanel(this,bf,be,Object.create(bj))},defaults:{axisOriginIsZero:!1,tooltipOffset:10}});a4.type("pvc.MetricDotChart",aL.MetricPointAbstract).add({_createPointPlot:function(){return new aL.visual.MetricPointPlot(this,{fixed:{DotsVisible:!0}})}});a4.type("pvc.MetricLineChart",aL.MetricPointAbstract).add({_createPointPlot:function(){return new aL.visual.MetricPointPlot(this,{fixed:{LinesVisible:!0}})}});a4.type("pvc.BulletChart",aL.BaseChart).init(function(bf){bf=bf||{};var be=bf.dimensionGroups||(bf.dimensionGroups={}),bh=be.range||(be.range={});void 0===bh.valueType&&(bh.valueType=Number);var bg=be.marker||(be.marker={});void 0===bg.valueType&&(bg.valueType=Number);this.base(bf)}).add({bulletChartPanel:null,allowNoData:!0,_processOptionsCore:function(be){be.legend=!1;be.selectable=!1;this.base(be)},_initVisualRoles:function(){this.base();this._addVisualRole("title",{defaultDimension:"title*"});this._addVisualRole("subTitle",{defaultDimension:"subTitle*"});this._addVisualRole("value",{isMeasure:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"value*"});this._addVisualRole("marker",{isMeasure:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"marker*"});this._addVisualRole("range",{isMeasure:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"range*"})},_createTranslation:function(be){var bg=this.base(be),bf=bg.virtualItemSize();if(bf){switch(bf){case 1:bg.defReader({names:"value"});break;case 2:bg.defReader({names:["title","value"]});break;case 3:bg.defReader({names:["title","value","marker"]});break;default:bg.defReader({names:["title","subTitle","value","marker"]});bf>4&&bg.defReader({names:"range",indexes:p.range(4,bf)})}}return bg},_initPlotsCore:function(){new aL.visual.BulletPlot(this)},_createContent:function(be){var bf=this.plots.bullet;this.bulletChartPanel=new aL.BulletChartPanel(this,this.basePanel,bf,be)},defaults:{compatVersion:1,orientation:"horizontal",bulletSize:30,bulletSpacing:50,bulletMargin:100,bulletTitle:"Title",bulletSubtitle:"",bulletTitlePosition:"left",tooltipFormat:function(bf,bg,be){return this.chart.options.valueFormat(be)},crosstabMode:!1,seriesInRows:!1}});a4.type("pvc.BulletChartPanel",aL.PlotPanel).add({pvBullets:null,pvBullet:null,data:null,onSelectionChange:null,_createCore:function(bf){var bu,be,bm,bp,br,bk,bg,bl,bq,bn=this.chart,bt=bn.options,bj=this.buildData(),bi="horizontal"==bt.orientation?"left":"bottom";if("horizontal"==bt.orientation){bu=bf.clientSize.width-this.chart.options.bulletMargin-20;be=0;switch(bt.bulletTitlePosition){case"top":bg=this.chart.options.bulletMargin;bp=0;bm="left";br=-12;bq=parseInt(bt.titleSize/2,10);break;case"bottom":bg=this.chart.options.bulletMargin;bp=0;bm="left";br=bt.bulletSize+32;bq=0;break;case"right":bg=5;bp=bu+5;bm="left";br=parseInt(bt.bulletSize/2,10);bq=0;break;case"left":default:bg=this.chart.options.bulletMargin;bp=0;br=parseInt(bt.bulletSize/2,10);bm="right";bq=0}bk="bottom";bl=function(){return this.index*(bt.bulletSize+bt.bulletSpacing)+bq}}else{bu=bf.clientSize.height-this.chart.options.bulletMargin-20;switch(bt.bulletTitlePosition){case"top":bg=this.chart.options.bulletMargin;bp=0;bm="left";br=-20;be=0;bl=void 0;break;case"bottom":bg=this.chart.options.bulletMargin;bp=0;bm="left";br=bu+20;be=0;bl=20;break;case"right":bg=5;bp=this.chart.options.bulletSize+40;bm="left";br=bu;be=-Math.PI/2;bl=void 0;break;case"left":default:bg=this.chart.options.bulletMargin;bp=-12;br=this.height-this.chart.options.bulletMargin-20;bm="left";be=-Math.PI/2;bl=void 0}bk="right";bg=function(){return bt.bulletMargin+this.index*(bt.bulletSize+bt.bulletSpacing)}}this.pvBullets=this.pvPanel.add(p.Panel).data(bj)[aL.BasePanel.orthogonalLength[bi]](bu)[aL.BasePanel.parallelLength[bi]](this.chart.options.bulletSize).margin(20).left(bg).top(bl);this.pvBullet=this.pvBullets.add(p.Layout.Bullet).orient(bi).ranges(function(bv){return bv.ranges}).measures(function(bv){return bv.measures}).markers(function(bv){return bv.markers});if(bn.clickable()&&this.clickAction){var bo=this;this.pvBullet.cursor("pointer").event("click",function(bx){var bv=bx.title,by=bx.subtitle,bw=p.event;return bo.clickAction(bv,by,bx.measures,bw)})}this.pvBulletRange=this.pvBullet.range.add(p.Bar);this.pvBulletMeasure=this.pvBullet.measure.add(p.Bar).text(function(bv,bw){return bw.formattedMeasures[this.index]});this.pvBulletMarker=this.pvBullet.marker.add(p.Dot).shape("square").fillStyle("white").text(function(bv,bw){return bw.formattedMarkers[this.index]});if(this.showsTooltip()){var bs=this;this.pvBulletMeasure.localProperty("tooltip").tooltip(function(bv,bx){var bw=bx.title,by=bx.subtitle;return bn.options.tooltipFormat.call(bs,bw,by,bv)});this.pvBulletMarker.localProperty("tooltip").tooltip(function(bv,bx){var bw=bx.title,by=bx.subtitle;return bn.options.tooltipFormat.call(bs,bw,by,bv)});this.pvBulletMeasure.event("mouseover",p.Behavior.tipsy(this.chart._tooltipOptions));this.pvBulletMarker.event("mouseover",p.Behavior.tipsy(this.chart._tooltipOptions))}this.pvBulletRule=this.pvBullet.tick.add(p.Rule);this.pvBulletRuleLabel=this.pvBulletRule.anchor(bk).add(p.Label).text(this.pvBullet.x.tickFormat);this.pvBulletTitle=this.pvBullet.anchor(bi).add(p.Label).font("bold 12px sans-serif").textAngle(be).left(-10).textAlign(bm).textBaseline("bottom").left(bp).top(br).text(function(bv){return bv.formattedTitle});this.pvBulletSubtitle=this.pvBullet.anchor(bi).add(p.Label).textStyle("#666").textAngle(be).textAlign(bm).textBaseline("top").left(bp).top(br).text(function(bv){return bv.formattedSubtitle});var bh="function"==typeof bt.axisDoubleClickAction?function(bw,bv){bt.axisDoubleClickAction(bw,bv)}:null;if(bn.doubleClickable()&&bh){this.pvBulletTitle.cursor("pointer").events("all").event("dblclick",function(bv){bh(bv,arguments[arguments.length-1])});this.pvBulletSubtitle.cursor("pointer").events("all").event("dblclick",function(bv){bh(bv,arguments[arguments.length-1])})}},applyExtensions:function(){this.base();this.extend(this.pvBullets,"bulletsPanel");this.extend(this.pvBullet,"bulletPanel");this.extend(this.pvBulletRange,"bulletRange");this.extend(this.pvBulletMeasure,"bulletMeasure");this.extend(this.pvBulletMarker,"bulletMarker");this.extend(this.pvBulletRule,"bulletRule");this.extend(this.pvBulletRuleLabel,"bulletRuleLabel");this.extend(this.pvBulletTitle,"bulletTitle");this.extend(this.pvBulletSubtitle,"bulletSubtitle")},_getExtensionId:function(){return[{abs:"content"}].concat(this.base())},buildData:function(){var bk,bn=this.chart,br=bn.options,bm=bn.visualRoles.title,bo=bm.grouping,bp=bn.visualRoles.subTitle,bq=bp.grouping,be=bn.visualRoles.value,bj=be.grouping,bh=bn.visualRoles.marker,bg=bh.grouping,bf=bn.visualRoles.range,bl=bf.grouping,bi={title:br.bulletTitle,formattedTitle:br.bulletTitle,subtitle:br.bulletSubtitle,formattedSubtitle:br.bulletSubtitle,ranges:a4.array.to(br.bulletRanges)||[],measures:a4.array.to(br.bulletMeasures)||[],markers:a4.array.to(br.bulletMarkers)||[]};a4.set(bi,"formattedRanges",bi.ranges.map(String),"formattedMeasures",bi.measures.map(String),"formattedMarkers",bi.markers.map(String));bk=bj||bo||bg||bq||bl?bn.data.datums().select(function(bt){var bs,bu=Object.create(bi);if(bj){bs=bj.view(bt);bu.measures=bs.values();bu.formattedMeasures=bs.labels()}if(bo){bs=bo.view(bt);bu.title=bs.value;bu.formattedTitle=bs.label}if(bq){bs=bq.view(bt);bu.subtitle=bs.value;bu.formattedSubtitle=bs.label}if(bg){bs=bg.view(bt);bu.markers=bs.values();bu.formattedMarkers=bs.labels()}if(bl){bs=bl.view(bt);bu.ranges=bs.values();bu.formattedRanges=bs.labels()}return bu},this).array():[bi];return bk}});a4.type("pvc.ParallelCoordinates",aL.BaseChart).init(function(be){be=be||{};be.dimensions=be.dimensions||{};be.dimensions.value||(be.dimensions.value={valueType:null});this.base(be)}).add({parCoordPanel:null,_createContent:function(be){this.parCoordPanel=new aL.ParCoordPanel(this,this.basePanel,a4.create(be,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,sortCategorical:this.options.sortCategorical,mapAllDimensions:this.options.mapAllDimensions,numDigits:this.options.numDigits}))},defaults:a4.create(aL.BaseChart.prototype.defaults,{compatVersion:1,topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,sortCategorical:!0,mapAllDimensions:!0,numDigits:0})});a4.type("pvc.ParCoordPanel",aL.BasePanel).add({anchor:"fill",pvParCoord:null,dimensions:null,dimensionDescr:null,data:null,retrieveData:function(){var bD=this.chart.data,bw=this.chart.options.numDigits;this.dimensions=bD.getVisibleCategories();var bh=bD.getValues(),bf=bD.getVisibleSeriesIndexes(),bi=bD.getVisibleCategoriesIndexes(),bn=bD.getCategories(),bt=bi.map(this.chart.options.mapAllDimensions?function(bG){return isNaN(bh[bG][0])?{categorical:!0,len:0,map:[]}:{categorical:!1,len:0,map:[],displayValue:[]}}:function(bG){return isNaN(bh[bG][0])?{categorical:!0,len:0,map:[]}:null}),bj=function(bJ,bK){var bI=bt[bJ],bH=null;if(bI.categorical){bH=bI.map[bK];if(null==bH){bH=bI.len;bI.len++;bI.map[bK]=bH}}else{var bG=bK.toFixed(bw);bH=bI.map[bG];if(null==bH){bH=bI.len;bI.len++;bI.map[bG]=bH;bI.displayValue[bG]=bK}}return bH};for(var bC in bt){bt.hasOwnProperty(bC)&&bt[bC]&&bt[bC].categorical&&(bt[bC].displayValue=bt[bC].map)}var bz,bB,by;if(this.chart.options.sortCategorical||this.chart.options.mapAllDimensions){for(bz=0;bz<bt.length;bz++){if(bt[bz]){for(var bl=0;bl<bh[bz].length;bl++){bj(bz,bh[bz][bl])}var bE=bt[bz].map,be=[];for(bB in bE){bE.hasOwnProperty(bB)&&be.push(bB)}be.sort();if(bt[bz].categorical){for(by=0;by<be.length;by++){bE[be[by]]=by}}else{for(by=0;by<be.length;by++){bE[be[by]].index=by}}}}}var bk=function(bI){var bG={};for(var bH in bi){bi.hasOwnProperty(bH)&&(bG[bn[bH]]=bt[bH]?bj(bH,bh[bH][bI]):bh[bH][bI])}return bG};this.data=bf.map(function(bG){return bk(bG)});var bo=this.dimensions.map(function(bG){var bH={},bI=bG.split("__");bH.id=bG;bH.name=bI[0];bH.unit=bI.length>1?bI[1]:"";return bH});for(bz=0;bz<bo.length;bz++){bB=bo[bz];var bm=bi[bz];bB.orgRowIndex=bm;var bq,bu,bs,bp,br,bA=bh[bm].length;if(bt[bm]){bq=bu=bs=bp=bt[bm].displayValue[bh[bm][0]];for(by=1;bA>by;by++){br=bt[bm].displayValue[bh[bm][by]];if(bq>br){bs=bq;bq=br}if(br>bu){bp=bu;bu=br}}}else{bq=bu=bs=bp=bh[bm][0];for(by=1;bA>by;by++){br=bh[bm][by];if(bq>br){bs=bq;bq=br}if(br>bu){bp=bu;bu=br}}}var bg=(bu-bp+(bs-bq))/2;bB.min=bq;bB.max=bu;bB.step=bg;bB.categorical=!1;if(bt[bm]){bB.map=bt[bm].map;bB.mapLength=bt[bm].len;bB.categorical=bt[bm].categorical;if(!bB.categorical){bB.orgValue=[];var bx=bt[bm].map;for(var bF in bx){bx.hasOwnProperty(bF)&&(bB.orgValue[bx[bF]]=0+bF)}}}}var bv=function(bI,bJ){for(var bG={},bH=0;bH<bI.length;bH++){bG[bI[bH]]=bJ[bH]}return bG};this.dimensionDescr=bv(this.dimensions,bo)},_createCore:function(){function bo(bM){var bL=bM.dim;bv[bL].min=Math.max(bq[bL].domain()[0],bq[bL].invert(bx-bM.y-bM.dy));bv[bL].max=Math.min(bq[bL].domain()[1],bq[bL].invert(bx-bM.y));bl=bL;bu.render();return !1}function bJ(bM){if(bM.dy<3){var bL=bM.dim;bv[bL].min=Math.max(bq[bL].domain()[0],bq[bL].invert(0));bv[bL].max=Math.min(bq[bL].domain()[1],bq[bL].invert(bx));bM.y=be;bM.dy=bn;bl=bL;bu.render()}return !1}var bz=this;this.retrieveData();var bx=this.height,bC=this.chart.options.numDigits,br=this.chart.options.topRuleOffset,be=this.chart.options.botRuleOffset,bK=this.chart.options.leftRuleOffset,bj=this.width-this.chart.options.rightRuleOffset,bh=this.height-br,bn=bh-be,bg=br-12,bA=this.dimensions,bI=this.dimensionDescr,bk=function(bL,bN){var bO=bI[bL].min,bM=bI[bL].max,bP=bI[bL].step;if(bN){bO-=bP;bM+=bP}return p.Scale.linear(bO,bM).range(be,bh)},bG=function(bM){var bO=bk(bM,!0).range(be,bh),bL=bI[bM];if(bL.orgValue&&!bL.categorical){var bN=function(bP){var bQ=bO(bL.orgValue[bP]);return bQ};bN.domain=function(){return bO.domain()};bN.invert=function(bP){return bO.invert(bP)};return bN}return bO},bs=function(bL){var bM=bk(bL,!1).range("steelblue","brown");return bM},bt=p.Scale.ordinal(bA).splitFlush(bK,bj),bq=p.dict(bA,bG),bp=p.dict(bA,bs),bv=p.dict(bA,function(bL){return{min:bq[bL].domain()[0],max:bq[bL].domain()[1]}}),bl=bA[0],by=this.chart.options.mapAllDimensions?function(bL){return bA.every(function(bN){var bM=bI[bN],bO=bM.orgValue&&!bM.categorical?bM.orgValue[bL[bN]]:bL[bN];return bO>=bv[bN].min&&bO<=bv[bN].max})}:function(bL){return bA.every(function(bM){return bL[bM]>=bv[bM].min&&bL[bM]<=bv[bM].max})};this.pvParCoord=this.pvPanel.add(p.Panel).data(bz.data).visible(by).add(p.Line).data(bA).left(function(bL){return bt(bL)}).bottom(function(bM,bN){var bL=bq[bM](bN[bM]);return bL}).strokeStyle("#ddd").lineWidth(1).antialias(!1);var bm=this.pvPanel.add(p.Rule).data(bA).left(bt).top(br).bottom(be);bm.anchor("top").add(p.Label).top(bg).font("bold 10px sans-serif").text(function(bL){return bI[bL].name});var bF=[],bw=6,bf=3;for(var bE in bI){if(bI.hasOwnProperty(bE)){var bD=bI[bE];if(bD.categorical){var bi=bt(bD.id)+bw;for(var bB in bD.map){bD.map.hasOwnProperty(bB)&&(bF[bF.length]={x:bi,y:bq[bD.id](bD.map[bB])+bf,label:bB})}}}}var bu=(this.pvPanel.add(p.Panel).data(bF).add(p.Label).left(function(bL){return bL.x}).bottom(function(bL){return bL.y}).text(function(bL){return bL.label}).textAlign("left"),this.pvPanel.add(p.Panel)),bH=(bu.add(p.Panel).data(bz.data).visible(by).add(p.Line).data(bA).left(function(bL){return bt(bL)}).bottom(function(bL,bM){return bq[bL](bM[bL])}).strokeStyle(function(bM,bO){var bL=bI[bl],bN=bL.orgValue&&!bL.categorical?bL.orgValue[bO[bl]]:bO[bl];return bp[bl](bN)}).lineWidth(1),bu.add(p.Panel).data(bA.map(function(bL){return{y:be,dy:bn,dim:bL}})).left(function(bL){return bt(bL.dim)-30}).width(60).fillStyle("rgba(0,0,0,.001)").cursor("crosshair").event("mousedown",p.Behavior.select()).event("select",bo).event("selectend",bJ).add(p.Bar).left(25).top(function(bL){return bL.y}).width(10).height(function(bL){return bL.dy}).fillStyle(function(bL){return bL.dim==bl?bp[bL.dim]((bv[bL.dim].max+bv[bL.dim].min)/2):"hsla(0,0,50%,.5)"}).strokeStyle("white").cursor("move").event("mousedown",p.Behavior.drag()).event("dragstart",bo).event("drag",bo));bH.anchor("bottom").add(p.Label).textBaseline("top").text(function(bL){return bI[bL.dim].categorical?"":bv[bL.dim].min.toFixed(bC)+bI[bL.dim].unit});bH.anchor("top").add(p.Label).textBaseline("bottom").text(function(bL){return bI[bL.dim].categorical?"":bv[bL.dim].max.toFixed(bC)+bI[bL.dim].unit});this.extend(this.pvParCoord,"parCoord");this.extend(this.pvPanel,"chart")}});a4.type("pvc.DataTree",aL.BaseChart).init(function(be){be=be||{};be.dimensionGroups=be.dimensionGroups||{};be.dimensionGroups.value||(be.dimensionGroups.value={valueType:null});this.base(be)}).add({structEngine:null,structMetadata:null,structDataset:null,DataTreePanel:null,_getColorRoleSpec:function(){return{isRequired:!0,defaultSourceRole:"category",requireIsDiscrete:!0}},setStructData:function(be){this.structDataset=be.resultset;this.structDataset.length||this._log("Warning: Structure-dataset is empty");this.structMetadata=be.metadata;this.structMetadata.length||this._log("Warning: Structure-Metadata is empty")},_createContent:function(bh){var be=this.structEngine,bf=be?be.type:new aL.data.ComplexType();bf.addDimension("value",{});var bg={seriesInRows:!0,crosstabMode:!0},bi=new aL.data.CrosstabTranslationOper(bf,this.structDataset,this.structMetadata,bg);bi.configureType();be||(be=this.structEngine=new aL.data.Data({type:bf}));be.load(bi.execute(be));aL.debug>=3&&this._log(this.structEngine.getInfo());this.dataTreePanel=new aL.DataTreePanel(this,this.basePanel,a4.create(bh,{topRuleOffset:this.options.topRuleOffset,botRuleOffset:this.options.botRuleOffset,leftRuleOffset:this.options.leftRuleOffset,rightRuleOffset:this.options.rightRuleOffset,boxplotColor:this.options.boxplotColor,valueFontsize:this.options.valueFontsize,headerFontsize:this.options.headerFontsize,border:this.options.border,perpConnector:this.options.perpConnector,numDigits:this.options.numDigits,minVerticalSpace:this.options.minVerticalSpace,connectorSpace:this.options.connectorSpace,minAspectRatio:this.options.minAspectRatio}))},defaults:{compatVersion:1,topRuleOffset:30,botRuleOffset:30,leftRuleOffset:60,rightRuleOffset:60,boxplotColor:"grey",headerFontsize:16,valueFontsize:20,border:2,perpConnector:!1,numDigits:0,connectorSpace:0.15,minVerticalSpace:0.05,minAspectRatio:2}});a4.type("pvc.DataTreePanel",aL.PlotPanel).add({pvDataTree:null,treeElements:null,structMap:null,structArr:null,hRules:null,vRules:null,rules:null,generatePerpConnectors:function(bm){this.hRules=[];this.vRules=[];this.rules=[];for(var bj in this.structMap){var bf=this.structMap[bj];if(null!=bf.children){var bg=10000,bl=-10000,bk=bf.left+bf.width;this.hRules.push({left:bk,width:bm,bottom:bf.bottom+bf.height/2});bk+=bm;for(var bh in bf.children){var be=this.structMap[bf.children[bh]],bi=be.bottom+be.height/2;bi>bl&&(bl=bi);bg>bi&&(bg=bi);this.hRules.push({left:bk,width:be.left-bk,bottom:bi})}bl>bg&&this.vRules.push({left:bk,bottom:bg,height:bl-bg})}}},generateLineSegment:function(bg,bi,bf,bh){var be=[];be.push({x:bg,y:bi});be.push({x:bf,y:bh});this.rules.push(be)},generateConnectors:function(bo){this.hRules=[];this.vRules=[];if(this.chart.options.perpConnector){this.generatePerpConnectors(bo)}else{this.rules=[];for(var bl in this.structMap){var bg=this.structMap[bl];if(null!=bg.children){var bk,be,bj,bi=10000,bm=-10000;for(bj in bg.children){be=this.structMap[bg.children[bj]];bk=be.bottom+be.height/2;bk>bm&&(bm=bk);bi>bk&&(bi=bk)}var bn=(bm+bi)/2,bh=bg.left+bg.width,bf=bh+bo;this.generateLineSegment(bh,bg.bottom+bg.height/2,bf,bn);for(bj in bg.children){be=this.structMap[bg.children[bj]];bk=be.bottom+be.height/2;this.generateLineSegment(bf,bn,be.left,bk)}}}}},retrieveStructure:function(){var bx=this.chart.structEngine,bh=this.chart.options,bn=bx.getVisibleCategories();this.treeElements=bx.getVisibleSeries();var bu,bf=bx.getValues(),bp=bn.length>4;for(bu in this.treeElements){this.treeElements[bu]=$.trim(this.treeElements[bu])}var bl=[];bl.getElement=function(bz){null==bl[bz]&&(bl[bz]={min:10000,max:-10000});return bl[bz]};bl.addValue=function(bA,bB){var bz=bl.getElement(bA);bB<bz.min&&(bz.min=bB);bB>bz.max&&(bz.max=bB);return bz};var bj,bm,bv,bk;for(bu in this.treeElements){bv=this.treeElements[bu];bj=bv[0];bm=bj.charCodeAt(0);bk=parseInt(bv.slice(1),10);bl.addValue("__cols",bm);bl.addValue(bj,bk)}var be=bl.getElement("__cols"),bs=this.innerWidth/(be.max-be.min+1),bw=bh.connectorSpace*bs,br=bs-bw,by=br/bh.minAspectRatio,bt=be.min;delete bl.__cols;for(bu in bl){be=bl[bu];if("function"!=typeof be){var bg=be.max-be.min+1;be.gridHeight=this.innerHeight/bg;be.cellHeight=be.gridHeight*(1-bh.minVerticalSpace);be.cellHeight>by&&(be.cellHeight=by);be.relBottom=(be.gridHeight-be.cellHeight)/2;be.numRows=bg}}var bq=new RegExp("[\\s\"']+","g");this.structMap={};for(bu in this.treeElements){var bo={};bv=this.treeElements[bu];bo.box_id=bv;this.structMap[bv]=bo;bj=bv[0];bm=bj.charCodeAt(0);bk=parseInt(bv.slice(1),10);be=bl.getElement(bj);bo.colIndex=bm-bt;bo.rowIndex=be.numRows-(bk-be.min)-1;bo.left=this.leftOffs+bo.colIndex*bs;bo.width=br;if(bp){bo.bottom=bf[4][bu];bo.height=bf[5][bu]}else{bo.bottom=this.botOffs+bo.rowIndex*be.gridHeight+be.relBottom;bo.height=be.cellHeight}bo.label=bf[0][bu];bo.selector=bf[1][bu];bo.aggregation=bf[2][bu];var bi=(bf[3][bu]||"").replace(bq," ");bo.children=" "===bi||""===bi?null:bi.split(" ")}this.generateConnectors((bs-br)/2);this.structArr=[];for(bu in this.structMap){bv=this.structMap[bu];this.structArr.push(bv)}},findDataValue:function(bf,bg){for(var be=0;be<bg[0].length;be++){if(bg[0][be]==bf){return bg[1][be]}}this._log("Error: value with key : "+bf+" not found.")},generateBoxPlots:function(){var bo=this.chart.options;for(var bj in this.structArr){var bf=this.structArr[bj];if(bf.values.length){bf.subplot={};var be=bf.subplot,bm=[],bh=15,bk=bf.width/6;be.hRules=[];be.vRules=[];be.marks=[];be.labels=[];bm.push(this.findDataValue("_p5",bf.values));bm.push(this.findDataValue("_p25",bf.values));bm.push(this.findDataValue("_p50",bf.values));bm.push(this.findDataValue("_p75",bf.values));bm.push(this.findDataValue("_p95",bf.values));var bn=!1;if("undefined"!=typeof bm[2]){if(bm[4]<bm[0]){bm=bm.reverse();this._log(" dataset "+bf.box_id+" repaired (_p95 was smaller than _p5)")}if(bm[4]>bm[0]){be.hScale=p.Scale.linear(bm[0],bm[4])}else{bn=!0;be.hScale=p.Scale.linear(bm[0]-1e-10,bm[0]+1e-10)}be.hScale.range(bf.left+bk,bf.left+bf.width-bk);var bi,bg=""+bm[2];for(bi=0;bi<bm.length;bi++){bm[bi]=be.hScale(bm[bi])}be.bot=bf.bottom+bf.height/3;be.top=bf.bottom+2*bf.height/3;be.mid=(be.top+be.bot)/2;be.textBottom=bf.bottom+bh;be.textBottom=be.bot-bo.valueFontsize-1;var bl=3;if(bn){be.vRules.push({left:bm[0],bottom:be.bot,lWidth:bl,height:be.top-be.bot})}else{be.hRules.push({left:bm[0],width:bm[1]-bm[0],lWidth:1,bottom:be.mid});be.hRules.push({left:bm[1],width:bm[3]-bm[1],lWidth:1,bottom:be.bot});be.hRules.push({left:bm[1],width:bm[3]-bm[1],lWidth:1,bottom:be.top});be.hRules.push({left:bm[3],width:bm[4]-bm[3],lWidth:1,bottom:be.mid});for(bi=0;bi<bm.length;bi++){be.vRules.push({left:bm[bi],bottom:be.bot,lWidth:2==bi?bl:1,height:be.top-be.bot})}}be.labels.push({left:bm[2],bottom:be.textBottom,text:this.labelFixedDigits(bg),size:bo.smValueFont,color:bo.boxplotColor})}}}},labelFixedDigits:function(be){"string"==typeof be&&(be=parseFloat(be));if("number"==typeof be){var bf=this.chart.options.numDigits;be=be.toFixed(bf)}return""+be},addDataPoint:function(bg){var bf=this.chart.options;for(var bl in this.structArr){var bi=this.structArr[bl];if(bi.values.length){var bk=this.findDataValue(bg,bi.values);if("undefined"!=typeof bk){var bj=bi.subplot,be=bj.hScale(bk),bh="green";bj.marks.push({left:be,bottom:bj.mid,color:bh});bj.labels.push({left:be,bottom:bj.textBottom,text:this.labelFixedDigits(bk),size:bf.valueFont,color:bh})}}}},retrieveData:function(){var bm,bl=this.chart.data,bs=this.chart.options,bp=(bl.getVisibleCategories(),bl.getVisibleSeries()),bq=bl.getValues(),bk={},bh=bq.length;for(var bo in this.structArr){var bg=this.structArr[bo];bg.values=[];for(bm=0;bh>bm;bm++){bg.values.push([])}bk[bg.selector]=bg}var bj={};for(bm in bp){var bn=bk[bp[bm]];if("undefined"!=typeof bn){for(var bi in bq){bn.values[bi].push(bq[bi][bm])}}else{bj[bp[bm]]=!0}}for(var bf in bj){this._log("Could'nt find box for selector: "+bf)}this.generateBoxPlots();var be=new RegExp("[\\s\"']+","g");if(bs.selectParam){var br=bs.selectParam.replace(be,"");if("undefined"!=br&&br.length>0&&"undefined"!=typeof window[br]){br=window[br];this.addDataPoint(br)}}},_createCore:function(){var bk=this,bm=this.chart.options;bm.smValueFontsize=Math.round(0.6*bm.valueFontsize);bm.smValueFont=""+bm.smValueFontsize+"px sans-serif";bm.valueFont=""+bm.valueFontsize+"px sans-serif";var bj=bm.topRuleOffset,be=bm.botRuleOffset,bi=bm.leftRuleOffset;this.innerWidth=this.width-bi-bm.rightRuleOffset;this.innerHeight=this.height-bj-be;this.botOffs=be;this.leftOffs=bi;this.retrieveStructure();this.retrieveData();var bf,bg=bm.headerFontsize+3,bl=this.rules;for(bf=0;bf<bl.length;bf++){this.pvPanel.add(p.Line).data(bl[bf]).left(function(bn){return bn.x}).bottom(function(bn){return bn.y}).lineWidth(1).strokeStyle("black")}this.pvDataTree=this.pvPanel.add(p.Bar).data(bk.structArr).left(function(bn){return bn.left}).bottom(function(bn){return bn.bottom}).height(function(bn){return bn.height}).width(function(bn){return bn.width}).fillStyle("green").add(p.Bar).left(function(bn){return bn.left+bm.border}).bottom(function(bn){return bn.bottom+bm.border}).height(function(bn){return bn.height-bm.border-bg}).width(function(bn){return bn.width-2*bm.border}).fillStyle("white").add(p.Label).text(function(bn){return bn.label}).textAlign("center").left(function(bn){return bn.left+bn.width/2}).bottom(function(bn){return bn.bottom+bn.height-bm.headerFontsize-5+bm.headerFontsize/5}).font(""+bm.headerFontsize+"px sans-serif").textStyle("white").fillStyle("blue");for(bf=0;bf<this.structArr.length;bf++){var bh=this.structArr[bf];this.pvPanel.add(p.Rule).data(bh.subplot.hRules).left(function(bn){return bn.left}).width(function(bn){return bn.width}).bottom(function(bn){return bn.bottom}).lineWidth(function(bn){return bn.lWidth}).strokeStyle(bk.chart.options.boxplotColor);this.pvPanel.add(p.Rule).data(bh.subplot.vRules).left(function(bn){return bn.left}).height(function(bn){return bn.height}).bottom(function(bn){return bn.bottom}).lineWidth(function(bn){return bn.lWidth}).strokeStyle(bk.chart.options.boxplotColor);this.pvPanel.add(p.Dot).data(bh.subplot.marks).left(function(bn){return bn.left}).bottom(function(bn){return bn.bottom}).fillStyle(function(bn){return bn.color});this.pvPanel.add(p.Label).data(bh.subplot.labels).left(function(bn){return bn.left}).bottom(function(bn){return bn.bottom}).font(function(bn){return bn.size}).text(function(bn){return bn.text}).textAlign("center").textStyle(function(bn){return bn.color})}if(bm.perpConnector){this.pvPanel.add(p.Rule).data(bk.vRules).left(function(bn){return bn.left}).bottom(function(bn){return bn.bottom}).height(function(bn){return bn.height}).strokeStyle("black");this.pvPanel.add(p.Rule).data(bk.hRules).left(function(bn){return bn.left}).bottom(function(bn){return bn.bottom}).width(function(bn){return bn.width}).strokeStyle("black")}},applyExtensions:function(){this.extend(this.pvDataTree,"dataTree")}});a4.type("pvc.data.BoxplotChartTranslationOper").add({_configureTypeCore:function(){var bg=[],be=[],bf=[];this.collectFreeDiscreteAndConstinuousIndexes(bf,be);this._getUnboundRoleDefaultDimNames("category",bf.length,bg);a4.query(aL.BoxplotChart.measureRolesNames).take(be.length).each(function(bh){this._getUnboundRoleDefaultDimNames(bh,1,bg)},this);bg.length&&this.defReader({names:bg})}});a4.type("pvc.BoxplotPanel",aL.CategoricalAbstractPanel).init(function(bg,bf,bh,be){this.base(bg,bf,bh,be);this.boxSizeRatio=bh.option("BoxSizeRatio");this.maxBoxSize=bh.option("BoxSizeMax")}).add({plotType:"box",anchor:"fill",_v1DimRoleName:{value:"median"},_createCore:function(){function bg(bq,bp){var bo=this.base(bq,bp);return"stroke"===bp?bo.darker(1):bo}function bl(bo){bo.lock(bi,function(){return this.pvMark.parent[bk]()/2}).override("defaultColor",bg);return bo}function bm(bo){bo.lockMark(bi,function(bp){return bp.vars.category.boxLeft}).lockMark(bk,function(bp){return bp.vars.category.boxWidth});return bo}function bj(bo){bm(bo);bo.override("defaultColor",bg);return bo}this.base();var bh=this._buildScene(),bf=this.isOrientationVertical()?"bottom":"left",bi=this.anchorOrtho(bf),bk=this.anchorLength(bf),be=this.anchorOrthoLength(bf),bn=["panel"];this.compatVersion()<=1&&bn.push("");this.pvBoxPanel=new aL.visual.Panel(this,this.pvPanel,{extensionId:bn}).lock("data",bh.childNodes).lockMark(bi,function(bp){var bo=bp.vars.category;return bo.x-bo.width/2}).pvMark[bk](function(bo){return bo.vars.category.width});this.pvRuleWhiskerUpper=bl(new aL.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleWhisker",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,showsInteraction:!0})).intercept("visible",function(bo){return bo.vars.category.showRuleWhiskerUpper&&this.delegateExtension(!0)}).pvMark.lock(bf,function(bo){return bo.vars.category.ruleWhiskerUpperBottom}).lock(be,function(bo){return bo.vars.category.ruleWhiskerUpperHeight});this.pvRuleWhiskerLower=bl(new aL.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleWhisker",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,showsInteraction:!0})).intercept("visible",function(bo){return bo.vars.category.showRuleWhiskerBelow&&this.delegateExtension(!0)}).pvMark.lock(bf,function(bo){return bo.vars.category.ruleWhiskerLowerBottom}).lock(be,function(bo){return bo.vars.category.ruleWhiskerLowerHeight});this.pvBar=bm(new aL.visual.Bar(this,this.pvBoxPanel,{extensionId:"boxBar",freePosition:!0,normalStroke:!0})).intercept("visible",function(bo){return bo.vars.category.showBox&&this.delegateExtension(!0)}).lockMark(bf,function(bo){return bo.vars.category.boxBottom}).lockMark(be,function(bo){return bo.vars.category.boxHeight}).override("defaultColor",bg).override("defaultStrokeWidth",a4.fun.constant(1)).pvMark;this.pvRuleMin=bj(new aL.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleMin",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,showsInteraction:!0})).intercept("visible",function(bo){return null!=bo.vars.minimum.value&&this.delegateExtension(!0)}).pvMark.lock(bf,function(bo){return bo.vars.minimum.position});this.pvRuleMax=bj(new aL.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleMax",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,showsInteraction:!0})).intercept("visible",function(bo){return null!=bo.vars.maximum.value&&this.delegateExtension(!0)}).pvMark.lock(bf,function(bo){return bo.vars.maximum.position});this.pvRuleMedian=bj(new aL.visual.Rule(this,this.pvBoxPanel,{extensionId:"boxRuleMedian",freePosition:!0,noHover:!1,noSelect:!1,noClick:!1,noDoubleClick:!1,showsInteraction:!0})).intercept("visible",function(bo){return null!=bo.vars.median.value&&this.delegateExtension(!0)}).lockMark(bf,function(bo){return bo.vars.median.position}).override("defaultStrokeWidth",a4.fun.constant(2)).pvMark},renderInteractive:function(){this.pvBoxPanel.render()},_buildScene:function(){function bm(bq){var br=new aL.visual.Scene(bh,{source:bq}),bt=br.vars;bt.series=new Y(null,"");var bu=bt.category=new Y(bq.value,bq.label);a4.set(bu,"group",bq,"x",bj(bq.value),"width",be,"boxWidth",bi,"boxLeft",be/2-bi/2);bl.measureVisualRoles().forEach(function(bE){var bD,bC=bf[bE.name];if(bC){var bB=bq.dimensions(bC),bA=bB.value(bn);bD=new Y(bA,bB.format(bA));bD.position=bk(bA)}else{bD=new Y(null,"");bD.position=null}bt[bE.name]=bD});bo.onNewScene(br,!0);var bp,bv,by=null!=bt.minimum.value,bs=null!=bt.lowerQuartil.value,bx=null!=bt.median.value,bz=null!=bt.upperQuartil.value,bw=bs||bz;if(bw){bp=bs?bt.lowerQuartil.position:bx?bt.median.position:bt.upperQuartil.position;bv=bz?bt.upperQuartil.position:bx?bt.median.position:bt.lowerQuartil.position;bw=bv!==bp;if(bw){bu.boxBottom=bp;bu.boxHeight=bv-bp}}bu.showBox=bw;bw=null!=bt.maximum.value;if(bw){bp=bz?bt.upperQuartil.position:bx?bt.median.position:bs?bt.lowerQuartil.position:by?bt.minimum.position:null;bw=null!=bp;if(bw){bu.ruleWhiskerUpperBottom=bp;bu.ruleWhiskerUpperHeight=bt.maximum.position-bp}}bu.showRuleWhiskerUpper=bw;bw=by;if(bw){bv=bs?bt.lowerQuartil.position:bx?bt.median.position:bz?bt.upperQuartil.position:null;bw=null!=bv;if(bw){bp=bt.minimum.position;bu.ruleWhiskerLowerHeight=bv-bp;bu.ruleWhiskerLowerBottom=bp}}bu.showRuleWhiskerBelow=bw}var bl=this.chart,bf=a4.query(bl.measureVisualRoles()).object({name:function(bp){return bp.name},value:function(bp){return bp.firstDimensionName()}}),bn={visible:!0,zeroIfNone:!1},bg=this.visibleData({ignoreNulls:!1}),bh=new aL.visual.Scene(null,{panel:this,source:bg}),bj=this.axes.base.scale,be=bj.range().band,bi=Math.min(be*this.boxSizeRatio,this.maxBoxSize),bk=this.axes.ortho.scale,bo=new aL.visual.RoleVarHelper(bh,this.visualRoles.color,{roleVar:"color"});bg.children().each(bm,this);return bh}});a4.type("pvc.BoxplotChart",aL.CategoricalAbstract).add({_processOptionsCore:function(be){this.base.apply(this,arguments);be.stacked=!1},_initVisualRoles:function(){this.base();var be={isMeasure:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number};[{name:"median",label:"Median",defaultDimension:"median",isRequired:!0},{name:"lowerQuartil",label:"Lower Quartil",defaultDimension:"lowerQuartil"},{name:"upperQuartil",label:"Upper Quartil",defaultDimension:"upperQuartil"},{name:"minimum",label:"Minimum",defaultDimension:"minimum"},{name:"maximum",label:"Maximum",defaultDimension:"maximum"}].forEach(function(bf){this._addVisualRole(bf.name,a4.create(be,bf))},this)},_getTranslationClass:function(be){return a4.type(this.base(be)).add(aL.data.BoxplotChartTranslationOper)},_initPlotsCore:function(){new aL.visual.BoxPlot(this);if(this.options.plot2){this._animatable=!0;new aL.visual.PointPlot(this,{name:"plot2",defaults:{LinesVisible:!0,DotsVisible:!0,OrthoRole:"median",ColorAxis:2},fixed:{OrthoAxis:1}})}},_initAxes:function(be){this.base(be);var bf=this.axesByType.ortho;bf&&bf.forEach(function(bg){bg.option.defaults({Offset:0.02})})},_createPlotPanels:function(be,bi){var bk=this.plots,bh=bk.box,bg=new aL.BoxplotPanel(this,be,bh,Object.create(bi));this.bpChartPanel=bg;var bf=bk.plot2;if(bf){aL.debug>=3&&this._log("Creating Point panel.");var bj=new aL.PointPanel(this,be,bf,Object.create(bi));bj._v1DimRoleName.value=bf.option("OrthoRole")}},defaults:{crosstabMode:!1}}).addStatic({measureRolesNames:["median","lowerQuartil","upperQuartil","minimum","maximum"]});a4.type("pvc.visual.TreemapDiscreteColorAxis",aL.visual.ColorAxis).init(function(bh,bg,be,bf){this.base(bh,bg,be,bf);this.isByParent="byparent"===bh.plots.treemap.option("ColorMode")}).add({domainItemValueProp:function(){return this.role&&this.role.grouping.isSingleDimension?"value":"absKey"},domainGroupOperator:function(){return"select"},_calcAvgColor:function(bh){var bf=bh.length;if(bf>1){var bk=0,bj=0,be=0,bg=0;bh.forEach(function(bn){var bm=bn.rgb();bk+=bm.r;bj+=bm.g;be+=bm.b;bg+=bm.a});var bl=Math.floor;return p.rgb(bl(bk/bf),bl(bj/bf),bl(be/bf),bl(bg/bf))}var bi=bh[0];return bf?bi.darker(0.7):bi},_getBaseScheme:function(){var bj=this,bf=function(bl){return null!=bl.value},bh=function(bl){return bl.children().where(bf)},be=function(bl){return bh(bl).any()},bk=function(bl){return bh(bl).any(be)},bi=a4.query(this.domainData().nodes()).where(bk).array(),bg=bj.option("Colors");return function(br){var bm=br instanceof Array?br:a4.array.copy(arguments),bp=a4.query(bi).object({name:function(bu){return bj.domainItemValue(bu)}});a4.array.removeIf(bm,function(bu){return a4.hasOwnProp.call(bp,bu)});var bq=bg(bm),bs={},bt=function(bu){var bx,bw=bj.domainItemValue(bu);if(a4.hasOwnProp.call(bp,bw)){bx=a4.getOwn(bs,bw);if(!bx){var bv=bh(bu).select(bt).array();if(!bv.length){throw a4.assert("Should have at least one child that is also a parent.")}bx=bs[bw]=bj._calcAvgColor(bv)}}else{bx=bq(bw)}return bx};bi.forEach(bt);var bo=function(bu){return a4.getOwn(bs,bu)||bq(bu)};a4.copy(bo,bq);var bl,bn;bo.domain=function(){if(arguments.length){throw a4.error.operationInvalid("The scale cannot be modified.")}return bl||(bl=a4.array.append(a4.ownKeys(bs),bm))};bo.range=function(){if(arguments.length){throw a4.error.operationInvalid("The scale cannot be modified.")}return bn||(bn=a4.array.append(a4.own(bs),bq.range()))};return bo}},_selectDomainItems:function(bj){var bi=a4.query(bj.nodes()),bf=function(bk){return null!=bk.value},bh=function(bk){return bk.children().where(bf)},be=function(bk){return bh(bk).any()},bg=function(bk){return !be(bk)};return bi.where(this.isByParent?function(bk){return bk.parent?bf(bk)&&be(bk):bg(bk)||bh(bk).any(bg)}:function(bk){return(!bk.parent||bf(bk))&&bg(bk)})}});a4.type("pvc.data.TreemapChartTranslationOper").add({_configureTypeCore:function(){var bg=[],be=[],bf=[];this.collectFreeDiscreteAndConstinuousIndexes(bf,be);var bh=bf.length,bi=be.length;bh&&this._getUnboundRoleDefaultDimNames("category",bh,bg);bi&&a4.query(["size","color"]).take(bi).each(function(bj){this._getUnboundRoleDefaultDimNames(bj,1,bg)},this);bg.length&&this.defReader({names:bg})}});a4.type("pvc.TreemapPanel",aL.PlotPanel).init(function(bg,bf,bh,be){this.base(bg,bf,bh,be);this.axes.size=bg._getAxis("size",(bh.option("SizeAxis")||0)-1);this.visualRoles.size=bg.visualRole(bh.option("SizeRole"));this.layoutMode=bh.option("LayoutMode")}).add({_createCore:function(bh){var bm=this,bl=bh.clientSize,bj=bm._buildScene();if(bj){if(!bj.childNodes.length&&!this.visualRoles.multiChart.isBound()){throw new InvalidDataException("Unable to create a treemap chart, please check the data values.")}var bq=a4.number.to(bm._getConstantExtension("leaf","lineWidth"),1),bg=bq,bp=bg/2,bi=bm.visualRoles.size.isBound()?bm.axes.size.scale.by1(function(br){return br.vars.size.value}):100,be=bm.pvTreemapPanel=new aL.visual.Panel(bm,bm.pvPanel,{panelType:p.Layout.Treemap,extensionId:"panel"}).pvMark.lock("visible",!0).lock("nodes",bj.nodes()).lock("left",bp).lock("top",bp).lock("width",bl.width-bg).lock("height",bl.height-bg).lock("size",bi).lock("mode",bm.layoutMode).lock("order",null).lock("round",!1);be.node.left(function(br){return br.x+bp}).top(function(br){return br.y+bp}).width(function(br){return br.dx-bg}).height(function(br){return br.dy-bg});var bk,bf=bm.axes.color;bk=bm.visualRoles.color.isBound()?bf.sceneScale({sceneVarName:"color"}):a4.fun.constant(bf.option("Unbound"));var bo=new aL.visual.Bar(bm,be.leaf,{extensionId:"leaf"}).lockMark("visible").override("defaultColor",function(br){return bk(br)}).override("defaultStrokeWidth",function(){return bq}).pvMark.antialias(!1).lineCap("round").strokeDasharray(function(br){return br.vars.size.value<0?"dash":null});new aL.visual.Bar(bm,be.node,{extensionId:"ascendant",noHover:!0,noSelect:!0,noClick:!0,noDoubleClick:!0}).intercept("visible",function(br){return !!br.parent&&!!br.firstChild&&this.delegateExtension(!0)}).override("anyInteraction",function(br){return br.anyInteraction()||br.isActiveDescendantOrSelf()}).override("defaultStrokeWidth",function(){return 1.5*bg}).override("interactiveStrokeWidth",function(bs,br){this.showsActivity()&&bs.isActiveDescendantOrSelf()&&(br=1.5*Math.max(1,br));return br}).override("defaultColor",function(br){return bk(br)}).override("normalColor",a4.fun.constant(null)).override("interactiveColor",function(bt,br,bs){if("stroke"===bs){if(this.showsActivity()){if(bt.isActiveDescendantOrSelf()){return p.color(br).brighter(0.5)}if(bt.anyActive()){return null}}if(this.showsSelection()&&bt.isSelectedDescendantOrSelf()){return p.color(br).brighter(0.5)}}return null}).pvMark.antialias(!1);var bn=aL.visual.ValueLabel.maybeCreate(bm,be.label,{noAnchor:!0});bn&&bn.pvMark.textMargin(3).sign.optional("textAngle",function(bs){var bt=this.defaultText(bs),br=this.pvMark;return bs.dx-2*br.textMargin()>p.Text.measureWidth(bt,br.font())?0:bs.dx>=bs.dy?0:-Math.PI/2}).override("calcTextFitInfo",function(bv,bz){var bu=this.pvMark,bA=bu.textMargin();if(!(-0.000001>bA)){var bt=bu.textAngle();isHorizText=Math.abs(Math.sin(bt))<0.000001,isVertiText=!isHorizText&&Math.abs(Math.cos(bt))<0.000001;if(isHorizText||isVertiText){var by,bw=!1,bs=p.Text.measure(bz,bu.font()),br=0.75*bs.height,bx=bv[isVertiText?"dx":"dy"];"middle"!==bu.textBaseline()&&(bx/=2);bx-=2*bA;bw|=br>bx;var by=bv[isVertiText?"dy":"dx"];"center"!==bu.textAlign()&&(by/=2);by-=2*bA;bw|=0>=by||this.hideOverflowed&&bs.width>by;return{hide:bw,widthMax:by}}}}).override("getAnchoredToMark",function(){return bo})}},_getExtensionId:function(){var be=[{abs:this.chart.parent?"smallContent":"content"}];return be.concat(this.base())},renderInteractive:function(){this.pvTreemapPanel.render()},_buildScene:function(){var bl=this.visibleData({ignoreNulls:!1});if(!bl.childCount()){return null}var bj=this.visualRoles,bk=new aL.visual.Scene(null,{panel:this,source:bl}),be=new aL.visual.RoleVarHelper(bk,bj.size,{roleVar:"size",allowNestedVars:!0,hasPercentSubVar:!0}),bg=bj.size.isBound(),bi=bj.color&&bj.color.grouping,bf=bi&&"byparent"===this.plot.option("ColorMode"),bh=function(bp){var bo=bp.group;bp.vars.category=Y.fromComplex(bo);be.onNewScene(bp,!0);if(bg&&!bp.vars.size.value){bp.parentNode&&bp.parentNode.removeChild(bp);return bp}var bn=bo.children().where(function(br){return null!=br.value}).array();if(bi){var bm=bf&&!bn.length?bo.parent:bo;if(bm){var bq=bi.view(bm);bp.vars.color=new Y(bq.keyTrimmed(),bq.label)}else{bp.vars.color=new Y(null,"")}}else{bp.parent||(bp.vars.color=new Y(null,""))}bn.length&&bn.forEach(function(br){bh(new aL.visual.Scene(bp,{source:br}))});return bp};return bh(bk)}});a4.type("pvc.TreemapChart",aL.BaseChart).add({_animatable:!1,_axisClassByType:{size:aL.visual.NormalizedAxis},_axisCreateIfUnbound:{color:!0},_getColorRoleSpec:function(){return{defaultSourceRole:"category",defaultDimension:"color*"}},_initVisualRoles:function(){this.base();this._addVisualRole("category",{isRequired:!0,defaultDimension:"category*",autoCreateDimension:!0});this._addVisualRole("size",{isMeasure:!0,isRequired:!1,isPercent:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"size"})},_getTranslationClass:function(be){return a4.type(this.base(be)).add(aL.data.TreemapChartTranslationOper)},_getIsNullDatum:a4.fun.constant(),_initPlotsCore:function(){var be=new aL.visual.TreemapPlot(this);null==this.options.legend&&(this.options.legend="byparent"===be.option("ColorMode"));var bf=be.option("RootCategoryLabel");this.visualRoles.category.setRootLabel(bf);this.visualRoles.color.setRootLabel(bf)},_initAxes:function(be){if(this.visualRoles.color.isDiscrete()){a4.hasOwnProp.call(this,"_axisClassByType")||(this._axisClassByType=Object.create(this._axisClassByType));this._axisClassByType.color=aL.visual.TreemapDiscreteColorAxis}else{delete this._axisClassByType}return this.base(be)},_createContent:function(bf){this.base();var be=this.plots.treemap;new aL.TreemapPanel(this,this.basePanel,be,bf)},_createVisibleData:function(bf,be){return this.visualRoles.category.select(bf,be)},defaults:{legend:null}});a4.type("pvc.visual.SunburstDiscreteColorAxis",aL.visual.ColorAxis).add({_getOptionsDefinition:function(){return P},domainItemValueProp:function(){return this.role&&this.role.grouping.isSingleDimension?"value":"absKey"},domainGroupOperator:function(){return"select"},_selectDomainItems:function(bg){var bf=a4.query(bg.nodes()),be=function(bh){return null!=bh.value};return bf.where(function(bh){return bh.parent?be(bh)&&!bh.parent.parent:!1})}});var P=a4.create(f,{SliceBrightnessFactor:{resolve:"_resolveFull",cast:aL.castNonNegativeNumber,value:1}});a4.type("pvc.visual.SunburstSlice",aL.visual.Sign).init(function(bf,bh,bg){var be=bh.add(p.Wedge);bg=a4.setDefaults(bg,"freeColor",!1);this.base(bf,be,bg);this._bindProperty("lineWidth","strokeWidth")}).prototype.property("strokeWidth").constructor.add({defaultStrokeWidth:a4.fun.constant(0.5),interactiveStrokeWidth:function(be,bf){return this.showsActivity()&&be.isActiveDescendantOrSelf()?2*Math.max(1,bf):bf},defaultColor:function(be){return be.color},normalColor:function(bg,be,bf){return be&&"stroke"===bf?be.darker():be},interactiveColor:function(bg,be,bf){if(this.showsActivity()){if("stroke"===bf){if(bg.isActiveDescendantOrSelf()){return be.brighter(2).alpha(0.7)}}else{if(bg.isActive){return be.brighter(0.2).alpha(0.8)}}}return this.mayShowNotAmongSelected(bg)?this.dimColor(be,bf):this.normalColor(bg,be,bf)}});a4.type("pvc.data.SunburstChartTranslationOper").add({_configureTypeCore:function(){var bg=[],be=[],bf=[];this.collectFreeDiscreteAndConstinuousIndexes(bf,be);var bh=bf.length,bi=be.length;bh&&this._getUnboundRoleDefaultDimNames("category",bh,bg);bi&&this._getUnboundRoleDefaultDimNames("size",1,bg);bg.length&&this.defReader({names:bg})}});a4.type("pvc.SunburstPanel",aL.PlotPanel).init(function(bg,bf,bh,be){this.base(bg,bf,bh,be);this.axes.size=bg._getAxis("size",(bh.option("SizeAxis")||0)-1);this.visualRoles.size=bg.visualRole(bh.option("SizeRole"));this.sliceOrder=bh.option("SliceOrder");this.emptySlicesVisible=bh.option("EmptySlicesVisible");this.emptySlicesLabel=this.emptySlicesVisible?bh.option("EmptySlicesLabel"):""}).add({_createCore:function(bi){var bl=this._getConstantExtension("label","font");a4.string.is(bl)&&(this.valuesFont=bl);var bh=this,bg=(bi.clientSize,bh._buildScene());if(bg){if(!bg.childNodes.length&&!this.visualRoles.multiChart.isBound()){throw new InvalidDataException("Unable to create a sunburst chart, please check the data values.")}var bk=bh.visualRoles.size.isBound()?bh.axes.size.scale.by1(function(bm){return bm.vars.size.value}):a4.fun.constant(100),be=bh.pvSunburstPanel=new aL.visual.Panel(bh,bh.pvPanel,{panelType:p.Layout.Partition.Fill,extensionId:"panel"}).pvMark.lock("visible",!0).lock("nodes",bg.nodes()).lock("size",bk).lock("orient","radial"),bj=new aL.visual.SunburstSlice(this,be.node,{extensionId:"slice",tooltipArgs:{options:{useCorners:!0,gravity:function(){var bo=this.midAngle(),bn=Math.cos(bo)>=0,bm=Math.sin(bo)>=0;return bn?bm?"nw":"sw":bm?"ne":"se"}}}}),bf=aL.visual.ValueLabel.maybeCreate(bh,be.label,{noAnchor:!0});bf&&bf.override("defaultText",function(bm){return bm.isRoot()?"":this.base(bm)}).override("calcTextFitInfo",function(bC,bx){var bE=this.pvMark,bo=bE.textMargin();if(!(-0.000001>bo)&&"center"===bE.textAlign()&&bx){var bm=aL.normAngle(bC.midAngle),bB=aL.normAngle(bE.textAngle()),by=Math.abs(bm-bB)<0.000001,bp=!1;if(!by){var bA=aL.normAngle(bB+Math.PI);bp=Math.abs(bm-bA)<0.000001}if(by||bp){var bs,br=bC.innerRadius,bv=br,bt=bC.outerRadius,bo=bE.textMargin(),bD=bC.angle,bz=p.Text.measure(bx,bE.font()),bw=!1;if(bD<Math.PI){var bq=0.85*bz.height,bu=bE.textBaseline(),bn="middle"===bu?bq+bo/2:2*(bq+3*bo/2);bv=Math.max(bv,bn/(2*Math.tan(bD/2)))}bs=bt-bo-bv;bw|=0>=bs;bs-=bo;bw|=this.hideOverflowed&&bz.width>bs;return{hide:bw,widthMax:bs}}}}).override("getAnchoredToMark",function(){return bj.pvMark})}},_getExtensionId:function(){var be=[{abs:this.chart.parent?"smallContent":"content"}];return be.concat(this.base())},renderInteractive:function(){this.pvSunburstPanel.render()},_buildScene:function(){var bk=this.visibleData({ignoreNulls:!1}),bo=this.emptySlicesVisible,br=this.emptySlicesLabel;if(!bk.childCount()){return null}var bp,bn=this.visualRoles,bl=new aL.visual.SunburstScene(null,{panel:this,source:bk}),bq=bn.size.isBound(),bi=new aL.visual.RoleVarHelper(bl,bn.size,{roleVar:"size",allowNestedVars:!0,hasPercentSubVar:!0}),bm=bn.color&&bn.color.grouping,bg=this.axes.color,bf=bg.option("SliceBrightnessFactor");bp=bn.color.isBound()?bg.sceneScale({sceneVarName:"color"}):a4.fun.constant(bg.option("Unbound"));var bh=function(bv){var bu=bv.group,bt=bv.vars.category=Y.fromComplex(bu);br&&null==bt.value&&(bt.value=br);bi.onNewScene(bv,!0);if(bq&&!bv.vars.size.value){bv.parentNode&&bv.parentNode.removeChild(bv);return bv}var bs=bu.children();bo||(bs=bs.where(function(bx){return null!=bx.value}));if(bm){var bw=bm.view(bu);bv.vars.color=new Y(bw.keyTrimmed(),bw.label)}else{bv.vars.color=new Y(null,"")}bs.each(function(bx){bh(new aL.visual.SunburstScene(bv,{source:bx}))});return bv},bj=function(bx,bs,bw){var by=null,bu=bx.parent;if(bu){by=bp(bx);if(by&&!bu.isRoot()){by=bu.color;by&&bs&&bf&&(by=by.brighter(bf*bs/(bw-1)))}}bx.color=by;var bt=bx.childNodes,bv=bt.length;bt.forEach(function(bA,bz){bj(bA,bz,bv)})};bh(bl);if(this.sliceOrder&&bq&&"none"!==this.sliceOrder){var be="bysizeascending"===this.sliceOrder?a4.ascending:a4.descending;bl.sort(function(bt,bs){return be(bt.vars.size.value,bs.vars.size.value)||a4.ascending(bt.childIndex(),bs.childIndex())})}bj(bl,0);return bl}});a4.type("pvc.visual.SunburstScene",aL.visual.Scene).add({_createSelectedInfo:function(){var bf=this.chart().data.owner.selectedCount()>0,be=bf&&this.datums().all(z);return{any:bf,is:be}}});a4.type("pvc.SunburstChart",aL.BaseChart).add({_animatable:!1,_axisClassByType:{size:aL.visual.NormalizedAxis},_axisCreateIfUnbound:{color:!0},_getColorRoleSpec:function(){return{defaultSourceRole:"category",defaultDimension:"color*",requireIsDiscrete:!0}},_initVisualRoles:function(){this.base();this._addVisualRole("category",{isRequired:!0,defaultDimension:"category*",autoCreateDimension:!0});this._addVisualRole("size",{isMeasure:!0,isRequired:!1,isPercent:!0,requireSingleDimension:!0,requireIsDiscrete:!1,valueType:Number,defaultDimension:"size"})},_getTranslationClass:function(be){return a4.type(this.base(be)).add(aL.data.SunburstChartTranslationOper)},_getIsNullDatum:a4.fun.constant(),_initPlotsCore:function(){var be=new aL.visual.SunburstPlot(this);this.options.legend=!1;var bf=be.option("RootCategoryLabel");this.visualRoles.category.setRootLabel(bf);this.visualRoles.color.setRootLabel(bf)},_initAxes:function(be){a4.hasOwnProp.call(this,"_axisClassByType")||(this._axisClassByType=Object.create(this._axisClassByType));this._axisClassByType.color=aL.visual.SunburstDiscreteColorAxis;return this.base(be)},_createContent:function(bf){this.base();var be=this.plots.sunburst;new aL.SunburstPanel(this,this.basePanel,be,bf)},_createVisibleData:function(bf,be){return this.visualRoles.category.select(bf,be)}});return aL}(def,pv);