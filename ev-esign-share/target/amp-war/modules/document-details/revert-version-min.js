(function(){Alfresco.module.RevertVersion=function(j){this.name="Alfresco.module.RevertVersion";this.id=j;var i=Alfresco.util.ComponentManager.get(this.id);if(i!==null){throw new Error("An instance of Alfresco.module.RevertVersion already exists.")}Alfresco.util.ComponentManager.register(this);Alfresco.util.YUILoaderHelper.require(["button","container","datatable","datasource"],this.onComponentsLoaded,this);return this};Alfresco.module.RevertVersion.prototype={defaultShowConfig:{nodeRef:null,filename:null,version:null,onRevertVersionComplete:null},showConfig:{},widgets:{},onComponentsLoaded:function f(){if(this.id===null){return}},show:function e(i){this.showConfig=YAHOO.lang.merge(this.defaultShowConfig,i);if(this.showConfig.nodeRef===undefined&&this.showConfig.filename===undefined&&this.showConfig.version===undefined){throw new Error("A nodeRef, filename and version must be provided")}if(this.widgets.panel){this._showPanel()}else{Alfresco.util.Ajax.request({url:Alfresco.constants.URL_SERVICECONTEXT+"modules/document-details/revert-version?htmlid="+this.id,successCallback:{fn:this.onTemplateLoaded,scope:this},failureMessage:"Could not load html revert template",execScripts:true})}},onTemplateLoaded:function b(i){var k=YAHOO.util.Dom;var m=document.createElement("div");m.innerHTML=i.serverResponse.responseText;var j=YAHOO.util.Dom.getFirstChild(m);this.widgets.panel=Alfresco.util.createYUIPanel(j);this.widgets.headerText=k.get(this.id+"-header-span");this.widgets.nodeRef=k.get(this.id+"-nodeRef-hidden");this.widgets.version=k.get(this.id+"-version-hidden");this.widgets.description=YAHOO.util.Dom.get(this.id+"-description-textarea");this.widgets.minorVersion=YAHOO.util.Dom.get(this.id+"-minorVersion-radioButton");this.widgets.okButton=Alfresco.util.createYUIButton(this,"ok-button",null,{type:"submit"});this.widgets.cancelButton=Alfresco.util.createYUIButton(this,"cancel-button",this.onCancelButtonClick);var l=new Alfresco.forms.Form(this.id+"-revertVersion-form");this.widgets.form=l;l.setSubmitElements(this.widgets.okButton);l.doBeforeFormSubmit={fn:function(){this.widgets.cancelButton.set("disabled",true);this.widgets.panel.hide();this.widgets.feedbackMessage=Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("message.reverting",this.name,{"0":this.showConfig.filename,"1":this.showConfig.version}),spanClass:"wait",displayTime:0})},obj:null,scope:this};l.setAJAXSubmit(true,{successCallback:{fn:this.onRevertSuccess,scope:this},failureCallback:{fn:this.onRevertFailure,scope:this}});l.setSubmitAsJSON(true);l.applyTabFix();l.init();this._showPanel()},onRevertSuccess:function d(i){this.widgets.feedbackMessage.destroy();this.widgets.okButton.set("disabled",false);YAHOO.Bubbling.fire("versionReverted",{nodeRef:this.showConfig.nodeRef,filename:this.showConfig.filename,version:this.showConfig.version});var j={successful:[{nodeRef:this.showConfig.nodeRef,version:this.showConfig.version}]};var k=this.showConfig.onRevertVersionComplete;if(k&&typeof k.fn=="function"){k.fn.call((typeof k.scope=="object"?k.scope:this),j,k.obj)}},onRevertFailure:function g(i){this.widgets.feedbackMessage.destroy();Alfresco.util.PopupManager.displayMessage({text:Alfresco.util.message("message.failure",this.name,{"0":this.showConfig.filename})})},onCancelButtonClick:function a(){this.widgets.panel.hide();this.widgets.okButton.set("disabled",false)},_applyConfig:function c(){var i=YAHOO.util.Dom;var j=Alfresco.util.message("header.revert",this.name,{"0":this.showConfig.filename,"1":this.showConfig.version});this.widgets.headerText.innerHTML=j;this.widgets.cancelButton.set("disabled",false);this.widgets.nodeRef.value=this.showConfig.nodeRef;this.widgets.version.value=this.showConfig.version},_showPanel:function h(){this.widgets.description.value="";this.widgets.minorVersion.checked=true;this._applyConfig();this.widgets.panel.show()}}})();Alfresco.module.getRevertVersionInstance=function(){var a="alfresco-revertVersion-instance";return Alfresco.util.ComponentManager.get(a)||new Alfresco.module.RevertVersion(a)};